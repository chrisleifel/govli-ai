<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Govli AI - Government Workflow & Security Platform</title>
    <link rel="stylesheet" href="/dist/output.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* PROFESSIONAL BLUE OCEAN COLOR SCHEME */
        :root {
            /* NEW PROFESSIONAL BLUE OCEAN PALETTE */
            --deep-ocean: #0a1628;
            --ocean-dark: #0c4a6e;
            --ocean-primary: #0369a1;
            --azure-blue: #0284c7;
            --sky-blue: #0ea5e9;
            --cyan-bright: #06b6d4;
            --teal-accent: #14b8a6;

            /* Neutral Depths */
            --navy-deep: #0f172a;
            --slate-dark: #1e293b;
            --slate-medium: #334155;
            --slate-light: #475569;

            /* Accent Colors */
            --emerald-success: #10b981;
            --amber-warning: #f59e0b;
            --rose-danger: #f43f5e;
            --violet-special: #8b5cf6;

            /* Glass & Overlay */
            --glass-bg: rgba(15, 23, 42, 0.75);
            --glass-border: rgba(6, 182, 212, 0.25);
            --glow-cyan: rgba(6, 182, 212, 0.4);
            --glow-azure: rgba(2, 132, 199, 0.5);
        }

        .gradient-bg {
            /* Deep ocean gradient with subtle cyan undertones */
            background: linear-gradient(135deg,
                #0a1628 0%,
                #0c2340 25%,
                #0e3a5f 50%,
                #1e3a5f 75%,
                #164e7f 100%
            );
            min-height: 100vh;
            position: relative;
        }

        .gradient-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 50%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(2, 132, 199, 0.06) 0%, transparent 50%);
            pointer-events: none;
        }

        .sidebar {
            /* Sophisticated ocean depth gradient */
            background: linear-gradient(180deg,
                #0c4a6e 0%,
                #0369a1 50%,
                #0284c7 100%
            );
            box-shadow: 4px 0 30px rgba(6, 182, 212, 0.2), 4px 0 60px rgba(0, 0, 0, 0.4);
            border-right: 1px solid rgba(6, 182, 212, 0.3);
            transition: all 0.3s ease;
            position: relative;
            width: 256px;
            min-width: 256px;
            flex-shrink: 0;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(180deg,
                rgba(255, 255, 255, 0.05) 0%,
                transparent 50%,
                rgba(0, 0, 0, 0.1) 100%
            );
            pointer-events: none;
        }

        /* Sidebar Collapse - Desktop Auto-Expand */
        /* Modified 2025-01-11: Main content now expands when sidebar collapses */
        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            opacity: 0;
            overflow: hidden;
            border-right: none;
            box-shadow: none;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                height: 100vh;
                z-index: 1000;
            }
        }

        /* Sidebar Toggle Button */
        .sidebar-toggle {
            position: fixed;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 999;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3), 0 0 15px var(--glow-cyan);
        }

        .sidebar-toggle:hover {
            background: rgba(6, 182, 212, 0.3);
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 15px var(--glow-cyan);
        }

        .sidebar-toggle:active {
            transform: translateY(-50%) scale(0.95);
        }

        .sidebar-toggle i {
            color: white;
            font-size: 14px;
            transition: transform 0.3s ease;
        }

        .sidebar-toggle.sidebar-open {
            left: 264px; /* 256px sidebar + 8px margin */
        }

        @media (max-width: 768px) {
            .sidebar-toggle.sidebar-open {
                left: 264px;
            }
        }

        .sidebar-toggle.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .glass-dark {
            background: rgba(10, 22, 40, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(6, 182, 212, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        /* Modified 2025-01-11: Compact mobile header */
        @media (max-width: 768px) {
            header.glass-dark {
                padding: 8px 12px !important;
            }

            header #pageTitle {
                font-size: 16px !important;
                line-height: 1.2;
            }

            header #pageSubtitle {
                display: none !important;
            }

            /* Hide secure badge on mobile (but keep help button) */
            header .glass.rounded-lg:not(#helpButton) {
                display: none !important;
            }

            /* Help button on mobile */
            header #helpButton {
                padding: 6px 10px !important;
            }

            header #helpButton span {
                display: none !important;
            }

            header #helpButton i {
                font-size: 18px !important;
            }

            /* Make user icon smaller */
            header .flex.items-center.space-x-4 {
                gap: 0 !important;
            }

            header .bg-blue-500 {
                width: 32px !important;
                height: 32px !important;
            }

            /* Tighten app switcher button */
            header .app-switcher-btn {
                padding: 6px 8px !important;
                gap: 6px !important;
            }

            header .app-switcher-btn i {
                font-size: 14px;
            }

            header .app-switcher-btn .text-sm {
                font-size: 12px !important;
            }

            /* Reduce gap between elements */
            header .flex.items-center.gap-4 {
                gap: 8px !important;
            }
        }

        .nav-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: rgba(6, 182, 212, 0.15);
            transform: translateX(5px);
            box-shadow: inset 4px 0 0 var(--cyan-bright);
        }

        .nav-item.active {
            background: rgba(6, 182, 212, 0.25);
            border-right: 3px solid var(--cyan-bright);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);
        }

        /* Navigation Group Styles */
        .nav-group {
            margin-bottom: 8px;
        }

        .nav-group-header {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(6, 182, 212, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-group-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(6, 182, 212, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .nav-group-header:hover::before {
            left: 100%;
        }

        .nav-group-header:hover {
            background: rgba(6, 182, 212, 0.08);
            border-color: rgba(6, 182, 212, 0.2);
            box-shadow: 0 4px 12px rgba(6, 182, 212, 0.15);
        }

        .nav-group-header:active {
            transform: scale(0.98);
        }

        .nav-group-items {
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .nav-group-items.collapsed {
            max-height: 0 !important;
            opacity: 0;
        }

        .nav-item-highlighted {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%);
            border: 2px solid rgba(6, 182, 212, 0.3);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-item-highlighted::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(6, 182, 212, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }

        .nav-item-highlighted:hover::before {
            width: 300px;
            height: 300px;
        }

        .nav-item-highlighted:hover {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.25) 0%, rgba(59, 130, 246, 0.25) 100%);
            border-color: rgba(6, 182, 212, 0.5);
            transform: translateX(5px);
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.3), inset 0 0 20px rgba(6, 182, 212, 0.1);
        }

        .nav-item-highlighted:active {
            transform: translateX(5px) scale(0.98);
        }

        /* Chevron rotation animation */
        .group-chevron {
            transition: transform 0.3s ease;
        }

        .group-chevron.rotated {
            transform: rotate(0deg) !important;
        }

        /* Mobile responsive navigation */
        @media (max-width: 768px) {
            .nav-group-header {
                font-size: 12px;
                padding: 10px !important;
            }

            .nav-group-header .text-sm {
                font-size: 11px;
            }

            .nav-item {
                padding: 10px !important;
                font-size: 14px;
            }

            .nav-item-highlighted {
                padding: 12px !important;
            }

            /* Auto-collapse all groups on mobile for cleaner view */
            .nav-group-items {
                transition: max-height 0.25s ease;
            }
        }

        /* Keyboard focus styles for accessibility */
        .nav-group-header:focus,
        .nav-item:focus,
        .nav-item-highlighted:focus {
            outline: 2px solid rgba(6, 182, 212, 0.6);
            outline-offset: 2px;
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.2);
        }

        .workflow-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
        }

        .workflow-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), 0 0 30px var(--glow-cyan);
        }

        .workflow-card.selected {
            background: rgba(6, 182, 212, 0.25);
            border-color: var(--cyan-bright);
            box-shadow: 0 0 25px var(--glow-cyan), 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .security-alert {
            animation: pulse-glow 2s infinite;
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); }
        }
        
        .typing {
            border-right: 2px solid var(--success-green);
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { border-color: transparent; }
            51%, 100% { border-color: var(--success-green); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 22, 40, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .threat-indicator {
            animation: blink-red 1.5s infinite;
        }
        
        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Added 2024-10-22: API Integration Platform Styles */
        .api-tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .api-tab-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .api-tab-button.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        .api-module-content {
            display: block;
        }

        .api-module-content.hidden {
            display: none;
        }

        .compatibility-score {
            background: linear-gradient(90deg, #ef4444, #f59e0b, #10b981);
            height: 8px;
            border-radius: 4px;
        }

        .terminal {
            background: rgba(0, 0, 0, 0.5);
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #10b981;
        }

        /* Enhanced 2024-10-30: Advanced Security Operations Center Styles */
        .security-module-tab {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .security-module-tab:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .security-module-tab.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        .security-module-content {
            display: none;
        }

        .security-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Added 2024-10-05: Drag and Drop Workflow Builder Styles */
        .workflow-step {
            cursor: grab;
            transition: all 0.3s ease;
        }

        .workflow-step:active {
            cursor: grabbing;
        }

        .workflow-step.dragging {
            opacity: 0.5;
        }

        .drop-zone {
            min-height: 400px;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }

        .saved-workflow-card {
            transition: all 0.3s ease;
        }

        /* Custom scrollbar - Blue Ocean theme */
        .scrollbar-thin::-webkit-scrollbar {
            width: 8px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: rgba(6, 182, 212, 0.05);
            border-radius: 10px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--cyan-bright), var(--ocean-primary));
            border-radius: 10px;
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--sky-blue), var(--cyan-bright));
            box-shadow: 0 0 10px var(--glow-cyan);
        }

        /* Predictive Analytics Dashboard Styles - Added 2024-12-09 */
        .forecast-bar {
            animation: growBar 1s ease-out forwards;
            transform-origin: bottom;
        }

        @keyframes growBar {
            from { transform: scaleY(0); opacity: 0; }
            to { transform: scaleY(1); opacity: 1; }
        }

        .confidence-ring {
            animation: drawRing 1.5s ease-out forwards;
        }

        @keyframes drawRing {
            from { stroke-dashoffset: 251.2; }
            to { stroke-dashoffset: 0; }
        }

        .anomaly-pulse {
            animation: anomalyPulse 2s ease-in-out infinite;
        }

        @keyframes anomalyPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        #predictiveTooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(59, 130, 246, 0.5);
            backdrop-filter: blur(10px);
        }

        #predictiveTooltip.show {
            opacity: 1;
        }

        /* Regulation Assistant Styles - Added 2025-10-07 */
        .regulation-chat-bubble-user {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .regulation-chat-bubble-assistant {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px 18px 18px 4px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2);
        }

        .regulation-typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #8b5cf6;
            border-radius: 50%;
            margin: 0 2px;
            animation: regulation-typing 1.4s infinite;
        }

        .regulation-typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .regulation-typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes regulation-typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.7;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }

        .regulation-sample-question {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .regulation-sample-question:hover {
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.3);
            transform: translateY(-2px);
            border-color: rgba(139, 92, 246, 0.5);
        }

        .regulation-indicator-allowed {
            color: #10b981;
            font-weight: 600;
        }

        .regulation-indicator-not-allowed {
            color: #ef4444;
            font-weight: 600;
        }

        .regulation-indicator-permit {
            color: #f59e0b;
            font-weight: 600;
        }

        .regulation-info-card {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }

        .regulation-contact-card {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
        }

        .regulation-link-button {
            display: inline-block;
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 6px 12px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.75rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .regulation-link-button:hover {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            transform: translateY(-2px);
        }

        .regulation-scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(59, 130, 246, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.5);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .regulation-scroll-btn:hover {
            background: rgba(59, 130, 246, 1);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.5);
            transform: translateY(-50%) scale(1.1);
        }

        .regulation-scroll-btn-left {
            left: 8px;
        }

        .regulation-scroll-btn-right {
            right: 8px;
        }

        .regulation-scroll-btn.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .regulation-questions-container {
            position: relative;
        }

        .regulation-questions-scroll {
            scroll-behavior: smooth;
        }

        .regulation-chat-container {
            scroll-behavior: smooth;
        }

        .regulation-chat-container::-webkit-scrollbar {
            width: 8px;
        }

        .regulation-chat-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .regulation-chat-container::-webkit-scrollbar-thumb {
            background: rgba(139, 92, 246, 0.5);
            border-radius: 4px;
        }

        /* Policy Intelligence Center Styles - Added 2025-10-07 */
        .policy-citation-federal {
            color: #8b5cf6;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .policy-citation-federal:hover {
            color: #a78bfa;
        }

        .policy-citation-state {
            color: #10b981;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .policy-citation-state:hover {
            color: #34d399;
        }

        .policy-citation-municipal {
            color: #3b82f6;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .policy-citation-municipal:hover {
            color: #60a5fa;
        }

        .policy-confidence-meter {
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .policy-confidence-fill {
            height: 100%;
            border-radius: 6px;
            transition: width 1.5s ease;
            position: relative;
            overflow: hidden;
        }

        .policy-confidence-high {
            background: linear-gradient(90deg, #10b981, #34d399);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
        }

        .policy-confidence-medium {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6);
        }

        .policy-confidence-low {
            background: linear-gradient(90deg, #ef4444, #f87171);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
        }

        .policy-status-compliant {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #34d399;
        }

        .policy-status-needs-review {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.4);
            color: #fbbf24;
        }

        .policy-status-non-compliant {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #f87171;
        }

        .policy-status-unclear {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            color: #a78bfa;
        }

        .policy-conflict-critical {
            border-left: 4px solid #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .policy-conflict-moderate {
            border-left: 4px solid #f59e0b;
            background: rgba(245, 158, 11, 0.1);
        }

        .policy-conflict-minor {
            border-left: 4px solid #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .policy-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .policy-table th {
            background: rgba(59, 130, 246, 0.2);
            color: white;
            font-weight: 600;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid rgba(59, 130, 246, 0.4);
        }

        .policy-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .policy-table tr:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        /* Quantum-Ready Security Module Styles - Added 2025-10-07 */
        .quantum-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #8b5cf6, transparent);
            border-radius: 50%;
            animation: quantumFloat 3s ease-in-out infinite;
        }

        @keyframes quantumFloat {
            0%, 100% { transform: translateY(0) translateX(0); opacity: 0.3; }
            50% { transform: translateY(-20px) translateX(10px); opacity: 0.7; }
        }

        .quantum-strength-bar {
            height: 24px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
        }

        .quantum-strength-fill {
            height: 100%;
            transition: width 1s ease-out;
            position: relative;
            overflow: hidden;
        }

        .quantum-strength-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes quantumThreatPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.8); }
        }

        .quantum-threat-indicator {
            animation: quantumThreatPulse 2s ease-in-out infinite;
        }

        .quantum-timeline-point {
            position: relative;
        }

        .quantum-timeline-point::before {
            content: '';
            position: absolute;
            width: 16px;
            height: 16px;
            background: #8b5cf6;
            border-radius: 50%;
            left: -8px;
            top: 50%;
            transform: translateY(-50%);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6);
        }

        .quantum-encryption-demo {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }

        @keyframes quantumEncryptionFlow {
            0% { opacity: 0; transform: translateX(-20px); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateX(20px); }
        }

        .quantum-encryption-flow {
            animation: quantumEncryptionFlow 2s ease-in-out infinite;
        }

        .quantum-cert-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .quantum-decision-node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quantum-decision-node:hover {
            transform: scale(1.05);
            background: rgba(139, 92, 246, 0.2);
        }

        .quantum-vs-divider {
            position: relative;
        }

        .quantum-vs-divider::after {
            content: 'VS';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.5);
        }

        /* Blockchain Audit Trail Styles - Added 2024-12-09 */
        .blockchain-block {
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .blockchain-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
        }

        .blockchain-block::after {
            content: '';
            position: absolute;
            right: -40px;
            top: 50%;
            width: 40px;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.8);
        }

        .blockchain-block:last-child::after {
            display: none;
        }

        .neon-blue {
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 40px rgba(59, 130, 246, 0.3);
        }

        .neon-purple {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.6), 0 0 40px rgba(139, 92, 246, 0.3);
        }

        .neon-green {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6), 0 0 40px rgba(16, 185, 129, 0.3);
        }

        .neon-red {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.6), 0 0 40px rgba(239, 68, 68, 0.3);
        }

        .neon-yellow {
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.6), 0 0 40px rgba(245, 158, 11, 0.3);
        }

        @keyframes blockCreate {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .block-creating {
            animation: blockCreate 0.6s ease-out;
        }

        @keyframes hashPulse {
            0%, 100% {
                box-shadow: 0 0 10px rgba(16, 185, 129, 0.4);
            }
            50% {
                box-shadow: 0 0 25px rgba(16, 185, 129, 0.8);
            }
        }

        .hash-verified {
            animation: hashPulse 2s ease-in-out infinite;
        }

        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .timeline-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.8);
            position: absolute;
            left: 15px;
            z-index: 10;
        }

        #blockchainTooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(59, 130, 246, 0.5);
            backdrop-filter: blur(10px);
            max-width: 300px;
        }

        #blockchainTooltip.show {
            opacity: 1;
        }

        .contract-status {
            position: relative;
            overflow: hidden;
        }

        .contract-status::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .contract-status:hover::before {
            left: 100%;
        }

        @keyframes copySuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #10b981; }
            100% { transform: scale(1); }
        }

        .copy-success {
            animation: copySuccess 0.3s ease;
        }

        /* Document Processing Center Styles - Added 2025-10-18 */
        .cjis-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            font-size: 0.75rem;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 9999px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .cjis-badge::before {
            content: 'ðŸ”’';
            font-size: 0.875rem;
        }

        .doc-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .doc-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .confidence-bar {
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .field-chip {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .field-approved {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .field-rejected {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .field-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* Intelligence Hub Styles */
        .insight-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .insight-card:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .pulse-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .knowledge-node {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.7rem;
            text-align: center;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .knowledge-node:hover {
            transform: scale(1.2);
            z-index: 10;
        }

        .knowledge-line {
            position: absolute;
            height: 2px;
            background: rgba(59, 130, 246, 0.3);
            transform-origin: left center;
            pointer-events: none;
        }

        .confidence-meter {
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .integration-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-partial {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-limited {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .search-result-group {
            margin-bottom: 24px;
        }

        .search-result-item {
            padding: 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .search-result-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .priority-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .priority-high {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .priority-medium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .priority-low {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .automation-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .automation-card:hover {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(59, 130, 246, 0.15));
            transform: translateY(-2px);
        }

        /* Constituent Inbox Styles - Added 2025-10-27 */
        .inbox-tab-button {
            background: rgba(255, 255, 255, 0.05);
        }

        .inbox-tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        .inbox-tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .inbox-filter-chip.active {
            background: rgba(59, 130, 246, 0.3);
            border: 1px solid #3b82f6;
        }

        .inbox-message-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .inbox-message-card:hover {
            transform: translateX(4px);
            background: rgba(255, 255, 255, 0.15);
        }

        .inbox-message-card.unread {
            border-left: 4px solid #3b82f6;
        }

        .pulse-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* CJIS Security Config Styles - Added 2025-10-27 */
        .cjis-tab-button {
            background: rgba(255, 255, 255, 0.05);
        }

        .cjis-tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
        }

        .cjis-tab-button:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Added 2024-10-31: Autonomous Government Operations Styles */
        .agent-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .agent-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .agent-status-active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .learning-progress {
            animation: progress 3s ease-in-out infinite;
        }

        @keyframes progress {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.05); }
        }

        .autonomous-module-tab {
            transition: all 0.3s ease;
        }

        .autonomous-module-tab.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        .autonomous-module-content {
            display: none;
        }

        .autonomous-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Added 2024-10-31: Government Digital Twin Styles */
        .twin-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .twin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .sync-indicator {
            animation: sync-pulse 2s infinite;
        }

        @keyframes sync-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .simulation-running {
            animation: simulation-glow 1.5s ease-in-out infinite;
        }

        @keyframes simulation-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.8); }
        }

        .digital-twin-module-tab {
            transition: all 0.3s ease;
        }

        .digital-twin-module-tab.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        .digital-twin-module-content {
            display: none;
        }

        .digital-twin-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .flow-connector {
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
            animation: flow 2s linear infinite;
        }

        @keyframes flow {
            0% { stroke-dashoffset: 20; }
            100% { stroke-dashoffset: 0; }
        }

        .optimization-badge {
            animation: badge-glow 2s ease-in-out infinite;
        }

        @keyframes badge-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 15px rgba(16, 185, 129, 0.8); }
        }

        /* Fix for tab content scrolling */
        .tab-content {
            min-height: 0;
            height: auto;
        }

        /* Added 2024-11-04: Public Engagement Portal Styles */
        .engagement-tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .engagement-tab-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .engagement-tab-button.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        .engagement-module-content {
            display: none;
        }

        .engagement-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .upvote-button {
            transition: all 0.3s ease;
        }

        .upvote-button:hover {
            transform: translateY(-2px);
            background: rgba(59, 130, 246, 0.3);
        }

        .upvote-button.voted {
            background: rgba(59, 130, 246, 0.5);
            color: #60a5fa;
        }

        .live-indicator {
            animation: blink-live 1.5s infinite;
        }

        @keyframes blink-live {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .chart-bar {
            animation: growBar 1s ease-out forwards;
            transform-origin: left;
        }

        @keyframes growBar {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }

        /* Added 2024-11-06: SecureMesh Module Styles */
        /* Security Clearance Badges */
        .clearance-unclassified {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .clearance-confidential {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #60a5fa;
        }

        .clearance-secret {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #fbbf24;
        }

        .clearance-top-secret {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #f87171;
        }

        /* Message Bubbles */
        .message-sent {
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            border-radius: 18px 18px 4px 18px;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .message-received {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 18px 18px 18px 4px;
        }

        /* AI Analysis Indicators */
        .sentiment-positive {
            color: #10b981;
        }

        .sentiment-neutral {
            color: #3b82f6;
        }

        .sentiment-negative {
            color: #ef4444;
        }

        .urgency-low {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .urgency-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .urgency-high {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        /* Blockchain Verification */
        .blockchain-verified {
            animation: pulse-verify 2s infinite;
        }

        @keyframes pulse-verify {
            0%, 100% { box-shadow: 0 0 10px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.8); }
        }

        /* Real-time Connection Indicator */
        .connection-active {
            animation: blink-connection 1.5s infinite;
        }

        @keyframes blink-connection {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Typing Indicator */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #3b82f6;
            border-radius: 50%;
            margin: 0 2px;
            animation: typing-bounce 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-bounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Tab Buttons */
        .mesh-tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .mesh-tab-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .mesh-tab-button.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        /* Module Content */
        .mesh-module-content {
            display: none;
        }

        .mesh-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* AI Processing Animation */
        .ai-processing {
            animation: ai-pulse 1.5s ease-in-out infinite;
        }

        @keyframes ai-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }
        /* End Added 2024-11-06: SecureMesh Module Styles */

        /* Added 2024-11-06: Department Process Center Styles */

        /* Department Color Coding */
        .dept-building {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        .dept-building-light {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #fbbf24;
        }

        .dept-tax {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .dept-tax-light {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #34d399;
        }

        .dept-public-works {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        .dept-public-works-light {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid #3b82f6;
            color: #60a5fa;
        }

        .dept-health {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        .dept-health-light {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #f87171;
        }

        .dept-planning {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        .dept-planning-light {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid #8b5cf6;
            color: #a78bfa;
        }

        .dept-legal {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        }
        .dept-legal-light {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid #6366f1;
            color: #818cf8;
        }

        .dept-hr {
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
        }
        .dept-hr-light {
            background: rgba(236, 72, 153, 0.2);
            border: 1px solid #ec4899;
            color: #f472b6;
        }

        .dept-it {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }
        .dept-it-light {
            background: rgba(6, 182, 212, 0.2);
            border: 1px solid #06b6d4;
            color: #22d3ee;
        }

        /* Compliance Status Badges */
        .compliance-good {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            color: #10b981;
        }

        .compliance-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid #f59e0b;
            color: #fbbf24;
        }

        .compliance-critical {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #f87171;
        }

        /* Tab Navigation */
        .dept-tab-button {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dept-tab-button:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .dept-tab-button.active {
            background: rgba(59, 130, 246, 0.3);
            border-bottom: 3px solid #3b82f6;
        }

        /* Module Content */
        .dept-module-content {
            display: none;
        }

        .dept-module-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Workflow Status */
        .workflow-status-active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .workflow-status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .workflow-status-paused {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }

        /* Progress Animation */
        .progress-bar {
            transition: width 0.5s ease;
        }

        /* Pulse Effect */
        .pulse-effect {
            animation: pulse-glow 2s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }

        /* Added 2024-11-07: Mobile Command Center Styles */
        /* Connectivity Status Animations */
        .mobile-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .mobile-status-online { background: #10b981; }
        .mobile-status-offline { background: #f59e0b; }
        .mobile-status-limited { background: #ef4444; }
        .mobile-status-syncing { background: #3b82f6; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Emergency Button Pulse Animation */
        .emergency-fab {
            animation: emergency-pulse 2s infinite;
        }

        @keyframes emergency-pulse {
            0%, 100% {
                box-shadow: 0 8px 24px rgba(239, 68, 68, 0.5);
            }
            50% {
                box-shadow: 0 8px 32px rgba(239, 68, 68, 0.8);
                transform: scale(1.05);
            }
        }

        /* Mobile-Optimized Touch Targets */
        .mobile-action-tile {
            min-height: 100px;
            transition: all 0.3s ease;
        }

        .mobile-action-tile:active {
            transform: scale(0.95);
        }

        .mobile-touch-button {
            min-height: 44px;
            transition: all 0.3s ease;
        }

        .mobile-touch-button:active {
            transform: scale(0.98);
        }

        /* Glassmorphism for Mobile */
        .mobile-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Route Optimization Styles */
        .route-stat-old {
            text-decoration: line-through;
            color: #ef4444;
        }

        .route-stat-new {
            color: #10b981;
        }

        /* Checklist Interactions */
        .checklist-btn {
            transition: all 0.3s ease;
        }

        .checklist-btn:active {
            transform: scale(0.95);
        }

        .checklist-btn.selected {
            opacity: 1;
            font-weight: 900;
        }

        /* Priority Badges */
        .priority-high {
            background: #ef4444;
            color: white;
        }

        .priority-normal {
            background: #f59e0b;
            color: #000000;
        }

        /* Loading Skeleton for Mobile */
        .mobile-skeleton {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 25%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        /* End Added 2024-11-07: Mobile Command Center Styles */

        /* Added 2025-01-08: Govli App Switcher Styles */
        /* Modified 2025-01-11: Moved to header for cleaner mobile experience */
        .app-switcher-btn {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
        }

        .app-switcher-btn:hover {
            background: rgba(6, 182, 212, 0.2);
            box-shadow: 0 4px 20px var(--glow-cyan);
        }

        .app-switcher-dropdown {
            display: none;
            position: fixed;
            top: 60px;
            left: 20px;
            width: 400px;
            max-width: calc(100vw - 40px);
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px var(--glow-cyan);
            z-index: 999999;
            animation: slideDown 0.3s ease-out;
        }

        .app-switcher-dropdown.active {
            display: block;
        }

        /* Backdrop overlay for mobile - ensures dropdown is above all content */
        .app-switcher-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999998;
            backdrop-filter: blur(2px);
        }

        .app-switcher-backdrop.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .app-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .app-card:hover {
            transform: translateY(-4px);
            border-color: var(--cyan-bright);
            box-shadow: 0 8px 24px rgba(6, 182, 212, 0.3);
            background: rgba(6, 182, 212, 0.1);
        }

        .app-card.active {
            background: rgba(6, 182, 212, 0.2);
            border-color: var(--cyan-bright);
            box-shadow: 0 0 20px var(--glow-cyan);
        }

        .app-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .app-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--cyan-bright);
            color: white;
            font-size: 9px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        @media (max-width: 768px) {
            .app-switcher-btn {
                padding: 6px 10px;
                gap: 8px;
            }

            .app-switcher-btn .text-xs {
                display: none;
            }

            .app-switcher-dropdown {
                position: fixed;
                top: 50px;
                left: 12px;
                right: 12px;
                width: auto;
                max-width: none;
                background: rgba(15, 23, 42, 0.98);
                backdrop-filter: blur(30px);
                z-index: 999999;
            }
        }
        /* End Added 2025-01-08: Govli App Switcher Styles */
    </style>
</head>
<body class="gradient-bg text-white overflow-hidden">
    <!-- Tooltip for Predictive Analytics -->
    <div id="predictiveTooltip" class="tooltip"></div>

    <!-- Tooltip for Blockchain -->
    <div id="blockchainTooltip" class="tooltip"></div>

    <!-- App Switcher Backdrop -->
    <div id="appSwitcherBackdrop" class="app-switcher-backdrop"></div>

    <!-- App Switcher Dropdown (Portal to body) -->
    <div id="appSwitcherDropdown" class="app-switcher-dropdown">
        <div class="p-5 border-b border-white/10">
            <h3 class="text-white font-bold text-base mb-1">Govli Platform</h3>
            <p class="text-white/60 text-xs">Switch between applications</p>
        </div>

        <div class="p-5 grid grid-cols-2 gap-3">
            <!-- Core Platform App -->
            <div class="app-card active" data-app="core">
                <div class="app-badge">Active</div>
                <div class="app-icon" style="background: linear-gradient(135deg, #0284c7, #8b5cf6);">
                    <i class="fas fa-building text-white"></i>
                </div>
                <h4 class="text-white font-semibold text-xs mb-1">Core Platform</h4>
                <p class="text-white/60 text-xs">Workflows & CRM</p>
            </div>

            <!-- Permits App -->
            <div class="app-card" data-app="permits" style="cursor: pointer;">
                <div class="app-icon" style="background: linear-gradient(135deg, #10b981, #14b8a6);">
                    <i class="fas fa-clipboard-check text-white"></i>
                </div>
                <h4 class="text-white font-semibold text-xs mb-1">Permits</h4>
                <p class="text-white/60 text-xs">& Inspections</p>
            </div>

            <!-- FOIA App -->
            <div class="app-card" data-app="foia" style="cursor: pointer;" onclick="window.location.href='foia-admin-dashboard.html'">
                <div class="app-icon" style="background: linear-gradient(135deg, #06b6d4, #0284c7);">
                    <i class="fas fa-file-alt text-white"></i>
                </div>
                <h4 class="text-white font-semibold text-xs mb-1">FOIA</h4>
                <p class="text-white/60 text-xs">Public Records</p>
            </div>

            <!-- Create New Module -->
            <div class="app-card" data-app="new" style="cursor: pointer; border: 2px dashed rgba(6, 182, 212, 0.4); background: rgba(6, 182, 212, 0.05);">
                <div class="app-icon" style="background: rgba(6, 182, 212, 0.2); border: 2px dashed var(--cyan-bright);">
                    <i class="fas fa-plus text-cyan-400"></i>
                </div>
                <h4 class="text-cyan-400 font-semibold text-xs mb-1">New Module</h4>
                <p class="text-white/60 text-xs">Create custom app</p>
            </div>
        </div>

        <div class="p-4 border-t border-white/10">
            <div class="text-center text-xs text-white/40">
                Click to switch apps or create new modules
            </div>
        </div>
    </div>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle sidebar-open" id="sidebarToggle" aria-label="Toggle sidebar">
        <i class="fas fa-chevron-left"></i>
    </button>

    <div class="flex h-screen">
        <!-- Sidebar -->
        <div class="sidebar overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center space-x-3 mb-8">
                    <div class="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">Govli AI</h1>
                        <p class="text-xs text-blue-200">Security & Workflow Platform</p>
                    </div>
                </div>
                
                <nav class="space-y-2" role="navigation" aria-label="Main navigation">
                    <!-- GROUP 1: Command Center (expanded by default) -->
                    <div class="nav-group" data-group="command-center">
                        <button class="nav-group-header w-full p-3 rounded-lg flex items-center justify-between hover:bg-white/5 transition-all"
                                onclick="toggleGroup('command-center', 'click')"
                                aria-expanded="true"
                                aria-controls="group-command-center">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-crown text-cyan-400"></i>
                                <span class="text-white font-semibold text-sm uppercase tracking-wide">Command Center</span>
                            </div>
                            <i class="fas fa-chevron-down text-white/60 transform transition-transform duration-300 group-chevron"></i>
                        </button>
                        <div class="nav-group-items ml-3 space-y-1 mt-1" id="group-command-center" style="max-height: 500px; overflow: hidden; transition: max-height 0.3s ease;">
                            <div class="nav-item active p-3 rounded-lg" onclick="switchTab('dashboard', event)" role="button" tabindex="0" aria-label="Admin Dashboard">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-tachometer-alt text-white"></i>
                                    <span class="text-white font-medium">Admin Dashboard</span>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('analytics', event)" role="button" tabindex="0" aria-label="Analytics">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-chart-line text-white"></i>
                                    <span class="text-white font-medium">Analytics</span>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('intelligence', event)" role="button" tabindex="0" aria-label="Intelligence Hub">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-brain text-white"></i>
                                    <span class="text-white font-medium">Intelligence Hub</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 2: Citizen Portal (standalone highlighted) -->
                    <div class="nav-item nav-item-highlighted p-3 rounded-lg glass border-2 border-cyan-500/30" onclick="switchTab('citizen', event)" role="button" tabindex="0" aria-label="Citizen Portal">
                        <div class="flex items-center space-x-3">
                            <i class="fas fa-users text-cyan-400 text-lg"></i>
                            <span class="text-white font-semibold">Citizen Portal</span>
                            <div class="ml-auto">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 3: Constituent Management -->
                    <div class="nav-group" data-group="constituent-mgmt">
                        <button class="nav-group-header w-full p-3 rounded-lg flex items-center justify-between hover:bg-white/5 transition-all"
                                onclick="toggleGroup('constituent-mgmt', 'click')"
                                aria-expanded="false"
                                aria-controls="group-constituent-mgmt">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-user-friends text-blue-400"></i>
                                <span class="text-white font-semibold text-sm uppercase tracking-wide">Constituent Management</span>
                            </div>
                            <i class="fas fa-chevron-down text-white/60 transform transition-transform duration-300 group-chevron" style="transform: rotate(-90deg);"></i>
                        </button>
                        <div class="nav-group-items ml-3 space-y-1 mt-1" id="group-constituent-mgmt" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('crm', event)" role="button" tabindex="0" aria-label="CRM">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-address-book text-white"></i>
                                    <span class="text-white font-medium">CRM</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('constituent-inbox', event)" role="button" tabindex="0" aria-label="Constituent Inbox">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-inbox text-white"></i>
                                    <span class="text-white font-medium">Constituent Inbox</span>
                                    <div class="ml-auto">
                                        <span class="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">142</span>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('grants', event)" role="button" tabindex="0" aria-label="Grant Management">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-dollar-sign text-white"></i>
                                    <span class="text-white font-medium">Grant Management</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item-highlighted p-3 rounded-lg glass border-2 border-emerald-500/30" onclick="window.location.href='foia-admin-dashboard.html'" role="button" tabindex="0" aria-label="FOIA Management">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-file-alt text-emerald-400 text-lg"></i>
                                    <span class="text-white font-semibold">FOIA/Public Records</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 4: Automation & Workflows -->
                    <div class="nav-group" data-group="automation">
                        <button class="nav-group-header w-full p-3 rounded-lg flex items-center justify-between hover:bg-white/5 transition-all"
                                onclick="toggleGroup('automation', 'click')"
                                aria-expanded="false"
                                aria-controls="group-automation">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-cogs text-purple-400"></i>
                                <span class="text-white font-semibold text-sm uppercase tracking-wide">Automation & Workflows</span>
                            </div>
                            <i class="fas fa-chevron-down text-white/60 transform transition-transform duration-300 group-chevron" style="transform: rotate(-90deg);"></i>
                        </button>
                        <div class="nav-group-items ml-3 space-y-1 mt-1" id="group-automation" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('workflows', event)" role="button" tabindex="0" aria-label="Workflows">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-sitemap text-white"></i>
                                    <span class="text-white font-medium">Workflows</span>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('autonomous-operations', event)" role="button" tabindex="0" aria-label="Autonomous Operations">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-robot text-white"></i>
                                    <span class="text-white font-medium">Autonomous Operations</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('digital-twin', event)" role="button" tabindex="0" aria-label="Digital Twin">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-project-diagram text-white"></i>
                                    <span class="text-white font-medium">Digital Twin</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-cyan-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('api-integration', event)" role="button" tabindex="0" aria-label="API Integration">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-plug text-white"></i>
                                    <span class="text-white font-medium">API Integration</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 5: Field Operations -->
                    <div class="nav-group" data-group="field-ops">
                        <button class="nav-group-header w-full p-3 rounded-lg flex items-center justify-between hover:bg-white/5 transition-all"
                                onclick="toggleGroup('field-ops', 'click')"
                                aria-expanded="false"
                                aria-controls="group-field-ops">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-map-marked-alt text-green-400"></i>
                                <span class="text-white font-semibold text-sm uppercase tracking-wide">Field Operations</span>
                            </div>
                            <i class="fas fa-chevron-down text-white/60 transform transition-transform duration-300 group-chevron" style="transform: rotate(-90deg);"></i>
                        </button>
                        <div class="nav-group-items ml-3 space-y-1 mt-1" id="group-field-ops" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('mobile-command', event)" role="button" tabindex="0" aria-label="Mobile Command">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-mobile-screen-button text-white"></i>
                                    <span class="text-white font-medium">Mobile Command</span>
                                    <div class="ml-auto">
                                        <span class="bg-green-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">FIELD</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 6: Security & Compliance -->
                    <div class="nav-group" data-group="security-compliance">
                        <button class="nav-group-header w-full p-3 rounded-lg flex items-center justify-between hover:bg-white/5 transition-all"
                                onclick="toggleGroup('security-compliance', 'click')"
                                aria-expanded="false"
                                aria-controls="group-security-compliance">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-shield-halved text-red-400"></i>
                                <span class="text-white font-semibold text-sm uppercase tracking-wide">Security & Compliance</span>
                            </div>
                            <i class="fas fa-chevron-down text-white/60 transform transition-transform duration-300 group-chevron" style="transform: rotate(-90deg);"></i>
                        </button>
                        <div class="nav-group-items ml-3 space-y-1 mt-1" id="group-security-compliance" style="max-height: 0; overflow: hidden; transition: max-height 0.3s ease;">
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('security', event)" role="button" tabindex="0" aria-label="Security Analysis">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-shield-alt text-white"></i>
                                    <span class="text-white font-medium">Security Analysis</span>
                                    <div class="ml-auto">
                                        <div class="w-2 h-2 bg-red-400 rounded-full threat-indicator"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('compliance', event)" role="button" tabindex="0" aria-label="Compliance">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-clipboard-check text-white"></i>
                                    <span class="text-white font-medium">Compliance</span>
                                </div>
                            </div>
                            <div class="nav-item p-3 rounded-lg" onclick="switchTab('securemesh', event)" role="button" tabindex="0" aria-label="SecureMesh">
                                <div class="flex items-center space-x-3">
                                    <i class="fas fa-network-wired text-white"></i>
                                    <span class="text-white font-medium">SecureMesh</span>
                                    <div class="ml-auto">
                                        <span class="bg-green-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">LIVE</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- GROUP 7: Settings (pinned at bottom, standalone) -->
                    <div class="mt-auto pt-4 border-t border-white/10">
                        <div class="nav-item p-3 rounded-lg" onclick="switchTab('settings', event)" role="button" tabindex="0" aria-label="Settings">
                            <div class="flex items-center space-x-3">
                                <i class="fas fa-cog text-white"></i>
                                <span class="text-white font-medium">Settings</span>
                            </div>
                        </div>
                    </div>
                </nav>
                
                <!-- System Status -->
                <div class="mt-8 p-4 glass-dark rounded-lg">
                    <h4 class="text-sm font-semibold text-white mb-3">System Status</h4>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-white/70">AI Engine</span>
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-400 rounded-full mr-1"></div>
                                <span class="text-green-300">Online</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-white/70">Security</span>
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-yellow-400 rounded-full mr-1"></div>
                                <span class="text-yellow-300">Monitoring</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-white/70">Workflows</span>
                            <div class="flex items-center">
                                <div class="w-2 h-2 bg-green-400 rounded-full mr-1"></div>
                                <span class="text-green-300">28 Active</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="glass-dark border-b border-white/10 p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <!-- Added 2025-01-11: App Switcher in Header -->
                        <button class="app-switcher-btn" id="appSwitcherBtn" aria-label="Open app switcher">
                            <i class="fas fa-th text-cyan-400"></i>
                            <div class="flex flex-col items-start">
                                <span class="text-xs text-white/60">Govli</span>
                                <span class="text-sm font-semibold text-white" id="currentAppName">Core Platform</span>
                            </div>
                            <i class="fas fa-chevron-down text-xs text-white/40"></i>
                        </button>
                        <div>
                            <h2 id="pageTitle" class="text-2xl font-bold text-white">City Services Portal</h2>
                            <p id="pageSubtitle" class="text-sm text-white/70">Submit requests, track applications, and access city services</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="glass rounded-lg px-3 py-2">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-shield-alt text-green-400"></i>
                                <span class="text-sm text-white">Secure</span>
                            </div>
                        </div>
                        <!-- Help/Training Button -->
                        <button id="helpButton" class="glass rounded-lg px-3 py-2 hover:bg-white/10 transition-all" aria-label="Open training">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-graduation-cap text-cyan-400"></i>
                                <span class="text-sm text-white">Help</span>
                            </div>
                        </button>
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-white text-sm"></i>
                        </div>
                    </div>
                </div>
            </header>
            
            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Admin Dashboard Tab -->
                <div id="dashboard-content" class="tab-content">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Quick Stats -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Active Workflows</h3>
                                <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-play text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-blue-400 mb-2">28</div>
                            <div class="text-sm text-white/70">â†‘ 12% from last week</div>
                        </div>
                        
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Security Alerts</h3>
                                <div class="w-8 h-8 bg-red-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-red-400 mb-2">3</div>
                            <div class="text-sm text-white/70">â†“ 67% from yesterday</div>
                        </div>
                        
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Processing Efficiency</h3>
                                <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-chart-line text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-green-400 mb-2">96%</div>
                            <div class="text-sm text-white/70">â†‘ 4% improvement</div>
                        </div>
                    </div>
                    
                    <!-- Advanced AI Assistant -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-brain text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-semibold text-white">Govli AI Assistant Pro</h3>
                                    <p class="text-sm text-white/70">Advanced automation & intelligent operations</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-xs text-white/60">Active</span>
                            </div>
                        </div>

                        <!-- Quick Action Buttons -->
                        <div class="grid grid-cols-3 gap-2 mb-4">
                            <button onclick="executeQuickAction('analyze')" class="bg-gradient-to-r from-blue-500/20 to-blue-600/20 border border-blue-500/30 rounded-lg p-3 text-xs text-white hover:bg-blue-500/30 transition-all">
                                <i class="fas fa-chart-line mb-1"></i>
                                <div>Analyze System</div>
                            </button>
                            <button onclick="executeQuickAction('optimize')" class="bg-gradient-to-r from-green-500/20 to-green-600/20 border border-green-500/30 rounded-lg p-3 text-xs text-white hover:bg-green-500/30 transition-all">
                                <i class="fas fa-cogs mb-1"></i>
                                <div>Auto-Optimize</div>
                            </button>
                            <button onclick="executeQuickAction('secure')" class="bg-gradient-to-r from-red-500/20 to-red-600/20 border border-red-500/30 rounded-lg p-3 text-xs text-white hover:bg-red-500/30 transition-all">
                                <i class="fas fa-shield-alt mb-1"></i>
                                <div>Security Scan</div>
                            </button>
                        </div>
                        
                        <div class="bg-black/20 rounded-lg p-4 mb-4 h-40 overflow-y-auto" id="adminChatHistory">
                            <div class="text-green-300 mb-2">
                                <i class="fas fa-brain mr-2"></i>
                                <span class="font-semibold text-blue-300">AI Pro:</span>
                                <span>Advanced automation engine online. 28 workflows optimized, 3 security protocols enhanced. Ready for complex operations and intelligent automation.</span>
                            </div>
                        </div>

                        <!-- Advanced Command Interface -->
                        <div class="space-y-3">
                            <div class="flex space-x-2">
                                <select id="commandType" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="natural">Natural Language</option>
                                    <option value="automation">Automation Script</option>
                                    <option value="workflow">Workflow Command</option>
                                    <option value="security">Security Analysis</option>
                                    <option value="optimization">System Optimization</option>
                                </select>
                                <button onclick="toggleAdvancedMode()" id="advancedModeBtn" class="bg-purple-600/20 border border-purple-500/30 px-3 py-2 rounded-lg text-white text-sm hover:bg-purple-600/30 transition-colors">
                                    <i class="fas fa-magic mr-1"></i>Advanced
                                </button>
                            </div>
                            
                            <div class="flex space-x-2">
                                <input type="text" id="adminUserInput" placeholder="Enter command, automation script, or natural language query..."
                                       class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button onclick="sendAdvancedAdminMessage()" class="bg-gradient-to-r from-blue-600 to-purple-600 px-4 py-2 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all">
                                    <i class="fas fa-paper-plane text-white"></i>
                                </button>
                            </div>

                            <!-- Advanced Mode Panel -->
                            <div id="advancedPanel" class="hidden bg-black/30 rounded-lg p-4 space-y-3">
                                <div class="text-white text-sm font-medium mb-2">Advanced Automation Controls</div>
                                <div class="grid grid-cols-2 gap-3">
                                    <button onclick="insertTemplate('workflow')" class="bg-blue-600/20 border border-blue-500/30 rounded-lg p-2 text-xs text-white hover:bg-blue-600/30 transition-all">
                                        <i class="fas fa-sitemap mr-1"></i>Workflow Template
                                    </button>
                                    <button onclick="insertTemplate('security')" class="bg-red-600/20 border border-red-500/30 rounded-lg p-2 text-xs text-white hover:bg-red-600/30 transition-all">
                                        <i class="fas fa-lock mr-1"></i>Security Script
                                    </button>
                                    <button onclick="insertTemplate('automation')" class="bg-green-600/20 border border-green-500/30 rounded-lg p-2 text-xs text-white hover:bg-green-600/30 transition-all">
                                        <i class="fas fa-robot mr-1"></i>Auto Script
                                    </button>
                                    <button onclick="insertTemplate('api')" class="bg-purple-600/20 border border-purple-500/30 rounded-lg p-2 text-xs text-white hover:bg-purple-600/30 transition-all">
                                        <i class="fas fa-code mr-1"></i>API Command
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Document Processing Center - Added 2025-10-18 -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-file-medical text-orange-400 text-2xl"></i>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Document Processing Center</h3>
                                    <p class="text-sm text-white/70">AI-powered document review queue with intelligent field extraction</p>
                                </div>
                            </div>
                            <span class="cjis-badge">CJIS COMPLIANT</span>
                        </div>

                        <!-- Key Metrics -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-white/70">Processed This Month</div>
                                    <i class="fas fa-file-check text-blue-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-blue-400">2,847</div>
                                <div class="text-xs text-white/50 mt-1">+23% vs last month</div>
                            </div>

                            <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-white/70">Accuracy Rate</div>
                                    <i class="fas fa-bullseye text-green-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-green-400">94.7%</div>
                                <div class="text-xs text-white/50 mt-1">+2.3% improvement</div>
                            </div>

                            <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-white/70">Avg Processing Time</div>
                                    <i class="fas fa-clock text-purple-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-purple-400">2.3s</div>
                                <div class="text-xs text-white/50 mt-1">-0.8s faster</div>
                            </div>

                            <div class="bg-white/5 rounded-lg p-4 border border-white/10">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="text-sm text-white/70">Staff Time Saved</div>
                                    <i class="fas fa-user-clock text-yellow-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-yellow-400">142hrs</div>
                                <div class="text-xs text-white/50 mt-1">This week</div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex flex-wrap gap-3 mb-6">
                            <button onclick="showBatchUpload()" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition-all" aria-label="Upload multiple documents for batch processing">
                                <i class="fas fa-upload mr-2"></i>Batch Upload
                            </button>
                            <button onclick="exportDocProcessingReport()" class="bg-white/10 border border-white/20 text-white px-4 py-2 rounded-lg font-semibold hover:bg-white/20 transition-all" aria-label="Export processing report">
                                <i class="fas fa-download mr-2"></i>Export Report
                            </button>
                            <button onclick="configureDocProcessing()" class="bg-white/10 border border-white/20 text-white px-4 py-2 rounded-lg font-semibold hover:bg-white/20 transition-all" aria-label="Configure document processing settings">
                                <i class="fas fa-cog mr-2"></i>Configure Settings
                            </button>
                            <button onclick="enterDocTrainingMode()" class="bg-white/10 border border-white/20 text-white px-4 py-2 rounded-lg font-semibold hover:bg-white/20 transition-all" aria-label="Train AI model with new document types">
                                <i class="fas fa-brain mr-2"></i>Training Mode
                            </button>
                        </div>

                        <!-- Queue Summary -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                            <!-- High Priority Queue -->
                            <div class="bg-white/5 rounded-lg p-4 border border-red-500/30 cursor-pointer hover:bg-white/10 transition-all" onclick="openDocQueue('high')" role="button" tabindex="0" aria-label="Open high priority document queue">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-bold text-white flex items-center gap-2">
                                        <i class="fas fa-exclamation-triangle text-red-400"></i>
                                        High Priority
                                    </h4>
                                    <span class="bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-sm font-bold border border-red-500/30">23</span>
                                </div>
                                <p class="text-xs text-white/60 mb-2">Confidence &lt; 70% - Manual review required</p>
                                <div class="text-xs text-red-400">Click to review â†’</div>
                            </div>

                            <!-- Medium Priority Queue -->
                            <div class="bg-white/5 rounded-lg p-4 border border-yellow-500/30 cursor-pointer hover:bg-white/10 transition-all" onclick="openDocQueue('medium')" role="button" tabindex="0" aria-label="Open medium priority document queue">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-bold text-white flex items-center gap-2">
                                        <i class="fas fa-flag text-yellow-400"></i>
                                        Medium Priority
                                    </h4>
                                    <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full text-sm font-bold border border-yellow-500/30">45</span>
                                </div>
                                <p class="text-xs text-white/60 mb-2">Confidence 70-85% - Quick verification needed</p>
                                <div class="text-xs text-yellow-400">Click to review â†’</div>
                            </div>

                            <!-- Auto-Processed Queue -->
                            <div class="bg-white/5 rounded-lg p-4 border border-green-500/30 cursor-pointer hover:bg-white/10 transition-all" onclick="openDocQueue('auto')" role="button" tabindex="0" aria-label="Open auto-processed document queue">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="text-sm font-bold text-white flex items-center gap-2">
                                        <i class="fas fa-check-circle text-green-400"></i>
                                        Auto-Processed
                                    </h4>
                                    <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm font-bold border border-green-500/30">147</span>
                                </div>
                                <p class="text-xs text-white/60 mb-2">Confidence &gt; 85% - Automatically approved</p>
                                <div class="text-xs text-green-400">View history â†’</div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Recent Activity</h3>
                        <div class="space-y-3" id="recentActivity">
                            <!-- Activity items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Citizen Portal Tab -->
                <div id="citizen-content" class="tab-content" style="display: none;">
                    <!-- Welcome Banner -->
                    <div class="glass rounded-xl p-6 mb-6 bg-gradient-to-r from-blue-600/20 to-purple-600/20">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Welcome to City Services Portal</h2>
                                <p class="text-white/80">Submit requests, track applications, and access city services 24/7</p>
                            </div>
                            <div class="hidden md:block">
                                <div class="w-16 h-16 bg-white/10 rounded-full flex items-center justify-center">
                                    <i class="fas fa-city text-white text-2xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions & Service Stats -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
                        <!-- New Request -->
                        <div class="glass rounded-xl p-6 hover:scale-105 transition-transform cursor-pointer" onclick="openNewRequestModal()">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">New Request</h3>
                                <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-plus text-white text-sm"></i>
                                </div>
                            </div>
                            <p class="text-sm text-white/70 mb-4">Submit a new service request or application</p>
                            <div class="text-green-400 text-sm font-medium">Click to start â†’</div>
                        </div>
                        
                        <!-- My Requests -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">My Requests</h3>
                                <div class="w-8 h-8 bg-blue-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-list text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-blue-400 mb-2" id="userRequestCountCitizen">5</div>
                            <div class="text-sm text-white/70">2 pending review</div>
                        </div>
                        
                        <!-- Average Response -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Avg Response</h3>
                                <div class="w-8 h-8 bg-purple-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-clock text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-purple-400 mb-2">2.3</div>
                            <div class="text-sm text-white/70">business days</div>
                        </div>

                        <!-- Service Status -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Service Status</h3>
                                <div class="w-8 h-8 bg-green-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-circle text-white text-sm"></i>
                                </div>
                            </div>
                            <div class="text-lg font-bold text-green-400 mb-2">All Systems</div>
                            <div class="text-sm text-white/70">Operational</div>
                        </div>
                    </div>
                    
                    <!-- My Recent Requests -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white">My Recent Requests</h3>
                            <button onclick="viewAllRequests()" class="text-blue-400 hover:text-blue-300 text-sm">
                                View All <i class="fas fa-arrow-right ml-1"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-3" id="recentRequestsListCitizen">
                            <!-- Recent requests will be populated here -->
                        </div>
                    </div>

                    <!-- Regulation Assistant - Added 2025-10-07 -->
                    <div id="regulationAssistant" class="mb-6">
                        <!-- Content will be injected by JavaScript -->
                    </div>

                    <!-- Popular Services -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="glass rounded-xl p-6 hover:scale-105 transition-transform cursor-pointer" onclick="quickRequest('building_permit')">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="w-10 h-10 bg-orange-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-hammer text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white">Building Permits</h4>
                                    <p class="text-xs text-white/70">Construction & renovation</p>
                                </div>
                            </div>
                            <p class="text-sm text-white/80">Apply for building permits and inspections</p>
                        </div>

                        <div class="glass rounded-xl p-6 hover:scale-105 transition-transform cursor-pointer" onclick="quickRequest('business_license')">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-store text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white">Business License</h4>
                                    <p class="text-xs text-white/70">Start your business</p>
                                </div>
                            </div>
                            <p class="text-sm text-white/80">Register and license your business</p>
                        </div>

                        <div class="glass rounded-xl p-6 hover:scale-105 transition-transform cursor-pointer" onclick="quickRequest('report_issue')">
                            <div class="flex items-center space-x-3 mb-3">
                                <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-exclamation-triangle text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-white">Report Issue</h4>
                                    <p class="text-xs text-white/70">City services & problems</p>
                                </div>
                            </div>
                            <p class="text-sm text-white/80">Report potholes, streetlight issues, etc.</p>
                        </div>
                    </div>

                    <!-- AI Service Assistant -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center mb-4">
                            <div class="w-10 h-10 bg-gradient-to-r from-green-500 to-blue-600 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-robot text-white"></i>
                            </div>
                            <div>
                                <h3 class="text-lg font-semibold text-white">City Services AI Assistant</h3>
                                <p class="text-sm text-white/70">Get help finding the right service or department</p>
                            </div>
                        </div>
                        
                        <div class="bg-black/20 rounded-lg p-4 mb-4 h-32 overflow-y-auto" id="citizenChatHistory">
                            <div class="text-green-300 mb-2">
                                <i class="fas fa-robot mr-2"></i>
                                <span class="font-semibold text-blue-300">Assistant:</span>
                                <span id="citizenWelcomeMessage" class="typing">Hello! I'm here to help you find the right city service. What can I help you with today?</span>
                            </div>
                        </div>
                        
                        <div class="flex space-x-2">
                            <input type="text" id="citizenUserInput" placeholder="Ask about permits, licenses, reporting issues, or any city service..."
                                   class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <button onclick="sendCitizenMessage()" class="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-paper-plane text-white"></i>
                            </button>
                        </div>
                        
                        <!-- Quick Service Suggestions -->
                        <div class="flex flex-wrap gap-2 mt-3">
                            <button onclick="quickCitizenChat('building permit')" class="text-xs bg-white/10 text-white px-3 py-1 rounded-full hover:bg-white/20 transition-colors">
                                Building Permit
                            </button>
                            <button onclick="quickCitizenChat('business license')" class="text-xs bg-white/10 text-white px-3 py-1 rounded-full hover:bg-white/20 transition-colors">
                                Business License
                            </button>
                            <button onclick="quickCitizenChat('property taxes')" class="text-xs bg-white/10 text-white px-3 py-1 rounded-full hover:bg-white/20 transition-colors">
                                Property Taxes
                            </button>
                            <button onclick="quickCitizenChat('trash pickup')" class="text-xs bg-white/10 text-white px-3 py-1 rounded-full hover:bg-white/20 transition-colors">
                                Trash Pickup
                            </button>
                        </div>
                    </div>

                    <!-- Added 2024-11-04: Public Engagement Portal -->
                    <div class="mt-8 mb-6">
                        <h2 class="text-2xl font-bold text-white mb-4">Public Engagement</h2>

                        <!-- Module Navigation -->
                        <div class="glass rounded-xl p-2 mb-6">
                            <div class="flex items-center space-x-2 overflow-x-auto scrollbar-thin">
                                <button onclick="switchEngagementModule('transparency')" class="engagement-tab-button active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-engagement-module="transparency">
                                    <i class="fas fa-chart-line mr-2"></i>Transparency Dashboard
                                </button>
                                <button onclick="switchEngagementModule('records')" class="engagement-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-engagement-module="records">
                                    <i class="fas fa-file-alt mr-2"></i>Public Records
                                </button>
                                <button onclick="switchEngagementModule('feedback')" class="engagement-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-engagement-module="feedback">
                                    <i class="fas fa-comments mr-2"></i>Community Feedback
                                </button>
                                <button onclick="switchEngagementModule('meetings')" class="engagement-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-engagement-module="meetings">
                                    <i class="fas fa-video mr-2"></i>Town Halls & Meetings
                                </button>
                                <button onclick="switchEngagementModule('opendata')" class="engagement-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-engagement-module="opendata">
                                    <i class="fas fa-database mr-2"></i>Open Data
                                </button>
                            </div>
                        </div>

                        <!-- Module 1: Transparency Dashboard -->
                        <div id="engagement-module-transparency" class="engagement-module-content active">
                            <!-- Real-time Government Activity Feed -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                <!-- Key Metrics -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="text-white/70 text-sm">Active Projects</div>
                                        <i class="fas fa-project-diagram text-blue-400 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-2">127</div>
                                    <div class="text-xs text-green-400">+8 this month</div>
                                </div>

                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="text-white/70 text-sm">Requests Processed</div>
                                        <i class="fas fa-check-circle text-green-400 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-2">2,847</div>
                                    <div class="text-xs text-white/50">This month</div>
                                </div>

                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <div class="text-white/70 text-sm">Avg Response Time</div>
                                        <i class="fas fa-clock text-purple-400 text-xl"></i>
                                    </div>
                                    <div class="text-3xl font-bold text-white mb-2">2.3</div>
                                    <div class="text-xs text-green-400">-0.5 days improvement</div>
                                </div>
                            </div>

                            <!-- Public Projects Timeline -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-tasks text-blue-400"></i>
                                    Active Public Projects
                                </h3>

                                <div class="space-y-4" id="publicProjectsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Projects will be populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Budget Transparency -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-dollar-sign text-green-400"></i>
                                    Budget Transparency
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="text-white font-semibold mb-3">Fiscal Year 2024 Budget</h4>
                                        <div class="space-y-3">
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-white/70">Public Safety</span>
                                                    <span class="text-white font-medium">$45.2M (35%)</span>
                                                </div>
                                                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                                    <div class="chart-bar h-full bg-gradient-to-r from-blue-500 to-blue-400" style="width: 35%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-white/70">Infrastructure</span>
                                                    <span class="text-white font-medium">$32.8M (25%)</span>
                                                </div>
                                                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                                    <div class="chart-bar h-full bg-gradient-to-r from-green-500 to-green-400" style="width: 25%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-white/70">Education</span>
                                                    <span class="text-white font-medium">$26.2M (20%)</span>
                                                </div>
                                                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                                    <div class="chart-bar h-full bg-gradient-to-r from-purple-500 to-purple-400" style="width: 20%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-white/70">Parks & Recreation</span>
                                                    <span class="text-white font-medium">$19.7M (15%)</span>
                                                </div>
                                                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                                    <div class="chart-bar h-full bg-gradient-to-r from-yellow-500 to-yellow-400" style="width: 15%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-white/70">Other Services</span>
                                                    <span class="text-white font-medium">$6.6M (5%)</span>
                                                </div>
                                                <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                                    <div class="chart-bar h-full bg-gradient-to-r from-orange-500 to-orange-400" style="width: 5%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h4 class="text-white font-semibold mb-3">Budget Execution Rate</h4>
                                        <div class="glass-dark rounded-lg p-4 mb-4">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white/70 text-sm">Total Allocated</span>
                                                <span class="text-white font-bold">$130.5M</span>
                                            </div>
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white/70 text-sm">Spent (Q1-Q3)</span>
                                                <span class="text-green-400 font-bold">$89.2M</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-white/70 text-sm">Remaining</span>
                                                <span class="text-blue-400 font-bold">$41.3M</span>
                                            </div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-4xl font-bold text-white mb-2">68.3%</div>
                                            <div class="text-white/60 text-sm">Budget Execution Rate</div>
                                            <div class="text-green-400 text-xs mt-1">On track with projections</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Service Request Statistics -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-bar text-purple-400"></i>
                                    Service Request Analytics
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div>
                                        <h4 class="text-white/70 text-sm mb-3">Top Request Categories</h4>
                                        <div class="space-y-2" id="topRequestCategories">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="text-white/70 text-sm mb-3">Resolution Time by Category</h4>
                                        <div class="space-y-2" id="resolutionTimes">
                                            <!-- Populated by JavaScript -->
                                        </div>
                                    </div>
                                    <div>
                                        <h4 class="text-white/70 text-sm mb-3">Customer Satisfaction</h4>
                                        <div class="text-center">
                                            <div class="text-5xl font-bold text-green-400 mb-2">4.7</div>
                                            <div class="flex justify-center mb-2">
                                                <i class="fas fa-star text-yellow-400"></i>
                                                <i class="fas fa-star text-yellow-400"></i>
                                                <i class="fas fa-star text-yellow-400"></i>
                                                <i class="fas fa-star text-yellow-400"></i>
                                                <i class="fas fa-star-half-alt text-yellow-400"></i>
                                            </div>
                                            <div class="text-white/60 text-sm">Based on 2,847 responses</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Module 2: Public Records Request Tracker -->
                        <div id="engagement-module-records" class="engagement-module-content">
                            <!-- Header -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">Public Records Request Portal</h2>
                                        <p class="text-white/70">Submit and track Freedom of Information Act (FOIA) requests</p>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <button onclick="window.location.href='foia-track.html'" class="px-6 py-3 glass border border-cyan-500/30 rounded-lg text-white font-semibold hover:bg-white/5 transition-all">
                                            <i class="fas fa-search mr-2"></i>Track Request
                                        </button>
                                        <button onclick="window.location.href='foia-request.html'" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                            <i class="fas fa-plus mr-2"></i>New Request
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Request Statistics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">My Active Requests</div>
                                    <div class="text-3xl font-bold text-blue-400">3</div>
                                    <div class="text-xs text-white/50 mt-2">In progress</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Completed Requests</div>
                                    <div class="text-3xl font-bold text-green-400">12</div>
                                    <div class="text-xs text-white/50 mt-2">All time</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Avg. Fulfillment Time</div>
                                    <div class="text-3xl font-bold text-purple-400">7.2</div>
                                    <div class="text-xs text-green-400 mt-2">days</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">System Average</div>
                                    <div class="text-3xl font-bold text-white">8.5</div>
                                    <div class="text-xs text-white/50 mt-2">days (statewide)</div>
                                </div>
                            </div>

                            <!-- My Requests -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-list text-blue-400"></i>
                                    My Requests
                                </h3>

                                <div class="space-y-4" id="myRecordRequestsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Popular Record Types -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-fire text-orange-400"></i>
                                    Popular Record Types
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass-dark rounded-lg p-4 hover:scale-105 transition-all cursor-pointer" onclick="quickRecordRequest('police')">
                                        <div class="flex items-center gap-3 mb-2">
                                            <i class="fas fa-shield-alt text-blue-400 text-2xl"></i>
                                            <div>
                                                <div class="text-white font-semibold">Police Reports</div>
                                                <div class="text-white/60 text-xs">Incident & accident reports</div>
                                            </div>
                                        </div>
                                        <div class="text-xs text-white/50">Avg. 5 days</div>
                                    </div>

                                    <div class="glass-dark rounded-lg p-4 hover:scale-105 transition-all cursor-pointer" onclick="quickRecordRequest('building')">
                                        <div class="flex items-center gap-3 mb-2">
                                            <i class="fas fa-building text-green-400 text-2xl"></i>
                                            <div>
                                                <div class="text-white font-semibold">Building Records</div>
                                                <div class="text-white/60 text-xs">Permits & inspections</div>
                                            </div>
                                        </div>
                                        <div class="text-xs text-white/50">Avg. 3 days</div>
                                    </div>

                                    <div class="glass-dark rounded-lg p-4 hover:scale-105 transition-all cursor-pointer" onclick="quickRecordRequest('financial')">
                                        <div class="flex items-center gap-3 mb-2">
                                            <i class="fas fa-file-invoice-dollar text-purple-400 text-2xl"></i>
                                            <div>
                                                <div class="text-white font-semibold">Financial Records</div>
                                                <div class="text-white/60 text-xs">Budget & expenditures</div>
                                            </div>
                                        </div>
                                        <div class="text-xs text-white/50">Avg. 7 days</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Module 3: Community Feedback System -->
                        <div id="engagement-module-feedback" class="engagement-module-content">
                            <!-- Header -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">Community Feedback & Ideas</h2>
                                        <p class="text-white/70">Share your ideas and help shape local policies</p>
                                    </div>
                                    <button onclick="openNewFeedbackModal()" class="px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                        <i class="fas fa-lightbulb mr-2"></i>Submit Idea
                                    </button>
                                </div>
                            </div>

                            <!-- Feedback Impact Metrics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Ideas Submitted</div>
                                    <div class="text-3xl font-bold text-purple-400">1,247</div>
                                    <div class="text-xs text-green-400 mt-2">+89 this month</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Under Review</div>
                                    <div class="text-3xl font-bold text-yellow-400">124</div>
                                    <div class="text-xs text-white/50 mt-2">Being evaluated</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Implemented</div>
                                    <div class="text-3xl font-bold text-green-400">87</div>
                                    <div class="text-xs text-green-400 mt-2">7% success rate</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Community Impact</div>
                                    <div class="text-3xl font-bold text-blue-400">23K</div>
                                    <div class="text-xs text-white/50 mt-2">citizens engaged</div>
                                </div>
                            </div>

                            <!-- Filter/Sort Options -->
                            <div class="glass rounded-xl p-4 mb-6">
                                <div class="flex flex-wrap gap-4 items-center">
                                    <div>
                                        <label class="text-white/70 text-sm mr-2">Sort by:</label>
                                        <select id="feedbackSort" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option value="popular">Most Popular</option>
                                            <option value="recent">Most Recent</option>
                                            <option value="discussed">Most Discussed</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-white/70 text-sm mr-2">Category:</label>
                                        <select id="feedbackCategory" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option value="all">All Categories</option>
                                            <option value="infrastructure">Infrastructure</option>
                                            <option value="safety">Public Safety</option>
                                            <option value="environment">Environment</option>
                                            <option value="education">Education</option>
                                            <option value="recreation">Parks & Recreation</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-white/70 text-sm mr-2">Status:</label>
                                        <select id="feedbackStatus" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm">
                                            <option value="all">All Status</option>
                                            <option value="new">New</option>
                                            <option value="review">Under Review</option>
                                            <option value="planned">Planned</option>
                                            <option value="implemented">Implemented</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Community Ideas/Feedback List -->
                            <div class="space-y-4" id="communityFeedbackList">
                                <!-- MOCK DATA - Replace in production -->
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Module 4: Town Halls & Meeting Participation -->
                        <div id="engagement-module-meetings" class="engagement-module-content">
                            <!-- Header -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">Town Halls & Public Meetings</h2>
                                        <p class="text-white/70">Participate in live or recorded government meetings</p>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center gap-2 bg-red-500/20 px-4 py-2 rounded-lg border border-red-400/30">
                                            <div class="w-3 h-3 bg-red-400 rounded-full live-indicator"></div>
                                            <span class="text-red-300 text-sm font-semibold">2 LIVE NOW</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Live Meetings -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-broadcast-tower text-red-400"></i>
                                    Live Meetings
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="liveMeetingsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Upcoming Meetings Calendar -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-calendar-alt text-blue-400"></i>
                                    Upcoming Meetings
                                </h3>

                                <div class="space-y-4" id="upcomingMeetingsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Past Meetings Archive -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-archive text-purple-400"></i>
                                    Meeting Archive
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="pastMeetingsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 5: Open Data Portal -->
                        <div id="engagement-module-opendata" class="engagement-module-content">
                            <!-- Header -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">Open Data Portal</h2>
                                        <p class="text-white/70">Explore, analyze, and download government datasets</p>
                                    </div>
                                    <button onclick="suggestDataset()" class="px-6 py-3 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                        <i class="fas fa-plus mr-2"></i>Suggest Dataset
                                    </button>
                                </div>
                            </div>

                            <!-- Data Portal Statistics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Available Datasets</div>
                                    <div class="text-3xl font-bold text-blue-400">347</div>
                                    <div class="text-xs text-green-400 mt-2">+12 this month</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Total Downloads</div>
                                    <div class="text-3xl font-bold text-green-400">28.5K</div>
                                    <div class="text-xs text-white/50 mt-2">All time</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Data Categories</div>
                                    <div class="text-3xl font-bold text-purple-400">24</div>
                                    <div class="text-xs text-white/50 mt-2">Topics covered</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Last Updated</div>
                                    <div class="text-3xl font-bold text-white">Today</div>
                                    <div class="text-xs text-green-400 mt-2">Real-time sync</div>
                                </div>
                            </div>

                            <!-- Search and Filter -->
                            <div class="glass rounded-xl p-4 mb-6">
                                <div class="flex flex-col md:flex-row gap-4">
                                    <div class="flex-1">
                                        <input type="text" id="datasetSearch" placeholder="Search datasets..." class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50">
                                    </div>
                                    <select id="datasetCategory" class="bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white">
                                        <option value="all">All Categories</option>
                                        <option value="public-safety">Public Safety</option>
                                        <option value="transportation">Transportation</option>
                                        <option value="health">Health</option>
                                        <option value="finance">Finance</option>
                                        <option value="environment">Environment</option>
                                        <option value="education">Education</option>
                                    </select>
                                    <select id="datasetFormat" class="bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white">
                                        <option value="all">All Formats</option>
                                        <option value="csv">CSV</option>
                                        <option value="json">JSON</option>
                                        <option value="xml">XML</option>
                                        <option value="api">API</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Featured Datasets -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-star text-yellow-400"></i>
                                    Featured Datasets
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="featuredDatasetsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- All Datasets -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-database text-blue-400"></i>
                                    All Datasets
                                </h3>

                                <div class="space-y-3" id="allDatasetsList">
                                    <!-- MOCK DATA - Replace in production -->
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Added 2024-11-06: Department Process Center & Workflow Builder -->
                <!-- Workflows Tab -->
                <div id="workflows-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <!-- Workflow Mode Toggle -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <h2 class="text-2xl font-bold text-white">Workflows</h2>
                            <div class="glass rounded-lg p-1 flex gap-1">
                                <button id="departmentModeBtn" onclick="switchWorkflowView('department')" class="px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white">
                                    <i class="fas fa-building mr-2"></i>Department Center
                                </button>
                                <button id="builderModeBtn" onclick="switchWorkflowView('builder')" class="px-4 py-2 rounded-lg text-sm font-medium transition-all text-white/70 hover:text-white">
                                    <i class="fas fa-project-diagram mr-2"></i>Workflow Builder
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-white/60 text-sm">
                            <i class="fas fa-info-circle"></i>
                            <span id="workflowViewDescription">Department-focused process management</span>
                        </div>
                    </div>

                    <!-- Department Process Center Mode -->
                    <div id="departmentProcessCenterMode">
                        <!-- Department Selection Hub -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4">Select Department</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="departmentHub">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                    <!-- Department Dashboard (Hidden until department selected) -->
                    <div id="departmentDashboard" class="hidden">
                        <!-- Department Header -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <div id="deptIcon" class="w-16 h-16 rounded-xl flex items-center justify-center text-white text-2xl">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <h2 id="deptName" class="text-3xl font-bold text-white">Department Name</h2>
                                        <p id="deptDescription" class="text-white/70">Department description</p>
                                    </div>
                                </div>
                                <button onclick="backToDepartments()" class="px-4 py-2 glass rounded-lg text-white hover:bg-white/20 transition-all">
                                    <i class="fas fa-arrow-left mr-2"></i>Back to Departments
                                </button>
                            </div>
                        </div>

                        <!-- Module Navigation -->
                        <div class="glass rounded-xl p-2 mb-6">
                            <div class="flex items-center space-x-2 overflow-x-auto scrollbar-thin">
                                <button onclick="switchDeptModule('overview')" class="dept-tab-button active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-dept-module="overview">
                                    <i class="fas fa-dashboard mr-2"></i>Overview
                                </button>
                                <button onclick="switchDeptModule('workflows')" class="dept-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-dept-module="workflows">
                                    <i class="fas fa-diagram-project mr-2"></i>Workflows
                                </button>
                                <button onclick="switchDeptModule('compliance')" class="dept-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-dept-module="compliance">
                                    <i class="fas fa-clipboard-check mr-2"></i>Compliance
                                </button>
                                <button onclick="switchDeptModule('knowledge')" class="dept-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-dept-module="knowledge">
                                    <i class="fas fa-book mr-2"></i>Knowledge Base
                                </button>
                                <button onclick="switchDeptModule('integration')" class="dept-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-dept-module="integration">
                                    <i class="fas fa-link mr-2"></i>Integration
                                </button>
                            </div>
                        </div>

                        <!-- Module 1: Overview Dashboard -->
                        <div id="dept-module-overview" class="dept-module-content active">
                            <!-- KPI Cards -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6" id="deptKPIs">
                                <!-- Populated by JavaScript -->
                            </div>

                            <!-- Active Workflows & Quick Actions -->
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <!-- Active Workflows -->
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-tasks text-blue-400"></i>
                                        Active Workflows
                                    </h3>
                                    <div class="space-y-3" id="activeWorkflowsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- Quick Actions -->
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-bolt text-yellow-400"></i>
                                        Quick Actions
                                    </h3>
                                    <div class="grid grid-cols-2 gap-3" id="quickActionsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-clock text-purple-400"></i>
                                    Recent Activity
                                </h3>
                                <div class="space-y-3" id="recentActivityList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 2: Workflows -->
                        <div id="dept-module-workflows" class="dept-module-content">
                            <!-- Workflow Templates -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-white">Workflow Templates</h3>
                                    <button onclick="createCustomWorkflow()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                        <i class="fas fa-plus mr-2"></i>Create Custom Workflow
                                    </button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="workflowTemplatesList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Running Workflows -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4">Running Workflows</h3>
                                <div class="space-y-4" id="runningWorkflowsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 3: Compliance -->
                        <div id="dept-module-compliance" class="dept-module-content">
                            <!-- Compliance Overview -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Compliance Score</div>
                                    <div class="text-3xl font-bold text-green-400 mb-2">98.5%</div>
                                    <div class="text-xs text-green-400">All regulations met</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Active Audits</div>
                                    <div class="text-3xl font-bold text-blue-400 mb-2">3</div>
                                    <div class="text-xs text-white/50">In progress</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Pending Reviews</div>
                                    <div class="text-3xl font-bold text-yellow-400 mb-2">7</div>
                                    <div class="text-xs text-yellow-400">Requires attention</div>
                                </div>
                            </div>

                            <!-- Compliance Monitoring -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-shield-check text-green-400"></i>
                                    Compliance Monitoring
                                </h3>
                                <div class="space-y-4" id="complianceMonitoringList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Audit Trail -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-file-alt text-blue-400"></i>
                                    Audit Trail
                                </h3>
                                <div class="space-y-3" id="auditTrailList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 4: Knowledge Base -->
                        <div id="dept-module-knowledge" class="dept-module-content">
                            <!-- Search -->
                            <div class="glass rounded-xl p-4 mb-6">
                                <div class="flex gap-3">
                                    <input type="text" id="knowledgeSearch" placeholder="Search best practices, regulations, and procedures..." class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50">
                                    <button onclick="searchKnowledge()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                        <i class="fas fa-search mr-2"></i>Search
                                    </button>
                                </div>
                            </div>

                            <!-- Knowledge Categories -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <!-- Best Practices -->
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-lightbulb text-yellow-400"></i>
                                        Best Practices
                                    </h3>
                                    <div class="space-y-2" id="bestPracticesList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- Regulations -->
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-gavel text-blue-400"></i>
                                        Regulations
                                    </h3>
                                    <div class="space-y-2" id="regulationsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- AI Suggestions -->
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-brain text-purple-400"></i>
                                        AI Suggestions
                                    </h3>
                                    <div class="space-y-2" id="aiSuggestionsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Document Library -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-folder text-blue-400"></i>
                                    Document Library
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="documentLibraryList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 5: Integration -->
                        <div id="dept-module-integration" class="dept-module-content">
                            <!-- Cross-Department Connections -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-link text-blue-400"></i>
                                    Cross-Department Connections
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="crossDeptConnectionsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Workflow Handoffs -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-exchange-alt text-purple-400"></i>
                                    Workflow Handoffs
                                </h3>
                                <div class="space-y-4" id="workflowHandoffsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Shared Documents -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-share-nodes text-green-400"></i>
                                    Shared Document Repositories
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="sharedDocsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <!-- End Department Process Center Mode -->

                    <!-- Workflow Builder Mode -->
                    <div id="workflowBuilderMode" class="hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-robot text-white text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-xl font-bold text-white">AI Workflow Builder</h3>
                                        <p class="text-sm text-white/70">Describe your workflow in plain language</p>
                                    </div>
                                </div>
                                <button onclick="createBlankWorkflow()" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                    <i class="fas fa-plus mr-2"></i>Create Blank Workflow
                                </button>
                            </div>

                            <textarea
                                id="aiWorkflowInput"
                                rows="4"
                                placeholder="Example: Create a permit approval workflow with document validation, supervisor review, and email notifications..."
                                class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3"
                                aria-label="Describe your workflow"></textarea>

                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <button onclick="loadWorkflowExample('permit')" class="text-sm px-3 py-2 bg-purple-500/20 rounded-lg text-purple-300 hover:bg-purple-500/30 transition-all">
                                        <i class="fas fa-building mr-1"></i>Permit Example
                                    </button>
                                    <button onclick="loadWorkflowExample('hr')" class="text-sm px-3 py-2 bg-blue-500/20 rounded-lg text-blue-300 hover:bg-blue-500/30 transition-all">
                                        <i class="fas fa-users mr-1"></i>HR Example
                                    </button>
                                    <button onclick="loadWorkflowExample('invoice')" class="text-sm px-3 py-2 bg-green-500/20 rounded-lg text-green-300 hover:bg-green-500/30 transition-all">
                                        <i class="fas fa-file-invoice mr-1"></i>Invoice Example
                                    </button>
                                </div>
                                <button onclick="generateWorkflowFromAI()" class="px-6 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                    <i class="fas fa-magic mr-2"></i>Generate Workflow
                                </button>
                            </div>
                        </div>

                        <!-- Workflow Canvas -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-project-diagram text-blue-400"></i>
                                Workflow Canvas
                            </h3>
                            <div id="workflowCanvas" class="bg-white/5 rounded-lg p-8 min-h-[400px] border-2 border-dashed border-white/20">
                                <div class="flex flex-col items-center justify-center h-full text-center">
                                    <i class="fas fa-diagram-project text-white/30 text-6xl mb-4"></i>
                                    <p class="text-white/60 mb-2">No workflow loaded</p>
                                    <p class="text-white/40 text-sm">Use the AI builder above or create a blank workflow to get started</p>
                                </div>
                            </div>
                        </div>

                        <!-- Workflow Library -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-folder text-yellow-400"></i>
                                Saved Workflows
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="savedWorkflowsList">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                    <!-- End Workflow Builder Mode -->
                </div>

                <!-- Save Workflow Modal -->
                <div id="saveModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50" role="dialog" aria-labelledby="saveModalTitle">
                    <div class="glass rounded-xl p-6 max-w-md w-full mx-4">
                        <h3 id="saveModalTitle" class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                            <i class="fas fa-save text-green-400"></i>
                            Save Workflow
                        </h3>
                        <div class="mb-6">
                            <label for="workflowName" class="block text-white/70 text-sm mb-2">Workflow Name</label>
                            <input
                                type="text"
                                id="workflowName"
                                class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/30 focus:outline-none focus:border-blue-400 transition-all"
                                placeholder="e.g., Permit Application Process"
                                aria-label="Enter workflow name">
                        </div>
                        <div class="flex gap-3">
                            <button
                                id="cancelSave"
                                class="flex-1 px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-all"
                                aria-label="Cancel">
                                Cancel
                            </button>
                            <button
                                id="confirmSave"
                                class="flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg text-white hover:shadow-lg transition-all font-medium"
                                aria-label="Confirm save">
                                <i class="fas fa-check mr-2"></i>Save
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Security Analysis Tab -->
                <div id="security-content" class="tab-content" style="display: none;">
                    <!-- Quantum-Ready Security Module - Added 2025-10-07 -->
                    <div id="quantumSecurityModule">
                        <!-- Quantum Security content will be injected here by JavaScript -->
                    </div>

                    <!-- Enhanced 2024-10-30: Advanced Security Operations Center -->
                    <!-- Security Module Navigation -->
                    <div class="glass rounded-xl p-2 mb-6">
                        <div class="flex items-center space-x-2 overflow-x-auto">
                            <button onclick="switchSecurityModule('dashboard')" class="security-module-tab active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-security-module="dashboard">
                                <i class="fas fa-chart-line mr-2"></i>Threat Dashboard
                            </button>
                            <button onclick="switchSecurityModule('behavioral')" class="security-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-security-module="behavioral">
                                <i class="fas fa-brain mr-2"></i>Behavioral Analytics
                            </button>
                            <button onclick="switchSecurityModule('incidents')" class="security-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-security-module="incidents">
                                <i class="fas fa-robot mr-2"></i>Incident Response
                            </button>
                            <button onclick="switchSecurityModule('compliance')" class="security-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-security-module="compliance">
                                <i class="fas fa-clipboard-check mr-2"></i>Compliance Reports
                            </button>
                        </div>
                    </div>

                    <!-- Module 1: Threat Dashboard (Enhanced existing content) -->
                    <div id="security-module-dashboard" class="security-module-content">
                    <!-- Security Action Bar -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-4">
                            <button onclick="runSecurityScan()" class="bg-gradient-to-r from-red-500 to-red-600 px-4 py-2 rounded-lg hover:shadow-lg transition-all text-white">
                                <i class="fas fa-search mr-2"></i>Run Full Scan
                            </button>
                            <button onclick="generateSecurityReport()" class="bg-gradient-to-r from-blue-500 to-blue-600 px-4 py-2 rounded-lg hover:shadow-lg transition-all text-white">
                                <i class="fas fa-file-alt mr-2"></i>Generate Report
                            </button>
                            <button onclick="openDiagnostics()" class="bg-gradient-to-r from-purple-500 to-purple-600 px-4 py-2 rounded-lg hover:shadow-lg transition-all text-white">
                                <i class="fas fa-stethoscope mr-2"></i>Diagnostics
                            </button>
                            <button onclick="openCJISConfig()" class="bg-gradient-to-r from-green-500 to-green-600 px-4 py-2 rounded-lg hover:shadow-lg transition-all text-white">
                                <i class="fas fa-shield-alt mr-2"></i>CJIS Config
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                            <span class="text-green-300 text-sm font-medium">Real-time Monitoring Active</span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Threat Detection -->
                        <div class="lg:col-span-2 glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Real-Time Threat Detection</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-red-400 rounded-full threat-indicator"></div>
                                    <span class="text-red-300 text-sm font-medium">3 Active Threats</span>
                                    <button onclick="refreshThreats()" class="ml-2 text-white/60 hover:text-white">
                                        <i class="fas fa-sync-alt text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="space-y-3" id="threatsList">
                                <div class="security-alert bg-red-500/20 border border-red-500/50 rounded-lg p-4 hover:bg-red-500/30 transition-colors cursor-pointer" onclick="showThreatDetails('threat1')">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                                            <span class="text-red-300 font-medium">Suspicious Login Attempts</span>
                                        </div>
                                        <span class="text-xs bg-red-500 text-white px-2 py-1 rounded">CRITICAL</span>
                                    </div>
                                    <p class="text-sm text-white/70 mb-2">Multiple failed login attempts from IP 192.168.1.100</p>
                                    <div class="flex items-center justify-between">
                                        <div class="text-xs text-red-300">2 minutes ago â€¢ 15 attempts</div>
                                        <div class="flex space-x-2">
                                            <button onclick="blockIP('192.168.1.100')" class="text-xs bg-red-600 text-white px-2 py-1 rounded hover:bg-red-700">Block IP</button>
                                            <button onclick="investigateThreat('threat1')" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Investigate</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-4 hover:bg-yellow-500/30 transition-colors cursor-pointer" onclick="showThreatDetails('threat2')">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-clock text-yellow-400"></i>
                                            <span class="text-yellow-300 font-medium">Unusual Data Access</span>
                                        </div>
                                        <span class="text-xs bg-yellow-500 text-white px-2 py-1 rounded">MEDIUM</span>
                                    </div>
                                    <p class="text-sm text-white/70 mb-2">Tax database accessed outside normal hours</p>
                                    <div class="flex items-center justify-between">
                                        <div class="text-xs text-yellow-300">15 minutes ago â€¢ User: admin_user</div>
                                        <div class="flex space-x-2">
                                            <button onclick="auditAccess('tax_db')" class="text-xs bg-yellow-600 text-white px-2 py-1 rounded hover:bg-yellow-700">Audit Log</button>
                                            <button onclick="notifyAdmin('unusual_access')" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Notify Admin</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-orange-500/20 border border-orange-500/50 rounded-lg p-4 hover:bg-orange-500/30 transition-colors cursor-pointer" onclick="showThreatDetails('threat3')">
                                    <div class="flex items-center justify-between mb-2">
                                        <div class="flex items-center space-x-2">
                                            <i class="fas fa-tachometer-alt text-orange-400"></i>
                                            <span class="text-orange-300 font-medium">API Rate Limit Exceeded</span>
                                        </div>
                                        <span class="text-xs bg-orange-500 text-white px-2 py-1 rounded">MEDIUM</span>
                                    </div>
                                    <p class="text-sm text-white/70 mb-2">Permit API receiving 500+ req/min from 203.45.67.89</p>
                                    <div class="flex items-center justify-between">
                                        <div class="text-xs text-orange-300">1 hour ago â€¢ 2,847 requests</div>
                                        <div class="flex space-x-2">
                                            <button onclick="throttleAPI('permit_api')" class="text-xs bg-orange-600 text-white px-2 py-1 rounded hover:bg-orange-700">Apply Throttle</button>
                                            <button onclick="analyzeTraffic('permit_api')" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">Analyze</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Security Score -->
                        <div class="glass rounded-xl p-6">
                            <div class="text-center mb-6">
                                <h3 class="text-lg font-semibold text-white mb-4">Security Score</h3>
                                <div class="relative w-32 h-32 mx-auto">
                                    <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="rgb(75 85 99)" stroke-width="8"/>
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="rgb(16 185 129)" stroke-width="8" 
                                                stroke-linecap="round" stroke-dasharray="251.2" stroke-dashoffset="62.8"/>
                                    </svg>
                                    <div class="absolute inset-0 flex items-center justify-center">
                                        <div class="text-center">
                                            <div class="text-2xl font-bold text-green-400">75</div>
                                            <div class="text-xs text-white/70">/ 100</div>
                                        </div>
                                    </div>
                                </div>
                                <p class="text-green-300 text-sm mt-2">Good Security Posture</p>
                            </div>
                            
                            <div class="space-y-3">
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-white/70">Vulnerabilities</span>
                                    <span class="text-yellow-300">2 Low</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-white/70">Last Scan</span>
                                    <span class="text-white">2 hours ago</span>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <span class="text-white/70">Patches Pending</span>
                                    <span class="text-blue-300">3 Available</span>
                                </div>
                                <button onclick="viewSecurityDetails()" class="w-full mt-4 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                    View Detailed Report
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Diagnostics & Monitoring -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Live Network Monitoring -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Network Monitoring</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                    <span class="text-green-300 text-xs">Live</span>
                                </div>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-globe text-blue-400"></i>
                                        <div>
                                            <p class="text-white text-sm font-medium">Inbound Traffic</p>
                                            <p class="text-white/60 text-xs">HTTP/HTTPS Requests</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-green-400 font-bold">1,247/min</p>
                                        <p class="text-green-300 text-xs">â†‘ 12% normal</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-shield-alt text-green-400"></i>
                                        <div>
                                            <p class="text-white text-sm font-medium">Firewall Blocks</p>
                                            <p class="text-white/60 text-xs">Malicious Traffic</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-red-400 font-bold">23/min</p>
                                        <p class="text-red-300 text-xs">â†“ 45% from peak</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-database text-purple-400"></i>
                                        <div>
                                            <p class="text-white text-sm font-medium">Database Queries</p>
                                            <p class="text-white/60 text-xs">Active Connections</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-blue-400 font-bold">89 active</p>
                                        <p class="text-blue-300 text-xs">12ms avg response</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Health Diagnostics -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">System Diagnostics</h3>
                                <button onclick="runDiagnostics()" class="text-blue-400 hover:text-blue-300 text-sm">
                                    <i class="fas fa-play mr-1"></i>Run Tests
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-server text-green-400"></i>
                                        <span class="text-white text-sm">Server Health</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                        <span class="text-green-300 text-sm">Healthy</span>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-memory text-yellow-400"></i>
                                        <span class="text-white text-sm">Memory Usage</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-16 bg-white/20 rounded-full h-2">
                                            <div class="bg-yellow-400 h-2 rounded-full" style="width: 67%"></div>
                                        </div>
                                        <span class="text-yellow-300 text-sm">67%</span>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-hdd text-blue-400"></i>
                                        <span class="text-white text-sm">Disk Space</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-16 bg-white/20 rounded-full h-2">
                                            <div class="bg-blue-400 h-2 rounded-full" style="width: 45%"></div>
                                        </div>
                                        <span class="text-blue-300 text-sm">45%</span>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <i class="fas fa-microchip text-green-400"></i>
                                        <span class="text-white text-sm">CPU Load</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-16 bg-white/20 rounded-full h-2">
                                            <div class="bg-green-400 h-2 rounded-full" style="width: 34%"></div>
                                        </div>
                                        <span class="text-green-300 text-sm">34%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Security Tools -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Vulnerability Scanner -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-white">Vulnerability Scanner</h4>
                                <i class="fas fa-bug text-red-400"></i>
                            </div>
                            <div class="space-y-3">
                                <div class="text-sm text-white/70">Last scan: 2 hours ago</div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-white">Critical</span>
                                    <span class="text-red-400 font-bold">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-white">High</span>
                                    <span class="text-orange-400 font-bold">0</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-white">Medium</span>
                                    <span class="text-yellow-400 font-bold">2</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm text-white">Low</span>
                                    <span class="text-green-400 font-bold">5</span>
                                </div>
                                <button onclick="startVulnerabilityScan()" class="w-full mt-4 bg-red-600 text-white py-2 rounded-lg hover:bg-red-700 transition-colors text-sm">
                                    <i class="fas fa-search mr-2"></i>Start New Scan
                                </button>
                            </div>
                        </div>
                        
                        <!-- Penetration Testing -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-white">Penetration Test</h4>
                                <i class="fas fa-crosshairs text-purple-400"></i>
                            </div>
                            <div class="space-y-3">
                                <div class="text-sm text-white/70">Simulated attacks to test defenses</div>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">SQL Injection</span>
                                        <span class="text-green-400">âœ“ Blocked</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">XSS Attempts</span>
                                        <span class="text-green-400">âœ“ Blocked</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">Brute Force</span>
                                        <span class="text-yellow-400">âš  Partial</span>
                                    </div>
                                </div>
                                <button onclick="startPenetrationTest()" class="w-full mt-4 bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                    <i class="fas fa-shield-alt mr-2"></i>Run Pen Test
                                </button>
                            </div>
                        </div>
                        
                        <!-- Security Audit -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="text-lg font-semibold text-white">Security Audit</h4>
                                <i class="fas fa-clipboard-check text-blue-400"></i>
                            </div>
                            <div class="space-y-3">
                                <div class="text-sm text-white/70">Compliance & policy checks</div>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">Password Policy</span>
                                        <span class="text-green-400">âœ“ Compliant</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">Data Encryption</span>
                                        <span class="text-green-400">âœ“ AES-256</span>
                                    </div>
                                    <div class="flex items-center justify-between text-sm">
                                        <span class="text-white">Access Controls</span>
                                        <span class="text-yellow-400">âš  Review</span>
                                    </div>
                                </div>
                                <button onclick="generateAuditReport()" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                    <i class="fas fa-file-alt mr-2"></i>Generate Audit
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Security Recommendations -->
                    <div class="glass rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-white">AI Security Recommendations</h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                                <span class="text-blue-300 text-xs">AI Analyzing</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-start space-x-3 p-4 bg-blue-500/20 rounded-lg hover:bg-blue-500/30 transition-colors">
                                <i class="fas fa-lightbulb text-blue-400 mt-1"></i>
                                <div class="flex-1">
                                    <h4 class="font-medium text-white">Implement Rate Limiting</h4>
                                    <p class="text-sm text-white/70 mt-1">Add rate limiting to permit API to prevent potential DDoS attacks</p>
                                    <div class="flex space-x-2 mt-3">
                                        <button onclick="applyRecommendation('rate_limiting')" class="text-blue-400 text-sm hover:text-blue-300">Apply â†’</button>
                                        <button onclick="dismissRecommendation('rate_limiting')" class="text-white/60 text-sm hover:text-white/80">Dismiss</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 p-4 bg-green-500/20 rounded-lg hover:bg-green-500/30 transition-colors">
                                <i class="fas fa-shield-alt text-green-400 mt-1"></i>
                                <div class="flex-1">
                                    <h4 class="font-medium text-white">Enhanced Authentication</h4>
                                    <p class="text-sm text-white/70 mt-1">Enable 2FA for all administrative accounts to improve security</p>
                                    <div class="flex space-x-2 mt-3">
                                        <button onclick="applyRecommendation('2fa')" class="text-green-400 text-sm hover:text-green-300">Apply â†’</button>
                                        <button onclick="dismissRecommendation('2fa')" class="text-white/60 text-sm hover:text-white/80">Dismiss</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 p-4 bg-purple-500/20 rounded-lg hover:bg-purple-500/30 transition-colors">
                                <i class="fas fa-eye text-purple-400 mt-1"></i>
                                <div class="flex-1">
                                    <h4 class="font-medium text-white">Audit Log Monitoring</h4>
                                    <p class="text-sm text-white/70 mt-1">Set up automated monitoring for unusual database access patterns</p>
                                    <div class="flex space-x-2 mt-3">
                                        <button onclick="applyRecommendation('audit_monitoring')" class="text-purple-400 text-sm hover:text-purple-300">Apply â†’</button>
                                        <button onclick="dismissRecommendation('audit_monitoring')" class="text-white/60 text-sm hover:text-white/80">Dismiss</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3 p-4 bg-yellow-500/20 rounded-lg hover:bg-yellow-500/30 transition-colors">
                                <i class="fas fa-key text-yellow-400 mt-1"></i>
                                <div class="flex-1">
                                    <h4 class="font-medium text-white">SSL Certificate Renewal</h4>
                                    <p class="text-sm text-white/70 mt-1">SSL certificate expires in 30 days. Set up automatic renewal</p>
                                    <div class="flex space-x-2 mt-3">
                                        <button onclick="applyRecommendation('ssl_renewal')" class="text-yellow-400 text-sm hover:text-yellow-300">Apply â†’</button>
                                        <button onclick="dismissRecommendation('ssl_renewal')" class="text-white/60 text-sm hover:text-white/80">Dismiss</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Federal Compliance & Enterprise Integration Dashboard -->
                    <div class="glass rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center space-x-3">
                                <h4 class="text-xl font-semibold text-white">Enterprise Compliance Center</h4>
                                <div class="flex items-center space-x-2 bg-emerald-500/20 px-3 py-1.5 rounded-lg border border-emerald-400/30">
                                    <i class="fas fa-check-circle text-emerald-400 text-sm"></i>
                                    <span class="text-emerald-300 text-sm font-semibold">Fully Compliant</span>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="exportComplianceReport()" class="bg-emerald-600/20 hover:bg-emerald-600/30 text-emerald-300 px-4 py-2 rounded-lg transition-colors flex items-center space-x-2 border border-emerald-500/30">
                                    <i class="fas fa-file-shield text-sm"></i>
                                    <span class="font-medium">Export Report</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Compliance Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-gradient-to-br from-emerald-500/20 to-green-500/20 rounded-xl p-4 border border-emerald-400/30">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-white/70 font-medium">CJIS Compliance</span>
                                    <i class="fas fa-check-circle text-emerald-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-white mb-1">100%</div>
                                <div class="text-xs text-emerald-400 font-medium">Fully Certified</div>
                                <div class="w-full bg-white/10 rounded-full h-1.5 mt-2">
                                    <div class="bg-emerald-400 h-1.5 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-blue-500/20 to-indigo-500/20 rounded-xl p-4 border border-blue-400/30">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-white/70 font-medium">FedRAMP High</span>
                                    <i class="fas fa-shield-alt text-blue-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-white mb-1">IL5</div>
                                <div class="text-xs text-blue-400 font-medium">Impact Level 5</div>
                                <div class="w-full bg-white/10 rounded-full h-1.5 mt-2">
                                    <div class="bg-blue-400 h-1.5 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-xl p-4 border border-purple-400/30">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-white/70 font-medium">Quantum Encryption</span>
                                    <i class="fas fa-lock text-purple-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-white mb-1">AES-256</div>
                                <div class="text-xs text-purple-400 font-medium">Post-Quantum</div>
                                <div class="w-full bg-white/10 rounded-full h-1.5 mt-2">
                                    <div class="bg-purple-400 h-1.5 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-xl p-4 border border-orange-400/30">
                                <div class="flex items-center justify-between mb-3">
                                    <span class="text-white/70 font-medium">Audit Intelligence</span>
                                    <i class="fas fa-file-alt text-orange-400"></i>
                                </div>
                                <div class="text-2xl font-bold text-white mb-1">24/7</div>
                                <div class="text-xs text-orange-400 font-medium">Real-time</div>
                                <div class="w-full bg-white/10 rounded-full h-1.5 mt-2">
                                    <div class="bg-orange-400 h-1.5 rounded-full" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Enterprise Integration Matrix -->
                        <div class="bg-black/20 rounded-xl p-6">
                            <h5 class="text-white font-semibold mb-4 flex items-center space-x-2">
                                <i class="fas fa-network-wired text-blue-400"></i>
                                <span>Enterprise Integration Matrix</span>
                            </h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="space-y-3">
                                    <h6 class="text-white/70 font-medium text-sm">Identity Management</h6>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">Active Directory</span>
                                            </div>
                                            <span class="text-emerald-400 text-xs font-medium">Connected</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">SAML 2.0</span>
                                            </div>
                                            <span class="text-emerald-400 text-xs font-medium">Active</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-emerald-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">OAuth 2.1</span>
                                            </div>
                                            <span class="text-emerald-400 text-xs font-medium">Enabled</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <h6 class="text-white/70 font-medium text-sm">Security Framework</h6>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">Zero Trust</span>
                                            </div>
                                            <span class="text-blue-400 text-xs font-medium">Enforced</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">MFA Required</span>
                                            </div>
                                            <span class="text-blue-400 text-xs font-medium">100%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-blue-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">RBAC</span>
                                            </div>
                                            <span class="text-blue-400 text-xs font-medium">Dynamic</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <h6 class="text-white/70 font-medium text-sm">Data Intelligence</h6>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">ML Pipeline</span>
                                            </div>
                                            <span class="text-purple-400 text-xs font-medium">Running</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">Data Lake</span>
                                            </div>
                                            <span class="text-purple-400 text-xs font-medium">Synced</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-2 h-2 bg-purple-400 rounded-full"></div>
                                                <span class="text-white/70 text-sm">Analytics</span>
                                            </div>
                                            <span class="text-purple-400 text-xs font-medium">Real-time</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CJIS Security Compliance Configuration - Added 2025-10-27 -->
                    <div id="cjisSecurityConfig" class="hidden mt-6">
                        <!-- Compliance Score Header -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h2 class="text-2xl font-bold text-white mb-2 flex items-center gap-3">
                                        <i class="fas fa-shield-alt text-green-400"></i>
                                        CJIS Security Compliance Configuration
                                        <span class="text-xs bg-gradient-to-r from-green-500 to-blue-500 text-white px-3 py-1 rounded-full">98.7% Compliant</span>
                                    </h2>
                                    <p class="text-white/70">Enhanced authentication, FIPS 140-2 encryption, and comprehensive audit logging</p>
                                </div>
                                <button onclick="closeCJISConfig()" class="text-white/60 hover:text-white text-xl">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- Compliance Metrics -->
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-sm mb-1">Overall Compliance</div>
                                    <div class="text-2xl font-bold text-green-400">98.7%</div>
                                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-check mr-1"></i>Excellent</div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-sm mb-1">Authentication</div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-user-shield mr-1"></i>Enforced</div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-sm mb-1">Encryption</div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-key mr-1"></i>FIPS Mode</div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-sm mb-1">Audit Logging</div>
                                    <div class="text-2xl font-bold text-blue-400">97.5%</div>
                                    <div class="text-white/60 text-sm mt-1"><i class="fas fa-clipboard-list mr-1"></i>Active</div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-sm mb-1">Security Events</div>
                                    <div class="text-2xl font-bold text-yellow-400">12</div>
                                    <div class="text-white/60 text-sm mt-1"><i class="fas fa-bell mr-1"></i>Last 24h</div>
                                </div>
                            </div>
                        </div>

                        <!-- Configuration Tabs -->
                        <div class="glass rounded-xl p-2 mb-6">
                            <div class="flex gap-2 overflow-x-auto">
                                <button class="cjis-tab-button active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition" data-cjis-tab="authentication" onclick="switchCJISTab('authentication')">
                                    <i class="fas fa-user-lock mr-2"></i>Authentication
                                </button>
                                <button class="cjis-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition" data-cjis-tab="encryption" onclick="switchCJISTab('encryption')">
                                    <i class="fas fa-lock mr-2"></i>Encryption
                                </button>
                                <button class="cjis-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition" data-cjis-tab="audit" onclick="switchCJISTab('audit')">
                                    <i class="fas fa-clipboard-list mr-2"></i>Audit Logging
                                </button>
                            </div>
                        </div>

                        <!-- Authentication Config -->
                        <div id="cjis-authentication" class="cjis-tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2 space-y-6">
                                    <!-- MFA Settings -->
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <i class="fas fa-mobile-alt text-blue-400"></i>
                                            Multi-Factor Authentication
                                            <span class="ml-auto text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">Required</span>
                                        </h3>
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between p-4 glass rounded-lg">
                                                <div class="flex-1">
                                                    <h4 class="text-white font-semibold mb-1">Enforce MFA for All Users</h4>
                                                    <p class="text-white/60 text-sm">CJIS Policy 5.6.2.2 compliance</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" checked disabled class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                            <div class="flex items-center justify-between p-4 glass rounded-lg">
                                                <div class="flex-1">
                                                    <h4 class="text-white font-semibold mb-1">Biometric Authentication</h4>
                                                    <p class="text-white/60 text-sm">Fingerprint or facial recognition</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" checked class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                            <div class="flex items-center justify-between p-4 glass rounded-lg">
                                                <div class="flex-1">
                                                    <h4 class="text-white font-semibold mb-1">Hardware Security Keys</h4>
                                                    <p class="text-white/60 text-sm">FIDO2/WebAuthn (YubiKey)</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" checked class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Password Policy -->
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                                            <i class="fas fa-key text-purple-400 mr-2"></i>
                                            Advanced Password Policy
                                        </h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div class="glass rounded-lg p-4">
                                                <label class="text-white/70 text-sm mb-2 block">Minimum Length</label>
                                                <input type="number" value="12" min="8" max="64" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <p class="text-white/50 text-xs mt-1">CJIS minimum: 8 characters</p>
                                            </div>
                                            <div class="glass rounded-lg p-4">
                                                <label class="text-white/70 text-sm mb-2 block">Password Expiration (days)</label>
                                                <input type="number" value="90" min="30" max="365" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <p class="text-white/50 text-xs mt-1">CJIS max: 90 days</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Status Column -->
                                <div class="space-y-6">
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-lg font-bold text-white mb-4">Authentication Status</h3>
                                        <div class="space-y-4">
                                            <div>
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-white/80 text-sm">MFA Enrollment</span>
                                                    <span class="text-green-400 font-semibold">87%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 87%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-white/80 text-sm">Password Compliance</span>
                                                    <span class="text-green-400 font-semibold">94%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 94%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Encryption Config -->
                        <div id="cjis-encryption" class="cjis-tab-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2 space-y-6">
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <i class="fas fa-certificate text-blue-400"></i>
                                            FIPS 140-2 Encryption
                                            <span class="ml-auto text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">Enabled</span>
                                        </h3>
                                        <div class="glass rounded-lg p-4">
                                            <h4 class="text-white font-semibold mb-3">Encryption Algorithms</h4>
                                            <div class="space-y-2">
                                                <div class="flex items-center justify-between">
                                                    <span class="text-white/80 text-sm">Data at Rest</span>
                                                    <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full font-semibold">AES-256-GCM</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-white/80 text-sm">Data in Transit</span>
                                                    <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full font-semibold">TLS 1.3</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-white/80 text-sm">Key Exchange</span>
                                                    <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full font-semibold">ECDHE</span>
                                                </div>
                                                <div class="flex items-center justify-between">
                                                    <span class="text-white/80 text-sm">Hashing</span>
                                                    <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full font-semibold">SHA-384</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-4 p-4 bg-green-500/10 border border-green-500/30 rounded-lg">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-green-400 mt-1"></i>
                                                <div>
                                                    <p class="text-white text-sm font-semibold mb-1">FIPS 140-2 Validated</p>
                                                    <p class="text-white/70 text-sm">All cryptographic operations use NIST-certified modules (Certificate #3245)</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-lg font-bold text-white mb-4">Encryption Coverage</h3>
                                        <div class="space-y-4">
                                            <div>
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-white/80 text-sm">Data at Rest</span>
                                                    <span class="text-green-400 font-semibold">100%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex items-center justify-between mb-2">
                                                    <span class="text-white/80 text-sm">Data in Transit</span>
                                                    <span class="text-green-400 font-semibold">100%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-green-500 h-2 rounded-full" style="width: 100%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Audit Logging Config -->
                        <div id="cjis-audit" class="cjis-tab-content hidden">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <div class="lg:col-span-2 space-y-6">
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                            <i class="fas fa-clipboard-list text-blue-400"></i>
                                            Comprehensive Audit Logging
                                            <span class="ml-auto text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">Active</span>
                                        </h3>
                                        <div class="space-y-4">
                                            <div class="flex items-center justify-between p-4 glass rounded-lg">
                                                <div class="flex-1">
                                                    <h4 class="text-white font-semibold mb-1">Authentication Events</h4>
                                                    <p class="text-white/60 text-sm">Login, logout, failed attempts, MFA events</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" checked disabled class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                            <div class="flex items-center justify-between p-4 glass rounded-lg">
                                                <div class="flex-1">
                                                    <h4 class="text-white font-semibold mb-1">Data Access Logging</h4>
                                                    <p class="text-white/60 text-sm">All CJI data access tracking</p>
                                                </div>
                                                <label class="relative inline-flex items-center cursor-pointer">
                                                    <input type="checkbox" checked disabled class="sr-only peer">
                                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                                                </label>
                                            </div>
                                        </div>

                                        <div class="mt-6">
                                            <h4 class="text-white font-semibold mb-4">Log Retention</h4>
                                            <div class="grid grid-cols-2 gap-4">
                                                <div class="glass rounded-lg p-4">
                                                    <label class="text-white/70 text-sm mb-2 block">Retention Period (years)</label>
                                                    <input type="number" value="7" min="1" max="10" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                    <p class="text-white/50 text-xs mt-1">CJIS minimum: 7 years</p>
                                                </div>
                                                <div class="glass rounded-lg p-4">
                                                    <label class="text-white/70 text-sm mb-2 block">Current Log Size</label>
                                                    <div class="text-blue-400 font-semibold text-lg">24.7 GB</div>
                                                    <p class="text-white/50 text-xs mt-1">45% of capacity</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-6">
                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-lg font-bold text-white mb-4">Audit Statistics</h3>
                                        <div class="space-y-3">
                                            <div class="flex items-center justify-between">
                                                <span class="text-white/80 text-sm">Events Today</span>
                                                <span class="text-white font-semibold">1,847</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-white/80 text-sm">Auth Events</span>
                                                <span class="text-blue-400 font-semibold">342</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-white/80 text-sm">Data Access</span>
                                                <span class="text-green-400 font-semibold">1,205</span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-white/80 text-sm">Security Events</span>
                                                <span class="text-red-400 font-semibold">12</span>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="glass rounded-xl p-6">
                                        <h3 class="text-lg font-bold text-white mb-4">CJIS Requirements</h3>
                                        <div class="space-y-3">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-green-400 mt-1"></i>
                                                <div>
                                                    <p class="text-white text-sm font-semibold">7-Year Retention</p>
                                                    <p class="text-white/60 text-xs">Policy 5.11</p>
                                                </div>
                                            </div>
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-check-circle text-green-400 mt-1"></i>
                                                <div>
                                                    <p class="text-white text-sm font-semibold">Tamper Detection</p>
                                                    <p class="text-white/60 text-xs">Policy 5.11.2</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Save Button -->
                        <div class="mt-6 flex justify-end">
                            <button onclick="saveCJISConfiguration()" class="bg-gradient-to-r from-green-500 to-green-600 px-6 py-3 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                <i class="fas fa-save mr-2"></i>Save Configuration
                            </button>
                        </div>
                    </div>
                    </div>
                    <!-- End Module 1: Threat Dashboard -->

                    <!-- Module 2: Behavioral Analytics & Anomaly Detection -->
                    <!-- Added 2024-10-30: Advanced Security Operations Center Enhancement -->
                    <div id="security-module-behavioral" class="security-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-brain text-purple-400"></i>
                                AI-Powered Behavioral Analytics
                                <span class="text-xs bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full">Machine Learning</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Advanced machine learning algorithms analyze user behavior patterns to detect anomalies, insider threats, and account compromises in real-time.
                            </p>

                            <!-- Anomaly Detection Dashboard -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Behavioral Models</div>
                                    <div class="text-2xl font-bold text-white">247</div>
                                    <div class="text-green-400 text-xs mt-1">Active user profiles</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Anomalies Detected</div>
                                    <div class="text-2xl font-bold text-yellow-400">18</div>
                                    <div class="text-white/60 text-xs mt-1">Last 24 hours</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">False Positive Rate</div>
                                    <div class="text-2xl font-bold text-green-400">0.8%</div>
                                    <div class="text-green-400 text-xs mt-1">
                                        <i class="fas fa-arrow-down mr-1"></i>-0.2% this month
                                    </div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Risk Score Avg</div>
                                    <div class="text-2xl font-bold text-blue-400">23/100</div>
                                    <div class="text-green-400 text-xs mt-1">Low risk environment</div>
                                </div>
                            </div>

                            <!-- Active Anomalies -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                    <i class="fas fa-exclamation-circle text-yellow-400"></i>
                                    Active Behavioral Anomalies
                                </h4>
                                <div class="space-y-3">
                                    <!-- Anomaly 1 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div>
                                                <div class="text-white font-medium">Unusual Data Access Pattern</div>
                                                <div class="text-white/60 text-sm">User: sarah.johnson@agency.gov</div>
                                            </div>
                                            <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full text-xs font-semibold">Risk: 67/100</span>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                            <div>
                                                <div class="text-white/50 text-xs">Baseline Access</div>
                                                <div class="text-white text-sm">120 records/day</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Current Access</div>
                                                <div class="text-yellow-400 text-sm">847 records/day</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Time</div>
                                                <div class="text-white text-sm">02:47 AM</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Location</div>
                                                <div class="text-white text-sm">Remote VPN</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-lock mr-2"></i>Suspend Access
                                            </button>
                                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-user-check mr-2"></i>Request MFA
                                            </button>
                                            <button class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-flag mr-2"></i>Mark as False Positive
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Anomaly 2 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div>
                                                <div class="text-white font-medium">Geographic Access Anomaly</div>
                                                <div class="text-white/60 text-sm">User: michael.chen@agency.gov</div>
                                            </div>
                                            <span class="bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-xs font-semibold">Risk: 89/100</span>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                            <div>
                                                <div class="text-white/50 text-xs">Previous Location</div>
                                                <div class="text-white text-sm">Washington DC</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Current Location</div>
                                                <div class="text-red-400 text-sm">Moscow, Russia</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Time Gap</div>
                                                <div class="text-white text-sm">12 minutes</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Device</div>
                                                <div class="text-white text-sm">Unknown</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-ban mr-2"></i>Block Immediately
                                            </button>
                                            <button class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-phone mr-2"></i>Contact User
                                            </button>
                                            <button class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-clipboard-list mr-2"></i>Create Incident
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Anomaly 3 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div>
                                                <div class="text-white font-medium">Off-Hours System Access</div>
                                                <div class="text-white/60 text-sm">User: admin@agency.gov</div>
                                            </div>
                                            <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full text-xs font-semibold">Risk: 45/100</span>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3">
                                            <div>
                                                <div class="text-white/50 text-xs">Typical Hours</div>
                                                <div class="text-white text-sm">9 AM - 5 PM</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Current Time</div>
                                                <div class="text-yellow-400 text-sm">11:23 PM</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">Actions</div>
                                                <div class="text-white text-sm">Configuration changes</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50 text-xs">MFA Status</div>
                                                <div class="text-green-400 text-sm">Verified</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-eye mr-2"></i>Monitor Activity
                                            </button>
                                            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-check mr-2"></i>Approve
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- User Risk Profiles -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">High-Risk User Profiles</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-red-500 to-orange-500 flex items-center justify-center">
                                                <span class="text-white font-bold text-sm">MK</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Marcus King</div>
                                                <div class="text-white/60 text-xs">IT Administrator â€¢ 6 anomalies</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <div class="text-right">
                                                <div class="text-red-400 text-lg font-bold">78</div>
                                                <div class="text-white/50 text-xs">Risk Score</div>
                                            </div>
                                            <button class="px-3 py-1 bg-red-600 hover:bg-red-700 rounded-lg text-white text-xs transition">
                                                Review
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center">
                                                <span class="text-white font-bold text-sm">SJ</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Sarah Johnson</div>
                                                <div class="text-white/60 text-xs">Records Specialist â€¢ 4 anomalies</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <div class="text-right">
                                                <div class="text-yellow-400 text-lg font-bold">67</div>
                                                <div class="text-white/50 text-xs">Risk Score</div>
                                            </div>
                                            <button class="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white text-xs transition">
                                                Review
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-500 to-green-500 flex items-center justify-center">
                                                <span class="text-white font-bold text-sm">DL</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">David Lopez</div>
                                                <div class="text-white/60 text-xs">System Analyst â€¢ 2 anomalies</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <div class="text-right">
                                                <div class="text-yellow-400 text-lg font-bold">52</div>
                                                <div class="text-white/50 text-xs">Risk Score</div>
                                            </div>
                                            <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-xs transition">
                                                Review
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MOCK DATA - Replace in production -->
                        <!-- TODO: Connect to behavioral analytics engine API -->
                        <!-- TODO: Integrate with machine learning model for anomaly detection -->
                    </div>
                    <!-- End Module 2: Behavioral Analytics -->

                    <!-- Module 3: Automated Incident Response -->
                    <!-- Added 2024-10-30: Advanced Security Operations Center Enhancement -->
                    <div id="security-module-incidents" class="security-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-robot text-blue-400"></i>
                                Automated Incident Response Workflows
                                <span class="text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">AI-Powered</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Pre-configured response playbooks automatically execute when threats are detected, reducing response time from hours to seconds.
                            </p>

                            <!-- Incident Response Statistics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Active Playbooks</div>
                                    <div class="text-2xl font-bold text-white">34</div>
                                    <div class="text-green-400 text-xs mt-1">All automated</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Incidents Today</div>
                                    <div class="text-2xl font-bold text-blue-400">12</div>
                                    <div class="text-green-400 text-xs mt-1">11 auto-resolved</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Avg Resolution Time</div>
                                    <div class="text-2xl font-bold text-purple-400">3.2 min</div>
                                    <div class="text-green-400 text-xs mt-1">
                                        <i class="fas fa-arrow-down mr-1"></i>-87% vs manual
                                    </div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Success Rate</div>
                                    <div class="text-2xl font-bold text-green-400">98.4%</div>
                                    <div class="text-white/60 text-xs mt-1">Last 30 days</div>
                                </div>
                            </div>

                            <!-- Active Response Playbooks -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Active Response Playbooks</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Playbook 1 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center">
                                                    <i class="fas fa-user-lock text-red-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Brute Force Response</div>
                                                    <div class="text-white/60 text-xs">Auto-block malicious IPs</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                        </div>
                                        <div class="space-y-2 mb-3">
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>1. Detect failed login attempts (threshold: 5)</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>2. Block source IP for 24 hours</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>3. Notify security team</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>4. Log to SIEM system</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/60">Triggered: 847 times today</span>
                                            <span class="text-green-400 font-semibold">100% success</span>
                                        </div>
                                    </div>

                                    <!-- Playbook 2 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center">
                                                    <i class="fas fa-virus text-yellow-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Malware Detection</div>
                                                    <div class="text-white/60 text-xs">Quarantine and analyze</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                        </div>
                                        <div class="space-y-2 mb-3">
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>1. Detect malware signature</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>2. Isolate infected system</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>3. Run forensic analysis</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>4. Create incident ticket</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/60">Triggered: 3 times today</span>
                                            <span class="text-green-400 font-semibold">100% contained</span>
                                        </div>
                                    </div>

                                    <!-- Playbook 3 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                                    <i class="fas fa-user-shield text-purple-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Privilege Escalation</div>
                                                    <div class="text-white/60 text-xs">Unauthorized access prevention</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                        </div>
                                        <div class="space-y-2 mb-3">
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>1. Detect privilege escalation attempt</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>2. Deny access immediately</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>3. Alert security officer</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>4. Review user permissions</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/60">Triggered: 23 times today</span>
                                            <span class="text-green-400 font-semibold">100% blocked</span>
                                        </div>
                                    </div>

                                    <!-- Playbook 4 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                                    <i class="fas fa-database text-blue-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Data Exfiltration</div>
                                                    <div class="text-white/60 text-xs">Prevent data theft</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                        </div>
                                        <div class="space-y-2 mb-3">
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>1. Detect unusual data transfer volume</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>2. Block outbound traffic</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>3. Suspend user account</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-xs text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>4. Initiate forensic investigation</span>
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/60">Triggered: 1 time today</span>
                                            <span class="text-green-400 font-semibold">100% prevented</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Automated Responses -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Recent Automated Responses</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                            <i class="fas fa-check text-green-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Brute Force Attack Blocked</div>
                                            <div class="text-white/60 text-xs">Playbook: Brute Force Response â€¢ IP: 192.168.45.123</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-white text-sm">2.3s</div>
                                            <div class="text-white/60 text-xs">Response time</div>
                                        </div>
                                        <div class="text-green-400 text-xs font-semibold">SUCCESS</div>
                                    </div>

                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                            <i class="fas fa-check text-green-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Suspicious Access Pattern Mitigated</div>
                                            <div class="text-white/60 text-xs">Playbook: Behavioral Analytics â€¢ User: j.smith</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-white text-sm">4.7s</div>
                                            <div class="text-white/60 text-xs">Response time</div>
                                        </div>
                                        <div class="text-green-400 text-xs font-semibold">SUCCESS</div>
                                    </div>

                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                            <i class="fas fa-check text-green-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Malware Quarantined</div>
                                            <div class="text-white/60 text-xs">Playbook: Malware Detection â€¢ File: invoice.pdf.exe</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-white text-sm">1.8s</div>
                                            <div class="text-white/60 text-xs">Response time</div>
                                        </div>
                                        <div class="text-green-400 text-xs font-semibold">SUCCESS</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MOCK DATA - Replace in production -->
                        <!-- TODO: Connect to incident response automation system -->
                        <!-- TODO: Integrate with SOAR platform for workflow execution -->
                    </div>
                    <!-- End Module 3: Incident Response -->

                    <!-- Module 4: Compliance Reporting -->
                    <!-- Added 2024-10-30: Advanced Security Operations Center Enhancement -->
                    <div id="security-module-compliance" class="security-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-clipboard-check text-green-400"></i>
                                CJIS Compliance & Security Reporting
                                <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full">Automated</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Automated compliance monitoring and reporting for CJIS, FedRAMP, FISMA, and other government security standards.
                            </p>

                            <!-- Compliance Status Dashboard -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4 text-center">
                                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-green-500/20 flex items-center justify-center">
                                        <i class="fas fa-shield-check text-green-400 text-2xl"></i>
                                    </div>
                                    <div class="text-white font-medium mb-1">CJIS v5.9</div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-white/60 text-xs mt-1">All controls met</div>
                                </div>

                                <div class="glass rounded-xl p-4 text-center">
                                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-green-500/20 flex items-center justify-center">
                                        <i class="fas fa-cloud-upload text-green-400 text-2xl"></i>
                                    </div>
                                    <div class="text-white font-medium mb-1">FedRAMP High</div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-white/60 text-xs mt-1">Authorized</div>
                                </div>

                                <div class="glass rounded-xl p-4 text-center">
                                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-green-500/20 flex items-center justify-center">
                                        <i class="fas fa-file-contract text-green-400 text-2xl"></i>
                                    </div>
                                    <div class="text-white font-medium mb-1">FISMA</div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-white/60 text-xs mt-1">Compliant</div>
                                </div>

                                <div class="glass rounded-xl p-4 text-center">
                                    <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-green-500/20 flex items-center justify-center">
                                        <i class="fas fa-lock text-green-400 text-2xl"></i>
                                    </div>
                                    <div class="text-white font-medium mb-1">NIST 800-53</div>
                                    <div class="text-2xl font-bold text-green-400">324/324</div>
                                    <div class="text-white/60 text-xs mt-1">Controls active</div>
                                </div>
                            </div>

                            <!-- Available Compliance Reports -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Available Compliance Reports</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Report 1 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                                    <i class="fas fa-file-alt text-blue-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">CJIS Security Audit</div>
                                                    <div class="text-white/60 text-xs">Complete security assessment</div>
                                                </div>
                                            </div>
                                            <span class="text-green-400 text-xs">Current</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                                            <div>
                                                <span class="text-white/50">Last Updated:</span>
                                                <span class="text-white ml-1">Today</span>
                                            </div>
                                            <div>
                                                <span class="text-white/50">Coverage:</span>
                                                <span class="text-white ml-1">100%</span>
                                            </div>
                                        </div>
                                        <button class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                            <i class="fas fa-download mr-2"></i>Download PDF
                                        </button>
                                    </div>

                                    <!-- Report 2 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                                    <i class="fas fa-chart-bar text-purple-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Threat Intelligence Summary</div>
                                                    <div class="text-white/60 text-xs">Monthly threat analysis</div>
                                                </div>
                                            </div>
                                            <span class="text-green-400 text-xs">Current</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                                            <div>
                                                <span class="text-white/50">Period:</span>
                                                <span class="text-white ml-1">Oct 2024</span>
                                            </div>
                                            <div>
                                                <span class="text-white/50">Incidents:</span>
                                                <span class="text-white ml-1">847</span>
                                            </div>
                                        </div>
                                        <button class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white text-sm transition">
                                            <i class="fas fa-download mr-2"></i>Download PDF
                                        </button>
                                    </div>

                                    <!-- Report 3 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                                    <i class="fas fa-check-circle text-green-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">FedRAMP Continuous Monitoring</div>
                                                    <div class="text-white/60 text-xs">ConMon package</div>
                                                </div>
                                            </div>
                                            <span class="text-green-400 text-xs">Current</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                                            <div>
                                                <span class="text-white/50">Status:</span>
                                                <span class="text-green-400 ml-1">Authorized</span>
                                            </div>
                                            <div>
                                                <span class="text-white/50">POA&Ms:</span>
                                                <span class="text-white ml-1">0</span>
                                            </div>
                                        </div>
                                        <button class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition">
                                            <i class="fas fa-download mr-2"></i>Download PDF
                                        </button>
                                    </div>

                                    <!-- Report 4 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center">
                                                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Incident Response Report</div>
                                                    <div class="text-white/60 text-xs">Response metrics</div>
                                                </div>
                                            </div>
                                            <span class="text-green-400 text-xs">Current</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                                            <div>
                                                <span class="text-white/50">Incidents:</span>
                                                <span class="text-white ml-1">12</span>
                                            </div>
                                            <div>
                                                <span class="text-white/50">Resolved:</span>
                                                <span class="text-green-400 ml-1">12 (100%)</span>
                                            </div>
                                        </div>
                                        <button class="w-full px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white text-sm transition">
                                            <i class="fas fa-download mr-2"></i>Download PDF
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Compliance Timeline -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Compliance Activity Timeline</h4>
                                <div class="space-y-4">
                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                                                <i class="fas fa-check text-green-400"></i>
                                            </div>
                                            <div class="w-0.5 h-full bg-white/20 mt-2"></div>
                                        </div>
                                        <div class="flex-1 pb-6">
                                            <div class="text-white font-medium mb-1">CJIS Audit Completed</div>
                                            <div class="text-white/60 text-sm mb-2">All 13 policy areas assessed and verified</div>
                                            <div class="text-white/50 text-xs">Today, 9:30 AM â€¢ Security Team</div>
                                        </div>
                                    </div>

                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center">
                                                <i class="fas fa-sync text-blue-400"></i>
                                            </div>
                                            <div class="w-0.5 h-full bg-white/20 mt-2"></div>
                                        </div>
                                        <div class="flex-1 pb-6">
                                            <div class="text-white font-medium mb-1">FedRAMP ConMon Package Submitted</div>
                                            <div class="text-white/60 text-sm mb-2">Monthly continuous monitoring deliverables</div>
                                            <div class="text-white/50 text-xs">Yesterday, 4:15 PM â€¢ Compliance Officer</div>
                                        </div>
                                    </div>

                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-10 h-10 rounded-full bg-purple-500/20 flex items-center justify-center">
                                                <i class="fas fa-shield-check text-purple-400"></i>
                                            </div>
                                            <div class="w-0.5 h-full bg-white/20 mt-2"></div>
                                        </div>
                                        <div class="flex-1 pb-6">
                                            <div class="text-white font-medium mb-1">Security Control Assessment</div>
                                            <div class="text-white/60 text-sm mb-2">NIST 800-53 Rev 5 - All 324 controls validated</div>
                                            <div class="text-white/50 text-xs">3 days ago â€¢ Auditor</div>
                                        </div>
                                    </div>

                                    <div class="flex gap-4">
                                        <div class="flex flex-col items-center">
                                            <div class="w-10 h-10 rounded-full bg-green-500/20 flex items-center justify-center">
                                                <i class="fas fa-certificate text-green-400"></i>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white font-medium mb-1">ISO 27001 Certification Renewed</div>
                                            <div class="text-white/60 text-sm mb-2">Information security management system certified</div>
                                            <div class="text-white/50 text-xs">1 week ago â€¢ External Auditor</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- MOCK DATA - Replace in production -->
                        <!-- TODO: Connect to compliance management system -->
                        <!-- TODO: Integrate with automated report generation -->
                    </div>
                    <!-- End Module 4: Compliance Reports -->
                </div>

                <!-- Analytics Tab -->
                <div id="analytics-content" class="tab-content" style="display: none;">
                    <!-- Analytics Header with Controls -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Advanced Analytics Dashboard</h2>
                                <p class="text-white/70">Real-time insights from all platform workflows and integrations</p>
                            </div>
                            <div class="mt-4 lg:mt-0 flex items-center space-x-4">
                                <div class="flex items-center space-x-2">
                                    <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                    <span class="text-green-400 text-sm">Live Data</span>
                                </div>
                                <select id="analyticsTimeRange" onchange="updateAnalytics()" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="24h">Last 24 Hours</option>
                                    <option value="7d" selected>Last 7 Days</option>
                                    <option value="30d">Last 30 Days</option>
                                    <option value="90d">Last 90 Days</option>
                                </select>
                                <button onclick="customizeAnalytics()" class="bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                    <i class="fas fa-cog"></i>
                                    <span>Customize</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Key Performance Indicators -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                        <div class="glass rounded-xl p-6 hover:bg-white/10 transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/70 text-sm">Total Workflows</p>
                                    <p class="text-2xl font-bold text-white" id="totalWorkflows">2,847</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-green-400 text-xs mr-1"></i>
                                        <span class="text-green-400 text-xs">+12.5%</span>
                                        <span class="text-white/50 text-xs ml-1">vs last week</span>
                                    </div>
                                </div>
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-project-diagram text-white"></i>
                                </div>
                            </div>
                        </div>

                        <div class="glass rounded-xl p-6 hover:bg-white/10 transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/70 text-sm">Processing Time</p>
                                    <p class="text-2xl font-bold text-white" id="avgProcessingTime">1.2s</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-down text-green-400 text-xs mr-1"></i>
                                        <span class="text-green-400 text-xs">-8.3%</span>
                                        <span class="text-white/50 text-xs ml-1">improvement</span>
                                    </div>
                                </div>
                                <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-teal-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-stopwatch text-white"></i>
                                </div>
                            </div>
                        </div>

                        <div class="glass rounded-xl p-6 hover:bg-white/10 transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/70 text-sm">Success Rate</p>
                                    <p class="text-2xl font-bold text-white" id="successRate">98.7%</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-green-400 text-xs mr-1"></i>
                                        <span class="text-green-400 text-xs">+2.1%</span>
                                        <span class="text-white/50 text-xs ml-1">this month</span>
                                    </div>
                                </div>
                                <div class="w-12 h-12 bg-gradient-to-r from-emerald-500 to-green-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-check-circle text-white"></i>
                                </div>
                            </div>
                        </div>

                        <div class="glass rounded-xl p-6 hover:bg-white/10 transition-all duration-300">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-white/70 text-sm">Active Users</p>
                                    <p class="text-2xl font-bold text-white" id="activeUsers">1,439</p>
                                    <div class="flex items-center mt-2">
                                        <i class="fas fa-arrow-up text-green-400 text-xs mr-1"></i>
                                        <span class="text-green-400 text-xs">+18.7%</span>
                                        <span class="text-white/50 text-xs ml-1">this week</span>
                                    </div>
                                </div>
                                <div class="w-12 h-12 bg-gradient-to-r from-orange-500 to-red-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-users text-white"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Analytics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Workflow Performance Chart -->
                        <div class="lg:col-span-2 glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Workflow Performance Trends</h3>
                                <div class="flex items-center space-x-2">
                                    <button onclick="toggleChart('performance')" class="text-white/70 hover:text-white text-sm">
                                        <i class="fas fa-expand-arrows-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div id="performanceChart" class="h-80 bg-black/20 rounded-lg p-4 relative overflow-hidden">
                                <!-- Animated Chart Placeholder -->
                                <div class="absolute inset-4">
                                    <div class="flex items-end justify-between h-full">
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-blue-500 to-blue-300 rounded-t w-8 animate-pulse" style="height: 60%"></div>
                                            <span class="text-white/50 text-xs mt-2">Mon</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-purple-500 to-purple-300 rounded-t w-8 animate-pulse" style="height: 80%; animation-delay: 0.2s"></div>
                                            <span class="text-white/50 text-xs mt-2">Tue</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-green-500 to-green-300 rounded-t w-8 animate-pulse" style="height: 45%; animation-delay: 0.4s"></div>
                                            <span class="text-white/50 text-xs mt-2">Wed</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-yellow-500 to-yellow-300 rounded-t w-8 animate-pulse" style="height: 90%; animation-delay: 0.6s"></div>
                                            <span class="text-white/50 text-xs mt-2">Thu</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-red-500 to-red-300 rounded-t w-8 animate-pulse" style="height: 70%; animation-delay: 0.8s"></div>
                                            <span class="text-white/50 text-xs mt-2">Fri</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-indigo-500 to-indigo-300 rounded-t w-8 animate-pulse" style="height: 55%; animation-delay: 1s"></div>
                                            <span class="text-white/50 text-xs mt-2">Sat</span>
                                        </div>
                                        <div class="flex flex-col items-center">
                                            <div class="bg-gradient-to-t from-pink-500 to-pink-300 rounded-t w-8 animate-pulse" style="height: 85%; animation-delay: 1.2s"></div>
                                            <span class="text-white/50 text-xs mt-2">Sun</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Chart Legend -->
                                <div class="absolute top-4 right-4 space-y-2">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-blue-500 rounded"></div>
                                        <span class="text-white/70 text-xs">Workflows</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-purple-500 rounded"></div>
                                        <span class="text-white/70 text-xs">Grants</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-3 h-3 bg-green-500 rounded"></div>
                                        <span class="text-white/70 text-xs">Security</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Health Monitor -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">System Health</h3>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">CPU Usage</span>
                                        <span class="text-white text-sm" id="cpuUsage">23%</span>
                                    </div>
                                    <div class="w-full bg-white/10 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-green-500 to-yellow-500 h-2 rounded-full transition-all duration-1000" style="width: 23%"></div>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">Memory</span>
                                        <span class="text-white text-sm" id="memoryUsage">67%</span>
                                    </div>
                                    <div class="w-full bg-white/10 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-1000" style="width: 67%"></div>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">Database</span>
                                        <span class="text-white text-sm" id="databaseLoad">34%</span>
                                    </div>
                                    <div class="w-full bg-white/10 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-emerald-500 to-teal-500 h-2 rounded-full transition-all duration-1000" style="width: 34%"></div>
                                    </div>
                                </div>

                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-white/70 text-sm">Network I/O</span>
                                        <span class="text-white text-sm" id="networkIO">89%</span>
                                    </div>
                                    <div class="w-full bg-white/10 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full transition-all duration-1000" style="width: 89%"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Status Indicators -->
                            <div class="mt-6 space-y-3">
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        <span class="text-white/80 text-sm">API Gateway</span>
                                    </div>
                                    <span class="text-green-400 text-xs">Online</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        <span class="text-white/80 text-sm">Database Cluster</span>
                                    </div>
                                    <span class="text-green-400 text-xs">Healthy</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-2 h-2 bg-yellow-400 rounded-full animate-pulse"></div>
                                        <span class="text-white/80 text-sm">Cache Layer</span>
                                    </div>
                                    <span class="text-yellow-400 text-xs">Warning</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Secondary Analytics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Usage Distribution -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Module Usage Distribution</h3>
                                <button onclick="refreshUsageData()" class="text-white/70 hover:text-white">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-4 h-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded"></div>
                                        <span class="text-white/80">Workflow Management</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-blue-600 h-2 rounded-full" style="width: 85%"></div>
                                        </div>
                                        <span class="text-white text-sm w-10">85%</span>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-4 h-4 bg-gradient-to-r from-purple-500 to-purple-600 rounded"></div>
                                        <span class="text-white/80">Grant Management</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-purple-600 h-2 rounded-full" style="width: 72%"></div>
                                        </div>
                                        <span class="text-white text-sm w-10">72%</span>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-4 h-4 bg-gradient-to-r from-green-500 to-green-600 rounded"></div>
                                        <span class="text-white/80">Security Analysis</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-green-500 to-green-600 h-2 rounded-full" style="width: 68%"></div>
                                        </div>
                                        <span class="text-white text-sm w-10">68%</span>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-4 h-4 bg-gradient-to-r from-yellow-500 to-yellow-600 rounded"></div>
                                        <span class="text-white/80">Citizen Portal</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 h-2 rounded-full" style="width: 54%"></div>
                                        </div>
                                        <span class="text-white text-sm w-10">54%</span>
                                    </div>
                                </div>

                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-4 h-4 bg-gradient-to-r from-red-500 to-red-600 rounded"></div>
                                        <span class="text-white/80">Compliance Monitor</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <div class="w-24 bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-red-500 to-red-600 h-2 rounded-full" style="width: 41%"></div>
                                        </div>
                                        <span class="text-white text-sm w-10">41%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Pie Chart Visualization -->
                            <div class="mt-6 flex justify-center">
                                <div class="relative w-40 h-40">
                                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                                        <!-- Workflow Management - 85% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="url(#gradient-blue)" stroke-width="8" 
                                                stroke-dasharray="214" stroke-dashoffset="32" class="animate-pulse"/>
                                        <!-- Grant Management - 72% -->
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="url(#gradient-purple)" stroke-width="6" 
                                                stroke-dasharray="181" stroke-dashoffset="70" class="animate-pulse" style="animation-delay: 0.2s"/>
                                    </svg>
                                    <!-- Gradients for the circles -->
                                    <svg width="0" height="0">
                                        <defs>
                                            <linearGradient id="gradient-blue" x1="0%" y1="0%" x2="100%" y2="0%">
                                                <stop offset="0%" style="stop-color:#3B82F6"/>
                                                <stop offset="100%" style="stop-color:#1D4ED8"/>
                                            </linearGradient>
                                            <linearGradient id="gradient-purple" x1="0%" y1="0%" x2="100%" y2="0%">
                                                <stop offset="0%" style="stop-color:#8B5CF6"/>
                                                <stop offset="100%" style="stop-color:#5B21B6"/>
                                            </linearGradient>
                                        </defs>
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Real-Time Activity Feed -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Real-Time Activity</h3>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                    <span class="text-green-400 text-xs">Live</span>
                                </div>
                            </div>
                            <div id="activityFeed" class="space-y-3 max-h-80 overflow-y-auto custom-scrollbar">
                                <!-- Real-time activity items will be populated here -->
                            </div>
                            <div class="mt-4 text-center">
                                <button onclick="loadMoreActivity()" class="text-blue-400 hover:text-blue-300 text-sm">
                                    Load More Activity
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Metrics -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Error Rate Trends -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Error Rate Analysis</h3>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-3xl font-bold text-green-400 mb-1">0.03%</div>
                                    <div class="text-white/60 text-sm">Current Error Rate</div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">Authentication</span>
                                        <span class="text-red-400">0.01%</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">API Calls</span>
                                        <span class="text-yellow-400">0.02%</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">Database</span>
                                        <span class="text-green-400">0.00%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Geographic Distribution -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">User Distribution</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-4 bg-blue-500 rounded-sm"></div>
                                        <span class="text-white/80 text-sm">United States</span>
                                    </div>
                                    <span class="text-white text-sm">47%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-4 bg-green-500 rounded-sm"></div>
                                        <span class="text-white/80 text-sm">Canada</span>
                                    </div>
                                    <span class="text-white text-sm">23%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-4 bg-yellow-500 rounded-sm"></div>
                                        <span class="text-white/80 text-sm">United Kingdom</span>
                                    </div>
                                    <span class="text-white text-sm">18%</span>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-6 h-4 bg-purple-500 rounded-sm"></div>
                                        <span class="text-white/80 text-sm">Australia</span>
                                    </div>
                                    <span class="text-white text-sm">12%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Benchmarks -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Performance Benchmarks</h3>
                            <div class="space-y-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-400 mb-1">A+</div>
                                    <div class="text-white/60 text-sm">Overall Grade</div>
                                </div>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">Speed Index</span>
                                        <span class="text-green-400">1.2s</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">Time to Interactive</span>
                                        <span class="text-green-400">2.1s</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-white/70">First Paint</span>
                                        <span class="text-green-400">0.8s</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Added 2024-12-09: Predictive Analytics Dashboard -->
                    <div class="mt-6 glass rounded-xl p-6">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            <i class="fas fa-chart-line text-purple-400"></i>
                            Predictive Analytics & Forecasting
                        </h2>

                        <!-- Row 1: Forecasting Chart + ML Confidence -->
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <!-- 30-Day Workload Forecast -->
                            <div class="lg:col-span-2 glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h3 class="font-bold text-white mb-1">30-Day Workload Forecast</h3>
                                        <p class="text-sm text-white/70">Predicted case volume based on historical patterns</p>
                                    </div>
                                    <button
                                        id="exportForecastBtn"
                                        class="px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 rounded-lg text-blue-300 transition-all text-sm"
                                        aria-label="Export forecast data">
                                        <i class="fas fa-download mr-2"></i>Export
                                    </button>
                                </div>

                                <!-- Chart -->
                                <div class="relative h-64 flex items-end justify-between gap-1" id="forecastChart">
                                    <!-- Bars will be generated by JS -->
                                </div>

                                <!-- Legend -->
                                <div class="flex items-center justify-center gap-4 mt-4 text-sm">
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 bg-gradient-to-r from-blue-400 to-cyan-500 rounded"></div>
                                        <span class="text-white/70">Historical</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 bg-gradient-to-r from-purple-400 to-pink-500 rounded"></div>
                                        <span class="text-white/70">Predicted</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-4 h-4 bg-gradient-to-r from-yellow-400 to-orange-500 rounded"></div>
                                        <span class="text-white/70">Anomaly</span>
                                    </div>
                                </div>
                            </div>

                            <!-- ML Confidence Scores -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4">ML Confidence Scores</h3>

                                <div class="space-y-4">
                                    <!-- Overall Confidence Ring -->
                                    <div class="text-center">
                                        <div class="relative w-32 h-32 mx-auto mb-3">
                                            <svg class="w-32 h-32 transform -rotate-90" viewBox="0 0 120 120">
                                                <circle cx="60" cy="60" r="50" fill="none" stroke="rgb(75 85 99)" stroke-width="8"/>
                                                <circle
                                                    cx="60" cy="60" r="50"
                                                    fill="none"
                                                    stroke="url(#gradientPredictive1)"
                                                    stroke-width="8"
                                                    stroke-linecap="round"
                                                    stroke-dasharray="314"
                                                    stroke-dashoffset="62.8"
                                                    class="confidence-ring"/>
                                                <defs>
                                                    <linearGradient id="gradientPredictive1" x1="0%" y1="0%" x2="100%" y2="100%">
                                                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
                                                        <stop offset="100%" style="stop-color:#8b5cf6;stop-opacity:1" />
                                                    </linearGradient>
                                                </defs>
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="text-center">
                                                    <div class="text-2xl font-bold text-white">87%</div>
                                                    <div class="text-xs text-white/70">Overall</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Individual Model Scores -->
                                    <div class="space-y-3">
                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-white/70">Workload Model</span>
                                                <span class="text-green-400 font-medium">92%</span>
                                            </div>
                                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-green-400 to-emerald-500 rounded-full" style="width: 92%"></div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-white/70">Resource Model</span>
                                                <span class="text-blue-400 font-medium">85%</span>
                                            </div>
                                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-blue-400 to-cyan-500 rounded-full" style="width: 85%"></div>
                                            </div>
                                        </div>

                                        <div>
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-white/70">Anomaly Detection</span>
                                                <span class="text-purple-400 font-medium">84%</span>
                                            </div>
                                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-purple-400 to-pink-500 rounded-full" style="width: 84%"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                                        <p class="text-xs text-blue-300">
                                            <i class="fas fa-info-circle mr-1"></i>
                                            Models trained on 6 months of historical data
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Row 2: Resource Recommendations + Anomaly Detection -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- AI Resource Allocation -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-users-cog text-blue-400"></i>
                                    AI Resource Recommendations
                                </h3>

                                <div class="space-y-4" id="resourceRecommendations">
                                    <!-- Generated by JS -->
                                </div>

                                <div class="mt-4 pt-4 border-t border-white/10">
                                    <button
                                        id="applyRecommendationsBtn"
                                        class="w-full px-4 py-2 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg text-white font-medium hover:shadow-lg transition-all"
                                        aria-label="Apply recommendations">
                                        <i class="fas fa-check mr-2"></i>Apply Recommendations
                                    </button>
                                </div>
                            </div>

                            <!-- Anomaly Detection Alerts -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                    Anomaly Detection Alerts
                                </h3>

                                <div class="space-y-3" id="anomalyAlerts">
                                    <!-- Generated by JS -->
                                </div>

                                <div class="mt-4 text-center">
                                    <button class="text-sm text-blue-400 hover:text-blue-300 transition-all">
                                        View All Alerts <i class="fas fa-arrow-right ml-1"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Row 3: What-If Analysis Scenario Planner -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="font-bold text-white mb-1 flex items-center gap-2">
                                        <i class="fas fa-sliders-h text-purple-400"></i>
                                        What-If Analysis: Scenario Planning
                                    </h3>
                                    <p class="text-sm text-white/70">Adjust variables to test different scenarios</p>
                                </div>
                                <button
                                    id="resetScenariosBtn"
                                    class="px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg text-white text-sm transition-all"
                                    aria-label="Reset to defaults">
                                    <i class="fas fa-undo mr-2"></i>Reset
                                </button>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Scenario Controls -->
                                <div class="space-y-6">
                                    <div>
                                        <label class="text-white/70 text-sm mb-2 block">Staffing Level Adjustment</label>
                                        <input
                                            type="range"
                                            id="staffingSlider"
                                            min="50"
                                            max="150"
                                            value="100"
                                            class="w-full"
                                            aria-label="Adjust staffing level">
                                        <div class="flex justify-between text-xs text-white/50 mt-1">
                                            <span>-50%</span>
                                            <span id="staffingValue" class="text-white font-medium">100%</span>
                                            <span>+50%</span>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="text-white/70 text-sm mb-2 block">Expected Case Volume Change</label>
                                        <input
                                            type="range"
                                            id="volumeSlider"
                                            min="50"
                                            max="150"
                                            value="100"
                                            class="w-full"
                                            aria-label="Adjust case volume">
                                        <div class="flex justify-between text-xs text-white/50 mt-1">
                                            <span>-50%</span>
                                            <span id="volumeValue" class="text-white font-medium">100%</span>
                                            <span>+50%</span>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="text-white/70 text-sm mb-2 block">Process Efficiency</label>
                                        <input
                                            type="range"
                                            id="efficiencySlider"
                                            min="70"
                                            max="130"
                                            value="100"
                                            class="w-full"
                                            aria-label="Adjust efficiency">
                                        <div class="flex justify-between text-xs text-white/50 mt-1">
                                            <span>70%</span>
                                            <span id="efficiencyValue" class="text-white font-medium">100%</span>
                                            <span>130%</span>
                                        </div>
                                    </div>

                                    <button
                                        id="runScenarioBtn"
                                        class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg text-white font-medium hover:shadow-lg transition-all"
                                        aria-label="Run scenario analysis">
                                        <i class="fas fa-play mr-2"></i>Run Scenario Analysis
                                    </button>
                                </div>

                                <!-- Scenario Results -->
                                <div class="glass-dark rounded-lg p-6">
                                    <h4 class="text-white font-bold mb-4">Predicted Outcomes</h4>
                                    <div id="scenarioResults" class="space-y-4">
                                        <div class="flex items-center justify-between p-3 bg-blue-500/10 rounded-lg">
                                            <div>
                                                <div class="text-white/70 text-sm">Average Processing Time</div>
                                                <div class="text-2xl font-bold text-white mt-1">2.4 days</div>
                                            </div>
                                            <div class="text-green-400">
                                                <i class="fas fa-arrow-down"></i> 12%
                                            </div>
                                        </div>

                                        <div class="flex items-center justify-between p-3 bg-purple-500/10 rounded-lg">
                                            <div>
                                                <div class="text-white/70 text-sm">Capacity Utilization</div>
                                                <div class="text-2xl font-bold text-white mt-1">78%</div>
                                            </div>
                                            <div class="text-yellow-400">
                                                <i class="fas fa-minus"></i> 0%
                                            </div>
                                        </div>

                                        <div class="flex items-center justify-between p-3 bg-green-500/10 rounded-lg">
                                            <div>
                                                <div class="text-white/70 text-sm">Backlog Reduction</div>
                                                <div class="text-2xl font-bold text-white mt-1">45%</div>
                                            </div>
                                            <div class="text-green-400">
                                                <i class="fas fa-arrow-up"></i> 15%
                                            </div>
                                        </div>

                                        <div class="flex items-center justify-between p-3 bg-red-500/10 rounded-lg">
                                            <div>
                                                <div class="text-white/70 text-sm">Resource Cost Impact</div>
                                                <div class="text-2xl font-bold text-white mt-1">$0</div>
                                            </div>
                                            <div class="text-white/50">
                                                <i class="fas fa-minus"></i> 0%
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced 2024-10-30: Advanced Government Analytics -->
                    <!-- Operational Analytics with Process Mining -->
                    <div class="mt-6 glass rounded-xl p-6">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            <i class="fas fa-cogs text-blue-400"></i>
                            Operational Analytics & Process Mining
                        </h2>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- Process Flow Analysis -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-project-diagram text-purple-400"></i>
                                    Process Flow Analysis
                                </h3>
                                <div class="space-y-4">
                                    <!-- Process Steps Visualization -->
                                    <div class="relative">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Permit Application</span>
                                            <span class="text-green-400 text-xs font-semibold">92% efficiency</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="flex-1 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded flex items-center justify-center text-white text-xs">
                                                Submit
                                            </div>
                                            <i class="fas fa-arrow-right text-white/50"></i>
                                            <div class="flex-1 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded flex items-center justify-center text-white text-xs">
                                                Review
                                            </div>
                                            <i class="fas fa-arrow-right text-white/50"></i>
                                            <div class="flex-1 h-8 bg-gradient-to-r from-pink-500 to-red-500 rounded flex items-center justify-center text-white text-xs">
                                                Approve
                                            </div>
                                        </div>
                                        <div class="flex items-center justify-between mt-1 text-xs text-white/60">
                                            <span>2.1 days</span>
                                            <span>4.5 days</span>
                                            <span>1.2 days</span>
                                        </div>
                                    </div>

                                    <!-- Bottleneck Identification -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="text-white/70 text-xs mb-2">Process Bottlenecks</div>
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between">
                                                <span class="text-white text-sm">Document Review (Step 3)</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs">Critical</span>
                                                    <span class="text-white/60 text-xs">+3.2 days</span>
                                                </div>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-white text-sm">Supervisor Approval (Step 5)</span>
                                                <div class="flex items-center gap-2">
                                                    <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs">Moderate</span>
                                                    <span class="text-white/60 text-xs">+1.8 days</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Process Variants -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="text-white/70 text-xs mb-2">Process Variants Detected</div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white text-sm">Standard Path</span>
                                            <span class="text-green-400 text-sm font-semibold">78%</span>
                                        </div>
                                        <div class="flex items-center justify-between mt-2">
                                            <span class="text-white text-sm">Escalation Path</span>
                                            <span class="text-yellow-400 text-sm font-semibold">15%</span>
                                        </div>
                                        <div class="flex items-center justify-between mt-2">
                                            <span class="text-white text-sm">Expedited Path</span>
                                            <span class="text-blue-400 text-sm font-semibold">7%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Resource Utilization -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-users-cog text-green-400"></i>
                                    Resource Utilization
                                </h3>
                                <div class="space-y-4">
                                    <!-- Department Workload -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Building & Safety</span>
                                            <span class="text-yellow-400 text-sm font-semibold">87%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3">
                                            <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-3 rounded-full" style="width: 87%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Public Works</span>
                                            <span class="text-green-400 text-sm font-semibold">64%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3">
                                            <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full" style="width: 64%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">City Manager</span>
                                            <span class="text-red-400 text-sm font-semibold">92%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3">
                                            <div class="bg-gradient-to-r from-red-500 to-pink-500 h-3 rounded-full" style="width: 92%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Finance Department</span>
                                            <span class="text-blue-400 text-sm font-semibold">71%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3">
                                            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 71%"></div>
                                        </div>
                                    </div>

                                    <!-- Staffing Recommendations -->
                                    <div class="glass rounded-lg p-4 mt-4">
                                        <div class="text-white/70 text-xs mb-2">AI Staffing Recommendations</div>
                                        <div class="space-y-2">
                                            <div class="flex items-start gap-2">
                                                <i class="fas fa-lightbulb text-yellow-400 text-xs mt-1"></i>
                                                <div class="text-white/70 text-xs">Add 2 reviewers to City Manager (reduce 25% load)</div>
                                            </div>
                                            <div class="flex items-start gap-2">
                                                <i class="fas fa-lightbulb text-yellow-400 text-xs mt-1"></i>
                                                <div class="text-white/70 text-xs">Reallocate 1 staff from Public Works to Building & Safety</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Process Mining Insights -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-search-dollar text-purple-400"></i>
                                Process Mining Insights
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-1">Avg Cycle Time</div>
                                    <div class="text-2xl font-bold text-white">7.8 days</div>
                                    <div class="flex items-center gap-1 mt-1">
                                        <i class="fas fa-arrow-down text-green-400 text-xs"></i>
                                        <span class="text-green-400 text-xs">-15% vs target</span>
                                    </div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-1">Rework Rate</div>
                                    <div class="text-2xl font-bold text-white">8.3%</div>
                                    <div class="flex items-center gap-1 mt-1">
                                        <i class="fas fa-arrow-up text-red-400 text-xs"></i>
                                        <span class="text-red-400 text-xs">+2.1% this month</span>
                                    </div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-1">Compliance Score</div>
                                    <div class="text-2xl font-bold text-white">96.4%</div>
                                    <div class="flex items-center gap-1 mt-1">
                                        <i class="fas fa-check text-green-400 text-xs"></i>
                                        <span class="text-green-400 text-xs">Above benchmark</span>
                                    </div>
                                </div>
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-1">Process Maturity</div>
                                    <div class="text-2xl font-bold text-white">Level 4</div>
                                    <div class="text-white/60 text-xs mt-1">Quantitatively Managed</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Citizen Experience Journey Mapping & Scoring -->
                    <div class="mt-6 glass rounded-xl p-6">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            <i class="fas fa-user-friends text-green-400"></i>
                            Citizen Experience Analytics
                        </h2>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                            <!-- Overall Experience Score -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4">Overall Experience Score</h3>
                                <div class="flex items-center justify-center mb-4">
                                    <div class="relative w-32 h-32">
                                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                                            <circle cx="50" cy="50" r="40" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="8"/>
                                            <circle cx="50" cy="50" r="40" fill="none" stroke="url(#gradient-experience)" stroke-width="8"
                                                    stroke-dasharray="251" stroke-dashoffset="38" class="transition-all duration-1000"/>
                                        </svg>
                                        <div class="absolute inset-0 flex items-center justify-center flex-col">
                                            <div class="text-3xl font-bold text-white">8.5</div>
                                            <div class="text-xs text-white/60">out of 10</div>
                                        </div>
                                        <svg width="0" height="0">
                                            <defs>
                                                <linearGradient id="gradient-experience" x1="0%" y1="0%" x2="100%" y2="0%">
                                                    <stop offset="0%" style="stop-color:#10b981"/>
                                                    <stop offset="100%" style="stop-color:#3b82f6"/>
                                                </linearGradient>
                                            </defs>
                                        </svg>
                                    </div>
                                </div>
                                <div class="flex items-center justify-center gap-1">
                                    <i class="fas fa-arrow-up text-green-400 text-xs"></i>
                                    <span class="text-green-400 text-sm">+0.4 vs last quarter</span>
                                </div>
                            </div>

                            <!-- Experience Breakdown -->
                            <div class="lg:col-span-2 glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4">Experience Breakdown</h3>
                                <div class="space-y-3">
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Digital Services</span>
                                            <span class="text-green-400 text-sm font-semibold">9.2/10</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full" style="width: 92%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Response Time</span>
                                            <span class="text-blue-400 text-sm font-semibold">8.7/10</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full" style="width: 87%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Communication Clarity</span>
                                            <span class="text-purple-400 text-sm font-semibold">8.1/10</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 81%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Resolution Quality</span>
                                            <span class="text-yellow-400 text-sm font-semibold">7.9/10</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-2 rounded-full" style="width: 79%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Journey Mapping -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-route text-blue-400"></i>
                                Citizen Journey Map
                            </h3>
                            <div class="relative">
                                <!-- Journey Steps -->
                                <div class="flex items-center justify-between mb-8">
                                    <div class="text-center flex-1">
                                        <div class="w-12 h-12 mx-auto bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center mb-2">
                                            <i class="fas fa-search text-white"></i>
                                        </div>
                                        <div class="text-white text-xs font-semibold">Discovery</div>
                                        <div class="text-white/60 text-xs mt-1">Score: 8.9</div>
                                    </div>
                                    <div class="flex-1 h-0.5 bg-gradient-to-r from-cyan-500 to-purple-500 mx-2"></div>
                                    <div class="text-center flex-1">
                                        <div class="w-12 h-12 mx-auto bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center mb-2">
                                            <i class="fas fa-file-alt text-white"></i>
                                        </div>
                                        <div class="text-white text-xs font-semibold">Application</div>
                                        <div class="text-white/60 text-xs mt-1">Score: 8.7</div>
                                    </div>
                                    <div class="flex-1 h-0.5 bg-gradient-to-r from-pink-500 to-green-500 mx-2"></div>
                                    <div class="text-center flex-1">
                                        <div class="w-12 h-12 mx-auto bg-gradient-to-r from-green-500 to-emerald-500 rounded-full flex items-center justify-center mb-2">
                                            <i class="fas fa-hourglass-half text-white"></i>
                                        </div>
                                        <div class="text-white text-xs font-semibold">Processing</div>
                                        <div class="text-white/60 text-xs mt-1">Score: 7.4</div>
                                    </div>
                                    <div class="flex-1 h-0.5 bg-gradient-to-r from-emerald-500 to-yellow-500 mx-2"></div>
                                    <div class="text-center flex-1">
                                        <div class="w-12 h-12 mx-auto bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center mb-2">
                                            <i class="fas fa-bell text-white"></i>
                                        </div>
                                        <div class="text-white text-xs font-semibold">Updates</div>
                                        <div class="text-white/60 text-xs mt-1">Score: 8.3</div>
                                    </div>
                                    <div class="flex-1 h-0.5 bg-gradient-to-r from-orange-500 to-blue-500 mx-2"></div>
                                    <div class="text-center flex-1">
                                        <div class="w-12 h-12 mx-auto bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full flex items-center justify-center mb-2">
                                            <i class="fas fa-check-circle text-white"></i>
                                        </div>
                                        <div class="text-white text-xs font-semibold">Resolution</div>
                                        <div class="text-white/60 text-xs mt-1">Score: 9.1</div>
                                    </div>
                                </div>

                                <!-- Pain Points -->
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-3">Identified Pain Points</div>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div class="flex items-start gap-2">
                                            <i class="fas fa-exclamation-triangle text-red-400 text-xs mt-1"></i>
                                            <div>
                                                <div class="text-white text-xs font-semibold">Processing Stage Delays</div>
                                                <div class="text-white/60 text-xs">Avg wait: 4.2 days (target: 2 days)</div>
                                            </div>
                                        </div>
                                        <div class="flex items-start gap-2">
                                            <i class="fas fa-exclamation-triangle text-yellow-400 text-xs mt-1"></i>
                                            <div>
                                                <div class="text-white text-xs font-semibold">Status Update Frequency</div>
                                                <div class="text-white/60 text-xs">Citizens request updates 3.2x/case</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sentiment Analysis -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-smile text-yellow-400"></i>
                                    Sentiment Analysis
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-smile text-green-400"></i>
                                            <span class="text-white/80 text-sm">Positive</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-32 bg-white/10 rounded-full h-2">
                                                <div class="bg-green-500 h-2 rounded-full" style="width: 72%"></div>
                                            </div>
                                            <span class="text-white text-sm w-10">72%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-meh text-yellow-400"></i>
                                            <span class="text-white/80 text-sm">Neutral</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-32 bg-white/10 rounded-full h-2">
                                                <div class="bg-yellow-500 h-2 rounded-full" style="width: 21%"></div>
                                            </div>
                                            <span class="text-white text-sm w-10">21%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-frown text-red-400"></i>
                                            <span class="text-white/80 text-sm">Negative</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <div class="w-32 bg-white/10 rounded-full h-2">
                                                <div class="bg-red-500 h-2 rounded-full" style="width: 7%"></div>
                                            </div>
                                            <span class="text-white text-sm w-10">7%</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Top Issues -->
                                <div class="glass rounded-lg p-4 mt-4">
                                    <div class="text-white/70 text-xs mb-2">Top Negative Feedback Topics</div>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/80">Processing delays</span>
                                            <span class="text-red-400">43%</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/80">Unclear requirements</span>
                                            <span class="text-yellow-400">28%</span>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <span class="text-white/80">Communication gaps</span>
                                            <span class="text-yellow-400">19%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-trophy text-yellow-400"></i>
                                    Experience Leaders
                                </h3>
                                <div class="space-y-3">
                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white text-sm font-semibold">Building Permits</span>
                                            <span class="text-green-400 text-sm font-bold">9.4/10</span>
                                        </div>
                                        <div class="text-white/60 text-xs">Fast processing, clear communication</div>
                                    </div>
                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white text-sm font-semibold">Business Licenses</span>
                                            <span class="text-green-400 text-sm font-bold">9.1/10</span>
                                        </div>
                                        <div class="text-white/60 text-xs">Online portal, automated updates</div>
                                    </div>
                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white text-sm font-semibold">311 Service Requests</span>
                                            <span class="text-blue-400 text-sm font-bold">8.8/10</span>
                                        </div>
                                        <div class="text-white/60 text-xs">Multiple channels, real-time tracking</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Intelligence & Impact Analysis -->
                    <div class="mt-6 glass rounded-xl p-6">
                        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            <i class="fas fa-chart-pie text-yellow-400"></i>
                            Financial Intelligence & Impact Analysis
                        </h2>

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <!-- Financial KPIs -->
                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-1">Cost per Transaction</div>
                                <div class="text-2xl font-bold text-white mb-2">$12.47</div>
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-arrow-down text-green-400 text-xs"></i>
                                    <span class="text-green-400 text-xs">-18% YoY</span>
                                </div>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-1">Revenue Impact</div>
                                <div class="text-2xl font-bold text-white mb-2">$2.8M</div>
                                <div class="flex items-center gap-1">
                                    <i class="fas fa-arrow-up text-green-400 text-xs"></i>
                                    <span class="text-green-400 text-xs">+12% this quarter</span>
                                </div>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-1">Cost Avoidance</div>
                                <div class="text-2xl font-bold text-white mb-2">$1.2M</div>
                                <div class="text-white/60 text-xs">Through automation</div>
                            </div>

                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-1">ROI on AI Investment</div>
                                <div class="text-2xl font-bold text-white mb-2">347%</div>
                                <div class="text-white/60 text-xs">Over 18 months</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- Cost Breakdown -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-coins text-yellow-400"></i>
                                    Cost Breakdown by Department
                                </h3>
                                <div class="space-y-3">
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Personnel</span>
                                            <span class="text-white text-sm font-semibold">$4.2M (58%)</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full" style="width: 58%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Technology & Infrastructure</span>
                                            <span class="text-white text-sm font-semibold">$1.8M (25%)</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 25%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Operations</span>
                                            <span class="text-white text-sm font-semibold">$0.9M (12%)</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full" style="width: 12%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80 text-sm">Training & Development</span>
                                            <span class="text-white text-sm font-semibold">$0.4M (5%)</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-yellow-500 to-orange-500 h-2 rounded-full" style="width: 5%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Efficiency Gains -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-rocket text-green-400"></i>
                                    Efficiency Gains & Savings
                                </h3>
                                <div class="space-y-4">
                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-white/80 text-sm">Automation Savings</span>
                                            <span class="text-green-400 text-sm font-bold">$847K/year</span>
                                        </div>
                                        <div class="text-white/60 text-xs">2,450 hours saved annually</div>
                                    </div>

                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-white/80 text-sm">Reduced Paper Processing</span>
                                            <span class="text-green-400 text-sm font-bold">$124K/year</span>
                                        </div>
                                        <div class="text-white/60 text-xs">92% digital adoption rate</div>
                                    </div>

                                    <div class="glass rounded-lg p-3">
                                        <div class="flex items-center justify-between mb-1">
                                            <span class="text-white/80 text-sm">Faster Processing</span>
                                            <span class="text-green-400 text-sm font-bold">$231K/year</span>
                                        </div>
                                        <div class="text-white/60 text-xs">35% reduction in cycle time</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Economic Impact -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-building text-blue-400"></i>
                                Economic Impact Analysis
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-2">Business Permits Issued</div>
                                    <div class="text-2xl font-bold text-white mb-1">1,847</div>
                                    <div class="text-white/60 text-xs mb-2">Estimated economic activity</div>
                                    <div class="text-green-400 text-lg font-bold">$47.2M</div>
                                </div>

                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-2">Construction Permits</div>
                                    <div class="text-2xl font-bold text-white mb-1">892</div>
                                    <div class="text-white/60 text-xs mb-2">Estimated project value</div>
                                    <div class="text-green-400 text-lg font-bold">$124.8M</div>
                                </div>

                                <div class="glass rounded-lg p-4">
                                    <div class="text-white/70 text-xs mb-2">Jobs Supported</div>
                                    <div class="text-2xl font-bold text-white mb-1">3,420</div>
                                    <div class="text-white/60 text-xs mb-2">Direct & indirect employment</div>
                                    <div class="text-green-400 text-lg font-bold">+8.2%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance Tab -->
                <div id="compliance-content" class="tab-content" style="display: none;">
                    <!-- Compliance Badges -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-lg font-semibold text-white mb-4">Compliance Dashboard</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="text-center p-4 bg-green-500/20 rounded-lg">
                                <i class="fas fa-check-circle text-green-400 text-3xl mb-2"></i>
                                <h4 class="font-semibold text-white">GDPR Compliance</h4>
                                <p class="text-green-300 text-sm">Fully Compliant</p>
                            </div>

                            <div class="text-center p-4 bg-green-500/20 rounded-lg">
                                <i class="fas fa-shield-alt text-green-400 text-3xl mb-2"></i>
                                <h4 class="font-semibold text-white">SOC 2 Type II</h4>
                                <p class="text-green-300 text-sm">Certified</p>
                            </div>

                            <div class="text-center p-4 bg-yellow-500/20 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-yellow-400 text-3xl mb-2"></i>
                                <h4 class="font-semibold text-white">FISMA</h4>
                                <p class="text-yellow-300 text-sm">Under Review</p>
                            </div>
                        </div>
                    </div>

                    <!-- Blockchain Audit Trail - Added 2024-12-09 -->
                    <div id="blockchainAuditTrail">
                        <!-- Blockchain content will be injected here by JavaScript -->
                    </div>

                    <!-- Policy Intelligence Center - Added 2025-10-07 -->
                    <div id="policyIntelligenceCenter">
                        <!-- Policy Intelligence content will be injected here by JavaScript -->
                    </div>
                </div>
                
                <!-- Grant Management Tab -->
                <div id="grants-content" class="tab-content" style="display: none;">
                    <!-- Header Section -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-2xl font-bold text-white mb-2">Grant Management AI</h2>
                                <p class="text-white/70">Discover, track, and manage federal grants with cutting-edge AI assistance</p>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                    <span class="text-green-400 text-sm">AI Assistant Active</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Grant Search Assistant -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <!-- Search Interface -->
                        <div class="lg:col-span-2">
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center space-x-2 mb-4">
                                    <i class="fas fa-robot text-purple-400 text-xl"></i>
                                    <h3 class="text-lg font-semibold text-white">AI Grant Discovery Assistant</h3>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="relative">
                                        <input 
                                            type="text" 
                                            id="grant-search-input"
                                            placeholder="Describe your technology or project needs (e.g., 'AI cybersecurity tools', 'renewable energy infrastructure', 'smart city sensors')"
                                            class="w-full p-4 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-400/20"
                                        >
                                        <button 
                                            onclick="searchGrants()"
                                            class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white px-6 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2"
                                        >
                                            <i class="fas fa-search"></i>
                                            <span>Search Grants</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Quick Search Tags -->
                                    <div class="flex flex-wrap gap-2">
                                        <span class="text-white/70 text-sm">Quick searches:</span>
                                        <button onclick="quickSearch('cybersecurity')" class="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-sm hover:bg-blue-500/30 transition-colors">Cybersecurity</button>
                                        <button onclick="quickSearch('AI machine learning')" class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-sm hover:bg-purple-500/30 transition-colors">AI & ML</button>
                                        <button onclick="quickSearch('infrastructure')" class="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-sm hover:bg-green-500/30 transition-colors">Infrastructure</button>
                                        <button onclick="quickSearch('research development')" class="px-3 py-1 bg-yellow-500/20 text-yellow-300 rounded-full text-sm hover:bg-yellow-500/30 transition-colors">R&D</button>
                                        <button onclick="quickSearch('emergency management')" class="px-3 py-1 bg-red-500/20 text-red-300 rounded-full text-sm hover:bg-red-500/30 transition-colors">Emergency Mgmt</button>
                                    </div>
                                </div>
                                
                                <!-- AI Search Status -->
                                <div id="search-status" class="mt-4 p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg hidden">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full animate-spin"></div>
                                        <span class="text-blue-300">AI is analyzing federal grant databases...</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Grant Analytics -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">Grant Analytics</h3>
                            <div class="space-y-4">
                                <div class="bg-white/5 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/70">Total Available</span>
                                        <span class="text-green-400 font-semibold">$2.4B</span>
                                    </div>
                                </div>
                                <div class="bg-white/5 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/70">Active Opportunities</span>
                                        <span class="text-blue-400 font-semibold">1,247</span>
                                    </div>
                                </div>
                                <div class="bg-white/5 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/70">Closing This Month</span>
                                        <span class="text-orange-400 font-semibold">89</span>
                                    </div>
                                </div>
                                <div class="bg-white/5 rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/70">Match Rate</span>
                                        <span class="text-purple-400 font-semibold">94%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div id="grant-results" class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-lg font-semibold text-white mb-4">AI-Matched Grant Opportunities</h3>
                        <div id="grantSearchResults" class="space-y-4">
                            <!-- Results will be populated here -->
                        </div>
                    </div>

                    <!-- AI Insights -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-lg font-semibold text-white mb-4">AI Grant Insights</h3>
                        <div id="aiInsights" class="space-y-3">
                            <!-- AI insights will be populated here -->
                        </div>
                    </div>

                    <!-- Grant Pipeline Management -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Active Applications -->
                        <div class="glass rounded-xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-white">Active Applications</h3>
                                <button onclick="showAddGrantModal()" class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2">
                                    <i class="fas fa-plus"></i>
                                    <span>Add Grant</span>
                                </button>
                            </div>
                            
                            <div id="grantPipeline" class="space-y-3">
                                <!-- Dynamic grant pipeline will be populated here by JavaScript -->
                            </div>
                                
                                <div class="bg-white/5 rounded-lg p-4 border-l-4 border-purple-400">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-semibold text-white">DOE Smart Grid Technology</h4>
                                        <span class="px-2 py-1 bg-green-500/20 text-green-300 rounded text-sm">Submitted</span>
                                    </div>
                                    <p class="text-white/70 text-sm mb-2">$750K â€¢ Submitted: Dec 1, 2023</p>
                                    <div class="w-full bg-gray-700 rounded-full h-2">
                                        <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 100%"></div>
                                    </div>
                                    <p class="text-right text-white/50 text-xs mt-1">Awaiting Review</p>
                                </div>
                            </div>
                        </div>

                        <!-- AI Insights & Recommendations -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-semibold text-white mb-4">AI Insights & Recommendations</h3>
                            <div class="space-y-4">
                                <div class="bg-gradient-to-r from-purple-500/10 to-blue-500/10 border border-purple-500/20 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <i class="fas fa-lightbulb text-yellow-400 text-lg mt-1"></i>
                                        <div>
                                            <h4 class="font-semibold text-white mb-1">New Opportunity Alert</h4>
                                            <p class="text-white/70 text-sm">Based on your profile, DARPA just released a $50M cybersecurity grant that matches your expertise 96%.</p>
                                            <button class="mt-2 text-purple-400 hover:text-purple-300 text-sm font-medium">View Details â†’</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-blue-500/10 to-green-500/10 border border-blue-500/20 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <i class="fas fa-clock text-orange-400 text-lg mt-1"></i>
                                        <div>
                                            <h4 class="font-semibold text-white mb-1">Deadline Reminder</h4>
                                            <p class="text-white/70 text-sm">DHS Cybersecurity Innovation application deadline is in 12 days. AI suggests prioritizing Section 3 completion.</p>
                                            <button class="mt-2 text-blue-400 hover:text-blue-300 text-sm font-medium">Open Application â†’</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-gradient-to-r from-green-500/10 to-purple-500/10 border border-green-500/20 rounded-lg p-4">
                                    <div class="flex items-start space-x-3">
                                        <i class="fas fa-chart-line text-green-400 text-lg mt-1"></i>
                                        <div>
                                            <h4 class="font-semibold text-white mb-1">Success Optimization</h4>
                                            <p class="text-white/70 text-sm">Your application success rate could increase by 23% by adding more quantitative metrics to your proposals.</p>
                                            <button class="mt-2 text-green-400 hover:text-green-300 text-sm font-medium">Get Suggestions â†’</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Intelligence Hub Tab -->
                <div id="intelligence-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <!-- Platform-Wide AI Search -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <i class="fas fa-search text-blue-400 text-xl"></i>
                            <h3 class="text-lg font-bold text-white">Intelligent Platform Search</h3>
                        </div>
                        <div class="flex gap-3">
                            <input type="text" id="platformSearch" placeholder="Search across workflows, contacts, documents, policies, grants..."
                                   class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                   onkeypress="if(event.key==='Enter') performPlatformSearch()">
                            <button onclick="performPlatformSearch()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
                                <i class="fas fa-magic mr-2"></i>AI Search
                            </button>
                        </div>
                    </div>

                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="glass rounded-lg p-4">
                            <div class="text-sm text-white/70 mb-1">Active AI Insights</div>
                            <div class="text-2xl font-bold text-purple-400">47</div>
                            <div class="text-xs text-white/50 mt-1">Across 7 sections</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-sm text-white/70 mb-1">Automation Opportunities</div>
                            <div class="text-2xl font-bold text-blue-400">12</div>
                            <div class="text-xs text-white/50 mt-1">Avg 2.3 hrs saved each</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-sm text-white/70 mb-1">Cross-Section Actions</div>
                            <div class="text-2xl font-bold text-green-400">23</div>
                            <div class="text-xs text-white/50 mt-1">Pending review</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-sm text-white/70 mb-1">AI Confidence</div>
                            <div class="text-2xl font-bold text-yellow-400">91.2%</div>
                            <div class="text-xs text-white/50 mt-1">+3.1% this week</div>
                        </div>
                    </div>

                    <!-- Main Content Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column: Insights Feed -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Unified AI Insights Feed -->
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-white flex items-center gap-2">
                                        <i class="fas fa-lightbulb text-yellow-400"></i>
                                        Real-Time Intelligence Feed
                                    </h3>
                                    <div class="flex items-center gap-2">
                                        <div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div>
                                        <span class="text-xs text-white/70">Live</span>
                                    </div>
                                </div>

                                <!-- Filters -->
                                <div class="flex gap-2 mb-4 flex-wrap">
                                    <button onclick="filterInsights('all')" class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-lg text-sm font-medium border border-purple-500/30">All (47)</button>
                                    <button onclick="filterInsights('high')" class="bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-lg text-sm border border-white/20 transition-all">High Priority (8)</button>
                                    <button onclick="filterInsights('actionable')" class="bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-lg text-sm border border-white/20 transition-all">Actionable (23)</button>
                                    <button onclick="filterInsights('automated')" class="bg-white/10 hover:bg-white/20 text-white px-3 py-1 rounded-lg text-sm border border-white/20 transition-all">Auto-Run (16)</button>
                                </div>

                                <!-- Insight Cards -->
                                <div id="insightsFeed" class="space-y-3 max-h-[600px] overflow-y-auto">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Cross-Section Action Center -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-bolt text-yellow-400"></i>
                                    Cross-Section Actions
                                </h3>
                                <div id="actionCenter" class="space-y-3">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Intelligent Automation Suggestions -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-robot text-purple-400"></i>
                                    Automation Opportunities
                                </h3>
                                <div id="automationSuggestions" class="space-y-4">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Knowledge Graph & AI Status -->
                        <div class="space-y-6">
                            <!-- Knowledge Graph Preview -->
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                        <i class="fas fa-project-diagram text-blue-400"></i>
                                        Knowledge Graph
                                    </h3>
                                    <button onclick="openFullGraph()" class="text-blue-400 hover:text-blue-300 text-sm transition-colors">
                                        <i class="fas fa-expand mr-1"></i>Expand
                                    </button>
                                </div>
                                <div id="knowledgeGraphPreview" class="bg-black/20 rounded-lg" style="height: 300px; position: relative;">
                                    <!-- Graph will be rendered here -->
                                </div>
                                <div class="mt-3 text-xs text-white/60">
                                    <div class="flex items-center gap-2 mb-1">
                                        <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                        <span>Citizens</span>
                                    </div>
                                    <div class="flex items-center gap-2 mb-1">
                                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                        <span>Workflows</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <div class="w-3 h-3 rounded-full bg-purple-500"></div>
                                        <span>Vendors</span>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Confidence Dashboard -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-line text-green-400"></i>
                                    AI Model Performance
                                </h3>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-white/70">Document OCR</span>
                                            <span class="text-green-400 font-semibold">94.7%</span>
                                        </div>
                                        <div class="confidence-meter">
                                            <div class="confidence-fill bg-green-400" style="width: 94.7%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-white/70">Predictive Models</span>
                                            <span class="text-blue-400 font-semibold">87.3%</span>
                                        </div>
                                        <div class="confidence-meter">
                                            <div class="confidence-fill bg-blue-400" style="width: 87.3%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-white/70">Policy Interpretation</span>
                                            <span class="text-purple-400 font-semibold">91.5%</span>
                                        </div>
                                        <div class="confidence-meter">
                                            <div class="confidence-fill bg-purple-400" style="width: 91.5%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-white/70">Sentiment Analysis</span>
                                            <span class="text-yellow-400 font-semibold">89.2%</span>
                                        </div>
                                        <div class="confidence-meter">
                                            <div class="confidence-fill bg-yellow-400" style="width: 89.2%"></div>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="viewExplainability()" class="mt-4 w-full bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium border border-white/20 transition-all">
                                    <i class="fas fa-info-circle mr-2"></i>View Explainability
                                </button>
                            </div>

                            <!-- Integration Health -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-link text-blue-400"></i>
                                    Integration Health
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-white/70">Citizen Portal â†” Predictive</span>
                                        <span class="integration-status status-active">âœ“ Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-white/70">Documents â†” Workflows</span>
                                        <span class="integration-status status-active">âœ“ Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-white/70">CRM â†” Documents</span>
                                        <span class="integration-status status-active">âœ“ Active</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-white/70">Policy â†” Workflows</span>
                                        <span class="integration-status status-partial">âš  Partial</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-white/70">Grants â†” CRM</span>
                                        <span class="integration-status status-limited">âš  Limited</span>
                                    </div>
                                </div>
                                <button onclick="viewIntegrationDetails()" class="mt-4 w-full bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg text-sm font-medium border border-white/20 transition-all">
                                    <i class="fas fa-cog mr-2"></i>Configure Integrations
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Knowledge Graph Modal -->
                    <div id="graphModal" class="modal" role="dialog" aria-labelledby="graphModalTitle">
                        <div class="glass rounded-xl p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h2 id="graphModalTitle" class="text-2xl font-bold text-white flex items-center gap-3">
                                    <i class="fas fa-project-diagram text-blue-400"></i>
                                    Platform Knowledge Graph
                                </h2>
                                <button onclick="closeGraphModal()" class="text-white/70 hover:text-white transition-colors">
                                    <i class="fas fa-times text-2xl"></i>
                                </button>
                            </div>
                            <div id="knowledgeGraphFull" class="bg-black/20 rounded-xl" style="height: 600px; position: relative;">
                                <!-- Full graph visualization -->
                            </div>
                        </div>
                    </div>

                    <!-- Search Results Modal -->
                    <div id="searchModal" class="modal" role="dialog" aria-labelledby="searchModalTitle">
                        <div class="glass rounded-xl p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                            <div class="flex items-center justify-between mb-6">
                                <h2 id="searchModalTitle" class="text-2xl font-bold text-white flex items-center gap-3">
                                    <i class="fas fa-search text-purple-400"></i>
                                    Search Results
                                </h2>
                                <button onclick="closeSearchModal()" class="text-white/70 hover:text-white transition-colors">
                                    <i class="fas fa-times text-2xl"></i>
                                </button>
                            </div>
                            <div id="searchResults">
                                <!-- Results populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Integration Platform Tab -->
                <div id="api-integration-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <!-- Header -->
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2 flex items-center gap-3">
                            <i class="fas fa-plug text-blue-400"></i>
                            API Integration Platform
                            <span class="text-xs bg-gradient-to-r from-blue-500 to-purple-500 text-white px-3 py-1 rounded-full">CJIS Compliant</span>
                        </h2>
                        <p class="text-white/70">Intelligent API Discovery, Transformation & Orchestration for Government Systems</p>
                    </div>

                    <!-- Module Navigation Tabs -->
                    <div class="glass rounded-xl p-2 mb-6 overflow-x-auto">
                        <div class="flex gap-2 min-w-max">
                            <button onclick="switchAPIModule('discovery')" class="api-tab-button active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="discovery">
                                <i class="fas fa-search mr-2"></i>API Discovery
                            </button>
                            <button onclick="switchAPIModule('transformer')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="transformer">
                                <i class="fas fa-exchange-alt mr-2"></i>Data Transformer
                            </button>
                            <button onclick="switchAPIModule('orchestrator')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="orchestrator">
                                <i class="fas fa-project-diagram mr-2"></i>Logic Orchestrator
                            </button>
                            <button onclick="switchAPIModule('sync')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="sync">
                                <i class="fas fa-sync mr-2"></i>Sync Engine
                            </button>
                            <button onclick="switchAPIModule('security')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="security">
                                <i class="fas fa-shield-alt mr-2"></i>Security
                            </button>
                            <button onclick="switchAPIModule('errors')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="errors">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Error Handling
                            </button>
                            <button onclick="switchAPIModule('marketplace')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="marketplace">
                                <i class="fas fa-store mr-2"></i>Marketplace
                            </button>
                            <button onclick="switchAPIModule('workspace')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="workspace">
                                <i class="fas fa-users mr-2"></i>Workspace
                            </button>
                            <!-- Enhanced 2024-10-30: CJIS-Compliant Integration Hub -->
                            <button onclick="switchAPIModule('gov-connectors')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="gov-connectors">
                                <i class="fas fa-building mr-2"></i>Gov Connectors
                            </button>
                            <button onclick="switchAPIModule('cjis-transfer')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="cjis-transfer">
                                <i class="fas fa-lock mr-2"></i>CJIS Transfer
                            </button>
                            <button onclick="switchAPIModule('audit-logs')" class="api-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap" data-api-module="audit-logs">
                                <i class="fas fa-clipboard-list mr-2"></i>Audit Logs
                            </button>
                        </div>
                    </div>

                    <!-- Module 1: API Discovery -->
                    <div id="api-module-discovery" class="api-module-content">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-search text-blue-400"></i>
                                Intelligent API Search
                            </h3>
                            <div class="relative mb-3">
                                <input type="text" id="apiSearch" placeholder="Try: 'Find me all DMV databases with vehicle registration data' or 'Show APIs for tax assessment'"
                                       class="w-full px-6 py-4 bg-white/10 border border-white/20 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button onclick="searchAPIs()" class="absolute right-3 top-1/2 -translate-y-1/2 px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-medium hover:shadow-lg transition-all">
                                    <i class="fas fa-magic mr-2"></i>AI Search
                                </button>
                            </div>
                            <div class="flex gap-2 flex-wrap">
                                <span class="text-xs text-white/50">Quick searches:</span>
                                <button onclick="quickSearch('DMV')" class="text-xs px-3 py-1 bg-white/10 hover:bg-white/20 rounded-full text-blue-400 border border-blue-500/30 transition-all">DMV Records</button>
                                <button onclick="quickSearch('Criminal')" class="text-xs px-3 py-1 bg-white/10 hover:bg-white/20 rounded-full text-blue-400 border border-blue-500/30 transition-all">Criminal Database</button>
                                <button onclick="quickSearch('Tax')" class="text-xs px-3 py-1 bg-white/10 hover:bg-white/20 rounded-full text-blue-400 border border-blue-500/30 transition-all">Tax Systems</button>
                            </div>
                        </div>
                        <div id="apiResults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6"></div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-heartbeat text-green-400"></i>
                                    API Health Monitor
                                </h3>
                                <div id="healthDashboard" class="space-y-3"></div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-bar text-purple-400"></i>
                                    Quick Stats
                                </h3>
                                <div class="space-y-3 text-center">
                                    <div class="text-3xl font-bold text-blue-400">52</div>
                                    <div class="text-sm text-white/60">Total APIs Available</div>
                                    <div class="text-2xl font-bold text-green-400">99.7%</div>
                                    <div class="text-sm text-white/60">Average Uptime</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Module 2-7: Condensed versions -->
                    <div id="api-module-transformer" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4"><i class="fas fa-exchange-alt text-purple-400 mr-2"></i>Data Transformer</h3>
                            <p class="text-white/70 mb-4">Visual data mapping, PII detection, and quality scoring coming soon.</p>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                                <div class="text-white font-medium mb-2">âœ“ Feature includes:</div>
                                <ul class="text-white/70 text-sm space-y-1">
                                    <li>â€¢ Drag-and-drop field mapping</li>
                                    <li>â€¢ Automatic PII detection</li>
                                    <li>â€¢ Data quality scoring (94% average)</li>
                                    <li>â€¢ Format conversion (dates, addresses, names)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="api-module-orchestrator" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4"><i class="fas fa-project-diagram text-blue-400 mr-2"></i>Logic Orchestrator</h3>
                            <p class="text-white/70 mb-4">Build conditional workflows with decision trees and A/B testing.</p>
                            <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <div class="text-white font-medium mb-2">âœ“ Workflow templates available:</div>
                                <ul class="text-white/70 text-sm space-y-1">
                                    <li>â€¢ Building permit routing</li>
                                    <li>â€¢ Emergency dispatch prioritization</li>
                                    <li>â€¢ Grant application compliance checks</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div id="api-module-sync" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4"><i class="fas fa-sync text-blue-400 mr-2"></i>Sync Reconciliation</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="text-center glass-dark rounded-lg p-4">
                                    <div class="text-3xl font-bold text-green-400">99.8%</div>
                                    <div class="text-sm text-white/60">Success Rate</div>
                                </div>
                                <div class="text-center glass-dark rounded-lg p-4">
                                    <div class="text-3xl font-bold text-blue-400">1.2s</div>
                                    <div class="text-sm text-white/60">Avg Latency</div>
                                </div>
                                <div class="text-center glass-dark rounded-lg p-4">
                                    <div class="text-3xl font-bold text-purple-400">15K</div>
                                    <div class="text-sm text-white/60">Records/hour</div>
                                </div>
                                <div class="text-center glass-dark rounded-lg p-4">
                                    <div class="text-3xl font-bold text-yellow-400">3</div>
                                    <div class="text-sm text-white/60">Conflicts</div>
                                </div>
                            </div>
                        </div>
                        <div id="conflictQueue" class="space-y-3"></div>
                    </div>

                    <div id="api-module-security" class="api-module-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white/70">Threat Level</span>
                                    <i class="fas fa-shield-alt text-green-400"></i>
                                </div>
                                <div class="text-3xl font-bold text-green-400 mb-1">LOW</div>
                                <div class="text-xs text-white/60">No active threats detected</div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white/70">Compliance Score</span>
                                    <i class="fas fa-check-circle text-blue-400"></i>
                                </div>
                                <div class="text-3xl font-bold text-blue-400 mb-1">96/100</div>
                                <div class="text-xs text-white/60">CJIS + FedRAMP + FISMA</div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-white/70">API Calls Today</span>
                                    <i class="fas fa-chart-bar text-purple-400"></i>
                                </div>
                                <div class="text-3xl font-bold text-purple-400 mb-1">247K</div>
                                <div class="text-xs text-white/60">$3,240 estimated cost</div>
                            </div>
                        </div>
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">Compliance Status</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white text-sm">CJIS Compliance</span>
                                        <span class="text-green-400 font-medium">98%</span>
                                    </div>
                                    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-green-500 to-green-400" style="width: 98%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white text-sm">FedRAMP Authorization</span>
                                        <span class="text-blue-400 font-medium">94%</span>
                                    </div>
                                    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-blue-500 to-blue-400" style="width: 94%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white text-sm">FISMA Controls</span>
                                        <span class="text-purple-400 font-medium">96%</span>
                                    </div>
                                    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-purple-500 to-purple-400" style="width: 96%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="api-module-errors" class="api-module-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                            <div class="glass rounded-xl p-4">
                                <div class="text-sm text-white/70 mb-1">Total Errors (24h)</div>
                                <div class="text-2xl font-bold text-red-400">127</div>
                                <div class="text-xs text-white/50 mt-1">â†“ 23% from yesterday</div>
                            </div>
                            <div class="glass rounded-xl p-4">
                                <div class="text-sm text-white/70 mb-1">Auto-Recovered</div>
                                <div class="text-2xl font-bold text-green-400">94</div>
                                <div class="text-xs text-white/50 mt-1">74% success rate</div>
                            </div>
                            <div class="glass rounded-xl p-4">
                                <div class="text-sm text-white/70 mb-1">Manual Review</div>
                                <div class="text-2xl font-bold text-yellow-400">28</div>
                                <div class="text-xs text-white/50 mt-1">Requires attention</div>
                            </div>
                            <div class="glass rounded-xl p-4">
                                <div class="text-sm text-white/70 mb-1">Failed Retries</div>
                                <div class="text-2xl font-bold text-red-400">5</div>
                                <div class="text-xs text-white/50 mt-1">Escalated to team</div>
                            </div>
                        </div>
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-lg font-bold text-white mb-4"><i class="fas fa-chart-pie text-blue-400 mr-2"></i>Error Breakdown</h3>
                            <div id="errorCategories" class="space-y-3"></div>
                        </div>
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4"><i class="fas fa-inbox text-yellow-400 mr-2"></i>Dead Letter Queue</h3>
                            <div id="deadLetterQueue" class="space-y-3"></div>
                        </div>
                    </div>

                    <div id="api-module-marketplace" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <div class="flex gap-4 mb-4">
                                <input type="text" placeholder="Search connectors..." class="flex-1 px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <select class="px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option>All Categories</option>
                                    <option>Public Safety</option>
                                    <option>Regulatory</option>
                                    <option>Administrative</option>
                                </select>
                            </div>
                            <div class="flex gap-2 flex-wrap">
                                <button class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm border border-blue-500/30">CJIS Certified</button>
                                <button class="px-3 py-1 bg-white/10 hover:bg-white/20 text-white rounded-full text-sm border border-white/20 transition-all">FedRAMP</button>
                                <button class="px-3 py-1 bg-white/10 hover:bg-white/20 text-white rounded-full text-sm border border-white/20 transition-all">Free Tier</button>
                            </div>
                        </div>
                        <div id="connectorGallery" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    </div>

                    <div id="api-module-workspace" class="api-module-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="lg:col-span-2 glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-code text-blue-400"></i>
                                    Collaborative Editor
                                    <span class="text-sm bg-green-500/20 text-green-400 px-2 py-1 rounded-full ml-auto">4 users online</span>
                                </h3>
                                <div class="bg-black/30 rounded-lg p-4 h-96 overflow-y-auto text-green-400 font-mono text-sm">
                                    <div>// Real-time collaboration workspace</div>
                                    <div class="mt-2">ðŸ‘¤ <span class="text-blue-400">John (Dev)</span> is editing...</div>
                                    <div class="mt-1">ðŸ‘¤ <span class="text-green-400">Sarah (QA)</span> is reviewing...</div>
                                </div>
                            </div>
                            <div class="space-y-6">
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-lg font-bold text-white mb-4"><i class="fas fa-comments text-green-400 mr-2"></i>Team Chat</h3>
                                    <div class="bg-black/20 rounded-lg p-3 h-48 overflow-y-auto mb-3">
                                        <div id="teamChat" class="space-y-2"></div>
                                    </div>
                                    <input type="text" placeholder="Type a message..." class="w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-green-500">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Error Details Modal -->
                <div id="errorModal" class="modal" style="display: none;">
                    <div class="glass rounded-xl p-6 m-4 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                        <div class="flex items-start justify-between mb-6">
                            <div>
                                <h3 class="text-2xl font-bold text-white mb-2" id="modalTitle">Error Details</h3>
                                <p class="text-white/70 text-sm" id="modalSubtitle"></p>
                            </div>
                            <button onclick="closeErrorModal()" class="text-white/70 hover:text-white text-2xl transition-all">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div id="modalContent" class="space-y-6"></div>
                        <div class="flex gap-3 mt-6">
                            <button onclick="retryError()" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-redo mr-2"></i>Retry Request
                            </button>
                            <button onclick="escalateError()" class="px-6 py-3 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white font-medium transition-all">
                                <i class="fas fa-exclamation-triangle mr-2"></i>Escalate to Team
                            </button>
                            <button onclick="closeErrorModal()" class="px-6 py-3 bg-white/10 hover:bg-white/20 rounded-lg text-white font-medium transition-all">
                                Close
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Added 2024-10-31: Autonomous Government Operations Module -->
                <div id="autonomous-operations-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <!-- Header -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div class="w-14 h-14 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl flex items-center justify-center">
                                    <i class="fas fa-robot text-white text-2xl"></i>
                                </div>
                                <div>
                                    <h1 class="text-3xl font-bold text-white">Autonomous Government Operations</h1>
                                    <p class="text-white/70">AI-Powered Process Agents â€¢ Continuous Learning â€¢ Supervised Automation</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-3">
                                <div class="flex items-center space-x-2 bg-green-500/20 px-4 py-2 rounded-lg border border-green-400/30">
                                    <div class="w-3 h-3 bg-green-400 rounded-full agent-status-active"></div>
                                    <span class="text-green-300 text-sm font-semibold">8 AGENTS ACTIVE</span>
                                </div>
                                <div class="text-white/60 text-sm">
                                    <i class="fas fa-chart-line mr-2"></i>234 tasks completed today
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Module Navigation -->
                    <div class="glass rounded-xl p-2 mb-6">
                        <div class="flex items-center space-x-2 overflow-x-auto">
                            <button onclick="switchAutonomousModule('agents')" class="autonomous-module-tab active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-autonomous-module="agents">
                                <i class="fas fa-robot mr-2"></i>AI Agents
                            </button>
                            <button onclick="switchAutonomousModule('supervision')" class="autonomous-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-autonomous-module="supervision">
                                <i class="fas fa-eye mr-2"></i>Supervision
                            </button>
                            <button onclick="switchAutonomousModule('learning')" class="autonomous-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-autonomous-module="learning">
                                <i class="fas fa-brain mr-2"></i>Learning System
                            </button>
                            <button onclick="switchAutonomousModule('integration')" class="autonomous-module-tab px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-autonomous-module="integration">
                                <i class="fas fa-plug mr-2"></i>Integrations
                            </button>
                        </div>
                    </div>

                    <!-- Module 1: AI Agents Framework -->
                    <div id="autonomous-module-agents" class="autonomous-module-content active">
                        <!-- Agent Overview Dashboard -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-2">Active Agents</div>
                                <div class="text-3xl font-bold text-white">8</div>
                                <div class="text-green-400 text-xs mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>+2 this week
                                </div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-2">Tasks Completed</div>
                                <div class="text-3xl font-bold text-blue-400">234</div>
                                <div class="text-white/60 text-xs mt-2">Today</div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-2">Automation Rate</div>
                                <div class="text-3xl font-bold text-purple-400">87%</div>
                                <div class="text-green-400 text-xs mt-2">
                                    <i class="fas fa-arrow-up mr-1"></i>+5% vs last month
                                </div>
                            </div>
                            <div class="glass rounded-xl p-6">
                                <div class="text-white/70 text-xs mb-2">Cost Savings</div>
                                <div class="text-3xl font-bold text-green-400">$127K</div>
                                <div class="text-white/60 text-xs mt-2">This month</div>
                            </div>
                        </div>

                        <!-- Specialized Government Agents -->
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-robot text-purple-400"></i>
                                Specialized Government Agents
                                <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full">AI-Powered</span>
                            </h3>

                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Agent 1: Permit Processing Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                                                <i class="fas fa-file-alt text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Permit Processing</div>
                                                <div class="text-white/60 text-xs">Building permits & licenses</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">42/50 permits</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-2 rounded-full" style="width: 84%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">2.3 min</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Success Rate</div>
                                                <div class="text-green-400 font-semibold">98.5%</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Document validation & extraction</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Compliance rule checking</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Automated approval/rejection</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>

                                <!-- Agent 2: Tax Processing Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                                                <i class="fas fa-dollar-sign text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Tax Processing</div>
                                                <div class="text-white/60 text-xs">Returns & payment verification</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">89/100 returns</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full" style="width: 89%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">1.8 min</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Success Rate</div>
                                                <div class="text-green-400 font-semibold">99.2%</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Form validation & calculation</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Fraud detection algorithms</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Payment plan automation</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>

                                <!-- Agent 3: Document Classification Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                                                <i class="fas fa-folder-open text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Document Classification</div>
                                                <div class="text-white/60 text-xs">AI-powered categorization</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">367/400 docs</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 91.75%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">0.4 sec</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Accuracy</div>
                                                <div class="text-green-400 font-semibold">97.8%</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>OCR & text extraction</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>27 document types recognized</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Auto-routing to departments</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>

                                <!-- Agent 4: Citizen Query Response Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center">
                                                <i class="fas fa-comments text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Citizen Query Response</div>
                                                <div class="text-white/60 text-xs">24/7 support automation</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">156/180 queries</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-orange-500 to-red-500 h-2 rounded-full" style="width: 86.67%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">45 sec</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Satisfaction</div>
                                                <div class="text-green-400 font-semibold">4.7/5.0</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Natural language understanding</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Knowledge base: 1,200+ topics</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Escalation to human agents</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-orange-600 hover:bg-orange-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>

                                <!-- Agent 5: Grant Application Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-teal-500 to-cyan-500 flex items-center justify-center">
                                                <i class="fas fa-hand-holding-usd text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Grant Application</div>
                                                <div class="text-white/60 text-xs">Federal grant processing</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">12/15 grants</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-teal-500 to-cyan-500 h-2 rounded-full" style="width: 80%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">4.2 hrs</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Success Rate</div>
                                                <div class="text-green-400 font-semibold">94.1%</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Eligibility assessment</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Application completion assistance</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>SAM.gov integration</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>

                                <!-- Agent 6: Compliance Monitoring Agent -->
                                <div class="agent-card glass rounded-xl p-6">
                                    <div class="flex items-start justify-between mb-4">
                                        <div class="flex items-center gap-3">
                                            <div class="w-12 h-12 rounded-lg bg-gradient-to-r from-yellow-500 to-amber-500 flex items-center justify-center">
                                                <i class="fas fa-clipboard-check text-white text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-semibold">Compliance Monitoring</div>
                                                <div class="text-white/60 text-xs">Regulatory compliance tracking</div>
                                            </div>
                                        </div>
                                        <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                            <div class="w-2 h-2 bg-green-400 rounded-full agent-status-active"></div>
                                            ACTIVE
                                        </span>
                                    </div>

                                    <div class="space-y-3 mb-4">
                                        <div>
                                            <div class="flex items-center justify-between text-xs mb-1">
                                                <span class="text-white/70">Today's Progress</span>
                                                <span class="text-white">78/80 checks</span>
                                            </div>
                                            <div class="w-full bg-white/10 rounded-full h-2">
                                                <div class="bg-gradient-to-r from-yellow-500 to-amber-500 h-2 rounded-full" style="width: 97.5%"></div>
                                            </div>
                                        </div>

                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">3.1 min</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Accuracy</div>
                                                <div class="text-green-400 font-semibold">99.6%</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="space-y-2">
                                        <div class="text-xs text-white/70 font-semibold mb-2">Capabilities:</div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>CJIS, FISMA, FedRAMP checks</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Policy violation detection</span>
                                        </div>
                                        <div class="flex items-center gap-2 text-xs text-white/60">
                                            <i class="fas fa-check text-green-400"></i>
                                            <span>Automated remediation steps</span>
                                        </div>
                                    </div>

                                    <button class="w-full mt-4 px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-white text-sm transition">
                                        <i class="fas fa-cog mr-2"></i>Configure Agent
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Agent Activity Feed -->
                        <div class="glass rounded-xl p-6">
                            <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                <i class="fas fa-stream text-blue-400"></i>
                                Recent Agent Activity
                            </h4>
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                    <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                        <i class="fas fa-file-alt text-blue-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-white text-sm font-medium">Permit Processing completed task</div>
                                        <div class="text-white/60 text-xs">Approved building permit BP-2024-0847 in 2.1 minutes</div>
                                    </div>
                                    <div class="text-white/60 text-xs">2 min ago</div>
                                </div>

                                <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                    <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                        <i class="fas fa-dollar-sign text-green-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-white text-sm font-medium">Tax Processing verified return</div>
                                        <div class="text-white/60 text-xs">Validated Form 1040 â€¢ Refund: $2,847 â€¢ Status: Approved</div>
                                    </div>
                                    <div class="text-white/60 text-xs">5 min ago</div>
                                </div>

                                <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                    <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                        <i class="fas fa-folder-open text-purple-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-white text-sm font-medium">Document Classification processed batch</div>
                                        <div class="text-white/60 text-xs">Classified 47 documents â€¢ Routed to 8 departments</div>
                                    </div>
                                    <div class="text-white/60 text-xs">8 min ago</div>
                                </div>

                                <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition">
                                    <div class="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center">
                                        <i class="fas fa-comments text-orange-400"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="text-white text-sm font-medium">Citizen Query Response answered question</div>
                                        <div class="text-white/60 text-xs">Query: "How do I renew my business license?" â€¢ Satisfaction: 5/5</div>
                                    </div>
                                    <div class="text-white/60 text-xs">12 min ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Module 1: AI Agents -->

                    <!-- Module 2: Supervision & Control -->
                    <div id="autonomous-module-supervision" class="autonomous-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-eye text-blue-400"></i>
                                Agent Supervision & Control Mechanisms
                                <span class="text-xs bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full">Human-in-the-Loop</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Comprehensive oversight system ensuring all autonomous agents operate within defined boundaries with human supervision protocols.
                            </p>

                            <!-- Supervision Dashboard -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Approval Required</div>
                                    <div class="text-2xl font-bold text-yellow-400">12</div>
                                    <div class="text-white/60 text-xs mt-1">Pending human review</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Approved Today</div>
                                    <div class="text-2xl font-bold text-green-400">198</div>
                                    <div class="text-white/60 text-xs mt-1">Decisions validated</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Overrides</div>
                                    <div class="text-2xl font-bold text-red-400">3</div>
                                    <div class="text-white/60 text-xs mt-1">Agent decisions reversed</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Override Rate</div>
                                    <div class="text-2xl font-bold text-green-400">1.5%</div>
                                    <div class="text-white/60 text-xs mt-1">Within target (<5%)</div>
                                </div>
                            </div>

                            <!-- Pending Approvals -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4 flex items-center justify-between">
                                    <span class="flex items-center gap-2">
                                        <i class="fas fa-clipboard-list text-yellow-400"></i>
                                        Pending Human Approvals
                                    </span>
                                    <span class="text-xs bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full">12 awaiting review</span>
                                </h4>
                                <div class="space-y-3">
                                    <!-- Approval 1 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                                    <i class="fas fa-file-alt text-blue-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">High-Value Permit Approval</div>
                                                    <div class="text-white/60 text-sm">Agent: Permit Processing â€¢ Type: Commercial Construction</div>
                                                </div>
                                            </div>
                                            <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded text-xs font-semibold">REVIEW NEEDED</span>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-xs">
                                            <div>
                                                <div class="text-white/50">Project Value</div>
                                                <div class="text-white">$2.4M</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Agent Confidence</div>
                                                <div class="text-yellow-400">78%</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Recommendation</div>
                                                <div class="text-green-400">Approve</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Waiting Time</div>
                                                <div class="text-white">23 min</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-check mr-2"></i>Approve
                                            </button>
                                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-times mr-2"></i>Reject
                                            </button>
                                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-info-circle mr-2"></i>Review Details
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Approval 2 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-start justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                                    <i class="fas fa-dollar-sign text-green-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Tax Refund - Anomaly Detected</div>
                                                    <div class="text-white/60 text-sm">Agent: Tax Processing â€¢ Refund amount exceeds average</div>
                                                </div>
                                            </div>
                                            <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded text-xs font-semibold">REVIEW NEEDED</span>
                                        </div>
                                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-xs">
                                            <div>
                                                <div class="text-white/50">Refund Amount</div>
                                                <div class="text-white">$18,450</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Agent Confidence</div>
                                                <div class="text-yellow-400">65%</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Recommendation</div>
                                                <div class="text-yellow-400">Manual Review</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Waiting Time</div>
                                                <div class="text-white">45 min</div>
                                            </div>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-check mr-2"></i>Approve
                                            </button>
                                            <button class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-times mr-2"></i>Reject
                                            </button>
                                            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-sm transition">
                                                <i class="fas fa-info-circle mr-2"></i>Review Details
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Control Mechanisms -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Agent Control Mechanisms</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- Confidence Thresholds -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-sliders-h text-blue-400"></i>
                                                <span class="text-white font-medium">Confidence Thresholds</span>
                                            </div>
                                            <button class="text-blue-400 hover:text-blue-300 text-xs">
                                                <i class="fas fa-edit mr-1"></i>Edit
                                            </button>
                                        </div>
                                        <div class="space-y-3">
                                            <div>
                                                <div class="flex items-center justify-between text-xs mb-1">
                                                    <span class="text-white/70">Auto-Approve (High Confidence)</span>
                                                    <span class="text-green-400">â‰¥85%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-green-400 h-2 rounded-full" style="width: 85%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex items-center justify-between text-xs mb-1">
                                                    <span class="text-white/70">Human Review (Medium)</span>
                                                    <span class="text-yellow-400">50-84%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-yellow-400 h-2 rounded-full" style="width: 34%"></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div class="flex items-center justify-between text-xs mb-1">
                                                    <span class="text-white/70">Auto-Reject (Low Confidence)</span>
                                                    <span class="text-red-400"><50%</span>
                                                </div>
                                                <div class="w-full bg-white/10 rounded-full h-2">
                                                    <div class="bg-red-400 h-2 rounded-full" style="width: 50%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Escalation Rules -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-layer-group text-purple-400"></i>
                                                <span class="text-white font-medium">Escalation Rules</span>
                                            </div>
                                            <button class="text-purple-400 hover:text-purple-300 text-xs">
                                                <i class="fas fa-edit mr-1"></i>Edit
                                            </button>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Financial transactions >$10K</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Policy exception requests</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Multi-department coordination required</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Sensitive citizen data modifications</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/70">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Legal or compliance concerns</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Override History -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-history text-orange-400"></i>
                                                <span class="text-white font-medium">Recent Overrides</span>
                                            </div>
                                            <span class="text-xs text-white/60">Last 7 days</span>
                                        </div>
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between p-2 bg-white/5 rounded">
                                                <div class="text-xs">
                                                    <div class="text-white">Permit Processing Override</div>
                                                    <div class="text-white/60">Agent approved, human rejected</div>
                                                </div>
                                                <div class="text-red-400 text-xs">2 days ago</div>
                                            </div>
                                            <div class="flex items-center justify-between p-2 bg-white/5 rounded">
                                                <div class="text-xs">
                                                    <div class="text-white">Tax Processing Override</div>
                                                    <div class="text-white/60">Agent rejected, human approved</div>
                                                </div>
                                                <div class="text-green-400 text-xs">4 days ago</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Audit Trail -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-clipboard-list text-teal-400"></i>
                                                <span class="text-white font-medium">Audit Trail</span>
                                            </div>
                                            <button class="text-teal-400 hover:text-teal-300 text-xs">
                                                <i class="fas fa-download mr-1"></i>Export
                                            </button>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3 text-xs">
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Total Actions Logged</div>
                                                <div class="text-white font-semibold">12,847</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Retention Period</div>
                                                <div class="text-white font-semibold">7 years</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Compliance</div>
                                                <div class="text-green-400 font-semibold">100%</div>
                                            </div>
                                            <div class="bg-white/5 rounded-lg p-2">
                                                <div class="text-white/50">Last Audit</div>
                                                <div class="text-white font-semibold">Today</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Supervisor Dashboard -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Supervisor Performance</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center">
                                                <span class="text-white font-bold">JW</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Jane Williams</div>
                                                <div class="text-white/60 text-xs">Senior Supervisor</div>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div>
                                                <div class="text-white/50">Reviews Today</div>
                                                <div class="text-white font-semibold">47</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">3.2 min</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-green-500 to-teal-500 flex items-center justify-center">
                                                <span class="text-white font-bold">MS</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Michael Santos</div>
                                                <div class="text-white/60 text-xs">Lead Supervisor</div>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div>
                                                <div class="text-white/50">Reviews Today</div>
                                                <div class="text-white font-semibold">52</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">2.8 min</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-orange-500 to-red-500 flex items-center justify-center">
                                                <span class="text-white font-bold">AL</span>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Anna Lee</div>
                                                <div class="text-white/60 text-xs">Supervisor</div>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div>
                                                <div class="text-white/50">Reviews Today</div>
                                                <div class="text-white font-semibold">38</div>
                                            </div>
                                            <div>
                                                <div class="text-white/50">Avg Time</div>
                                                <div class="text-white font-semibold">4.1 min</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Module 2: Supervision -->

                    <!-- Module 3: Learning System for Continuous Improvement -->
                    <div id="autonomous-module-learning" class="autonomous-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-brain text-purple-400"></i>
                                AI Learning System & Continuous Improvement
                                <span class="text-xs bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full">Machine Learning</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Advanced machine learning system that continuously improves agent performance through feedback loops, pattern recognition, and adaptive algorithms.
                            </p>

                            <!-- Learning Statistics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Training Sessions</div>
                                    <div class="text-2xl font-bold text-white">1,247</div>
                                    <div class="text-green-400 text-xs mt-1">
                                        <i class="fas fa-arrow-up mr-1"></i>+127 this month
                                    </div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Model Accuracy</div>
                                    <div class="text-2xl font-bold text-green-400">94.7%</div>
                                    <div class="text-green-400 text-xs mt-1">
                                        <i class="fas fa-arrow-up mr-1"></i>+2.3% improvement
                                    </div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Feedback Processed</div>
                                    <div class="text-2xl font-bold text-blue-400">8,492</div>
                                    <div class="text-white/60 text-xs mt-1">Human corrections applied</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Efficiency Gain</div>
                                    <div class="text-2xl font-bold text-purple-400">+23%</div>
                                    <div class="text-white/60 text-xs mt-1">Since deployment</div>
                                </div>
                            </div>

                            <!-- Learning Progress by Agent -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Agent Learning Progress</h4>
                                <div class="space-y-4">
                                    <!-- Agent 1 Progress -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-file-alt text-blue-400"></i>
                                                <span class="text-white text-sm">Permit Processing</span>
                                            </div>
                                            <span class="text-green-400 text-sm font-semibold">98.5% Accuracy</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3 relative learning-progress">
                                            <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 98.5%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs text-white/60 mt-1">
                                            <span>Training iterations: 2,847</span>
                                            <span>Last improvement: 3 days ago</span>
                                        </div>
                                    </div>

                                    <!-- Agent 2 Progress -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-dollar-sign text-green-400"></i>
                                                <span class="text-white text-sm">Tax Processing</span>
                                            </div>
                                            <span class="text-green-400 text-sm font-semibold">99.2% Accuracy</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3 relative learning-progress">
                                            <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full" style="width: 99.2%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs text-white/60 mt-1">
                                            <span>Training iterations: 4,123</span>
                                            <span>Last improvement: Yesterday</span>
                                        </div>
                                    </div>

                                    <!-- Agent 3 Progress -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-folder-open text-purple-400"></i>
                                                <span class="text-white text-sm">Document Classification</span>
                                            </div>
                                            <span class="text-green-400 text-sm font-semibold">97.8% Accuracy</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3 relative learning-progress">
                                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full" style="width: 97.8%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs text-white/60 mt-1">
                                            <span>Training iterations: 5,671</span>
                                            <span>Last improvement: Today</span>
                                        </div>
                                    </div>

                                    <!-- Agent 4 Progress -->
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-comments text-orange-400"></i>
                                                <span class="text-white text-sm">Citizen Query Response</span>
                                            </div>
                                            <span class="text-yellow-400 text-sm font-semibold">89.3% Accuracy</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-3 relative learning-progress">
                                            <div class="bg-gradient-to-r from-orange-500 to-red-500 h-3 rounded-full" style="width: 89.3%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs text-white/60 mt-1">
                                            <span>Training iterations: 1,456</span>
                                            <span class="text-yellow-400">In training: +5.2% this week</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Learning Methods -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <!-- Supervised Learning -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                            <i class="fas fa-user-graduate text-blue-400 text-xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-semibold">Supervised Learning</div>
                                            <div class="text-white/60 text-xs">Human feedback loops</div>
                                        </div>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Corrections Applied</div>
                                            <div class="text-white font-semibold">8,492</div>
                                        </div>
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Accuracy Improvement</div>
                                            <div class="text-green-400 font-semibold">+12.3%</div>
                                        </div>
                                    </div>
                                    <div class="mt-4 text-xs text-white/60">
                                        Learns from human supervisor approvals, rejections, and modifications to improve decision-making accuracy.
                                    </div>
                                </div>

                                <!-- Reinforcement Learning -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center">
                                            <i class="fas fa-trophy text-green-400 text-xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-semibold">Reinforcement Learning</div>
                                            <div class="text-white/60 text-xs">Reward-based optimization</div>
                                        </div>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Successful Actions</div>
                                            <div class="text-white font-semibold">47,892</div>
                                        </div>
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Efficiency Gain</div>
                                            <div class="text-green-400 font-semibold">+23%</div>
                                        </div>
                                    </div>
                                    <div class="mt-4 text-xs text-white/60">
                                        Agents receive rewards for successful completions and penalties for errors, optimizing for speed and accuracy.
                                    </div>
                                </div>

                                <!-- Transfer Learning -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center gap-3 mb-4">
                                        <div class="w-12 h-12 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                            <i class="fas fa-share-alt text-purple-400 text-xl"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-semibold">Transfer Learning</div>
                                            <div class="text-white/60 text-xs">Cross-agent knowledge</div>
                                        </div>
                                    </div>
                                    <div class="space-y-2 text-xs">
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Patterns Shared</div>
                                            <div class="text-white font-semibold">1,247</div>
                                        </div>
                                        <div class="bg-white/5 rounded-lg p-2">
                                            <div class="text-white/50">Training Time Saved</div>
                                            <div class="text-green-400 font-semibold">-67%</div>
                                        </div>
                                    </div>
                                    <div class="mt-4 text-xs text-white/60">
                                        Knowledge learned by one agent is shared across similar agents, accelerating learning for new tasks.
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Learning Events -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Recent Learning Events</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                            <i class="fas fa-check text-green-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Tax Processing improved fraud detection</div>
                                            <div class="text-white/60 text-xs">Learned new pattern from 23 human corrections â€¢ Accuracy: 99.2% (+0.8%)</div>
                                        </div>
                                        <div class="text-white/60 text-xs">2 hours ago</div>
                                    </div>

                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                            <i class="fas fa-lightbulb text-blue-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Document Classification discovered new category</div>
                                            <div class="text-white/60 text-xs">Identified "Environmental Impact Report" as new document type</div>
                                        </div>
                                        <div class="text-white/60 text-xs">5 hours ago</div>
                                    </div>

                                    <div class="flex items-center gap-3 p-3 bg-white/5 rounded-lg">
                                        <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                            <i class="fas fa-share-alt text-purple-400"></i>
                                        </div>
                                        <div class="flex-1">
                                            <div class="text-white text-sm font-medium">Transfer learning completed</div>
                                            <div class="text-white/60 text-xs">Permit Processing shared validation logic with Grant Application agent</div>
                                        </div>
                                        <div class="text-white/60 text-xs">Yesterday</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Module 3: Learning System -->

                    <!-- Module 4: Integration with Existing Systems -->
                    <div id="autonomous-module-integration" class="autonomous-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-plug text-green-400"></i>
                                System Integrations
                                <span class="text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">Active Connections</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Seamless integration with existing Govli AI modules and external government systems for unified autonomous operations.
                            </p>

                            <!-- Integration Status -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Active Integrations</div>
                                    <div class="text-2xl font-bold text-white">12</div>
                                    <div class="text-green-400 text-xs mt-1">All systems operational</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">API Calls Today</div>
                                    <div class="text-2xl font-bold text-blue-400">48.7K</div>
                                    <div class="text-white/60 text-xs mt-1">Avg: 237ms response</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Data Synced</div>
                                    <div class="text-2xl font-bold text-purple-400">127 GB</div>
                                    <div class="text-white/60 text-xs mt-1">Last 24 hours</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Integration Health</div>
                                    <div class="text-2xl font-bold text-green-400">99.8%</div>
                                    <div class="text-white/60 text-xs mt-1">Uptime</div>
                                </div>
                            </div>

                            <!-- Govli AI Internal Integrations -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                    <i class="fas fa-layer-group text-blue-400"></i>
                                    Govli AI Internal Integrations
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <!-- Workflow Integration -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                                    <i class="fas fa-project-diagram text-blue-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">Workflow Engine</div>
                                                    <div class="text-white/60 text-xs">Process automation</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Auto-trigger workflows</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Status updates to workflows</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>234 workflows triggered today</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Document Management -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                                    <i class="fas fa-folder-open text-purple-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">Document System</div>
                                                    <div class="text-white/60 text-xs">File processing</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Read/write documents</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>OCR & extraction</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>1,847 documents processed</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- CRM Integration -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                                                    <i class="fas fa-users text-green-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">CRM System</div>
                                                    <div class="text-white/60 text-xs">Citizen data</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Access citizen records</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Update contact info</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>4,123 records accessed</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Analytics Integration -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center">
                                                    <i class="fas fa-chart-line text-orange-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">Analytics</div>
                                                    <div class="text-white/60 text-xs">Performance metrics</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Send performance data</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Real-time dashboards</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>12.4K metrics logged</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Constituent Inbox -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-teal-500/20 flex items-center justify-center">
                                                    <i class="fas fa-inbox text-teal-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">Constituent Inbox</div>
                                                    <div class="text-white/60 text-xs">Message handling</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Auto-respond to queries</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Route to departments</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>567 messages handled</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- API Integration Platform -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center">
                                                    <i class="fas fa-plug text-yellow-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium text-sm">API Platform</div>
                                                    <div class="text-white/60 text-xs">External APIs</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="space-y-2 text-xs">
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Access government APIs</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>Data transformation</span>
                                            </div>
                                            <div class="flex items-center gap-2 text-white/60">
                                                <i class="fas fa-check text-green-400"></i>
                                                <span>8,234 API calls made</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- External System Integrations -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                    <i class="fas fa-network-wired text-purple-400"></i>
                                    External Government System Integrations
                                </h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <!-- FBI CJIS -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-red-500 to-orange-500 flex items-center justify-center">
                                                    <i class="fas fa-shield-alt text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">FBI CJIS</div>
                                                    <div class="text-white/60 text-xs">Criminal records verification</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Queries Today</div>
                                                <div class="text-white">347</div>
                                            </div>
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Avg Response</div>
                                                <div class="text-white">287ms</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- IRS e-Services -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                                                    <i class="fas fa-dollar-sign text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">IRS e-Services</div>
                                                    <div class="text-white/60 text-xs">Tax verification</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Queries Today</div>
                                                <div class="text-white">892</div>
                                            </div>
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Avg Response</div>
                                                <div class="text-white">423ms</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- State DMV -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                                                    <i class="fas fa-id-card text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">State DMV</div>
                                                    <div class="text-white/60 text-xs">License verification</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Queries Today</div>
                                                <div class="text-white">1,234</div>
                                            </div>
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Avg Response</div>
                                                <div class="text-white">198ms</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SAM.gov -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-3">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                                                    <i class="fas fa-hand-holding-usd text-white"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">SAM.gov</div>
                                                    <div class="text-white/60 text-xs">Grant opportunities</div>
                                                </div>
                                            </div>
                                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">ACTIVE</span>
                                        </div>
                                        <div class="grid grid-cols-2 gap-2 text-xs">
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Queries Today</div>
                                                <div class="text-white">67</div>
                                            </div>
                                            <div class="bg-white/5 rounded p-2">
                                                <div class="text-white/50">Avg Response</div>
                                                <div class="text-white">512ms</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Integration Health Monitoring -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Integration Health Monitoring</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                            <span class="text-white text-sm">All integrations operational</span>
                                        </div>
                                        <span class="text-green-400 text-sm">99.8% uptime</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <i class="fas fa-clock text-blue-400"></i>
                                            <span class="text-white text-sm">Average API response time</span>
                                        </div>
                                        <span class="text-blue-400 text-sm">237ms</span>
                                    </div>
                                    <div class="flex items-center justify-between p-3 bg-white/5 rounded-lg">
                                        <div class="flex items-center gap-3">
                                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                            <span class="text-white text-sm">Failed requests (last 24h)</span>
                                        </div>
                                        <span class="text-yellow-400 text-sm">23 (0.047%)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End Module 4: Integrations -->
                </div>

                <!-- Added 2024-10-31: Government Digital Twin Module -->
                <div id="digital-twin-content" class="tab-content h-full overflow-y-auto" style="display: none;">
        <!-- Header -->
        <div class="glass rounded-xl p-6 mb-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-gradient-to-r from-cyan-600 to-blue-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-project-diagram text-white text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold text-white">Government Digital Twin</h1>
                        <p class="text-white/70">Real-Time Simulation â€¢ Predictive Modeling â€¢ Process Optimization</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="flex items-center space-x-2 bg-green-500/20 px-4 py-2 rounded-lg border border-green-400/30">
                        <div class="w-3 h-3 bg-green-400 rounded-full sync-indicator"></div>
                        <span class="text-green-300 text-sm font-semibold">LIVE SYNC</span>
                    </div>
                    <div class="text-white/60 text-sm">
                        <i class="fas fa-server mr-2"></i>12 agencies modeled
                    </div>
                </div>
            </div>
        </div>

        <!-- Module Navigation -->
        <div class="glass rounded-xl p-2 mb-6">
            <div class="flex items-center space-x-2 overflow-x-auto">
                <button onclick="switchDigitalTwinModule('modeling')" class="digital-twin-module-tab active px-6 py-3 rounded-lg text-white font-medium flex items-center space-x-2 min-w-max">
                    <i class="fas fa-cube mr-2"></i>Operational Modeling
                </button>
                <button onclick="switchDigitalTwinModule('simulation')" class="digital-twin-module-tab px-6 py-3 rounded-lg text-white font-medium flex items-center space-x-2 min-w-max">
                    <i class="fas fa-play-circle mr-2"></i>Simulation Engine
                </button>
                <button onclick="switchDigitalTwinModule('visualization')" class="digital-twin-module-tab px-6 py-3 rounded-lg text-white font-medium flex items-center space-x-2 min-w-max">
                    <i class="fas fa-chart-network mr-2"></i>Process Visualization
                </button>
                <button onclick="switchDigitalTwinModule('optimization')" class="digital-twin-module-tab px-6 py-3 rounded-lg text-white font-medium flex items-center space-x-2 min-w-max">
                    <i class="fas fa-cogs mr-2"></i>Scenario Testing
                </button>
            </div>
        </div>

        <!-- Module 1: Operational Modeling -->
        <!-- Added 2024-10-31: Government Digital Twin Module -->
        <div id="digital-twin-module-modeling" class="digital-twin-module-content active">
            <!-- Overview Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Digital Replicas</div>
                        <i class="fas fa-cube text-cyan-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">12</div>
                    <div class="text-xs text-green-400">+3 this month</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Model Accuracy</div>
                        <i class="fas fa-bullseye text-green-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">96.8%</div>
                    <div class="text-xs text-green-400">+1.2% vs last week</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Data Points</div>
                        <i class="fas fa-database text-purple-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">847K</div>
                    <div class="text-xs text-white/50">Updated 5 min ago</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Sync Latency</div>
                        <i class="fas fa-clock text-blue-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">287ms</div>
                    <div class="text-xs text-green-400">-45ms improvement</div>
                </div>
            </div>

            <!-- Government Agency Digital Twins -->
            <div class="glass rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-building text-cyan-400"></i>
                    Agency Digital Twins
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- DMV Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                                    <i class="fas fa-car text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">DMV - Motor Vehicles</div>
                                    <div class="text-white/60 text-xs">State Department</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Daily Transactions</div>
                                <div class="text-white font-semibold">4,287</div>
                            </div>
                            <div>
                                <div class="text-white/50">Avg Wait Time</div>
                                <div class="text-cyan-400 font-semibold">18 min</div>
                            </div>
                            <div>
                                <div class="text-white/50">Active Counters</div>
                                <div class="text-white font-semibold">24/32</div>
                            </div>
                            <div>
                                <div class="text-white/50">Staff Utilization</div>
                                <div class="text-green-400 font-semibold">87%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">97.2%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-500 to-cyan-500 h-2 rounded-full" style="width: 97.2%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-blue-500/20 text-blue-300 px-2 py-1 rounded text-xs">License Renewals</span>
                            <span class="bg-purple-500/20 text-purple-300 px-2 py-1 rounded text-xs">Vehicle Registration</span>
                            <span class="bg-cyan-500/20 text-cyan-300 px-2 py-1 rounded text-xs">Title Transfers</span>
                        </div>
                    </div>

                    <!-- IRS Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                                    <i class="fas fa-file-invoice-dollar text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">IRS - Tax Processing</div>
                                    <div class="text-white/60 text-xs">Federal Agency</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Returns Processed</div>
                                <div class="text-white font-semibold">12,847/day</div>
                            </div>
                            <div>
                                <div class="text-white/50">Processing Time</div>
                                <div class="text-cyan-400 font-semibold">2.3 hrs</div>
                            </div>
                            <div>
                                <div class="text-white/50">Auditors Active</div>
                                <div class="text-white font-semibold">156/180</div>
                            </div>
                            <div>
                                <div class="text-white/50">Accuracy Rate</div>
                                <div class="text-green-400 font-semibold">99.1%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">98.5%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full" style="width: 98.5%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-green-500/20 text-green-300 px-2 py-1 rounded text-xs">Tax Returns</span>
                            <span class="bg-emerald-500/20 text-emerald-300 px-2 py-1 rounded text-xs">Refunds</span>
                            <span class="bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded text-xs">Audits</span>
                        </div>
                    </div>

                    <!-- Building Permits Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-orange-500 to-amber-500 flex items-center justify-center">
                                    <i class="fas fa-hard-hat text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">Building Permits</div>
                                    <div class="text-white/60 text-xs">City Department</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Permits/Month</div>
                                <div class="text-white font-semibold">487</div>
                            </div>
                            <div>
                                <div class="text-white/50">Approval Time</div>
                                <div class="text-cyan-400 font-semibold">4.2 days</div>
                            </div>
                            <div>
                                <div class="text-white/50">Inspectors</div>
                                <div class="text-white font-semibold">18/24</div>
                            </div>
                            <div>
                                <div class="text-white/50">Compliance Rate</div>
                                <div class="text-green-400 font-semibold">94.7%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">95.8%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-orange-500 to-amber-500 h-2 rounded-full" style="width: 95.8%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-orange-500/20 text-orange-300 px-2 py-1 rounded text-xs">Construction</span>
                            <span class="bg-amber-500/20 text-amber-300 px-2 py-1 rounded text-xs">Renovations</span>
                            <span class="bg-red-500/20 text-red-300 px-2 py-1 rounded text-xs">Inspections</span>
                        </div>
                    </div>

                    <!-- Social Services Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-pink-500 to-rose-500 flex items-center justify-center">
                                    <i class="fas fa-hands-helping text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">Social Services</div>
                                    <div class="text-white/60 text-xs">State Department</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Active Cases</div>
                                <div class="text-white font-semibold">8,942</div>
                            </div>
                            <div>
                                <div class="text-white/50">Avg Case Time</div>
                                <div class="text-cyan-400 font-semibold">12.4 days</div>
                            </div>
                            <div>
                                <div class="text-white/50">Caseworkers</div>
                                <div class="text-white font-semibold">67/72</div>
                            </div>
                            <div>
                                <div class="text-white/50">Resolution Rate</div>
                                <div class="text-green-400 font-semibold">89.3%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">94.2%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-pink-500 to-rose-500 h-2 rounded-full" style="width: 94.2%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-pink-500/20 text-pink-300 px-2 py-1 rounded text-xs">Benefits</span>
                            <span class="bg-rose-500/20 text-rose-300 px-2 py-1 rounded text-xs">Family Services</span>
                            <span class="bg-purple-500/20 text-purple-300 px-2 py-1 rounded text-xs">Child Welfare</span>
                        </div>
                    </div>

                    <!-- Employment Services Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center">
                                    <i class="fas fa-briefcase text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">Employment Services</div>
                                    <div class="text-white/60 text-xs">State Department</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Job Placements</div>
                                <div class="text-white font-semibold">342/month</div>
                            </div>
                            <div>
                                <div class="text-white/50">Avg Match Time</div>
                                <div class="text-cyan-400 font-semibold">8.7 days</div>
                            </div>
                            <div>
                                <div class="text-white/50">Counselors</div>
                                <div class="text-white font-semibold">28/32</div>
                            </div>
                            <div>
                                <div class="text-white/50">Success Rate</div>
                                <div class="text-green-400 font-semibold">76.4%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">92.1%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-indigo-500 to-purple-500 h-2 rounded-full" style="width: 92.1%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-indigo-500/20 text-indigo-300 px-2 py-1 rounded text-xs">Job Matching</span>
                            <span class="bg-purple-500/20 text-purple-300 px-2 py-1 rounded text-xs">Training</span>
                            <span class="bg-blue-500/20 text-blue-300 px-2 py-1 rounded text-xs">UI Claims</span>
                        </div>
                    </div>

                    <!-- Health Services Digital Twin -->
                    <div class="twin-card glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center">
                                    <i class="fas fa-heartbeat text-white text-lg"></i>
                                </div>
                                <div>
                                    <div class="text-white font-semibold">Health Services</div>
                                    <div class="text-white/60 text-xs">County Department</div>
                                </div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full sync-indicator"></div>
                                SYNCED
                            </span>
                        </div>

                        <div class="grid grid-cols-2 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Daily Patients</div>
                                <div class="text-white font-semibold">1,247</div>
                            </div>
                            <div>
                                <div class="text-white/50">Wait Time</div>
                                <div class="text-cyan-400 font-semibold">32 min</div>
                            </div>
                            <div>
                                <div class="text-white/50">Medical Staff</div>
                                <div class="text-white font-semibold">89/96</div>
                            </div>
                            <div>
                                <div class="text-white/50">Bed Utilization</div>
                                <div class="text-yellow-400 font-semibold">83.2%</div>
                            </div>
                        </div>

                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Model Accuracy</span>
                                <span class="text-green-400 font-semibold">96.4%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-red-500 to-pink-500 h-2 rounded-full" style="width: 96.4%"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-1 mt-3">
                            <span class="bg-red-500/20 text-red-300 px-2 py-1 rounded text-xs">Emergency</span>
                            <span class="bg-pink-500/20 text-pink-300 px-2 py-1 rounded text-xs">Outpatient</span>
                            <span class="bg-purple-500/20 text-purple-300 px-2 py-1 rounded text-xs">Vaccinations</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resource Allocation Model -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-sliders-h text-purple-400"></i>
                    Resource Allocation Model
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-white font-medium">Personnel</span>
                            <span class="bg-blue-500/20 text-blue-300 px-2 py-1 rounded text-xs">456 Staff</span>
                        </div>
                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Utilization Rate</span>
                                <span class="text-cyan-400 font-semibold">84.7%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 84.7%"></div>
                            </div>
                        </div>
                        <div class="text-xs text-white/60 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            Optimal range: 75-90%
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-white font-medium">Infrastructure</span>
                            <span class="bg-purple-500/20 text-purple-300 px-2 py-1 rounded text-xs">124 Assets</span>
                        </div>
                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Capacity Usage</span>
                                <span class="text-cyan-400 font-semibold">67.3%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full" style="width: 67.3%"></div>
                            </div>
                        </div>
                        <div class="text-xs text-white/60 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            23% growth capacity available
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-white font-medium">Budget</span>
                            <span class="bg-green-500/20 text-green-300 px-2 py-1 rounded text-xs">$24.7M</span>
                        </div>
                        <div class="mb-2">
                            <div class="flex items-center justify-between text-xs mb-1">
                                <span class="text-white/60">Budget Spent</span>
                                <span class="text-cyan-400 font-semibold">78.2%</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full" style="width: 78.2%"></div>
                            </div>
                        </div>
                        <div class="text-xs text-white/60 mt-2">
                            <i class="fas fa-info-circle mr-1"></i>
                            $5.4M remaining this quarter
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Module 1 -->

        <!-- Module 2: Simulation Engine -->
        <!-- Added 2024-10-31: Simulation Engine for What-If Analysis -->
        <div id="digital-twin-module-simulation" class="digital-twin-module-content hidden">
            <!-- Simulation Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Active Simulations</div>
                        <i class="fas fa-play-circle text-purple-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">8</div>
                    <div class="text-xs text-cyan-400">3 running now</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Scenarios Tested</div>
                        <i class="fas fa-flask text-cyan-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">247</div>
                    <div class="text-xs text-green-400">+42 this week</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Prediction Accuracy</div>
                        <i class="fas fa-chart-line text-green-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">93.4%</div>
                    <div class="text-xs text-green-400">+2.1% vs baseline</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Est. Cost Savings</div>
                        <i class="fas fa-dollar-sign text-yellow-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">$2.8M</div>
                    <div class="text-xs text-green-400">From optimizations</div>
                </div>
            </div>

            <!-- Running Simulations -->
            <div class="glass rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-play-circle text-purple-400"></i>
                    Running Simulations
                </h3>

                <div class="space-y-4">
                    <!-- Simulation 1 -->
                    <div class="glass rounded-lg p-5 simulation-running">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">DMV Service Counter Optimization</div>
                                <div class="text-white/60 text-sm">Testing impact of adding 4 service counters during peak hours</div>
                            </div>
                            <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded text-xs font-semibold flex items-center gap-2">
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                RUNNING
                            </span>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Scenario Type</div>
                                <div class="text-white">Resource Addition</div>
                            </div>
                            <div>
                                <div class="text-white/50">Duration</div>
                                <div class="text-cyan-400">30 days simulated</div>
                            </div>
                            <div>
                                <div class="text-white/50">Progress</div>
                                <div class="text-white">67% (Day 20/30)</div>
                            </div>
                            <div>
                                <div class="text-white/50">Est. Completion</div>
                                <div class="text-white">4.2 min</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all" style="width: 67%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3 text-xs">
                            <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                <div class="text-green-400 font-semibold">-24% Wait Time</div>
                                <div class="text-white/60">From 18min to 13.7min</div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded p-2">
                                <div class="text-blue-400 font-semibold">+18% Throughput</div>
                                <div class="text-white/60">327 more daily customers</div>
                            </div>
                            <div class="bg-yellow-500/10 border border-yellow-500/30 rounded p-2">
                                <div class="text-yellow-400 font-semibold">+$89K Cost</div>
                                <div class="text-white/60">Additional staffing</div>
                            </div>
                        </div>
                    </div>

                    <!-- Simulation 2 -->
                    <div class="glass rounded-lg p-5 simulation-running">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">Tax Filing Deadline Extension Impact</div>
                                <div class="text-white/60 text-sm">Modeling effects of 30-day filing deadline extension on IRS workload</div>
                            </div>
                            <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded text-xs font-semibold flex items-center gap-2">
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                RUNNING
                            </span>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Scenario Type</div>
                                <div class="text-white">Policy Change</div>
                            </div>
                            <div>
                                <div class="text-white/50">Duration</div>
                                <div class="text-cyan-400">60 days simulated</div>
                            </div>
                            <div>
                                <div class="text-white/50">Progress</div>
                                <div class="text-white">42% (Day 25/60)</div>
                            </div>
                            <div>
                                <div class="text-white/50">Est. Completion</div>
                                <div class="text-white">8.7 min</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all" style="width: 42%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3 text-xs">
                            <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                <div class="text-green-400 font-semibold">-31% Peak Load</div>
                                <div class="text-white/60">Smoother distribution</div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded p-2">
                                <div class="text-blue-400 font-semibold">+12% Quality</div>
                                <div class="text-white/60">Fewer errors detected</div>
                            </div>
                            <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                <div class="text-green-400 font-semibold">-$234K Cost</div>
                                <div class="text-white/60">Reduced overtime</div>
                            </div>
                        </div>
                    </div>

                    <!-- Simulation 3 -->
                    <div class="glass rounded-lg p-5 simulation-running">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">Digital Permit Submission Rollout</div>
                                <div class="text-white/60 text-sm">Simulating transition from paper to digital building permit system</div>
                            </div>
                            <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded text-xs font-semibold flex items-center gap-2">
                                <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                                RUNNING
                            </span>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-3 text-xs">
                            <div>
                                <div class="text-white/50">Scenario Type</div>
                                <div class="text-white">Process Change</div>
                            </div>
                            <div>
                                <div class="text-white/50">Duration</div>
                                <div class="text-cyan-400">90 days simulated</div>
                            </div>
                            <div>
                                <div class="text-white/50">Progress</div>
                                <div class="text-white">88% (Day 79/90)</div>
                            </div>
                            <div>
                                <div class="text-white/50">Est. Completion</div>
                                <div class="text-white">1.8 min</div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all" style="width: 88%"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-3 text-xs">
                            <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                <div class="text-green-400 font-semibold">-47% Proc. Time</div>
                                <div class="text-white/60">From 4.2 to 2.2 days</div>
                            </div>
                            <div class="bg-blue-500/10 border border-blue-500/30 rounded p-2">
                                <div class="text-blue-400 font-semibold">+89% Satisfaction</div>
                                <div class="text-white/60">Customer feedback</div>
                            </div>
                            <div class="bg-green-500/10 border border-green-500/30 rounded p-2">
                                <div class="text-green-400 font-semibold">-$412K Cost</div>
                                <div class="text-white/60">Annual paper savings</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- What-If Scenario Builder -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-flask text-cyan-400"></i>
                    What-If Scenario Builder
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="text-white/70 text-sm mb-2 block">Select Agency/Department</label>
                        <select class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white mb-4">
                            <option>DMV - Motor Vehicles</option>
                            <option>IRS - Tax Processing</option>
                            <option>Building Permits</option>
                            <option>Social Services</option>
                            <option>Employment Services</option>
                            <option>Health Services</option>
                        </select>

                        <label class="text-white/70 text-sm mb-2 block">Scenario Type</label>
                        <select class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white mb-4">
                            <option>Resource Addition/Reduction</option>
                            <option>Policy Change</option>
                            <option>Process Modification</option>
                            <option>Budget Adjustment</option>
                            <option>Staffing Change</option>
                            <option>Technology Implementation</option>
                        </select>

                        <label class="text-white/70 text-sm mb-2 block">Simulation Duration</label>
                        <select class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white mb-4">
                            <option>7 days</option>
                            <option>30 days</option>
                            <option>60 days</option>
                            <option>90 days</option>
                            <option>6 months</option>
                            <option>1 year</option>
                        </select>
                    </div>

                    <div>
                        <label class="text-white/70 text-sm mb-2 block">Scenario Parameters</label>
                        <div class="space-y-3 mb-4">
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-white/60">Staff Count Change</span>
                                    <span class="text-cyan-400">+15%</span>
                                </div>
                                <input type="range" class="w-full" min="-50" max="50" value="15">
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-white/60">Budget Adjustment</span>
                                    <span class="text-cyan-400">+8%</span>
                                </div>
                                <input type="range" class="w-full" min="-30" max="30" value="8">
                            </div>
                            <div>
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="text-white/60">Process Efficiency</span>
                                    <span class="text-cyan-400">+22%</span>
                                </div>
                                <input type="range" class="w-full" min="-20" max="50" value="22">
                            </div>
                        </div>

                        <button class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-semibold py-3 rounded-lg transition flex items-center justify-center gap-2">
                            <i class="fas fa-play"></i>
                            Run Simulation
                        </button>
                    </div>
                </div>

                <div class="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-info-circle text-blue-400 text-lg mt-1"></i>
                        <div class="text-sm text-white/80">
                            <strong class="text-white">AI-Powered Predictions:</strong> Our simulation engine uses machine learning models trained on 5+ years of historical government operations data to predict outcomes with 93.4% accuracy.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Module 2 -->

        <!-- Module 3: Process Visualization -->
        <!-- Added 2024-10-31: Process Visualization and Flow Analysis -->
        <div id="digital-twin-module-visualization" class="digital-twin-module-content hidden">
            <!-- Visualization Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Process Flows</div>
                        <i class="fas fa-sitemap text-blue-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">47</div>
                    <div class="text-xs text-cyan-400">Across 12 agencies</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Bottlenecks Found</div>
                        <i class="fas fa-exclamation-triangle text-yellow-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">14</div>
                    <div class="text-xs text-yellow-400">6 critical priority</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Avg Flow Efficiency</div>
                        <i class="fas fa-tachometer-alt text-green-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">78.3%</div>
                    <div class="text-xs text-green-400">+4.7% this month</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Optimization Ideas</div>
                        <i class="fas fa-lightbulb text-purple-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">23</div>
                    <div class="text-xs text-purple-400">AI-generated</div>
                </div>
            </div>

            <!-- Process Flow Visualization -->
            <div class="glass rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-project-diagram text-blue-400"></i>
                    Building Permit Approval Process Flow
                </h3>

                <div class="bg-slate-900/50 rounded-lg p-6 mb-4" style="min-height: 400px;">
                    <!-- Process Flow Diagram -->
                    <div class="flex items-center justify-center gap-8">
                        <!-- Stage 1 -->
                        <div class="flex flex-col items-center">
                            <div class="glass rounded-lg p-4 w-40 text-center mb-2">
                                <div class="text-white font-semibold mb-1">Application</div>
                                <div class="text-white/60 text-xs mb-2">Submission</div>
                                <div class="text-green-400 text-sm font-semibold">24 min avg</div>
                                <div class="text-white/50 text-xs">98.7% complete rate</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <div class="text-xs text-white/60">Fast</div>
                            </div>
                        </div>

                        <div class="flex flex-col items-center">
                            <i class="fas fa-arrow-right text-blue-400 text-2xl mb-16"></i>
                        </div>

                        <!-- Stage 2 -->
                        <div class="flex flex-col items-center">
                            <div class="glass rounded-lg p-4 w-40 text-center mb-2">
                                <div class="text-white font-semibold mb-1">Document</div>
                                <div class="text-white/60 text-xs mb-2">Verification</div>
                                <div class="text-yellow-400 text-sm font-semibold">2.1 days avg</div>
                                <div class="text-white/50 text-xs">87.4% complete rate</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
                                <div class="text-xs text-white/60">Bottleneck</div>
                            </div>
                        </div>

                        <div class="flex flex-col items-center">
                            <i class="fas fa-arrow-right text-blue-400 text-2xl mb-16"></i>
                        </div>

                        <!-- Stage 3 -->
                        <div class="flex flex-col items-center">
                            <div class="glass rounded-lg p-4 w-40 text-center mb-2">
                                <div class="text-white font-semibold mb-1">Technical</div>
                                <div class="text-white/60 text-xs mb-2">Review</div>
                                <div class="text-green-400 text-sm font-semibold">1.4 days avg</div>
                                <div class="text-white/50 text-xs">94.2% complete rate</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <div class="text-xs text-white/60">Optimal</div>
                            </div>
                        </div>

                        <div class="flex flex-col items-center">
                            <i class="fas fa-arrow-right text-blue-400 text-2xl mb-16"></i>
                        </div>

                        <!-- Stage 4 -->
                        <div class="flex flex-col items-center">
                            <div class="glass rounded-lg p-4 w-40 text-center mb-2">
                                <div class="text-white font-semibold mb-1">Final</div>
                                <div class="text-white/60 text-xs mb-2">Approval</div>
                                <div class="text-green-400 text-sm font-semibold">0.7 days avg</div>
                                <div class="text-white/50 text-xs">99.1% complete rate</div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                <div class="text-xs text-white/60">Excellent</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 text-center">
                        <div class="text-white/70 text-sm mb-1">Total Process Time</div>
                        <div class="text-2xl font-bold text-white">4.2 days average</div>
                        <div class="text-yellow-400 text-xs">Target: 3.0 days â€¢ Gap: 1.2 days</div>
                    </div>
                </div>

                <div class="bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-lightbulb text-yellow-400 text-lg mt-1"></i>
                        <div class="text-sm text-white/80">
                            <strong class="text-white">AI Recommendation:</strong> Document Verification stage is the main bottleneck. Adding 2 additional reviewers or implementing automated document validation could reduce process time by 35% (to 2.7 days total).
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resource Utilization Heat Map -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-fire text-red-400"></i>
                        Staff Utilization Heat Map
                    </h3>

                    <div class="space-y-3">
                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Document Review Team</span>
                                <span class="text-red-400 font-semibold">94.7% utilized</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-4">
                                <div class="bg-gradient-to-r from-red-500 to-orange-500 h-4 rounded-full" style="width: 94.7%"></div>
                            </div>
                            <div class="text-xs text-red-400 mt-1">âš ï¸ Overutilized - Consider adding staff</div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Technical Reviewers</span>
                                <span class="text-green-400 font-semibold">78.3% utilized</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-4">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-4 rounded-full" style="width: 78.3%"></div>
                            </div>
                            <div class="text-xs text-green-400 mt-1">âœ“ Optimal range (75-85%)</div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Final Approvers</span>
                                <span class="text-cyan-400 font-semibold">67.1% utilized</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-4">
                                <div class="bg-gradient-to-r from-cyan-500 to-blue-500 h-4 rounded-full" style="width: 67.1%"></div>
                            </div>
                            <div class="text-xs text-cyan-400 mt-1">âœ“ Good capacity available</div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Customer Service</span>
                                <span class="text-yellow-400 font-semibold">56.8% utilized</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-4">
                                <div class="bg-gradient-to-r from-yellow-500 to-amber-500 h-4 rounded-full" style="width: 56.8%"></div>
                            </div>
                            <div class="text-xs text-yellow-400 mt-1">âš ï¸ Underutilized - Could reassign resources</div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Administrative Support</span>
                                <span class="text-green-400 font-semibold">81.2% utilized</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-4">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-4 rounded-full" style="width: 81.2%"></div>
                            </div>
                            <div class="text-xs text-green-400 mt-1">âœ“ Optimal range</div>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-xl p-6">
                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <i class="fas fa-chart-area text-purple-400"></i>
                        Workload Distribution Timeline
                    </h3>

                    <div class="space-y-3">
                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Monday</span>
                                <span class="text-cyan-400 font-semibold">847 tasks</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 71%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Tuesday</span>
                                <span class="text-cyan-400 font-semibold">923 tasks</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 77%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Wednesday</span>
                                <span class="text-red-400 font-semibold">1,147 tasks</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-red-500 to-orange-500 h-3 rounded-full" style="width: 96%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Thursday</span>
                                <span class="text-cyan-400 font-semibold">934 tasks</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full" style="width: 78%"></div>
                            </div>
                        </div>

                        <div>
                            <div class="flex items-center justify-between text-sm mb-2">
                                <span class="text-white">Friday</span>
                                <span class="text-green-400 font-semibold">712 tasks</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-3">
                                <div class="bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full" style="width: 60%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4 bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 text-xs text-white/80">
                        <i class="fas fa-info-circle text-blue-400 mr-2"></i>
                        Peak workload occurs on Wednesdays. Consider load balancing or shift scheduling adjustments.
                    </div>
                </div>
            </div>

            <!-- Identified Bottlenecks -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                    Critical Bottlenecks & Recommendations
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass rounded-lg p-4 border-l-4 border-red-500">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-white font-semibold">DMV License Renewal Queue</div>
                            <span class="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs font-semibold">CRITICAL</span>
                        </div>
                        <div class="text-white/60 text-sm mb-3">Avg wait time: 47 minutes (target: 20 min)</div>
                        <div class="bg-green-500/10 border border-green-500/30 rounded p-3 text-xs text-white/80">
                            <div class="text-green-400 font-semibold mb-1">ðŸ’¡ AI Recommendation:</div>
                            Add 3 express lanes for simple renewals. Est. impact: -35% wait time, +$47K annual cost.
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4 border-l-4 border-red-500">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-white font-semibold">IRS Audit Assignment Delay</div>
                            <span class="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs font-semibold">CRITICAL</span>
                        </div>
                        <div class="text-white/60 text-sm mb-3">Avg assignment time: 8.2 days (target: 3 days)</div>
                        <div class="bg-green-500/10 border border-green-500/30 rounded p-3 text-xs text-white/80">
                            <div class="text-green-400 font-semibold mb-1">ðŸ’¡ AI Recommendation:</div>
                            Implement automated case routing algorithm. Est. impact: -62% assignment time, $0 cost.
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4 border-l-4 border-yellow-500">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-white font-semibold">Permit Document Verification</div>
                            <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs font-semibold">HIGH</span>
                        </div>
                        <div class="text-white/60 text-sm mb-3">Processing time: 2.1 days (target: 1.0 day)</div>
                        <div class="bg-green-500/10 border border-green-500/30 rounded p-3 text-xs text-white/80">
                            <div class="text-green-400 font-semibold mb-1">ðŸ’¡ AI Recommendation:</div>
                            Deploy OCR + AI document validation. Est. impact: -48% processing time, +$124K implementation.
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4 border-l-4 border-yellow-500">
                        <div class="flex items-start justify-between mb-2">
                            <div class="text-white font-semibold">Social Services Case Assignment</div>
                            <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs font-semibold">HIGH</span>
                        </div>
                        <div class="text-white/60 text-sm mb-3">Workload imbalance: 32% variance across caseworkers</div>
                        <div class="bg-green-500/10 border border-green-500/30 rounded p-3 text-xs text-white/80">
                            <div class="text-green-400 font-semibold mb-1">ðŸ’¡ AI Recommendation:</div>
                            Implement AI-powered workload balancing. Est. impact: +24% efficiency, $0 cost.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Module 3 -->

        <!-- Module 4: Scenario Testing & Optimization -->
        <!-- Added 2024-10-31: Scenario Testing and Optimization Tools -->
        <div id="digital-twin-module-optimization" class="digital-twin-module-content hidden">
            <!-- Optimization Dashboard -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">A/B Tests Running</div>
                        <i class="fas fa-vial text-cyan-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">12</div>
                    <div class="text-xs text-green-400">4 showing improvements</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Optimizations Applied</div>
                        <i class="fas fa-check-circle text-green-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">89</div>
                    <div class="text-xs text-cyan-400">This quarter</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Efficiency Gain</div>
                        <i class="fas fa-arrow-up text-purple-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">+18.7%</div>
                    <div class="text-xs text-green-400">Across all agencies</div>
                </div>

                <div class="glass rounded-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-white/70 text-sm">Total Savings</div>
                        <i class="fas fa-piggy-bank text-yellow-400 text-xl"></i>
                    </div>
                    <div class="text-3xl font-bold text-white mb-2">$4.2M</div>
                    <div class="text-xs text-green-400">Annual projected</div>
                </div>
            </div>

            <!-- Active A/B Tests -->
            <div class="glass rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-vial text-cyan-400"></i>
                    Active A/B Tests
                </h3>

                <div class="space-y-4">
                    <!-- Test 1 -->
                    <div class="glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">Online vs. In-Person Permit Applications</div>
                                <div class="text-white/60 text-sm">Testing user preference and processing efficiency</div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-xs font-semibold">VARIANT A WINNING</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <!-- Variant A -->
                            <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <div class="text-green-400 font-semibold mb-3 flex items-center gap-2">
                                    <i class="fas fa-crown"></i>
                                    Variant A: Online Portal
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Completion Rate</span>
                                        <span class="text-white font-semibold">94.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Processing Time</span>
                                        <span class="text-green-400 font-semibold">2.1 days</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">User Satisfaction</span>
                                        <span class="text-white font-semibold">4.6/5.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Cost per Application</span>
                                        <span class="text-green-400 font-semibold">$12.40</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Variant B -->
                            <div class="bg-white/5 border border-white/10 rounded-lg p-4">
                                <div class="text-white/70 font-semibold mb-3">
                                    Variant B: In-Person
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Completion Rate</span>
                                        <span class="text-white font-semibold">89.7%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Processing Time</span>
                                        <span class="text-white font-semibold">3.8 days</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">User Satisfaction</span>
                                        <span class="text-white font-semibold">4.1/5.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Cost per Application</span>
                                        <span class="text-white font-semibold">$24.80</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between text-xs">
                            <div class="text-white/60">
                                <i class="fas fa-users mr-1"></i>
                                1,247 participants â€¢ 28 days duration
                            </div>
                            <div class="text-green-400 font-semibold">
                                Recommendation: Scale online portal to 100% availability
                            </div>
                        </div>
                    </div>

                    <!-- Test 2 -->
                    <div class="glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">Automated vs. Manual Tax Return Review</div>
                                <div class="text-white/60 text-sm">Comparing AI-assisted review accuracy and speed</div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-xs font-semibold">VARIANT A WINNING</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <!-- Variant A -->
                            <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                                <div class="text-green-400 font-semibold mb-3 flex items-center gap-2">
                                    <i class="fas fa-crown"></i>
                                    Variant A: AI-Assisted
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Accuracy Rate</span>
                                        <span class="text-white font-semibold">99.4%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Review Time</span>
                                        <span class="text-green-400 font-semibold">1.2 hrs</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Flagged Issues</span>
                                        <span class="text-white font-semibold">147/1000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Cost per Review</span>
                                        <span class="text-green-400 font-semibold">$8.20</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Variant B -->
                            <div class="bg-white/5 border border-white/10 rounded-lg p-4">
                                <div class="text-white/70 font-semibold mb-3">
                                    Variant B: Manual
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Accuracy Rate</span>
                                        <span class="text-white font-semibold">98.9%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Review Time</span>
                                        <span class="text-white font-semibold">3.7 hrs</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Flagged Issues</span>
                                        <span class="text-white font-semibold">134/1000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Cost per Review</span>
                                        <span class="text-white font-semibold">$24.60</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between text-xs">
                            <div class="text-white/60">
                                <i class="fas fa-users mr-1"></i>
                                2,847 returns reviewed â€¢ 14 days duration
                            </div>
                            <div class="text-green-400 font-semibold">
                                Recommendation: Expand AI-assisted review to all returns
                            </div>
                        </div>
                    </div>

                    <!-- Test 3 -->
                    <div class="glass rounded-lg p-5">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold mb-1">Appointment-Based vs. Walk-In DMV Service</div>
                                <div class="text-white/60 text-sm">Testing customer wait times and satisfaction</div>
                            </div>
                            <span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded text-xs font-semibold">INCONCLUSIVE</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <!-- Variant A -->
                            <div class="bg-white/5 border border-white/10 rounded-lg p-4">
                                <div class="text-white/70 font-semibold mb-3">
                                    Variant A: Appointments
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Wait Time</span>
                                        <span class="text-green-400 font-semibold">8 min</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Satisfaction</span>
                                        <span class="text-white font-semibold">4.7/5.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">No-Show Rate</span>
                                        <span class="text-red-400 font-semibold">18.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Daily Capacity</span>
                                        <span class="text-white font-semibold">387</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Variant B -->
                            <div class="bg-white/5 border border-white/10 rounded-lg p-4">
                                <div class="text-white/70 font-semibold mb-3">
                                    Variant B: Walk-In
                                </div>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Avg Wait Time</span>
                                        <span class="text-red-400 font-semibold">24 min</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Satisfaction</span>
                                        <span class="text-white font-semibold">3.9/5.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">No-Show Rate</span>
                                        <span class="text-green-400 font-semibold">0%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-white/60">Daily Capacity</span>
                                        <span class="text-white font-semibold">524</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between text-xs">
                            <div class="text-white/60">
                                <i class="fas fa-users mr-1"></i>
                                847 customers â€¢ 21 days duration
                            </div>
                            <div class="text-yellow-400 font-semibold">
                                Recommendation: Extend test duration to 60 days for conclusive results
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Optimization Recommendations -->
            <div class="glass rounded-xl p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-lightbulb text-purple-400"></i>
                    AI-Generated Optimization Recommendations
                </h3>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="glass rounded-lg p-5 optimization-badge">
                        <div class="flex items-start justify-between mb-3">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                                <i class="fas fa-robot text-white text-lg"></i>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-semibold">HIGH ROI</span>
                        </div>
                        <div class="text-white font-semibold mb-2">Automate Routine Verifications</div>
                        <div class="text-white/60 text-sm mb-3">Deploy AI to verify standard documents across all agencies</div>
                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            <div>
                                <div class="text-white/50">Time Savings</div>
                                <div class="text-green-400 font-semibold">-42%</div>
                            </div>
                            <div>
                                <div class="text-white/50">Cost Savings</div>
                                <div class="text-green-400 font-semibold">$847K/yr</div>
                            </div>
                            <div>
                                <div class="text-white/50">Implementation</div>
                                <div class="text-white">$340K</div>
                            </div>
                            <div>
                                <div class="text-white/50">Payback</div>
                                <div class="text-green-400 font-semibold">4.8 months</div>
                            </div>
                        </div>
                        <button class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg text-sm font-semibold transition">
                            Review Recommendation
                        </button>
                    </div>

                    <div class="glass rounded-lg p-5 optimization-badge">
                        <div class="flex items-start justify-between mb-3">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-white text-lg"></i>
                            </div>
                            <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded text-xs font-semibold">QUICK WIN</span>
                        </div>
                        <div class="text-white font-semibold mb-2">Smart Appointment Scheduling</div>
                        <div class="text-white/60 text-sm mb-3">AI-optimized scheduling to reduce wait times and no-shows</div>
                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            <div>
                                <div class="text-white/50">Time Savings</div>
                                <div class="text-cyan-400 font-semibold">-28%</div>
                            </div>
                            <div>
                                <div class="text-white/50">Cost Savings</div>
                                <div class="text-cyan-400 font-semibold">$247K/yr</div>
                            </div>
                            <div>
                                <div class="text-white/50">Implementation</div>
                                <div class="text-white">$89K</div>
                            </div>
                            <div>
                                <div class="text-white/50">Payback</div>
                                <div class="text-cyan-400 font-semibold">4.3 months</div>
                            </div>
                        </div>
                        <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg text-sm font-semibold transition">
                            Review Recommendation
                        </button>
                    </div>

                    <div class="glass rounded-lg p-5 optimization-badge">
                        <div class="flex items-start justify-between mb-3">
                            <div class="w-10 h-10 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                                <i class="fas fa-chart-line text-white text-lg"></i>
                            </div>
                            <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded text-xs font-semibold">MODERATE ROI</span>
                        </div>
                        <div class="text-white font-semibold mb-2">Predictive Resource Allocation</div>
                        <div class="text-white/60 text-sm mb-3">AI forecasting to optimize staffing levels by day/hour</div>
                        <div class="grid grid-cols-2 gap-2 text-xs mb-3">
                            <div>
                                <div class="text-white/50">Time Savings</div>
                                <div class="text-purple-400 font-semibold">-19%</div>
                            </div>
                            <div>
                                <div class="text-white/50">Cost Savings</div>
                                <div class="text-purple-400 font-semibold">$423K/yr</div>
                            </div>
                            <div>
                                <div class="text-white/50">Implementation</div>
                                <div class="text-white">$287K</div>
                            </div>
                            <div>
                                <div class="text-white/50">Payback</div>
                                <div class="text-purple-400 font-semibold">8.1 months</div>
                            </div>
                        </div>
                        <button class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded-lg text-sm font-semibold transition">
                            Review Recommendation
                        </button>
                    </div>
                </div>
            </div>

            <!-- Performance Optimization Tracker -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-bar text-cyan-400"></i>
                    Performance Optimization Tracker
                </h3>

                <div class="space-y-4">
                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold">DMV Service Counter Efficiency</div>
                                <div class="text-white/60 text-sm">Optimization applied: Oct 15, 2024</div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-xs font-semibold">+24% IMPROVEMENT</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <div class="text-white/50 text-xs">Before</div>
                                <div class="text-white font-semibold">18.2 min wait</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">After</div>
                                <div class="text-green-400 font-semibold">13.8 min wait</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">Annual Savings</div>
                                <div class="text-yellow-400 font-semibold">$234K</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold">IRS Tax Review Automation</div>
                                <div class="text-white/60 text-sm">Optimization applied: Oct 8, 2024</div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-xs font-semibold">+67% IMPROVEMENT</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <div class="text-white/50 text-xs">Before</div>
                                <div class="text-white font-semibold">3.7 hrs review</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">After</div>
                                <div class="text-green-400 font-semibold">1.2 hrs review</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">Annual Savings</div>
                                <div class="text-yellow-400 font-semibold">$1.2M</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <div class="text-white font-semibold">Building Permit Digital Submission</div>
                                <div class="text-white/60 text-sm">Optimization applied: Sep 28, 2024</div>
                            </div>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-xs font-semibold">+47% IMPROVEMENT</span>
                        </div>
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <div class="text-white/50 text-xs">Before</div>
                                <div class="text-white font-semibold">4.2 days process</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">After</div>
                                <div class="text-green-400 font-semibold">2.2 days process</div>
                            </div>
                            <div>
                                <div class="text-white/50 text-xs">Annual Savings</div>
                                <div class="text-yellow-400 font-semibold">$412K</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-6 bg-green-500/10 border border-green-500/30 rounded-lg p-4">
                    <div class="flex items-start gap-3">
                        <i class="fas fa-chart-line text-green-400 text-lg mt-1"></i>
                        <div class="text-sm text-white/80">
                            <strong class="text-white">Total Impact:</strong> 89 optimizations applied this quarter resulted in 18.7% average efficiency improvement and $4.2M in projected annual savings across all government agencies.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Module 4 -->

                </div>
                <!-- Constituent Inbox Tab - Added 2025-10-27 -->
                <div id="constituent-inbox-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <!-- Header -->
                    <div class="mb-6">
                        <h2 class="text-2xl font-bold text-white mb-2 flex items-center gap-3">
                            <i class="fas fa-inbox text-blue-400"></i>
                            Universal Constituent Inbox
                            <span class="text-xs bg-gradient-to-r from-green-500 to-blue-500 text-white px-3 py-1 rounded-full">96.8% Auto-Classified</span>
                        </h2>
                        <p class="text-white/70">AI-powered message ingestion, classification, and routing across all channels</p>
                    </div>

                    <!-- Stats Dashboard -->
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                        <div class="glass rounded-lg p-4">
                            <div class="text-white/70 text-sm mb-1">Total Messages</div>
                            <div class="text-2xl font-bold text-white">1,847</div>
                            <div class="text-green-400 text-sm mt-1"><i class="fas fa-arrow-up mr-1"></i>23% today</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-white/70 text-sm mb-1">Unread</div>
                            <div class="text-2xl font-bold text-blue-400">142</div>
                            <div class="text-white/60 text-sm mt-1"><i class="fas fa-clock mr-1"></i>Needs attention</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-white/70 text-sm mb-1">Auto-Classified</div>
                            <div class="text-2xl font-bold text-purple-400">96.8%</div>
                            <div class="text-green-400 text-sm mt-1"><i class="fas fa-robot mr-1"></i>AI Processing</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-white/70 text-sm mb-1">Avg Response Time</div>
                            <div class="text-2xl font-bold text-green-400">2.4h</div>
                            <div class="text-green-400 text-sm mt-1"><i class="fas fa-bolt mr-1"></i>Fast</div>
                        </div>
                        <div class="glass rounded-lg p-4">
                            <div class="text-white/70 text-sm mb-1">Channels Active</div>
                            <div class="text-2xl font-bold text-yellow-400">6</div>
                            <div class="text-white/60 text-sm mt-1"><i class="fas fa-plug mr-1"></i>All systems</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column: Inbox -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Filters & Tabs -->
                            <div class="glass rounded-xl p-6">
                                <div class="flex flex-wrap items-center gap-3 mb-4">
                                    <button class="inbox-tab-button active px-4 py-2 rounded-lg text-white text-sm font-medium transition" data-inbox-tab="all" onclick="filterInboxMessages('all')">
                                        <i class="fas fa-inbox mr-2"></i>All Messages
                                    </button>
                                    <button class="inbox-tab-button px-4 py-2 rounded-lg text-white text-sm font-medium transition" data-inbox-tab="unread" onclick="filterInboxMessages('unread')">
                                        <i class="fas fa-envelope mr-2"></i>Unread (142)
                                    </button>
                                    <button class="inbox-tab-button px-4 py-2 rounded-lg text-white text-sm font-medium transition" data-inbox-tab="urgent" onclick="filterInboxMessages('urgent')">
                                        <i class="fas fa-exclamation-circle mr-2"></i>Urgent
                                    </button>
                                    <button class="inbox-tab-button px-4 py-2 rounded-lg text-white text-sm font-medium transition" data-inbox-tab="assigned" onclick="filterInboxMessages('assigned')">
                                        <i class="fas fa-user-check mr-2"></i>Assigned to Me
                                    </button>
                                </div>

                                <div class="flex flex-wrap items-center gap-2">
                                    <span class="text-white/60 text-sm">Filter by:</span>
                                    <button class="inbox-filter-chip glass px-3 py-1.5 rounded-full text-white text-xs transition" data-inbox-filter="email" onclick="toggleInboxFilter('email')">
                                        <i class="fas fa-envelope mr-1"></i>Email
                                    </button>
                                    <button class="inbox-filter-chip glass px-3 py-1.5 rounded-full text-white text-xs transition" data-inbox-filter="web" onclick="toggleInboxFilter('web')">
                                        <i class="fas fa-globe mr-1"></i>Web Form
                                    </button>
                                    <button class="inbox-filter-chip glass px-3 py-1.5 rounded-full text-white text-xs transition" data-inbox-filter="social" onclick="toggleInboxFilter('social')">
                                        <i class="fas fa-comments mr-1"></i>Social Media
                                    </button>
                                    <button class="inbox-filter-chip glass px-3 py-1.5 rounded-full text-white text-xs transition" data-inbox-filter="sms" onclick="toggleInboxFilter('sms')">
                                        <i class="fas fa-sms mr-1"></i>SMS
                                    </button>
                                    <div class="ml-auto">
                                        <input type="text" id="inboxSearchInput" placeholder="Search messages..."
                                               class="bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/60 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Messages List -->
                            <div id="inboxMessagesList" class="space-y-3">
                                <!-- Messages will be inserted here by JavaScript -->
                            </div>

                            <!-- Pagination -->
                            <div class="glass rounded-xl p-4 flex items-center justify-between">
                                <div class="text-white/70 text-sm">Showing 1-20 of 142 messages</div>
                                <div class="flex items-center gap-2">
                                    <button class="glass px-3 py-2 rounded-lg text-white hover:bg-white/20 transition">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <button class="glass px-3 py-2 rounded-lg text-white bg-blue-500/30">1</button>
                                    <button class="glass px-3 py-2 rounded-lg text-white hover:bg-white/20 transition">2</button>
                                    <button class="glass px-3 py-2 rounded-lg text-white hover:bg-white/20 transition">3</button>
                                    <button class="glass px-3 py-2 rounded-lg text-white hover:bg-white/20 transition">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Analytics -->
                        <div class="space-y-6">
                            <!-- Channel Performance -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4">
                                    <i class="fas fa-chart-pie mr-2"></i>Channel Performance
                                </h3>
                                <div class="space-y-3">
                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-envelope text-blue-400"></i>
                                                </div>
                                                <span class="text-white text-sm">Email</span>
                                            </div>
                                            <span class="text-white/80 text-sm font-semibold">847</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: 46%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 bg-green-500/20 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-globe text-green-400"></i>
                                                </div>
                                                <span class="text-white text-sm">Web Form</span>
                                            </div>
                                            <span class="text-white/80 text-sm font-semibold">623</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-green-500 h-2 rounded-full" style="width: 34%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 bg-purple-500/20 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-comments text-purple-400"></i>
                                                </div>
                                                <span class="text-white text-sm">Social Media</span>
                                            </div>
                                            <span class="text-white/80 text-sm font-semibold">267</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-purple-500 h-2 rounded-full" style="width: 14%"></div>
                                        </div>
                                    </div>

                                    <div>
                                        <div class="flex items-center justify-between mb-2">
                                            <div class="flex items-center gap-2">
                                                <div class="w-10 h-10 bg-yellow-500/20 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-sms text-yellow-400"></i>
                                                </div>
                                                <span class="text-white text-sm">SMS</span>
                                            </div>
                                            <span class="text-white/80 text-sm font-semibold">110</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-yellow-500 h-2 rounded-full" style="width: 6%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Department Distribution -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-lg font-bold text-white mb-4">
                                    <i class="fas fa-sitemap mr-2"></i>Department Distribution
                                </h3>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Building & Safety</span>
                                        <span class="bg-orange-500/20 text-orange-400 px-3 py-1 rounded-full text-xs font-semibold">412</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Public Works</span>
                                        <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-semibold">328</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Parks & Recreation</span>
                                        <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-semibold">267</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Code Enforcement</span>
                                        <span class="bg-red-500/20 text-red-400 px-3 py-1 rounded-full text-xs font-semibold">198</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Finance Department</span>
                                        <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full text-xs font-semibold">156</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-white/80 text-sm">Other</span>
                                        <span class="bg-gray-500/20 text-gray-400 px-3 py-1 rounded-full text-xs font-semibold">486</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Module: Pre-Built Government System Connectors -->
                    <!-- Added 2024-10-30: CJIS-Compliant Integration Hub Enhancement -->
                    <div id="api-module-gov-connectors" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-building text-blue-400"></i>
                                Pre-Built Government System Connectors
                                <span class="text-xs bg-green-500/20 text-green-400 px-3 py-1 rounded-full">CJIS Certified</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Ready-to-use integrations with common government systems. All connectors are pre-configured for CJIS compliance, FedRAMP authorization, and NIST 800-53 security controls.
                            </p>

                            <!-- Connector Categories -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                                <!-- Law Enforcement Systems -->
                                <div class="glass rounded-xl p-6">
                                    <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                        <i class="fas fa-shield-alt text-blue-400"></i>
                                        Law Enforcement
                                    </h4>
                                    <div class="space-y-3">
                                        <!-- FBI CJIS -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">FBI CJIS</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">Criminal Justice Information Services</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">CJIS Compliant</span>
                                                <span class="text-white/50">v2.4.1</span>
                                            </div>
                                        </div>
                                        <!-- NCIC -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">NCIC</span>
                                                <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs">Setup</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">National Crime Information Center</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">FBI Certified</span>
                                                <span class="text-white/50">v1.8.3</span>
                                            </div>
                                        </div>
                                        <!-- NLETS -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">NLETS</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">National Law Enforcement Telecom</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">CJIS Compliant</span>
                                                <span class="text-white/50">v3.1.0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Vital Records & Identity Systems -->
                                <div class="glass rounded-xl p-6">
                                    <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                        <i class="fas fa-id-card text-purple-400"></i>
                                        Vital Records
                                    </h4>
                                    <div class="space-y-3">
                                        <!-- State DMV -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">State DMV</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">Department of Motor Vehicles Integration</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">Real ID Ready</span>
                                                <span class="text-white/50">v4.2.0</span>
                                            </div>
                                        </div>
                                        <!-- SSA -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">SSA</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">Social Security Administration</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">FedRAMP High</span>
                                                <span class="text-white/50">v2.1.5</span>
                                            </div>
                                        </div>
                                        <!-- Vital Records -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">Vital Records</span>
                                                <span class="bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded text-xs">Setup</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">Birth, Death, Marriage Records</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-purple-500/20 text-purple-400 px-2 py-1 rounded">EVVE Compliant</span>
                                                <span class="text-white/50">v1.6.2</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Financial & Tax Systems -->
                                <div class="glass rounded-xl p-6">
                                    <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                        <i class="fas fa-dollar-sign text-green-400"></i>
                                        Financial Systems
                                    </h4>
                                    <div class="space-y-3">
                                        <!-- IRS e-Services -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">IRS e-Services</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">Tax Information & Verification</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">FISMA High</span>
                                                <span class="text-white/50">v3.5.1</span>
                                            </div>
                                        </div>
                                        <!-- Treasury -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">Treasury</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">US Department of Treasury Services</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">FedRAMP High</span>
                                                <span class="text-white/50">v2.8.0</span>
                                            </div>
                                        </div>
                                        <!-- SAM.gov -->
                                        <div class="glass rounded-lg p-4 hover:bg-white/10 transition cursor-pointer">
                                            <div class="flex items-center justify-between mb-2">
                                                <span class="text-white font-semibold">SAM.gov</span>
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs">Active</span>
                                            </div>
                                            <div class="text-white/60 text-xs mb-2">System for Award Management</div>
                                            <div class="flex items-center gap-2 text-xs">
                                                <span class="bg-blue-500/20 text-blue-400 px-2 py-1 rounded">FedRAMP Mod</span>
                                                <span class="text-white/50">v1.9.4</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Connection Statistics -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Connection Statistics</h4>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div class="glass rounded-xl p-4">
                                        <div class="text-white/70 text-xs mb-1">Total Connectors</div>
                                        <div class="text-2xl font-bold text-white">24</div>
                                        <div class="text-green-400 text-xs mt-1">
                                            <i class="fas fa-arrow-up mr-1"></i>+3 this month
                                        </div>
                                    </div>
                                    <div class="glass rounded-xl p-4">
                                        <div class="text-white/70 text-xs mb-1">Active Connections</div>
                                        <div class="text-2xl font-bold text-green-400">18</div>
                                        <div class="text-white/60 text-xs mt-1">75% utilization</div>
                                    </div>
                                    <div class="glass rounded-xl p-4">
                                        <div class="text-white/70 text-xs mb-1">Avg Response Time</div>
                                        <div class="text-2xl font-bold text-blue-400">247ms</div>
                                        <div class="text-green-400 text-xs mt-1">
                                            <i class="fas fa-arrow-down mr-1"></i>-12ms vs last week
                                        </div>
                                    </div>
                                    <div class="glass rounded-xl p-4">
                                        <div class="text-white/70 text-xs mb-1">Success Rate</div>
                                        <div class="text-2xl font-bold text-green-400">99.8%</div>
                                        <div class="text-white/60 text-xs mt-1">Last 30 days</div>
                                    </div>
                                </div>
                            </div>

                            <!-- MOCK DATA - Replace in production -->
                            <!-- TODO: Connect to government connector registry API -->
                        </div>
                    </div>

                    <!-- Module: CJIS-Compliant Data Transfer -->
                    <!-- Added 2024-10-30: CJIS-Compliant Integration Hub Enhancement -->
                    <div id="api-module-cjis-transfer" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-lock text-blue-400"></i>
                                CJIS-Compliant Secure Data Transfer
                                <span class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full">Encrypted</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                All data transfers are automatically encrypted with AES-256 at rest and TLS 1.3 in transit. Multi-factor authentication required for all operations.
                            </p>

                            <!-- Security Status Dashboard -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-white/70 text-sm">Encryption Status</span>
                                        <i class="fas fa-shield-alt text-green-400"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-green-400">Active</div>
                                    <div class="text-xs text-white/60 mt-1">AES-256 + TLS 1.3</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-white/70 text-sm">CJIS Compliance</span>
                                        <i class="fas fa-check-circle text-green-400"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-green-400">100%</div>
                                    <div class="text-xs text-white/60 mt-1">All checks passed</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-white/70 text-sm">Data in Transit</span>
                                        <i class="fas fa-exchange-alt text-blue-400"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-blue-400">24.7 GB</div>
                                    <div class="text-xs text-white/60 mt-1">3 active transfers</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-white/70 text-sm">Security Incidents</span>
                                        <i class="fas fa-exclamation-triangle text-gray-400"></i>
                                    </div>
                                    <div class="text-2xl font-bold text-gray-400">0</div>
                                    <div class="text-xs text-green-400 mt-1">Last 90 days</div>
                                </div>
                            </div>

                            <!-- Active Secure Transfers -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4 flex items-center gap-2">
                                    <i class="fas fa-sync-alt text-blue-400 fa-spin"></i>
                                    Active Secure Transfers
                                </h4>
                                <div class="space-y-4">
                                    <!-- Transfer 1 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div>
                                                <div class="text-white font-semibold">Criminal Records Sync</div>
                                                <div class="text-white/60 text-xs">FBI CJIS â†’ Local Database</div>
                                            </div>
                                            <span class="text-white/80 text-sm">47%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2 mb-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" style="width: 47%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <div class="flex items-center gap-2">
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">
                                                    <i class="fas fa-lock mr-1"></i>Encrypted: AES-256
                                                </span>
                                                <span class="text-white/60">12.3 GB / 26.2 GB</span>
                                            </div>
                                            <span class="text-white/60">ETA: 8 min</span>
                                        </div>
                                    </div>
                                    <!-- Transfer 2 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div>
                                                <div class="text-white font-semibold">Vehicle Registration Update</div>
                                                <div class="text-white/60 text-xs">State DMV â†’ Verification System</div>
                                            </div>
                                            <span class="text-white/80 text-sm">82%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2 mb-2">
                                            <div class="bg-gradient-to-r from-green-500 to-blue-500 h-2 rounded-full" style="width: 82%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <div class="flex items-center gap-2">
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">
                                                    <i class="fas fa-lock mr-1"></i>Encrypted: TLS 1.3
                                                </span>
                                                <span class="text-white/60">4.1 GB / 5.0 GB</span>
                                            </div>
                                            <span class="text-white/60">ETA: 2 min</span>
                                        </div>
                                    </div>
                                    <!-- Transfer 3 -->
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <div>
                                                <div class="text-white font-semibold">Tax Information Verification</div>
                                                <div class="text-white/60 text-xs">IRS e-Services â†’ Financial System</div>
                                            </div>
                                            <span class="text-white/80 text-sm">23%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2 mb-2">
                                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full" style="width: 23%"></div>
                                        </div>
                                        <div class="flex items-center justify-between text-xs">
                                            <div class="flex items-center gap-2">
                                                <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded">
                                                    <i class="fas fa-lock mr-1"></i>Encrypted: AES-256
                                                </span>
                                                <span class="text-white/60">1.8 GB / 7.8 GB</span>
                                            </div>
                                            <span class="text-white/60">ETA: 15 min</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Security Features -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Security Features</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-lock text-green-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">End-to-End Encryption</div>
                                            <div class="text-white/60 text-sm">AES-256 at rest, TLS 1.3 in transit</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-user-shield text-blue-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">Multi-Factor Authentication</div>
                                            <div class="text-white/60 text-sm">Required for all data transfers</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-clipboard-check text-purple-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">Audit Logging</div>
                                            <div class="text-white/60 text-sm">Complete transfer history tracked</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-check-double text-yellow-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">Data Validation</div>
                                            <div class="text-white/60 text-sm">Integrity checks on all transfers</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-redo text-red-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">Automatic Retry</div>
                                            <div class="text-white/60 text-sm">Up to 3 attempts on failure</div>
                                        </div>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <div class="w-10 h-10 rounded-lg bg-pink-500/20 flex items-center justify-center flex-shrink-0">
                                            <i class="fas fa-bell text-pink-400"></i>
                                        </div>
                                        <div>
                                            <div class="text-white font-medium">Real-Time Alerts</div>
                                            <div class="text-white/60 text-sm">Instant notification on issues</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Compliance Certifications -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Compliance Certifications</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="glass rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">ðŸ›¡ï¸</div>
                                        <div class="text-white font-medium">CJIS Security Policy v5.9</div>
                                        <div class="text-green-400 text-sm mt-1">Certified</div>
                                    </div>
                                    <div class="glass rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">â˜ï¸</div>
                                        <div class="text-white font-medium">FedRAMP Moderate</div>
                                        <div class="text-green-400 text-sm mt-1">Authorized</div>
                                    </div>
                                    <div class="glass rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">ðŸ“‹</div>
                                        <div class="text-white font-medium">FISMA Compliance</div>
                                        <div class="text-green-400 text-sm mt-1">Certified</div>
                                    </div>
                                    <div class="glass rounded-lg p-4 text-center">
                                        <div class="text-3xl mb-2">ðŸ”</div>
                                        <div class="text-white font-medium">NIST 800-53</div>
                                        <div class="text-green-400 text-sm mt-1">Compliant</div>
                                    </div>
                                </div>
                            </div>

                            <!-- MOCK DATA - Replace in production -->
                            <!-- TODO: Connect to secure transfer monitoring API -->
                            <!-- SECURITY TODO: Implement real-time transfer validation -->
                        </div>
                    </div>

                    <!-- Module: Comprehensive Audit Logging -->
                    <!-- Added 2024-10-30: CJIS-Compliant Integration Hub Enhancement -->
                    <div id="api-module-audit-logs" class="api-module-content hidden">
                        <div class="glass rounded-xl p-6 mb-6">
                            <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                <i class="fas fa-clipboard-list text-blue-400"></i>
                                Comprehensive Audit Logging
                                <span class="text-xs bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full">CJIS Required</span>
                            </h3>
                            <p class="text-white/70 text-sm mb-6">
                                Complete audit trail of all integration activities with 7-year retention for CJIS compliance. All logs are tamper-proof and encrypted.
                            </p>

                            <!-- Audit Filters -->
                            <div class="glass rounded-xl p-4 mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                                    <input type="text" placeholder="Search logs..."
                                           class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <select class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option>All Event Types</option>
                                        <option>Data Transfer</option>
                                        <option>Authentication</option>
                                        <option>Configuration</option>
                                        <option>Security Alert</option>
                                    </select>
                                    <select class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option>All Users</option>
                                        <option>System Admin</option>
                                        <option>API User</option>
                                        <option>Service Account</option>
                                    </select>
                                    <select class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option>Last 24 Hours</option>
                                        <option>Last 7 Days</option>
                                        <option>Last 30 Days</option>
                                        <option>Last 90 Days</option>
                                    </select>
                                    <button class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-medium hover:shadow-lg transition-all">
                                        <i class="fas fa-download mr-2"></i>Export
                                    </button>
                                </div>
                            </div>

                            <!-- Audit Statistics -->
                            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Total Events</div>
                                    <div class="text-2xl font-bold text-white">12,847</div>
                                    <div class="text-white/60 text-xs mt-1">Last 24 hours</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Data Transfers</div>
                                    <div class="text-2xl font-bold text-blue-400">1,023</div>
                                    <div class="text-green-400 text-xs mt-1">79.6% success</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Auth Events</div>
                                    <div class="text-2xl font-bold text-purple-400">4,892</div>
                                    <div class="text-green-400 text-xs mt-1">All successful</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Security Alerts</div>
                                    <div class="text-2xl font-bold text-yellow-400">3</div>
                                    <div class="text-green-400 text-xs mt-1">All resolved</div>
                                </div>
                                <div class="glass rounded-xl p-4">
                                    <div class="text-white/70 text-xs mb-1">Failed Events</div>
                                    <div class="text-2xl font-bold text-red-400">12</div>
                                    <div class="text-white/60 text-xs mt-1">0.09% rate</div>
                                </div>
                            </div>

                            <!-- Recent Audit Events -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h4 class="text-white font-semibold mb-4">Recent Audit Events</h4>
                                <div class="space-y-3">
                                    <!-- Event 1 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-check text-green-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Data Transfer Completed</div>
                                                    <div class="text-white/60 text-sm">FBI CJIS â†’ Local Database</div>
                                                    <div class="text-white/50 text-xs mt-1">2.4 GB transferred â€¢ MFA verified â€¢ Checksum validated</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>2 min ago</div>
                                                <div>User: system.admin</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Event 2 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-user-check text-blue-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">MFA Authentication Success</div>
                                                    <div class="text-white/60 text-sm">IRS e-Services connector authentication</div>
                                                    <div class="text-white/50 text-xs mt-1">Method: Hardware token â€¢ IP: 192.168.1.45</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>8 min ago</div>
                                                <div>User: j.williams</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Event 3 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Security Alert Triggered</div>
                                                    <div class="text-white/60 text-sm">Unusual access pattern detected</div>
                                                    <div class="text-white/50 text-xs mt-1">Source: NCIC connector â€¢ Action: Auto-blocked â€¢ Alert sent</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>15 min ago</div>
                                                <div>System: Auto</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Event 4 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-cog text-purple-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Configuration Changed</div>
                                                    <div class="text-white/60 text-sm">DMV connector settings updated</div>
                                                    <div class="text-white/50 text-xs mt-1">Change: Encryption protocol upgraded to TLS 1.3</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>32 min ago</div>
                                                <div>User: m.santos</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Event 5 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-database text-green-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Database Sync Completed</div>
                                                    <div class="text-white/60 text-sm">State DMV â†’ Vehicle Verification System</div>
                                                    <div class="text-white/50 text-xs mt-1">2,890 records updated â€¢ 0 conflicts â€¢ 100% integrity</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>1 hour ago</div>
                                                <div>User: system.sync</div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Event 6 -->
                                    <div class="glass rounded-lg p-4 hover:bg-white/10 transition">
                                        <div class="flex items-start justify-between">
                                            <div class="flex items-start gap-3">
                                                <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
                                                    <i class="fas fa-times text-red-400"></i>
                                                </div>
                                                <div>
                                                    <div class="text-white font-medium">Transfer Failed</div>
                                                    <div class="text-white/60 text-sm">NLETS connector timeout</div>
                                                    <div class="text-white/50 text-xs mt-1">Reason: Network timeout (30s) â€¢ Auto-retry scheduled in 5 min</div>
                                                </div>
                                            </div>
                                            <div class="text-white/60 text-xs text-right">
                                                <div>2 hours ago</div>
                                                <div>System: Auto</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Retention Policy -->
                            <div class="glass rounded-xl p-6">
                                <h4 class="text-white font-semibold mb-4">Audit Log Retention Policy</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center">
                                                <i class="fas fa-clock text-blue-400 text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Active Storage</div>
                                                <div class="text-white/60 text-xs">Hot storage</div>
                                            </div>
                                        </div>
                                        <div class="text-2xl font-bold text-white mb-1">90 Days</div>
                                        <div class="text-white/60 text-sm">Quick access for recent audits</div>
                                    </div>
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-lg bg-purple-500/20 flex items-center justify-center">
                                                <i class="fas fa-archive text-purple-400 text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Archive Storage</div>
                                                <div class="text-white/60 text-xs">Cold storage</div>
                                            </div>
                                        </div>
                                        <div class="text-2xl font-bold text-white mb-1">7 Years</div>
                                        <div class="text-white/60 text-sm">CJIS compliance requirement</div>
                                    </div>
                                    <div class="glass rounded-lg p-4">
                                        <div class="flex items-center gap-3 mb-3">
                                            <div class="w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center">
                                                <i class="fas fa-hdd text-green-400 text-xl"></i>
                                            </div>
                                            <div>
                                                <div class="text-white font-medium">Total Log Size</div>
                                                <div class="text-white/60 text-xs">Compressed</div>
                                            </div>
                                        </div>
                                        <div class="text-2xl font-bold text-white mb-1">847 GB</div>
                                        <div class="text-white/60 text-sm">Encrypted and deduplicated</div>
                                    </div>
                                </div>
                            </div>

                            <!-- MOCK DATA - Replace in production -->
                            <!-- TODO: Connect to audit logging API -->
                            <!-- TODO: Implement tamper-proof log storage -->
                        </div>
                    </div>
                </div>

                <!-- Added 2024-11-06: SecureMesh Module -->
                <div id="securemesh-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <div class="p-6">
                        <!-- Module Navigation -->
                        <div class="glass rounded-xl p-2 mb-6">
                            <div class="flex items-center space-x-2 overflow-x-auto scrollbar-thin">
                                <button onclick="switchMeshModule('messenger')" class="mesh-tab-button active px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-mesh-module="messenger">
                                    <i class="fas fa-comments mr-2"></i>Secure Messenger
                                </button>
                                <button onclick="switchMeshModule('channels')" class="mesh-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-mesh-module="channels">
                                    <i class="fas fa-hashtag mr-2"></i>Channels
                                </button>
                                <button onclick="switchMeshModule('directory')" class="mesh-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-mesh-module="directory">
                                    <i class="fas fa-address-book mr-2"></i>Directory
                                </button>
                                <button onclick="switchMeshModule('ai-analysis')" class="mesh-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-mesh-module="ai-analysis">
                                    <i class="fas fa-brain mr-2"></i>AI Analysis
                                </button>
                                <button onclick="switchMeshModule('audit')" class="mesh-tab-button px-4 py-3 rounded-lg text-white text-sm font-medium whitespace-nowrap transition-all" data-mesh-module="audit">
                                    <i class="fas fa-clipboard-list mr-2"></i>Audit Trail
                                </button>
                            </div>
                        </div>

                        <!-- Module 1: Secure Messenger -->
                        <div id="mesh-module-messenger" class="mesh-module-content active">
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                <!-- Conversations List -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="text-lg font-bold text-white">Conversations</h3>
                                        <button onclick="startNewConversation()" class="w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center hover:bg-blue-600 transition-all">
                                            <i class="fas fa-plus text-white"></i>
                                        </button>
                                    </div>

                                    <!-- Search -->
                                    <div class="mb-4">
                                        <input type="text" id="conversationSearch" placeholder="Search conversations..." class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 text-sm">
                                    </div>

                                    <!-- Conversations -->
                                    <div class="space-y-2 max-h-[600px] overflow-y-auto scrollbar-thin" id="conversationsList">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>

                                <!-- Chat Window -->
                                <div class="lg:col-span-2 glass rounded-xl flex flex-col" style="height: 700px;">
                                    <!-- Chat Header -->
                                    <div class="border-b border-white/10 p-4">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                                    <span class="text-white font-bold text-sm" id="chatInitials">--</span>
                                                </div>
                                                <div>
                                                    <div class="text-white font-semibold" id="chatName">Select a conversation</div>
                                                    <div class="text-white/60 text-xs" id="chatStatus">Offline</div>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <!-- Clearance Selector Dropdown -->
                                                <div class="relative">
                                                    <button id="clearanceDropdownBtn" class="px-3 py-1 rounded-full text-xs font-semibold clearance-secret flex items-center gap-1 cursor-pointer hover:opacity-80 transition-all">
                                                        <span id="chatClearance">SECRET</span>
                                                        <i class="fas fa-chevron-down text-xs"></i>
                                                    </button>
                                                    <div id="clearanceDropdown" class="hidden absolute right-0 mt-2 w-48 glass rounded-lg shadow-xl z-50">
                                                        <div class="p-2 space-y-1">
                                                            <button onclick="changeClearance('unclassified')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-all clearance-unclassified text-xs font-semibold">
                                                                UNCLASSIFIED
                                                            </button>
                                                            <button onclick="changeClearance('confidential')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-all clearance-confidential text-xs font-semibold">
                                                                CONFIDENTIAL
                                                            </button>
                                                            <button onclick="changeClearance('secret')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-all clearance-secret text-xs font-semibold">
                                                                SECRET
                                                            </button>
                                                            <button onclick="changeClearance('top-secret')" class="w-full text-left px-3 py-2 rounded-lg hover:bg-white/10 transition-all clearance-top-secret text-xs font-semibold">
                                                                TOP SECRET
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- Chat Options Menu Button -->
                                                <div class="relative">
                                                    <button id="chatOptionsBtn" class="w-8 h-8 bg-white/10 rounded-lg flex items-center justify-center hover:bg-white/20 transition-all">
                                                        <i class="fas fa-ellipsis-v text-white"></i>
                                                    </button>
                                                    <div id="chatOptionsMenu" class="hidden absolute right-0 mt-2 w-56 glass rounded-lg shadow-xl z-50">
                                                        <div class="p-2 space-y-1">
                                                            <button onclick="viewConversationInfo()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-info-circle mr-2 text-blue-400"></i>Conversation Info
                                                            </button>
                                                            <button onclick="exportToEmail()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-envelope mr-2 text-green-400"></i>Export to Email
                                                            </button>
                                                            <button onclick="shareExternally()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-share-alt mr-2 text-purple-400"></i>Share Externally
                                                            </button>
                                                            <button onclick="viewAuditTrail()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-clipboard-list mr-2 text-yellow-400"></i>View Audit Trail
                                                            </button>
                                                            <div class="border-t border-white/10 my-1"></div>
                                                            <button onclick="muteConversation()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-bell-slash mr-2 text-gray-400"></i>Mute Notifications
                                                            </button>
                                                            <button onclick="archiveConversation()" class="w-full text-left px-4 py-2 rounded-lg hover:bg-white/10 transition-all text-white text-sm">
                                                                <i class="fas fa-archive mr-2 text-gray-400"></i>Archive
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Messages Area -->
                                    <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin" id="messagesArea">
                                        <!-- Messages populated by JavaScript -->
                                    </div>

                                    <!-- Typing Indicator -->
                                    <div id="typingIndicator" class="px-4 py-2 hidden">
                                        <div class="flex items-center space-x-2">
                                            <div class="typing-indicator">
                                                <span></span>
                                                <span></span>
                                                <span></span>
                                            </div>
                                            <span class="text-white/60 text-sm">Someone is typing...</span>
                                        </div>
                                    </div>

                                    <!-- AI Classification Display -->
                                    <div id="aiClassification" class="px-4 py-2 glass-dark mx-4 mb-2 rounded-lg hidden">
                                        <div class="flex items-center justify-between text-xs">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-brain text-purple-400"></i>
                                                <span class="text-white/70">AI Classification:</span>
                                                <span class="px-2 py-1 rounded-full font-semibold clearance-confidential" id="aiClassLevel">CONFIDENTIAL</span>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-white/70">Sentiment:</span>
                                                <i class="fas fa-smile sentiment-positive" id="aiSentiment"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Message Input -->
                                    <div class="border-t border-white/10 p-4">
                                        <!-- Voice Recording UI (Hidden by default) -->
                                        <div id="voiceRecordingUI" class="hidden mb-3 glass-dark rounded-lg p-4">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-3">
                                                    <div class="w-10 h-10 bg-red-500 rounded-full flex items-center justify-center animate-pulse">
                                                        <i class="fas fa-microphone text-white"></i>
                                                    </div>
                                                    <div>
                                                        <div class="text-white font-semibold">Recording Voice Memo</div>
                                                        <div class="text-white/60 text-xs" id="recordingTimer">00:00</div>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button onclick="cancelRecording()" class="px-4 py-2 bg-white/10 rounded-lg text-white text-sm hover:bg-white/20 transition-all">
                                                        <i class="fas fa-times mr-1"></i>Cancel
                                                    </button>
                                                    <button onclick="stopRecording()" class="px-4 py-2 bg-blue-500 rounded-lg text-white text-sm hover:bg-blue-600 transition-all">
                                                        <i class="fas fa-stop mr-1"></i>Stop & Send
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Email Compose UI (Hidden by default) -->
                                        <div id="emailComposeUI" class="hidden mb-3 glass-dark rounded-lg p-4">
                                            <div class="space-y-3">
                                                <div class="flex items-center justify-between mb-2">
                                                    <h4 class="text-white font-semibold text-sm">
                                                        <i class="fas fa-envelope mr-2 text-blue-400"></i>Send to External Agency
                                                    </h4>
                                                    <button onclick="closeEmailCompose()" class="text-white/60 hover:text-white transition-all">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                <input type="email" id="emailRecipient" placeholder="recipient@agency.gov" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 text-sm">
                                                <input type="text" id="emailSubject" placeholder="Subject: Secure Communication" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 text-sm">
                                                <textarea id="emailMessage" placeholder="Type your message..." class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50 text-sm h-24 resize-none"></textarea>
                                                <div class="flex items-center justify-between">
                                                    <div class="text-xs text-white/60">
                                                        <i class="fas fa-lock mr-1"></i>Encrypted via secure gateway
                                                    </div>
                                                    <button onclick="sendEmailMessage()" class="px-4 py-2 bg-green-500 rounded-lg text-white text-sm hover:bg-green-600 transition-all">
                                                        <i class="fas fa-paper-plane mr-1"></i>Send Email
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex space-x-2">
                                            <button onclick="attachFile()" class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center hover:bg-white/20 transition-all" title="Attach file">
                                                <i class="fas fa-paperclip text-white"></i>
                                            </button>
                                            <button onclick="toggleVoiceRecording()" id="voiceMemoBtn" class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center hover:bg-white/20 transition-all" title="Record voice memo">
                                                <i class="fas fa-microphone text-white"></i>
                                            </button>
                                            <button onclick="openEmailCompose()" class="w-10 h-10 bg-white/10 rounded-lg flex items-center justify-center hover:bg-white/20 transition-all" title="Send to external agency">
                                                <i class="fas fa-envelope text-white"></i>
                                            </button>
                                            <input type="text" id="messageInput" placeholder="Type a secure message..." class="flex-1 bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/50">
                                            <button onclick="sendMessage()" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                                <i class="fas fa-paper-plane mr-2"></i>Send
                                            </button>
                                        </div>
                                        <div class="flex items-center justify-between mt-2 text-xs text-white/50">
                                            <span>End-to-End Encrypted â€¢ Blockchain Verified</span>
                                            <span>AI Classification: <span class="text-blue-400">Active</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Module 2: Channels -->
                        <div id="mesh-module-channels" class="mesh-module-content">
                            <!-- Channels Overview -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Active Channels</div>
                                    <div class="text-3xl font-bold text-white mb-2">24</div>
                                    <div class="text-xs text-green-400">+3 this week</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Total Members</div>
                                    <div class="text-3xl font-bold text-blue-400 mb-2">847</div>
                                    <div class="text-xs text-white/50">Across departments</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Messages Today</div>
                                    <div class="text-3xl font-bold text-purple-400 mb-2">2,341</div>
                                    <div class="text-xs text-green-400">+12% vs yesterday</div>
                                </div>
                            </div>

                            <!-- Channel Categories -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-layer-group text-blue-400"></i>
                                    Department Channels
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="channelsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>

                            <!-- Emergency Channels -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-exclamation-triangle text-red-400"></i>
                                    Emergency Response Channels
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="emergencyChannelsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- Module 3: Directory -->
                        <div id="mesh-module-directory" class="mesh-module-content">
                            <!-- Search and Filters -->
                            <div class="glass rounded-xl p-4 mb-6">
                                <div class="flex flex-col md:flex-row gap-4">
                                    <div class="flex-1">
                                        <input type="text" id="directorySearch" placeholder="Search by name, department, or role..." class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/50">
                                    </div>
                                    <select id="departmentFilter" class="bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white">
                                        <option value="all">All Departments</option>
                                        <option value="law-enforcement">Law Enforcement</option>
                                        <option value="fire">Fire & Rescue</option>
                                        <option value="ems">EMS</option>
                                        <option value="public-works">Public Works</option>
                                        <option value="administration">Administration</option>
                                    </select>
                                    <select id="clearanceFilter" class="bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white">
                                        <option value="all">All Clearances</option>
                                        <option value="unclassified">Unclassified</option>
                                        <option value="confidential">Confidential</option>
                                        <option value="secret">Secret</option>
                                        <option value="top-secret">Top Secret</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Directory Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="directoryGrid">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Module 4: AI Analysis Dashboard -->
                        <div id="mesh-module-ai-analysis" class="mesh-module-content">
                            <!-- AI Analysis Overview -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between mb-4">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">AI Communication Analysis</h2>
                                        <p class="text-white/70">Real-time NLP analysis and security classification</p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-purple-500/20 px-4 py-2 rounded-lg border border-purple-400/30">
                                        <i class="fas fa-brain text-purple-400 ai-processing"></i>
                                        <span class="text-purple-300 text-sm font-semibold">AI ACTIVE</span>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Metrics -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Messages Analyzed</div>
                                    <div class="text-3xl font-bold text-white mb-2">15,847</div>
                                    <div class="text-xs text-green-400">Today</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Auto-Classifications</div>
                                    <div class="text-3xl font-bold text-blue-400 mb-2">98.7%</div>
                                    <div class="text-xs text-white/50">Accuracy rate</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Threat Detections</div>
                                    <div class="text-3xl font-bold text-red-400 mb-2">3</div>
                                    <div class="text-xs text-yellow-400">Flagged for review</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Response Time</div>
                                    <div class="text-3xl font-bold text-purple-400 mb-2">247ms</div>
                                    <div class="text-xs text-green-400">Average</div>
                                </div>
                            </div>

                            <!-- Classification Distribution -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-chart-pie text-blue-400"></i>
                                    Security Classification Distribution
                                </h3>

                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-white/70 flex items-center gap-2">
                                                <span class="px-2 py-1 rounded-full text-xs clearance-unclassified">UNCLASSIFIED</span>
                                            </span>
                                            <span class="text-white font-medium">12,847 (81%)</span>
                                        </div>
                                        <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-gradient-to-r from-green-500 to-green-400" style="width: 81%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-white/70 flex items-center gap-2">
                                                <span class="px-2 py-1 rounded-full text-xs clearance-confidential">CONFIDENTIAL</span>
                                            </span>
                                            <span class="text-white font-medium">2,341 (15%)</span>
                                        </div>
                                        <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-gradient-to-r from-blue-500 to-blue-400" style="width: 15%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-white/70 flex items-center gap-2">
                                                <span class="px-2 py-1 rounded-full text-xs clearance-secret">SECRET</span>
                                            </span>
                                            <span class="text-white font-medium">547 (3%)</span>
                                        </div>
                                        <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-gradient-to-r from-yellow-500 to-yellow-400" style="width: 3%"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm mb-2">
                                            <span class="text-white/70 flex items-center gap-2">
                                                <span class="px-2 py-1 rounded-full text-xs clearance-top-secret">TOP SECRET</span>
                                            </span>
                                            <span class="text-white font-medium">112 (1%)</span>
                                        </div>
                                        <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-gradient-to-r from-red-500 to-red-400" style="width: 1%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Sentiment Analysis -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-smile text-green-400"></i>
                                        Sentiment Analysis
                                    </h3>

                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-smile sentiment-positive text-xl"></i>
                                                <span class="text-white/80">Positive</span>
                                            </div>
                                            <span class="text-white font-bold">68%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-meh sentiment-neutral text-xl"></i>
                                                <span class="text-white/80">Neutral</span>
                                            </div>
                                            <span class="text-white font-bold">27%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <i class="fas fa-frown sentiment-negative text-xl"></i>
                                                <span class="text-white/80">Negative</span>
                                            </div>
                                            <span class="text-white font-bold">5%</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="glass rounded-xl p-6">
                                    <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                        <i class="fas fa-exclamation-circle text-yellow-400"></i>
                                        Urgency Detection
                                    </h3>

                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="px-3 py-1 rounded-full text-xs font-semibold urgency-high">HIGH</span>
                                                <span class="text-white/80">Urgent</span>
                                            </div>
                                            <span class="text-white font-bold">234</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="px-3 py-1 rounded-full text-xs font-semibold urgency-medium">MEDIUM</span>
                                                <span class="text-white/80">Standard</span>
                                            </div>
                                            <span class="text-white font-bold">8,412</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center gap-2">
                                                <span class="px-3 py-1 rounded-full text-xs font-semibold urgency-low">LOW</span>
                                                <span class="text-white/80">Routine</span>
                                            </div>
                                            <span class="text-white font-bold">7,201</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Features Demo -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-flask text-purple-400"></i>
                                    AI Features Demo
                                </h3>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Auto-Classification Demo -->
                                    <div class="glass-dark rounded-lg p-4">
                                        <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                                            <i class="fas fa-tag text-blue-400"></i>
                                            Auto-Classification
                                        </h4>
                                        <textarea id="classificationInput" rows="3" placeholder="Type a message to see AI classification in action..." class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 text-sm mb-3"></textarea>
                                        <button onclick="demoClassification()" class="w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                            <i class="fas fa-brain mr-2"></i>Analyze with AI
                                        </button>
                                        <div id="classificationResult" class="mt-3 hidden">
                                            <!-- Results populated by JavaScript -->
                                        </div>
                                    </div>

                                    <!-- Sentiment Analysis Demo -->
                                    <div class="glass-dark rounded-lg p-4">
                                        <h4 class="text-white font-semibold mb-3 flex items-center gap-2">
                                            <i class="fas fa-heart text-red-400"></i>
                                            Sentiment Analysis
                                        </h4>
                                        <textarea id="sentimentInput" rows="3" placeholder="Enter text to analyze sentiment..." class="w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/50 text-sm mb-3"></textarea>
                                        <button onclick="demoSentiment()" class="w-full px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                                            <i class="fas fa-brain mr-2"></i>Analyze Sentiment
                                        </button>
                                        <div id="sentimentResult" class="mt-3 hidden">
                                            <!-- Results populated by JavaScript -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Module 5: Blockchain Audit Trail -->
                        <div id="mesh-module-audit" class="mesh-module-content">
                            <!-- Audit Overview -->
                            <div class="glass rounded-xl p-6 mb-6">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h2 class="text-2xl font-bold text-white mb-2">Blockchain Audit Trail</h2>
                                        <p class="text-white/70">Immutable communication records with cryptographic verification</p>
                                    </div>
                                    <div class="flex items-center gap-2 bg-green-500/20 px-4 py-2 rounded-lg border border-green-400/30 blockchain-verified">
                                        <i class="fas fa-check-circle text-green-400"></i>
                                        <span class="text-green-300 text-sm font-semibold">VERIFIED</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Blockchain Stats -->
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Total Blocks</div>
                                    <div class="text-3xl font-bold text-white mb-2">8,947</div>
                                    <div class="text-xs text-green-400">+124 today</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Messages Verified</div>
                                    <div class="text-3xl font-bold text-green-400 mb-2">100%</div>
                                    <div class="text-xs text-white/50">All communications</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Chain Integrity</div>
                                    <div class="text-3xl font-bold text-blue-400 mb-2">Valid</div>
                                    <div class="text-xs text-green-400">No tampering detected</div>
                                </div>
                                <div class="glass rounded-xl p-6">
                                    <div class="text-white/70 text-xs mb-2">Last Verification</div>
                                    <div class="text-3xl font-bold text-purple-400 mb-2">2s</div>
                                    <div class="text-xs text-white/50">ago</div>
                                </div>
                            </div>

                            <!-- Recent Audit Logs -->
                            <div class="glass rounded-xl p-6">
                                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                                    <i class="fas fa-list text-blue-400"></i>
                                    Recent Audit Logs
                                </h3>

                                <div class="space-y-3" id="auditLogsList">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>

                        <!-- MOCK DATA - Replace in production -->
                        <!-- TODO: Connect to WebSocket server for real-time communications -->
                        <!-- TODO: Connect to AI NLP API endpoint /api/ai/classify -->
                        <!-- TODO: Connect to blockchain verification service /api/blockchain/verify -->
                        <!-- SECURITY TODO: Implement clearance-based access control -->
                    </div>
                </div>
                <!-- End Added 2024-11-06: SecureMesh Module -->

                <!-- Added 2024-11-07: Mobile Command Center -->
                <div id="mobile-command-content" class="tab-content h-full overflow-y-auto" style="display: none;">
                    <div class="p-6 max-w-md mx-auto">
                        <!-- CJIS COMPLIANCE NOTICE -->
                        <!-- SECURITY TODO: Implement CJIS-compliant security -->
                        <!-- TODO: Implement encrypted local storage (FIPS 140-2) -->
                        <!-- TODO: Add remote wipe capability -->
                        <!-- TODO: Integrate biometric authentication (Touch ID/Face ID) -->

                        <!-- Field Status Bar -->
                        <div class="mobile-glass rounded-xl p-4 mb-6 sticky top-0 z-50">
                            <div class="flex justify-between items-center mb-2">
                                <div class="text-sm font-semibold text-white">Building Inspection - 3 of 8 today</div>
                                <div class="flex items-center gap-2">
                                    <span class="mobile-status-dot mobile-status-syncing"></span>
                                    <span class="text-xs text-white">Syncing</span>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-white/70">
                                <div class="flex items-center gap-1">
                                    <span>ðŸ”‹</span>
                                    <span>6.5 hours remaining</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <span>ðŸ”’</span>
                                    <span>Encrypted Session Active</span>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Action Tiles -->
                        <h2 class="text-xl font-bold text-white mb-4">Quick Actions</h2>
                        <div class="grid grid-cols-3 gap-3 mb-6">
                            <div class="mobile-action-tile mobile-glass rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer relative" onclick="mobileShowAssignments()">
                                <div class="absolute top-2 right-2 bg-red-500 text-white rounded-full px-2 py-0.5 text-xs font-bold">8</div>
                                <div class="text-3xl mb-2">ðŸ“‹</div>
                                <div class="text-xs font-semibold text-white">Today's Assignments</div>
                            </div>
                            <div class="mobile-action-tile mobile-glass rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer" onclick="mobileQuickCapture()">
                                <div class="text-3xl mb-2">ðŸ“¸</div>
                                <div class="text-xs font-semibold text-white">Quick Capture</div>
                            </div>
                            <div class="mobile-action-tile mobile-glass rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer" onclick="mobileShowRouteOptimizer()">
                                <div class="text-3xl mb-2">ðŸ—ºï¸</div>
                                <div class="text-xs font-semibold text-white">Route Optimizer</div>
                            </div>
                            <div class="mobile-action-tile mobile-glass rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer" onclick="mobileDocumentScanner()">
                                <div class="text-3xl mb-2">ðŸ“„</div>
                                <div class="text-xs font-semibold text-white">Document Scanner</div>
                            </div>
                            <div class="mobile-action-tile mobile-glass rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer" onclick="mobileChecklistMode()">
                                <div class="text-3xl mb-2">âœ…</div>
                                <div class="text-xs font-semibold text-white">Checklist Mode</div>
                            </div>
                            <div class="mobile-action-tile bg-gradient-to-br from-red-600 to-red-700 rounded-2xl p-4 flex flex-col items-center justify-center text-center cursor-pointer col-span-2" onclick="mobileShowEmergencyModal()">
                                <div class="text-3xl mb-2">ðŸ†˜</div>
                                <div class="text-xs font-semibold text-white">Emergency Report</div>
                            </div>
                        </div>

                        <!-- Active Work Section -->
                        <h2 class="text-xl font-bold text-white mb-4">Active Work</h2>
                        <div class="bg-gradient-to-br from-blue-600/20 to-cyan-600/20 mobile-glass rounded-2xl p-6 mb-6">
                            <div class="flex justify-between items-start mb-4">
                                <div class="text-lg font-bold text-white">Building Inspection</div>
                                <div class="bg-white/20 px-3 py-1 rounded-xl text-xs font-semibold text-white">INSP-2024-00847</div>
                            </div>
                            <div class="text-sm text-white/70 mb-4">ðŸ“ 123 Oak Street, Springfield, IL 62701</div>

                            <div class="flex items-center gap-4 mb-4">
                                <div class="relative">
                                    <div class="w-20 h-20 rounded-full bg-gradient-to-br from-green-500 to-green-600 flex items-center justify-center">
                                        <div class="w-16 h-16 rounded-full bg-gray-900 flex items-center justify-center">
                                            <span class="text-lg font-bold text-white">5/12</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <div class="text-sm text-white/70">Inspection Progress</div>
                                    <div class="text-lg font-bold text-white">5 of 12 points completed</div>
                                </div>
                            </div>

                            <div class="flex gap-3 mb-4">
                                <button class="mobile-touch-button flex-1 bg-green-600 text-white rounded-xl font-semibold">Complete Current</button>
                                <button class="mobile-touch-button flex-1 bg-white/10 text-white rounded-xl font-semibold">Skip</button>
                            </div>

                            <div class="bg-white/5 rounded-xl p-3">
                                <div class="text-xs text-white/70 mb-2">NEXT UP</div>
                                <div class="flex justify-between items-center">
                                    <div class="text-sm font-semibold text-white">Plumbing Inspection - 456 Maple Ave</div>
                                    <div class="bg-blue-500 px-3 py-1 rounded-xl text-xs font-semibold text-white">ETA 18 min</div>
                                </div>
                            </div>
                        </div>

                        <!-- Route Optimization Module -->
                        <h2 class="text-xl font-bold text-white mb-4">Route Optimizer</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-6">
                            <div class="bg-gradient-to-r from-red-500/10 to-green-500/10 rounded-xl p-4 mb-4">
                                <div class="flex justify-around mb-4">
                                    <div class="text-center">
                                        <div class="text-xs text-white/70 uppercase mb-1">Distance</div>
                                        <div class="text-lg font-bold route-stat-old">47.3 mi</div>
                                        <div class="text-lg font-bold route-stat-new">35.1 mi</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-xs text-white/70 uppercase mb-1">Time</div>
                                        <div class="text-lg font-bold route-stat-old">6.5 hrs</div>
                                        <div class="text-lg font-bold route-stat-new">5.75 hrs</div>
                                    </div>
                                </div>
                                <div class="bg-green-600 text-white px-3 py-2 rounded-lg text-center font-bold text-sm">
                                    ðŸ’¡ AI route saves 45 minutes, 12.2 miles
                                </div>
                            </div>

                            <div class="bg-gray-800 h-48 rounded-xl mb-4 flex items-center justify-center text-white/70">
                                <!-- TODO: Connect to mapping service (Google Maps/Mapbox) -->
                                ðŸ—ºï¸ Interactive Map View
                            </div>

                            <div class="flex flex-wrap gap-2 mb-4">
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">1ï¸âƒ£ 123 Oak St</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">2ï¸âƒ£ 789 Pine Rd</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">3ï¸âƒ£ 321 Birch Ln</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">4ï¸âƒ£ 456 Maple Ave</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">5ï¸âƒ£ 654 Cedar Dr</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">6ï¸âƒ£ 159 Elm St</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">7ï¸âƒ£ 951 Ash Ct</div>
                                <div class="bg-blue-600/30 px-3 py-1 rounded-full text-xs font-semibold text-white">8ï¸âƒ£ 753 Walnut Pl</div>
                            </div>

                            <button class="mobile-touch-button w-full bg-blue-600 text-white rounded-xl font-bold h-14">
                                ðŸ§­ Start Navigation
                            </button>
                        </div>

                        <!-- Offline Sync Queue -->
                        <h2 class="text-xl font-bold text-white mb-4">Sync Queue</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-6">
                            <div class="space-y-3 mb-4">
                                <div class="bg-white/5 rounded-xl p-3 flex items-center gap-3">
                                    <div class="text-2xl">ðŸ“‹</div>
                                    <div class="flex-1">
                                        <div class="text-sm font-semibold text-white">Inspection Complete</div>
                                        <div class="text-xs text-white/70">12 photos â€¢ 2.3 MB</div>
                                    </div>
                                    <div class="priority-normal px-3 py-1 rounded-xl text-xs font-bold uppercase">Normal</div>
                                </div>

                                <div class="bg-white/5 rounded-xl p-3 flex items-center gap-3">
                                    <div class="text-2xl">âš ï¸</div>
                                    <div class="flex-1">
                                        <div class="text-sm font-semibold text-white">Violation Issued</div>
                                        <div class="text-xs text-white/70">3 photos â€¢ 456 KB</div>
                                    </div>
                                    <div class="priority-high px-3 py-1 rounded-xl text-xs font-bold uppercase">High</div>
                                </div>

                                <div class="bg-white/5 rounded-xl p-3 flex items-center gap-3">
                                    <div class="text-2xl">ðŸ“</div>
                                    <div class="flex-1">
                                        <div class="text-sm font-semibold text-white">Field Notes</div>
                                        <div class="text-xs text-white/70">Voice memo â€¢ 1.2 MB</div>
                                    </div>
                                    <div class="priority-normal px-3 py-1 rounded-xl text-xs font-bold uppercase">Normal</div>
                                </div>
                            </div>

                            <!-- Last Synced Timestamp -->
                            <div class="mt-4 pt-4 border-t border-white/10">
                                <div class="flex items-center justify-between text-xs text-white/60">
                                    <span>Last synced</span>
                                    <span class="font-medium">5 minutes ago</span>
                                </div>
                            </div>

                            <!-- Storage Info -->
                            <div class="mt-4 bg-white/5 rounded-xl p-3 flex justify-between">
                                <div>
                                    <div class="text-xs text-white/70">Cached Data</div>
                                    <div class="text-sm font-semibold text-white">4.2 GB</div>
                                </div>
                                <div>
                                    <div class="text-xs text-white/70">Available</div>
                                    <div class="text-sm font-semibold text-white">10.8 GB</div>
                                </div>
                            </div>
                        </div>

                        <!-- Today's Assignments -->
                        <h2 class="text-xl font-bold text-white mb-4">Today's Assignments</h2>
                        <div class="space-y-4 mb-6" id="mobileAssignmentsList">
                            <!-- Populated by JavaScript -->
                        </div>

                        <!-- Document Capture Interface -->
                        <h2 class="text-xl font-bold text-white mb-4">Document Capture</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-6">
                            <button class="w-full min-h-32 bg-gradient-to-br from-blue-600 to-cyan-600 border-2 border-dashed border-white/30 rounded-2xl text-white font-bold flex flex-col items-center justify-center gap-3 mb-4" onclick="mobileOpenCamera()">
                                <div class="text-5xl">ðŸ“·</div>
                                <div>Tap to Capture Photo</div>
                                <div class="text-xs opacity-80">Camera â€¢ Voice â€¢ GPS Auto-Tagged</div>
                            </button>

                            <div class="grid grid-cols-3 gap-2">
                                <div class="aspect-square bg-gray-800 rounded-lg flex flex-col items-center justify-center text-white/70 relative">
                                    <div>ðŸ“¸</div>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 py-1 text-xs text-center">Exterior</div>
                                </div>
                                <div class="aspect-square bg-gray-800 rounded-lg flex flex-col items-center justify-center text-white/70 relative">
                                    <div>ðŸ“¸</div>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 py-1 text-xs text-center">Electrical</div>
                                </div>
                                <div class="aspect-square bg-gray-800 rounded-lg flex flex-col items-center justify-center text-white/70 relative">
                                    <div>ðŸ“¸</div>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 py-1 text-xs text-center">Plumbing</div>
                                </div>
                                <div class="aspect-square bg-gray-800 rounded-lg flex flex-col items-center justify-center text-white/70 relative">
                                    <div>ðŸ“¸</div>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 py-1 text-xs text-center">HVAC</div>
                                </div>
                                <div class="aspect-square bg-gray-800 rounded-lg flex flex-col items-center justify-center text-white/70 relative">
                                    <div>ðŸ“¸</div>
                                    <div class="absolute bottom-0 left-0 right-0 bg-black/80 py-1 text-xs text-center">Violation</div>
                                </div>
                                <div class="aspect-square bg-gray-800 rounded-lg flex items-center justify-center text-white/70 text-2xl">
                                    +
                                </div>
                            </div>
                        </div>

                        <!-- Digital Inspection Checklist -->
                        <h2 class="text-xl font-bold text-white mb-4">Inspection Checklist</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-6">
                            <div class="flex gap-2 overflow-x-auto pb-2 mb-4 scrollbar-thin">
                                <button class="px-4 py-2 bg-blue-600 border border-blue-600 rounded-full text-white text-sm font-semibold whitespace-nowrap">Building</button>
                                <button class="px-4 py-2 bg-white/10 border border-white/20 rounded-full text-white text-sm font-semibold whitespace-nowrap">Electrical</button>
                                <button class="px-4 py-2 bg-white/10 border border-white/20 rounded-full text-white text-sm font-semibold whitespace-nowrap">Plumbing</button>
                                <button class="px-4 py-2 bg-white/10 border border-white/20 rounded-full text-white text-sm font-semibold whitespace-nowrap">Fire</button>
                                <button class="px-4 py-2 bg-white/10 border border-white/20 rounded-full text-white text-sm font-semibold whitespace-nowrap">Health</button>
                            </div>

                            <div class="space-y-4 mb-4">
                                <div class="bg-white/5 rounded-xl p-4">
                                    <div class="text-sm font-semibold text-white mb-3">1. Foundation and Structure</div>
                                    <div class="flex gap-2">
                                        <button class="checklist-btn flex-1 min-h-11 bg-green-500/20 border-2 border-green-500 text-green-500 rounded-lg font-bold text-sm">âœ“ Pass</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-red-500/20 border-2 border-red-500 text-red-500 rounded-lg font-bold text-sm">âœ— Fail</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-gray-500/20 border-2 border-transparent text-white/70 rounded-lg font-bold text-sm">â€” N/A</button>
                                    </div>
                                </div>

                                <div class="bg-white/5 rounded-xl p-4">
                                    <div class="text-sm font-semibold text-white mb-3">2. Roof and Drainage</div>
                                    <div class="flex gap-2">
                                        <button class="checklist-btn flex-1 min-h-11 bg-green-500/20 border-2 border-green-500 text-green-500 rounded-lg font-bold text-sm">âœ“ Pass</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-red-500/20 border-2 border-red-500 text-red-500 rounded-lg font-bold text-sm">âœ— Fail</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-gray-500/20 border-2 border-transparent text-white/70 rounded-lg font-bold text-sm">â€” N/A</button>
                                    </div>
                                </div>

                                <div class="bg-white/5 rounded-xl p-4">
                                    <div class="text-sm font-semibold text-white mb-3">3. Exterior Walls and Siding</div>
                                    <div class="flex gap-2">
                                        <button class="checklist-btn flex-1 min-h-11 bg-green-500/20 border-2 border-green-500 text-green-500 rounded-lg font-bold text-sm">âœ“ Pass</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-red-500/20 border-2 border-red-500 text-red-500 rounded-lg font-bold text-sm">âœ— Fail</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-gray-500/20 border-2 border-transparent text-white/70 rounded-lg font-bold text-sm">â€” N/A</button>
                                    </div>
                                </div>

                                <div class="bg-white/5 rounded-xl p-4">
                                    <div class="text-sm font-semibold text-white mb-3">4. Windows and Doors</div>
                                    <div class="flex gap-2">
                                        <button class="checklist-btn flex-1 min-h-11 bg-green-500/20 border-2 border-green-500 text-green-500 rounded-lg font-bold text-sm">âœ“ Pass</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-red-500/20 border-2 border-red-500 text-red-500 rounded-lg font-bold text-sm">âœ— Fail</button>
                                        <button class="checklist-btn flex-1 min-h-11 bg-gray-500/20 border-2 border-transparent text-white/70 rounded-lg font-bold text-sm">â€” N/A</button>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-white h-40 rounded-xl flex items-center justify-center text-gray-600 text-sm">
                                <!-- TODO: Implement digital signature capture -->
                                âœï¸ Digital Signature Area
                            </div>
                        </div>

                        <!-- Property Intelligence Panel -->
                        <h2 class="text-xl font-bold text-white mb-4">Property Intelligence</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-6">
                            <div class="space-y-4">
                                <div>
                                    <div class="text-xs text-white/70 uppercase mb-1">Property Owner</div>
                                    <div class="text-sm font-semibold text-white">John Smith</div>
                                </div>

                                <div>
                                    <div class="text-xs text-white/70 uppercase mb-1">Contact</div>
                                    <div class="text-sm font-semibold text-white">ðŸ“ž (217) 555-0100</div>
                                </div>

                                <div>
                                    <div class="text-xs text-white/70 uppercase mb-2">Previous Inspections (Last 5 Years)</div>
                                    <div class="space-y-2">
                                        <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2023-03-15: Annual Inspection - Passed</div>
                                        <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2022-08-22: Re-Inspection - Passed</div>
                                        <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2022-07-10: Building Inspection - Failed (HVAC)</div>
                                        <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2021-04-05: Annual Inspection - Passed</div>
                                        <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2020-09-30: Electrical Inspection - Passed</div>
                                    </div>
                                </div>

                                <div>
                                    <div class="text-xs text-white/70 uppercase mb-2">Open Permits</div>
                                    <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">PERMIT-2024-1247: Residential Addition (Expires: 2024-12-31)</div>
                                </div>

                                <div>
                                    <div class="text-xs text-white/70 uppercase mb-2">Violations History</div>
                                    <div class="bg-white/5 px-3 py-2 rounded-lg text-xs text-white">2022-07: HVAC system non-compliant (Resolved)</div>
                                </div>

                                <div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border-l-4 border-blue-500 px-4 py-3 rounded-lg">
                                    <div class="text-xs text-blue-400 font-bold uppercase mb-2">ðŸ¤– AI Prediction</div>
                                    <div class="text-sm text-white">This property type typically has: HVAC issues (67%), Electrical upgrades needed (45%), Plumbing concerns (23%)</div>
                                </div>
                            </div>
                        </div>

                        <!-- Team Collaboration -->
                        <h2 class="text-xl font-bold text-white mb-4">Team Collaboration</h2>
                        <div class="mobile-glass rounded-2xl p-6 mb-20">
                            <div class="bg-gray-800 h-40 rounded-xl mb-4 flex items-center justify-center text-white/70 text-sm">
                                <!-- TODO: Connect to mapping service for team locations -->
                                ðŸ—ºï¸ Team Location Map (5 members nearby)
                            </div>

                            <div class="grid grid-cols-3 gap-3">
                                <button class="mobile-touch-button bg-blue-600/20 border border-blue-500 rounded-xl text-white font-semibold text-xs flex flex-col items-center justify-center gap-1 py-3">
                                    <div>ðŸ“»</div>
                                    <div>Push-to-Talk</div>
                                </button>
                                <button class="mobile-touch-button bg-blue-600/20 border border-blue-500 rounded-xl text-white font-semibold text-xs flex flex-col items-center justify-center gap-1 py-3">
                                    <div>ðŸ’¬</div>
                                    <div>Messages</div>
                                </button>
                                <button class="mobile-touch-button bg-blue-600/20 border border-blue-500 rounded-xl text-white font-semibold text-xs flex flex-col items-center justify-center gap-1 py-3">
                                    <div>ðŸ†˜</div>
                                    <div>Request Backup</div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Added 2024-11-07: Mobile Command Center -->

                <!-- Settings Tab -->
                <div id="settings-content" class="tab-content" style="display: none;">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-lg font-semibold text-white mb-4">System Settings</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                                <div>
                                    <h4 class="font-medium text-white">Auto-Deploy Workflows</h4>
                                    <p class="text-sm text-white/70">Automatically deploy approved workflows</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg">
                                <div>
                                    <h4 class="font-medium text-white">Security Alerts</h4>
                                    <p class="text-sm text-white/70">Real-time security notifications</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Enhanced 2024-10-30: Message Detail Modal with CRM Integration -->
                <div id="messageDetailModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" role="dialog" aria-labelledby="messageDetailTitle">
                    <div class="glass rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                        <div class="sticky top-0 glass border-b border-white/10 p-6 flex items-center justify-between">
                            <h2 id="messageDetailTitle" class="text-xl font-bold text-white">Message Details</h2>
                            <button onclick="closeMessageDetail()" class="text-white/70 hover:text-white transition">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div id="messageDetailContent" class="p-6">
                            <!-- Message details will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- CRM Tab -->
                <div id="crm-content" class="tab-content h-full" style="display: none;">
                    <div class="h-full flex flex-col">
                        <!-- Enterprise CRM Header with Command Center -->
                        <div class="glass rounded-xl p-6 mb-4 flex-shrink-0">
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center space-x-4">
                                    <div class="w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-network-wired text-white text-xl"></i>
                                    </div>
                                    <div>
                                        <h3 class="text-2xl font-bold text-white">Enterprise CRM Intelligence</h3>
                                        <p class="text-white/70 text-sm">AI-Powered Relationship Management â€¢ CJIS IL5 â€¢ Zero Trust Architecture</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="flex items-center space-x-2 bg-emerald-500/20 px-3 py-1.5 rounded-lg border border-emerald-400/30">
                                        <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                                        <span class="text-emerald-300 text-xs font-semibold">FedRAMP IL5</span>
                                    </div>
                                    <div class="flex items-center space-x-2 bg-blue-500/20 px-3 py-1.5 rounded-lg border border-blue-400/30">
                                        <i class="fas fa-shield-check text-blue-400 text-xs"></i>
                                        <span class="text-blue-300 text-xs font-semibold">CJIS Certified</span>
                                    </div>
                                    <div class="flex items-center space-x-2 bg-purple-500/20 px-3 py-1.5 rounded-lg border border-purple-400/30">
                                        <i class="fas fa-brain text-purple-400 text-xs"></i>
                                        <span class="text-purple-300 text-xs font-semibold">AI Active</span>
                                    </div>
                                    <button onclick="showNewContactModal()" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-5 py-2.5 rounded-lg transition-all duration-200 flex items-center space-x-2 shadow-lg">
                                        <i class="fas fa-plus text-sm"></i>
                                        <span class="font-medium">Add Contact</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Main CRM Content - Scrollable -->
                        <div class="flex-1 overflow-y-auto space-y-4 pr-2">
                            <!-- AI Command Center -->
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center space-x-3 mb-4">
                                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-pink-500 rounded-xl flex items-center justify-center">
                                        <i class="fas fa-robot text-white"></i>
                                    </div>
                                    <div>
                                        <h4 class="text-white font-semibold text-lg">CRM AI Command Center</h4>
                                        <p class="text-white/60 text-sm">Natural language relationship intelligence and automation</p>
                                    </div>
                                    <div class="ml-auto flex items-center space-x-2">
                                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                        <span class="text-green-400 text-xs font-medium">Online</span>
                                    </div>
                                </div>
                                <div class="flex space-x-3">
                                    <div class="flex-1 relative">
                                        <input type="text" id="crmAiInput" placeholder="Ask: 'Show me high-value prospects from last month' or 'Schedule follow-ups for all pending deals'" 
                                               class="w-full bg-black/20 border border-white/20 rounded-xl px-4 py-4 pr-12 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all">
                                        <div class="absolute right-3 top-4 text-white/40">
                                            <i class="fas fa-microphone hover:text-purple-400 cursor-pointer transition-colors"></i>
                                        </div>
                                    </div>
                                    <button onclick="processCrmAiQuery()" class="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-4 rounded-xl transition-all duration-200 flex items-center space-x-2 shadow-lg">
                                        <i class="fas fa-paper-plane"></i>
                                        <span class="font-medium">Execute</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Enterprise Dashboard Grid -->
                            <div class="grid grid-cols-1 lg:grid-cols-4 gap-4">
                                <!-- Real-time Metrics -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-white font-semibold">Contact Intelligence</h4>
                                        <i class="fas fa-chart-network text-blue-400"></i>
                                    </div>
                                    <div class="space-y-4">
                                        <div class="flex justify-between items-center">
                                            <span class="text-white/70 text-sm">Total Contacts</span>
                                            <span class="text-xl font-bold text-white">28,574</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-white/70 text-sm">Active Engagements</span>
                                            <span class="text-lg font-semibold text-emerald-400">1,247</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-white/70 text-sm">AI Predictions</span>
                                            <span class="text-lg font-semibold text-purple-400">94.3%</span>
                                        </div>
                                        <div class="w-full bg-white/10 rounded-full h-2">
                                            <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full animate-pulse" style="width: 87%"></div>
                                        </div>
                                        <p class="text-xs text-white/60">87% relationship health score</p>
                                    </div>
                                </div>

                                <!-- Security & Compliance -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-white font-semibold">Security Matrix</h4>
                                        <i class="fas fa-shield-check text-emerald-400"></i>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Zero Trust</span>
                                            <span class="text-emerald-400 font-semibold text-sm">Active</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Quantum Encryption</span>
                                            <span class="text-emerald-400 font-semibold text-sm">256-bit</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Audit Trail</span>
                                            <span class="text-emerald-400 font-semibold text-sm">Real-time</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Compliance</span>
                                            <span class="text-emerald-400 font-semibold text-sm">99.97%</span>
                                        </div>
                                        <div class="p-3 bg-emerald-500/20 rounded-lg border border-emerald-400/30">
                                            <div class="flex items-center space-x-2">
                                                <i class="fas fa-check-circle text-emerald-400 text-sm"></i>
                                                <span class="text-emerald-300 text-xs font-medium">All systems secure</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Performance Analytics -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-white font-semibold">Performance</h4>
                                        <i class="fas fa-tachometer-alt text-yellow-400"></i>
                                    </div>
                                    <div class="space-y-3">
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Response Time</span>
                                            <span class="text-yellow-400 font-semibold text-sm">34ms</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Uptime</span>
                                            <span class="text-emerald-400 font-semibold text-sm">99.99%</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Scalability</span>
                                            <span class="text-blue-400 font-semibold text-sm">Auto</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-white/70 text-sm">Load Balance</span>
                                            <span class="text-purple-400 font-semibold text-sm">Optimal</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Quick Actions Panel -->
                                <div class="glass rounded-xl p-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="text-white font-semibold">Operations</h4>
                                        <i class="fas fa-bolt text-orange-400"></i>
                                    </div>
                                    <div class="space-y-2">
                                        <button onclick="bulkImportContacts()" class="w-full bg-blue-600/20 hover:bg-blue-600/30 text-blue-300 py-2.5 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-blue-500/30">
                                            <i class="fas fa-upload text-xs"></i>
                                            <span class="text-sm font-medium">Import</span>
                                        </button>
                                        <button onclick="exportContacts()" class="w-full bg-emerald-600/20 hover:bg-emerald-600/30 text-emerald-300 py-2.5 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-emerald-500/30">
                                            <i class="fas fa-download text-xs"></i>
                                            <span class="text-sm font-medium">Export</span>
                                        </button>
                                        <button onclick="runComplianceAudit()" class="w-full bg-purple-600/20 hover:bg-purple-600/30 text-purple-300 py-2.5 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-purple-500/30">
                                            <i class="fas fa-clipboard-check text-xs"></i>
                                            <span class="text-sm font-medium">Audit</span>
                                        </button>
                                        <button onclick="generateReport()" class="w-full bg-orange-600/20 hover:bg-orange-600/30 text-orange-300 py-2.5 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 border border-orange-500/30">
                                            <i class="fas fa-chart-bar text-xs"></i>
                                            <span class="text-sm font-medium">Reports</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Intelligent Contact Import & Enrichment - Added 2025-10-18 -->
                            <div class="glass rounded-xl p-6 bg-gradient-to-r from-purple-600/10 to-blue-600/10 border-purple-500/30">
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-id-card text-purple-400 text-2xl"></i>
                                        <div>
                                            <h4 class="text-xl font-bold text-white">Import Contacts from Documents</h4>
                                            <p class="text-sm text-white/70">AI-powered extraction from business cards, contact sheets, and files</p>
                                        </div>
                                    </div>
                                    <span class="text-sm bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full border border-purple-500/30">AI-Powered</span>
                                </div>

                                <!-- Document Type Icons -->
                                <div class="flex items-center gap-4 mb-6 flex-wrap">
                                    <div class="flex items-center gap-2 text-sm text-white/70">
                                        <i class="fas fa-address-card text-blue-400"></i>
                                        <span>Business Cards</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-white/70">
                                        <i class="fas fa-file-alt text-green-400"></i>
                                        <span>Contact Sheets</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-white/70">
                                        <i class="fas fa-envelope text-yellow-400"></i>
                                        <span>Email Signatures</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-white/70">
                                        <i class="fas fa-file-csv text-purple-400"></i>
                                        <span>Spreadsheets</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-sm text-white/70">
                                        <i class="fab fa-linkedin text-blue-300"></i>
                                        <span>LinkedIn</span>
                                    </div>
                                </div>

                                <!-- Import Options Grid -->
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                                    <button onclick="openContactImport('camera')" class="bg-white/10 hover:bg-white/20 text-white px-4 py-3 rounded-lg font-medium transition-all border border-white/20 flex items-center justify-center gap-2">
                                        <i class="fas fa-camera"></i>
                                        <span>Scan Business Card</span>
                                    </button>
                                    <button onclick="openContactImport('upload')" class="bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-4 py-3 rounded-lg font-medium transition-all shadow-lg flex items-center justify-center gap-2">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                        <span>Upload Documents</span>
                                    </button>
                                    <button onclick="openContactImport('bulk')" class="bg-white/10 hover:bg-white/20 text-white px-4 py-3 rounded-lg font-medium transition-all border border-white/20 flex items-center justify-center gap-2">
                                        <i class="fas fa-layer-group"></i>
                                        <span>Bulk Import</span>
                                    </button>
                                </div>

                                <!-- Recent Imports Summary -->
                                <div class="flex items-center justify-between text-sm">
                                    <div class="flex items-center gap-4">
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-check-circle text-green-400"></i>
                                            <span class="text-white/70">2,847 imported this month</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="fas fa-percent text-blue-400"></i>
                                            <span class="text-white/70">96.3% success rate</span>
                                        </div>
                                    </div>
                                    <button onclick="viewImportHistory()" class="text-purple-400 hover:text-purple-300 transition-colors">
                                        <i class="fas fa-history mr-1"></i>View History
                                    </button>
                                </div>
                            </div>

                            <!-- Advanced Contact Management Interface -->
                            <div class="glass rounded-xl p-6">
                                <div class="flex items-center justify-between mb-6">
                                    <div class="flex items-center space-x-3">
                                        <h4 class="text-xl font-semibold text-white">Intelligent Contact Matrix</h4>
                                        <div class="flex items-center space-x-2 bg-blue-500/20 px-3 py-1 rounded-lg">
                                            <i class="fas fa-sync-alt text-blue-400 text-xs animate-spin"></i>
                                            <span class="text-blue-300 text-xs font-medium">Live Sync</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center space-x-3">
                                        <div class="flex items-center space-x-2">
                                            <button onclick="toggleContactView('grid')" class="p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors">
                                                <i class="fas fa-th text-white/70 hover:text-white"></i>
                                            </button>
                                            <button onclick="toggleContactView('list')" class="p-2 bg-blue-600 rounded-lg">
                                                <i class="fas fa-list text-white"></i>
                                            </button>
                                        </div>
                                        <div class="relative">
                                            <input type="text" id="contactSearch" placeholder="Search by name, role, department..." 
                                                   class="bg-black/20 border border-white/20 rounded-lg px-4 py-2 pl-10 pr-20 text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 w-64">
                                            <i class="fas fa-search absolute left-3 top-3 text-white/50"></i>
                                            <div class="absolute right-2 top-2 flex items-center space-x-1">
                                                <button class="p-1 hover:bg-white/10 rounded">
                                                    <i class="fas fa-filter text-white/50 text-xs"></i>
                                                </button>
                                                <button class="p-1 hover:bg-white/10 rounded">
                                                    <i class="fas fa-sort text-white/50 text-xs"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <select id="contactFilter" class="bg-black/20 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="all">All Contacts</option>
                                            <option value="citizens">Citizens</option>
                                            <option value="officials">Government Officials</option>
                                            <option value="vendors">Verified Vendors</option>
                                            <option value="contractors">Licensed Contractors</option>
                                            <option value="high-value">High-Value Contacts</option>
                                            <option value="recent">Recent Activity</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Enhanced Contact Table -->
                                <div class="overflow-hidden rounded-xl border border-white/10">
                                    <div class="overflow-x-auto max-h-96">
                                        <table class="w-full">
                                            <thead class="bg-black/30 sticky top-0">
                                                <tr>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">
                                                        <div class="flex items-center space-x-2">
                                                            <input type="checkbox" class="rounded border-white/30">
                                                            <span>Contact Profile</span>
                                                        </div>
                                                    </th>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">Classification</th>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">Department/Org</th>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">Engagement</th>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">Status</th>
                                                    <th class="text-left py-4 px-6 text-white/70 font-semibold text-sm border-b border-white/10">Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="contactsTableBody" class="divide-y divide-white/5">
                                                <!-- Contacts will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    
    <!-- New Request Modal -->
    <div id="newRequestModal" class="modal">
        <div class="glass rounded-2xl p-8 max-w-3xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-2xl font-bold text-white">Submit New Service Request</h3>
                <button onclick="closeNewRequestModal()" class="text-white/60 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="newRequestForm" class="space-y-6">
                <!-- Service Type -->
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Service Type *</label>
                    <select id="serviceType" required class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select a service...</option>
                        <optgroup label="Permits & Licenses">
                            <option value="building_permit">Building Permit</option>
                            <option value="renovation_permit">Renovation Permit</option>
                            <option value="business_license">Business License</option>
                            <option value="event_permit">Event Permit</option>
                            <option value="sign_permit">Sign Permit</option>
                        </optgroup>
                        <optgroup label="Public Services">
                            <option value="pothole_repair">Pothole Repair</option>
                            <option value="streetlight_issue">Streetlight Issue</option>
                            <option value="tree_service">Tree Service Request</option>
                            <option value="trash_pickup">Trash/Recycling Issue</option>
                            <option value="water_sewer">Water/Sewer Issue</option>
                        </optgroup>
                        <optgroup label="Code Enforcement">
                            <option value="noise_complaint">Noise Complaint</option>
                            <option value="property_maintenance">Property Maintenance</option>
                            <option value="zoning_violation">Zoning Violation</option>
                        </optgroup>
                        <optgroup label="Other">
                            <option value="tax_inquiry">Tax Inquiry</option>
                            <option value="general_inquiry">General Inquiry</option>
                            <option value="document_request">Document Request</option>
                        </optgroup>
                    </select>
                    <div id="aiSuggestion" class="mt-2 text-sm text-blue-300 hidden">
                        <i class="fas fa-lightbulb mr-1"></i>
                        <span id="aiSuggestionText"></span>
                    </div>
                </div>

                <!-- Intelligent Document Processing - Added 2025-10-18 -->
                <div class="glass rounded-xl p-6 bg-gradient-to-r from-purple-600/10 to-blue-600/10">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h4 class="text-lg font-bold text-white flex items-center gap-2">
                                <i class="fas fa-magic text-purple-400"></i>
                                Speed Up Your Application with AI
                            </h4>
                            <p class="text-sm text-white/70 mt-1">Upload your building permit or documents - AI will auto-detect and extract information</p>
                        </div>
                        <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-full">
                            <i class="fas fa-shield-alt mr-1"></i>97.8% Accurate
                        </span>
                    </div>

                    <!-- Document Upload Zone -->
                    <div id="docProcessingDropZone" class="border-2 border-dashed border-white/30 rounded-lg p-8 text-center cursor-pointer hover:border-blue-400 hover:bg-blue-500/5 transition-all" role="button" tabindex="0" aria-label="Upload documents for auto-fill">
                        <i class="fas fa-file-upload text-4xl text-white/30 mb-3" aria-hidden="true"></i>
                        <p class="text-white font-medium mb-2">Upload Documents to Auto-fill</p>
                        <p class="text-sm text-white/60 mb-3">Building Permits, Driver's License, Utility Bills, Business Cards, or Previous Applications</p>
                        <div class="flex items-center justify-center gap-2 mb-3">
                            <span class="text-xs bg-blue-500/20 text-blue-300 px-2 py-1 rounded-full">PDF</span>
                            <span class="text-xs bg-green-500/20 text-green-300 px-2 py-1 rounded-full">JPG</span>
                            <span class="text-xs bg-purple-500/20 text-purple-300 px-2 py-1 rounded-full">PNG</span>
                            <span class="text-xs bg-yellow-500/20 text-yellow-300 px-2 py-1 rounded-full">TIFF</span>
                        </div>
                        <button type="button" onclick="document.getElementById('docProcessingFileInput').click()" class="bg-gradient-to-r from-blue-500 to-purple-600 px-4 py-2 rounded-lg text-white text-sm hover:shadow-lg transition-all" aria-label="Upload document">
                            <i class="fas fa-cloud-upload-alt mr-2" aria-hidden="true"></i>Choose File
                        </button>
                        <input type="file" id="docProcessingFileInput" class="hidden" accept=".pdf,.jpg,.jpeg,.png,.tiff" aria-label="Select documents to upload">
                    </div>

                    <!-- Processing Status -->
                    <div id="docProcessingStatus" class="mt-4 hidden">
                        <div class="space-y-2 mb-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-white/80">Analyzing document structure...</span>
                                <span id="docStage1" class="text-white/40"><i class="fas fa-circle text-xs"></i></span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-white/80">Detecting form type...</span>
                                <span id="docStage2" class="text-white/40"><i class="fas fa-circle text-xs"></i></span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-white/80">Extracting fields...</span>
                                <span id="docStage3" class="text-white/40"><i class="fas fa-circle text-xs"></i></span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-white/80">Validating data...</span>
                                <span id="docStage4" class="text-white/40"><i class="fas fa-circle text-xs"></i></span>
                            </div>
                        </div>
                        <div class="w-full bg-white/10 rounded-full h-2 overflow-hidden">
                            <div id="docProcessingProgressBar" class="bg-gradient-to-r from-blue-500 to-purple-600 h-full transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Document Classification Result -->
                    <div id="docClassificationResult" class="mt-4 hidden">
                        <div class="glass rounded-lg p-4 mb-3 bg-green-500/10">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-check-circle text-green-400"></i>
                                    <span class="text-sm font-bold text-white">Document Identified:</span>
                                    <span id="docDetectedType" class="text-sm text-green-400"></span>
                                </div>
                                <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-full" id="docTypeConfidence"></span>
                            </div>
                            <div class="text-xs text-white/60" id="docPages"></div>
                        </div>
                    </div>

                    <!-- Extracted Data Review -->
                    <div id="docProcessingExtractedPanel" class="mt-4 hidden">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-list-check text-blue-400"></i>
                                <span class="text-sm font-bold text-white">Extracted <span id="docProcessingFieldCount">0</span> Fields</span>
                            </div>
                            <button type="button" onclick="autoFillFromDocument()" class="text-sm bg-gradient-to-r from-blue-500 to-purple-600 px-4 py-2 rounded-lg text-white hover:shadow-lg transition-all" aria-label="Auto-fill form with extracted data">
                                <i class="fas fa-bolt mr-1" aria-hidden="true"></i>Auto-fill Form
                            </button>
                        </div>
                        <div id="docProcessingFields" class="space-y-2 bg-white/5 rounded-lg p-3 max-h-48 overflow-y-auto">
                            <!-- Extracted fields preview -->
                        </div>
                        <div class="mt-3 text-xs text-white/50 flex items-center justify-between">
                            <span><i class="fas fa-info-circle mr-1"></i>Review extracted data before auto-filling</span>
                            <button type="button" onclick="viewFullDocumentAnalysis()" class="text-blue-400 hover:text-blue-300">
                                View Full Analysis <i class="fas fa-external-link-alt ml-1"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">First Name *</label>
                        <input type="text" id="firstName" required class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter first name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">Last Name *</label>
                        <input type="text" id="lastName" required class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter last name">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">Email Address *</label>
                        <input type="email" id="email" required class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="your@email.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-white mb-2">Phone Number</label>
                        <input type="tel" id="phone" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="(555) 123-4567">
                    </div>
                </div>

                <!-- Address -->
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Property/Service Address</label>
                    <input type="text" id="address" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="123 Main Street, City, State ZIP">
                </div>

                <!-- Description -->
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Description *</label>
                    <textarea id="description" required rows="4" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-3 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please describe your request in detail..."></textarea>
                    <div class="text-xs text-white/60 mt-1">
                        <span id="charCount">0</span>/500 characters
                    </div>
                </div>

                <!-- Urgency -->
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Priority Level</label>
                    <div class="grid grid-cols-3 gap-3">
                        <label class="flex items-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors">
                            <input type="radio" name="priority" value="low" class="mr-2" checked>
                            <div>
                                <div class="text-green-400 font-medium">Low</div>
                                <div class="text-xs text-white/70">Standard processing</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors">
                            <input type="radio" name="priority" value="medium" class="mr-2">
                            <div>
                                <div class="text-yellow-400 font-medium">Medium</div>
                                <div class="text-xs text-white/70">Expedited review</div>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white/5 rounded-lg cursor-pointer hover:bg-white/10 transition-colors">
                            <input type="radio" name="priority" value="high" class="mr-2">
                            <div>
                                <div class="text-red-400 font-medium">High</div>
                                <div class="text-xs text-white/70">Urgent attention</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- File Upload -->
                <div>
                    <label class="block text-sm font-medium text-white mb-2">Attachments</label>
                    <div class="border-2 border-dashed border-white/20 rounded-lg p-6 text-center hover:border-white/40 transition-colors">
                        <i class="fas fa-cloud-upload-alt text-3xl text-white/40 mb-2"></i>
                        <p class="text-white/70 mb-2">Drag and drop files here, or click to browse</p>
                        <p class="text-xs text-white/50">Maximum 5 files, 10MB each. PDF, JPG, PNG, DOC supported.</p>
                        <input type="file" id="fileUpload" multiple class="hidden" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                        <button type="button" onclick="document.getElementById('fileUpload').click()" class="mt-3 bg-white/10 text-white px-4 py-2 rounded-lg hover:bg-white/20 transition-colors">
                            Choose Files
                        </button>
                    </div>
                    <div id="fileList" class="mt-3 space-y-2"></div>
                </div>

                <!-- AI Routing Preview -->
                <div id="routingPreview" class="bg-gradient-to-r from-blue-500/20 to-green-500/20 rounded-lg p-4 hidden">
                    <div class="flex items-center space-x-2 mb-2">
                        <i class="fas fa-robot text-blue-400"></i>
                        <span class="text-white font-medium">AI Routing Suggestion</span>
                    </div>
                    <div id="routingInfo" class="text-sm text-white/80"></div>
                </div>

                <!-- Submit Buttons -->
                <div class="flex justify-end space-x-4 pt-4 border-t border-white/20">
                    <button type="button" onclick="closeNewRequestModal()" class="px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="px-6 py-3 bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-lg hover:shadow-lg transition-all">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Request
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Enhanced Workflow Builder Modal -->
    <div id="workflowModal" class="modal">
        <div class="glass rounded-2xl p-8 max-w-6xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-magic text-white"></i>
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-white">AI-Powered Workflow Builder</h3>
                        <p class="text-sm text-white/70">Create intelligent, automated government processes</p>
                    </div>
                </div>
                <button onclick="closeModal()" class="text-white/60 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- AI Assistant Section -->
            <div class="bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-xl p-4 mb-6">
                <div class="flex items-center space-x-3 mb-3">
                    <i class="fas fa-robot text-blue-400"></i>
                    <span class="text-white font-medium">AI Workflow Assistant</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button onclick="generateWorkflowSuggestion('approval')" class="text-left p-3 bg-white/10 rounded-lg hover:bg-white/20 transition-colors">
                        <div class="text-sm font-medium text-white">Smart Approval Chain</div>
                        <div class="text-xs text-white/70">Auto-route based on amount/type</div>
                    </button>
                    <button onclick="generateWorkflowSuggestion('notification')" class="text-left p-3 bg-white/10 rounded-lg hover:bg-white/20 transition-colors">
                        <div class="text-sm font-medium text-white">Intelligent Notifications</div>
                        <div class="text-xs text-white/70">Multi-channel alerts & reminders</div>
                    </button>
                    <button onclick="generateWorkflowSuggestion('escalation')" class="text-left p-3 bg-white/10 rounded-lg hover:bg-white/20 transition-colors">
                        <div class="text-sm font-medium text-white">Auto-Escalation</div>
                        <div class="text-xs text-white/70">Time-based priority handling</div>
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Configuration Panel -->
                <div>
                    <h4 class="text-lg font-semibold text-white mb-4">Workflow Configuration</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Workflow Name *</label>
                            <input type="text" id="workflowName" placeholder="Enter descriptive workflow name"
                                   class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="text-xs text-white/60 mt-1">Use clear, descriptive names (e.g., "Building Permit Review Process")</div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Department *</label>
                            <select id="department" onchange="updateDepartmentTemplates()" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Department</option>
                                <option value="permits">Building & Permits</option>
                                <option value="tax">Tax & Finance</option>
                                <option value="public_works">Public Works</option>
                                <option value="health">Health Department</option>
                                <option value="planning">Planning & Zoning</option>
                                <option value="legal">Legal Department</option>
                                <option value="hr">Human Resources</option>
                                <option value="it">IT Services</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Workflow Type</label>
                            <select id="workflowType" onchange="updateWorkflowSuggestions()" class="w-full bg-white/10 border border-white/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Type</option>
                                <option value="approval">Approval Process</option>
                                <option value="review">Review & Inspection</option>
                                <option value="application">Application Processing</option>
                                <option value="complaint">Complaint Handling</option>
                                <option value="maintenance">Maintenance Request</option>
                                <option value="compliance">Compliance Check</option>
                                <option value="emergency">Emergency Response</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">Priority Level</label>
                            <div class="grid grid-cols-3 gap-2">
                                <label class="flex items-center p-2 bg-white/5 rounded cursor-pointer hover:bg-white/10">
                                    <input type="radio" name="priority" value="low" class="mr-2 text-blue-500" checked>
                                    <span class="text-white text-sm">Low</span>
                                </label>
                                <label class="flex items-center p-2 bg-white/5 rounded cursor-pointer hover:bg-white/10">
                                    <input type="radio" name="priority" value="medium" class="mr-2 text-blue-500">
                                    <span class="text-white text-sm">Medium</span>
                                </label>
                                <label class="flex items-center p-2 bg-white/5 rounded cursor-pointer hover:bg-white/10">
                                    <input type="radio" name="priority" value="high" class="mr-2 text-blue-500">
                                    <span class="text-white text-sm">High</span>
                                </label>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-white mb-2">SLA (Service Level Agreement)</label>
                            <div class="grid grid-cols-2 gap-2">
                                <input type="number" id="slaHours" placeholder="Hours" min="1" max="168" 
                                       class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <select id="slaUnit" class="bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="hours">Hours</option>
                                    <option value="days">Business Days</option>
                                    <option value="weeks">Weeks</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- AI Optimization Suggestions -->
                    <div id="aiSuggestions" class="mt-6 p-4 bg-green-500/20 rounded-lg hidden">
                        <div class="flex items-center space-x-2 mb-3">
                            <i class="fas fa-lightbulb text-green-400"></i>
                            <span class="text-green-300 font-medium">AI Optimization Suggestions</span>
                        </div>
                        <div id="suggestionsList" class="space-y-2 text-sm text-white/80">
                            <!-- Suggestions will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Workflow Steps Builder -->
                <div>
                    <div class="flex items-center justify-between mb-4">
                        <h4 class="text-lg font-semibold text-white">Workflow Steps</h4>
                        <div class="flex space-x-2">
                            <button onclick="showStepLibrary()" class="text-xs bg-purple-600 text-white px-3 py-1 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-book mr-1"></i>Step Library
                            </button>
                            <button onclick="optimizeWorkflow()" class="text-xs bg-blue-600 text-white px-3 py-1 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-magic mr-1"></i>AI Optimize
                            </button>
                        </div>
                    </div>
                    
                    <div id="workflowStepsBuilder" class="space-y-3 max-h-80 overflow-y-auto mb-4">
                        <!-- Steps will be added dynamically -->
                    </div>
                    
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="addWorkflowStep()" class="bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-plus mr-2"></i>Add Step
                        </button>
                        <button onclick="addConditionalStep()" class="bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 transition-colors">
                            <i class="fas fa-code-branch mr-2"></i>Add Condition
                        </button>
                    </div>

                    <!-- Workflow Validation -->
                    <div id="workflowValidation" class="mt-4 p-3 bg-yellow-500/20 rounded-lg hidden">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-exclamation-triangle text-yellow-400"></i>
                            <span class="text-yellow-300 font-medium">Workflow Validation</span>
                        </div>
                        <div id="validationIssues" class="text-sm text-white/80">
                            <!-- Validation issues will be shown here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workflow Preview & Testing -->
            <div class="mt-8 p-6 bg-black/20 rounded-xl">
                <div class="flex items-center justify-between mb-4">
                    <h4 class="text-lg font-semibold text-white">Workflow Preview</h4>
                    <div class="flex space-x-2">
                        <button onclick="testWorkflow()" class="text-sm bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-play mr-2"></i>Test Run
                        </button>
                        <button onclick="exportWorkflow()" class="text-sm bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-download mr-2"></i>Export
                        </button>
                    </div>
                </div>
                <div id="workflowPreviewCanvas" class="min-h-[200px] bg-white/5 rounded-lg flex items-center justify-center">
                    <div class="text-white/60 text-center">
                        <i class="fas fa-sitemap text-4xl mb-4"></i>
                        <p>Add workflow steps to see preview</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-end space-x-4 mt-8 pt-4 border-t border-white/20">
                <button onclick="closeModal()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                    Cancel
                </button>
                <button onclick="saveWorkflowDraft()" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    Save Draft
                </button>
                <button onclick="saveWorkflow()" class="px-6 py-2 bg-gradient-to-r from-green-500 to-blue-600 text-white rounded-lg hover:shadow-lg transition-all">
                    <i class="fas fa-rocket mr-2"></i>Deploy Workflow
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Global state
        let selectedWorkflow = null;
        let workflowStepCount = 0;
        let currentWorkflowSteps = [];
        
        // CRM Data
        let crmContacts = [
            {
                id: 1,
                name: "Sarah Johnson",
                email: "sarah.johnson@citymail.gov",
                type: "citizen",
                department: "Public Works",
                lastContact: "2024-01-15",
                status: "active",
                phone: "(555) 123-4567",
                address: "123 Oak Street, Downtown",
                notes: "Regular participant in town halls, environmental advocate"
            },
            {
                id: 2,
                name: "Detective Michael Chen",
                email: "m.chen@police.gov",
                type: "official",
                department: "Police Department",
                lastContact: "2024-01-18",
                status: "active",
                phone: "(555) 234-5678",
                address: "Police Headquarters",
                notes: "Lead investigator for fraud cases, CJIS certified"
            },
            {
                id: 3,
                name: "TechCorp Solutions",
                email: "contracts@techcorp.com",
                type: "vendor",
                department: "IT Services",
                lastContact: "2024-01-12",
                status: "active",
                phone: "(555) 345-6789",
                address: "456 Business Blvd",
                notes: "Primary IT contractor, FedRAMP High certified"
            },
            {
                id: 4,
                name: "Jennifer Martinez",
                email: "j.martinez@contractor.com",
                type: "contractor",
                department: "Infrastructure",
                lastContact: "2024-01-10",
                status: "inactive",
                phone: "(555) 456-7890",
                address: "789 Construction Way",
                notes: "Civil engineer, infrastructure planning specialist"
            },
            {
                id: 5,
                name: "Robert Wilson",
                email: "robert.wilson@residents.gov",
                type: "citizen",
                department: "Community Services",
                lastContact: "2024-01-17",
                status: "active",
                phone: "(555) 567-8901",
                address: "321 Maple Avenue",
                notes: "Community volunteer, frequent service requests"
            }
        ];
        let workflowLibrary = {
            stepTypes: {
                'input': { name: 'Data Input', icon: 'fas fa-keyboard', description: 'Collect information from forms or APIs' },
                'validation': { name: 'Validation', icon: 'fas fa-check-circle', description: 'Verify data accuracy and completeness' },
                'approval': { name: 'Approval', icon: 'fas fa-user-check', description: 'Route for human or automated approval' },
                'notification': { name: 'Notification', icon: 'fas fa-bell', description: 'Send alerts via email, SMS, or system' },
                'decision': { name: 'Decision Point', icon: 'fas fa-code-branch', description: 'Conditional logic based on criteria' },
                'assignment': { name: 'Task Assignment', icon: 'fas fa-user-tag', description: 'Assign work to specific users or roles' },
                'calculation': { name: 'Calculation', icon: 'fas fa-calculator', description: 'Perform mathematical or logical operations' },
                'integration': { name: 'System Integration', icon: 'fas fa-link', description: 'Connect with external systems or databases' },
                'document': { name: 'Document Generation', icon: 'fas fa-file-alt', description: 'Create reports, certificates, or forms' },
                'doc_processing': { name: 'Document Processing (AI)', icon: 'fas fa-magic', description: 'AI-powered OCR extraction and auto-fill (CJIS Compliant)' },
                'escalation': { name: 'Escalation', icon: 'fas fa-exclamation-triangle', description: 'Auto-escalate based on time or conditions' },
                'archive': { name: 'Archive/Store', icon: 'fas fa-archive', description: 'Store completed work or documents' },
                'completion': { name: 'Completion', icon: 'fas fa-flag-checkered', description: 'Final step and closure notifications' }
            },
            bestPractices: {
                'approval': [
                    'Add timeout escalation for approvals',
                    'Include delegation when approvers are unavailable',
                    'Send reminder notifications before deadline',
                    'Log all approval decisions with timestamps'
                ],
                'notification': [
                    'Use multiple channels for critical notifications',
                    'Include relevant case information in messages',
                    'Set delivery confirmation requirements',
                    'Personalize messages with recipient names'
                ],
                'escalation': [
                    'Define clear escalation criteria and timeframes',
                    'Notify all relevant parties of escalations',
                    'Include escalation history in case records',
                    'Set automatic supervisor notifications'
                ],
                'doc_processing': [
                    'Set confidence thresholds (High: >85%, Medium: 70-85%, Low: <70%)',
                    'Route low-confidence extractions for manual review',
                    'Enable PII detection and masking for sensitive documents',
                    'Configure document type templates for common forms',
                    'Set up CJIS-compliant audit logging for all document access',
                    'Enable duplicate detection to prevent reprocessing',
                    'Test OCR accuracy with sample documents before deployment'
                ]
            }
        };
        let userRequests = [
            {
                id: 'REQ-2024-001',
                type: 'Building Permit',
                description: 'Deck addition to rear of property',
                status: 'Under Review',
                statusColor: 'yellow',
                date: '2024-01-15',
                department: 'Building & Safety',
                priority: 'medium'
            },
            {
                id: 'REQ-2024-002',
                type: 'Business License',
                description: 'New restaurant license application',
                status: 'Approved',
                statusColor: 'green',
                date: '2024-01-10',
                department: 'Business Licensing',
                priority: 'low'
            },
            {
                id: 'REQ-2024-003',
                type: 'Pothole Repair',
                description: 'Large pothole on Oak Street near 5th Ave',
                status: 'In Progress',
                statusColor: 'blue',
                date: '2024-01-20',
                department: 'Public Works',
                priority: 'high'
            },
            {
                id: 'REQ-2024-004',
                type: 'Tree Service',
                description: 'Dead tree removal from front yard',
                status: 'Pending',
                statusColor: 'gray',
                date: '2024-01-22',
                department: 'Parks & Recreation',
                priority: 'low'
            },
            {
                id: 'REQ-2024-005',
                type: 'Noise Complaint',
                description: 'Loud construction work after hours',
                status: 'Resolved',
                statusColor: 'green',
                date: '2024-01-18',
                department: 'Code Enforcement',
                priority: 'medium'
            }
        ];
        
        // Workflow templates
        const workflowTemplates = [
            {
                id: 'permit',
                name: 'Permit Processing',
                icon: 'fas fa-file-signature',
                color: 'from-blue-500 to-cyan-500',
                description: 'Automate permit applications and approvals',
                steps: [
                    'Receive permit application',
                    'Validate required documents',
                    'Route to appropriate department',
                    'Conduct automated compliance checks',
                    'Schedule inspections if needed',
                    'Generate approval/denial notification',
                    'Update public records'
                ]
            },
            {
                id: 'tax',
                name: 'Tax Assessment',
                icon: 'fas fa-calculator',
                color: 'from-green-500 to-teal-500',
                description: 'Streamline tax calculation and collection',
                steps: [
                    'Import property data',
                    'Calculate assessed values',
                    'Apply tax rates and exemptions',
                    'Generate tax bills',
                    'Send notifications to taxpayers',
                    'Process payments',
                    'Handle appeals if necessary'
                ]
            },
            {
                id: 'complaint',
                name: 'Complaint Handling',
                icon: 'fas fa-exclamation-triangle',
                color: 'from-yellow-500 to-orange-500',
                description: 'Manage and resolve citizen complaints',
                steps: [
                    'Log complaint details',
                    'Categorize by department and priority',
                    'Assign to appropriate staff',
                    'Send acknowledgment to citizen',
                    'Track resolution progress',
                    'Notify citizen of resolution',
                    'Close case and update records'
                ]
            },
            {
                id: 'license',
                name: 'Business Licensing',
                icon: 'fas fa-certificate',
                color: 'from-purple-500 to-indigo-500',
                description: 'Process business license applications',
                steps: [
                    'Receive license application',
                    'Verify business information',
                    'Check zoning compliance',
                    'Process fee payments',
                    'Conduct background checks',
                    'Issue license or request corrections',
                    'Schedule renewal reminders'
                ]
            }
        ];
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize real API modules
            initializeDashboard(); // Load real dashboard stats

            // Initialize mock data functions (to be replaced)
            initializeWorkflowTemplates();
            populateRecentActivity();
            populateRecentRequests();
            populateCitizenRequests();
            startTypingAnimation();
            initializeNewRequestForm();
            updateCitizenCounter();
            initializeDocumentProcessing(); // Added 2025-10-18: Intelligent Document Processing
        });

        function updateCitizenCounter() {
            document.getElementById('userRequestCountCitizen').textContent = userRequests.length;
        }

        // Track which groups were opened by hover vs click
        const hoverOpenedGroups = new Set();

        // Navigation group toggle functionality
        function toggleGroup(groupId, source = 'click') {
            const groupElement = document.querySelector(`[data-group="${groupId}"]`);
            const itemsContainer = document.getElementById(`group-${groupId}`);
            const chevron = groupElement.querySelector('.group-chevron');
            const button = groupElement.querySelector('.nav-group-header');

            if (!groupElement || !itemsContainer) return;

            // Get current state
            const isExpanded = button.getAttribute('aria-expanded') === 'true';

            // Toggle state
            if (isExpanded) {
                // Collapse
                itemsContainer.style.maxHeight = '0';
                itemsContainer.style.opacity = '0';
                button.setAttribute('aria-expanded', 'false');
                chevron.style.transform = 'rotate(-90deg)';
                hoverOpenedGroups.delete(groupId);
            } else {
                // Expand
                itemsContainer.style.maxHeight = '500px';
                itemsContainer.style.opacity = '1';
                button.setAttribute('aria-expanded', 'true');
                chevron.style.transform = 'rotate(0deg)';

                // Track if this was opened by hover
                if (source === 'hover') {
                    hoverOpenedGroups.add(groupId);
                } else {
                    hoverOpenedGroups.delete(groupId);
                }
            }

            // Only save to localStorage if triggered by click (not hover)
            if (source === 'click') {
                saveNavigationState(groupId, !isExpanded);
            }
        }

        // Expand group on hover (desktop only)
        function expandGroupOnHover(groupId) {
            const groupElement = document.querySelector(`[data-group="${groupId}"]`);
            const button = groupElement?.querySelector('.nav-group-header');
            const isExpanded = button?.getAttribute('aria-expanded') === 'true';

            // Only expand if not already expanded
            if (!isExpanded) {
                toggleGroup(groupId, 'hover');
            }
        }

        // Collapse group when mouse leaves (only if opened by hover)
        function collapseGroupOnLeave(groupId) {
            const groupElement = document.querySelector(`[data-group="${groupId}"]`);
            const button = groupElement?.querySelector('.nav-group-header');
            const isExpanded = button?.getAttribute('aria-expanded') === 'true';

            // Only collapse if currently expanded AND was opened by hover (not clicked/pinned)
            if (isExpanded && hoverOpenedGroups.has(groupId)) {
                toggleGroup(groupId, 'hover');
            }
        }

        // Save navigation state to localStorage
        function saveNavigationState(groupId, isExpanded) {
            const navState = JSON.parse(localStorage.getItem('govli-nav-state') || '{}');
            navState[groupId] = isExpanded;
            localStorage.setItem('govli-nav-state', JSON.stringify(navState));
        }

        // Restore navigation state from localStorage
        function restoreNavigationState() {
            const navState = JSON.parse(localStorage.getItem('govli-nav-state') || '{}');

            // Default: Command Center expanded
            if (Object.keys(navState).length === 0) {
                navState['command-center'] = true;
            }

            // Apply saved states
            Object.keys(navState).forEach(groupId => {
                const isExpanded = navState[groupId];
                const groupElement = document.querySelector(`[data-group="${groupId}"]`);

                if (groupElement) {
                    const itemsContainer = document.getElementById(`group-${groupId}`);
                    const chevron = groupElement.querySelector('.group-chevron');
                    const button = groupElement.querySelector('.nav-group-header');

                    if (isExpanded) {
                        itemsContainer.style.maxHeight = '500px';
                        itemsContainer.style.opacity = '1';
                        button.setAttribute('aria-expanded', 'true');
                        chevron.style.transform = 'rotate(0deg)';
                    } else {
                        itemsContainer.style.maxHeight = '0';
                        itemsContainer.style.opacity = '0';
                        button.setAttribute('aria-expanded', 'false');
                        chevron.style.transform = 'rotate(-90deg)';
                    }
                }
            });
        }

        // Detect if device supports touch (mobile/tablet)
        function isTouchDevice() {
            return (('ontouchstart' in window) ||
                    (navigator.maxTouchPoints > 0) ||
                    (navigator.msMaxTouchPoints > 0));
        }

        // Setup hover-to-expand navigation (desktop only)
        function setupHoverNavigation() {
            // Skip hover behavior on touch devices
            if (isTouchDevice()) {
                console.log('Touch device detected - using click-only navigation');
                return;
            }

            console.log('Desktop device detected - enabling hover navigation');

            // Add hover listeners to all nav groups
            document.querySelectorAll('.nav-group').forEach(group => {
                const groupId = group.getAttribute('data-group');

                // Expand on hover
                group.addEventListener('mouseenter', function() {
                    expandGroupOnHover(groupId);
                });

                // Collapse on mouse leave (only if opened by hover)
                group.addEventListener('mouseleave', function() {
                    collapseGroupOnLeave(groupId);
                });
            });
        }

        // Keyboard navigation support for accessibility
        function setupKeyboardNavigation() {
            // Handle Enter/Space on nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        item.click();
                    }
                });
            });

            // Handle Enter/Space on nav item highlighted (Citizen Portal)
            document.querySelectorAll('.nav-item-highlighted').forEach(item => {
                item.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        item.click();
                    }
                });
            });

            // Handle Enter/Space on group headers
            document.querySelectorAll('.nav-group-header').forEach(header => {
                header.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const groupElement = header.closest('.nav-group');
                        const groupId = groupElement.getAttribute('data-group');
                        toggleGroup(groupId, 'click');
                    }
                });
            });
        }

        // Initialize navigation state on page load
        document.addEventListener('DOMContentLoaded', function() {
            restoreNavigationState();
            setupKeyboardNavigation();
            setupHoverNavigation(); // Enable hover on desktop only
        });

        // Tab switching
        function switchTab(tabName, event) {
            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            if (event && event.target) {
                const navItem = event.target.closest('.nav-item');
                if (navItem) {
                    navItem.classList.add('active');
                }
            }
            
            // Hide all content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show selected content
            document.getElementById(tabName + '-content').style.display = 'block';
            
            // Update header
            const titles = {
                dashboard: { title: 'Admin Dashboard', subtitle: 'System monitoring and workflow management' },
                citizen: { title: 'Citizen Portal', subtitle: 'Submit requests, track applications, and access city services' },
                workflows: { title: 'Workflow Management', subtitle: 'Create and manage automated processes' },
                security: { title: 'Security Analysis', subtitle: 'Threat detection and vulnerability assessment' },
                analytics: { title: 'System Analytics', subtitle: 'Performance metrics and insights' },
                compliance: { title: 'Compliance Monitor', subtitle: 'Regulatory compliance tracking' },
                grants: { title: 'Grant Management', subtitle: 'AI-powered federal grant discovery and workflow management' },
                crm: { title: 'CRM Management', subtitle: 'AI-powered customer relationship management with CJIS compliance' },
                intelligence: { title: 'Platform Intelligence Hub', subtitle: 'Unified AI insights and actions across all platform sections' },
                'api-integration': { title: 'API Integration Platform', subtitle: 'CJIS-compliant API discovery, transformation & orchestration for government systems' },
                'constituent-inbox': { title: 'Universal Constituent Inbox', subtitle: 'AI-powered multi-channel message classification and routing' },
                settings: { title: 'System Settings', subtitle: 'Configure platform preferences' }
            };
            
            document.getElementById('pageTitle').textContent = titles[tabName].title;
            document.getElementById('pageSubtitle').textContent = titles[tabName].subtitle;
            
            // Initialize specific tab functionality
            if (tabName === 'dashboard' && document.getElementById('dashboard-content')) {
                initializeDashboard();
            }
            if (tabName === 'analytics' && document.getElementById('activityFeed')) {
                initializeAnalytics();
            }
            if (tabName === 'crm' && document.getElementById('contactsTableBody')) {
                initializeCRM();
            }
            if (tabName === 'grants' && document.getElementById('grantSearchResults')) {
                initializeGrants();
            }
            if (tabName === 'compliance' && document.getElementById('blockchainAuditTrail')) {
                initializeBlockchain();
            }
            if (tabName === 'compliance' && document.getElementById('policyIntelligenceCenter')) {
                initializePolicyIntelligence();
            }
            if (tabName === 'citizen' && document.getElementById('regulationAssistant')) {
                initializeRegulationAssistant();
            }
            if (tabName === 'security' && document.getElementById('quantumSecurityModule')) {
                initializeQuantumSecurity();
            }
            if (tabName === 'constituent-inbox' && document.getElementById('inboxMessagesList')) {
                initializeConstituentInbox();
            }
        }

        // Enhanced 2024-10-30: Switch between security modules
        function switchSecurityModule(moduleName) {
            // Hide all security modules
            document.querySelectorAll('.security-module-content').forEach(module => {
                module.classList.remove('active');
                module.classList.add('hidden');
            });

            // Remove active class from all security tabs
            document.querySelectorAll('.security-module-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected module
            const selectedModule = document.getElementById('security-module-' + moduleName);
            if (selectedModule) {
                selectedModule.classList.add('active');
                selectedModule.classList.remove('hidden');
            }

            // Add active class to selected tab
            const selectedTab = document.querySelector('[data-security-module="' + moduleName + '"]');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }

        // Initialize workflow templates
        function initializeWorkflowTemplates() {
            const container = document.getElementById('workflowTemplates');
            if (!container) return;
            
            container.innerHTML = workflowTemplates.map(template => `
                <div class="workflow-card glass rounded-xl p-6 text-center" onclick="selectWorkflow('${template.id}')">
                    <div class="w-16 h-16 bg-gradient-to-r ${template.color} rounded-xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                        <i class="${template.icon} text-2xl text-white"></i>
                    </div>
                    <h4 class="font-bold text-lg mb-2 text-white">${template.name}</h4>
                    <p class="text-sm text-white/70 mb-4">${template.description}</p>
                    <div class="text-xs text-blue-300">
                        <i class="fas fa-list mr-1"></i>${template.steps.length} automated steps
                    </div>
                </div>
            `).join('');
        }
        
        // Select workflow
        function selectWorkflow(workflowId) {
            document.querySelectorAll('.workflow-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            event.target.closest('.workflow-card').classList.add('selected');
            selectedWorkflow = workflowTemplates.find(w => w.id === workflowId);
            
            showWorkflowPreview(selectedWorkflow);
        }
        
        // Show workflow preview
        function showWorkflowPreview(workflow) {
            const preview = document.getElementById('workflowPreview');
            const stepsContainer = document.getElementById('workflowSteps');
            
            stepsContainer.innerHTML = workflow.steps.map((step, index) => `
                <div class="flex items-center p-3 bg-white/5 rounded-lg mb-2">
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-3">
                        ${index + 1}
                    </div>
                    <span class="text-white">${step}</span>
                </div>
            `).join('');
            
            preview.style.display = 'block';
            preview.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Clear selection
        function clearSelection() {
            document.querySelectorAll('.workflow-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.getElementById('workflowPreview').style.display = 'none';
            selectedWorkflow = null;
        }
        
        // Deploy workflow
        function deployWorkflow() {
            if (!selectedWorkflow) return;
            
            addChatMessage(`ðŸš€ Deploying "${selectedWorkflow.name}" workflow... Setting up ${selectedWorkflow.steps.length} automated steps.`, 'ai');
            
            setTimeout(() => {
                addChatMessage(`âœ… Workflow "${selectedWorkflow.name}" deployed successfully! Now monitoring for new requests.`, 'ai');
                clearSelection();
            }, 2000);
        }
        
        // Modal functions
        function openWorkflowBuilder() {
            document.getElementById('workflowModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal() {
            document.getElementById('workflowModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }
        
        // Enhanced Workflow Builder Functions
        function addWorkflowStep(stepType = null) {
            workflowStepCount++;
            const stepsContainer = document.getElementById('workflowStepsBuilder');
            const stepDiv = document.createElement('div');
            stepDiv.className = 'workflow-step p-4 bg-white/5 rounded-lg border border-white/10 hover:bg-white/10 transition-colors';
            stepDiv.dataset.stepId = `step-${workflowStepCount}`;
            
            const stepTypeOptions = Object.keys(workflowLibrary.stepTypes).map(type => 
                `<option value="${type}" ${stepType === type ? 'selected' : ''}>${workflowLibrary.stepTypes[type].name}</option>`
            ).join('');
            
            stepDiv.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold flex-shrink-0">
                        ${workflowStepCount}
                    </div>
                    <div class="flex-1 space-y-3">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-white/80 mb-1">Step Type</label>
                                <select onchange="updateStepType(this)" class="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-sm text-white focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option value="">Select Type</option>
                                    ${stepTypeOptions}
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/80 mb-1">Assigned To</label>
                                <select class="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-sm text-white focus:outline-none focus:ring-1 focus:ring-blue-500">
                                    <option value="">Auto-assign</option>
                                    <option value="dept_head">Department Head</option>
                                    <option value="specialist">Subject Matter Expert</option>
                                    <option value="admin">System Administrator</option>
                                    <option value="external">External Reviewer</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-white/80 mb-1">Step Description</label>
                            <input type="text" placeholder="Describe what happens in this step..."
                                   class="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-sm text-white placeholder-white/60 focus:outline-none focus:ring-1 focus:ring-blue-500">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-white/80 mb-1">Time Limit</label>
                                <div class="flex space-x-1">
                                    <input type="number" placeholder="24" min="1" max="168" 
                                           class="flex-1 bg-white/10 border border-white/20 rounded px-2 py-1 text-xs text-white placeholder-white/60">
                                    <select class="bg-white/10 border border-white/20 rounded px-2 py-1 text-xs text-white">
                                        <option value="hours">hrs</option>
                                        <option value="days">days</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-white/80 mb-1">On Timeout</label>
                                <select class="w-full bg-white/10 border border-white/20 rounded px-2 py-1 text-xs text-white">
                                    <option value="escalate">Escalate</option>
                                    <option value="auto_approve">Auto-approve</option>
                                    <option value="notify">Notify only</option>
                                    <option value="reassign">Reassign</option>
                                </select>
                            </div>
                        </div>
                        <div class="step-conditions hidden bg-black/20 rounded p-3">
                            <label class="block text-xs font-medium text-white/80 mb-2">Conditions (if applicable)</label>
                            <textarea placeholder="Define conditions for this step (e.g., if amount > 1000, route to supervisor)"
                                      class="w-full bg-white/10 border border-white/20 rounded px-3 py-2 text-xs text-white placeholder-white/60 h-16"></textarea>
                        </div>
                    </div>
                    <div class="flex flex-col space-y-2">
                        <button onclick="duplicateStep(this)" class="text-blue-400 hover:text-blue-300 text-sm" title="Duplicate">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button onclick="moveStepUp(this)" class="text-green-400 hover:text-green-300 text-sm" title="Move Up">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button onclick="moveStepDown(this)" class="text-green-400 hover:text-green-300 text-sm" title="Move Down">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                        <button onclick="removeStep(this)" class="text-red-400 hover:text-red-300 text-sm" title="Remove">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            stepsContainer.appendChild(stepDiv);
            updateWorkflowPreview();
            
            // If stepType was provided, trigger the change event to load suggestions
            if (stepType) {
                const select = stepDiv.querySelector('select');
                updateStepType(select);
            }
        }

        function addConditionalStep() {
            addWorkflowStep('decision');
        }

        function updateStepType(selectElement) {
            const stepDiv = selectElement.closest('.workflow-step');
            const stepType = selectElement.value;
            const conditionsDiv = stepDiv.querySelector('.step-conditions');
            
            if (stepType === 'decision' || stepType === 'escalation') {
                conditionsDiv.classList.remove('hidden');
            } else {
                conditionsDiv.classList.add('hidden');
            }
            
            // Show AI suggestions for this step type
            if (stepType && workflowLibrary.bestPractices[stepType]) {
                showStepSuggestions(stepType, stepDiv);
            }
            
            updateWorkflowPreview();
        }

        function showStepSuggestions(stepType, stepDiv) {
            const suggestions = workflowLibrary.bestPractices[stepType];
            if (suggestions && suggestions.length > 0) {
                // Create or update suggestions tooltip
                let tooltip = stepDiv.querySelector('.step-suggestions');
                if (!tooltip) {
                    tooltip = document.createElement('div');
                    tooltip.className = 'step-suggestions absolute z-10 bg-blue-600 text-white text-xs rounded p-2 mt-1 max-w-xs shadow-lg';
                    tooltip.innerHTML = `
                        <div class="font-medium mb-1">ðŸ’¡ Best Practices:</div>
                        <ul class="list-disc list-inside space-y-1">
                            ${suggestions.map(s => `<li>${s}</li>`).join('')}
                        </ul>
                    `;
                    stepDiv.style.position = 'relative';
                    stepDiv.appendChild(tooltip);
                    
                    // Auto-hide after 5 seconds
                    setTimeout(() => {
                        if (tooltip.parentNode) {
                            tooltip.remove();
                        }
                    }, 5000);
                }
            }
        }

        function duplicateStep(button) {
            const stepDiv = button.closest('.workflow-step');
            const newStep = stepDiv.cloneNode(true);
            workflowStepCount++;
            
            // Update step number
            const stepNumber = newStep.querySelector('.bg-gradient-to-r');
            stepNumber.textContent = workflowStepCount;
            newStep.dataset.stepId = `step-${workflowStepCount}`;
            
            stepDiv.parentNode.insertBefore(newStep, stepDiv.nextSibling);
            updateWorkflowPreview();
        }

        function moveStepUp(button) {
            const stepDiv = button.closest('.workflow-step');
            const prevStep = stepDiv.previousElementSibling;
            if (prevStep) {
                stepDiv.parentNode.insertBefore(stepDiv, prevStep);
                renumberSteps();
                updateWorkflowPreview();
            }
        }

        function moveStepDown(button) {
            const stepDiv = button.closest('.workflow-step');
            const nextStep = stepDiv.nextElementSibling;
            if (nextStep) {
                stepDiv.parentNode.insertBefore(nextStep, stepDiv);
                renumberSteps();
                updateWorkflowPreview();
            }
        }

        function removeStep(button) {
            const stepDiv = button.closest('.workflow-step');
            stepDiv.remove();
            renumberSteps();
            updateWorkflowPreview();
        }

        function renumberSteps() {
            const steps = document.querySelectorAll('.workflow-step');
            steps.forEach((step, index) => {
                const stepNumber = step.querySelector('.bg-gradient-to-r');
                stepNumber.textContent = index + 1;
                step.dataset.stepId = `step-${index + 1}`;
            });
            workflowStepCount = steps.length;
        }
        
        // AI-Powered Workflow Functions
        function generateWorkflowSuggestion(suggestionType) {
            const department = document.getElementById('department').value;
            const workflowType = document.getElementById('workflowType').value;
            
            const suggestions = {
                'approval': {
                    name: 'Smart Approval Chain',
                    steps: [
                        { type: 'input', description: 'Receive request with automated data validation' },
                        { type: 'decision', description: 'Route based on amount, type, and urgency' },
                        { type: 'approval', description: 'Supervisor approval with 24hr timeout' },
                        { type: 'escalation', description: 'Auto-escalate to department head if needed' },
                        { type: 'notification', description: 'Multi-channel approval notification' },
                        { type: 'completion', description: 'Archive and close with analytics' }
                    ]
                },
                'notification': {
                    name: 'Intelligent Notification System',
                    steps: [
                        { type: 'input', description: 'Trigger event detection' },
                        { type: 'decision', description: 'Determine notification priority and channels' },
                        { type: 'notification', description: 'Send personalized alerts (email, SMS, app)' },
                        { type: 'validation', description: 'Confirm delivery and read receipts' },
                        { type: 'escalation', description: 'Retry with alternative channels if undelivered' },
                        { type: 'archive', description: 'Log communication history' }
                    ]
                },
                'escalation': {
                    name: 'Auto-Escalation Framework',
                    steps: [
                        { type: 'input', description: 'Monitor workflow progress and SLA compliance' },
                        { type: 'decision', description: 'Check if deadlines are approaching or missed' },
                        { type: 'escalation', description: 'Automatic escalation to next level' },
                        { type: 'assignment', description: 'Reassign to backup personnel if needed' },
                        { type: 'notification', description: 'Alert all stakeholders of escalation' },
                        { type: 'completion', description: 'Update escalation metrics and reports' }
                    ]
                }
            };
            
            if (suggestions[suggestionType]) {
                const suggestion = suggestions[suggestionType];
                
                // Clear existing steps
                document.getElementById('workflowStepsBuilder').innerHTML = '';
                workflowStepCount = 0;
                
                // Add suggested steps
                suggestion.steps.forEach(step => {
                    addWorkflowStep(step.type);
                    
                    // Fill in the description
                    const lastStep = document.querySelector('.workflow-step:last-child');
                    const descInput = lastStep.querySelector('input[placeholder*="Describe what happens"]');
                    if (descInput) {
                        descInput.value = step.description;
                    }
                });
                
                // Update workflow name
                const nameInput = document.getElementById('workflowName');
                if (!nameInput.value.trim()) {
                    nameInput.value = suggestion.name;
                }
                
                showAISuggestions([
                    `âœ¨ Generated ${suggestion.name} with ${suggestion.steps.length} optimized steps`,
                    'ðŸŽ¯ Includes best practices for government workflows',
                    'âš¡ Built-in escalation and notification handling',
                    'ðŸ“Š Ready for compliance and audit tracking'
                ]);
            }
        }

        function updateDepartmentTemplates() {
            const department = document.getElementById('department').value;
            const departmentTemplates = {
                'permits': ['Application Processing', 'Review & Inspection', 'Approval Process'],
                'tax': ['Assessment Review', 'Appeal Handling', 'Payment Processing'],
                'public_works': ['Maintenance Request', 'Emergency Response', 'Project Approval'],
                'health': ['Inspection Process', 'Permit Review', 'Compliance Check']
            };
            
            if (departmentTemplates[department]) {
                showAISuggestions([
                    `ðŸ“‹ Common ${department} workflows:`,
                    ...departmentTemplates[department].map(t => `â€¢ ${t}`),
                    'ðŸ¤– Click "AI Optimize" for department-specific suggestions'
                ]);
            }
        }

        function updateWorkflowSuggestions() {
            const workflowType = document.getElementById('workflowType').value;
            const typeOptimizations = {
                'approval': ['Add parallel approval for faster processing', 'Include backup approvers', 'Set escalation timeouts'],
                'review': ['Use checklists for consistency', 'Include photo/document requirements', 'Add quality control step'],
                'application': ['Auto-validate common fields', 'Pre-populate known data', 'Include status tracking'],
                'complaint': ['Prioritize by severity', 'Include acknowledgment step', 'Add follow-up reminders'],
                'maintenance': ['Include location mapping', 'Add contractor assignment', 'Include completion photos']
            };
            
            if (typeOptimizations[workflowType]) {
                showAISuggestions(typeOptimizations[workflowType]);
            }
        }

        function optimizeWorkflow() {
            const steps = document.querySelectorAll('.workflow-step');
            if (steps.length === 0) {
                showAISuggestions(['âš ï¸ Add some workflow steps first, then I can optimize them!']);
                return;
            }
            
            const optimizations = [
                'âš¡ Consider adding parallel processing where possible',
                'ðŸ”” Include automated reminders before deadlines',
                'ðŸ“Š Add data validation steps to prevent errors',
                'ðŸ”„ Include feedback loops for continuous improvement',
                'ðŸ“± Enable mobile notifications for urgent items',
                'ðŸ¤– Use AI to auto-categorize and route requests',
                'ðŸ“ˆ Add analytics tracking for performance metrics',
                'ðŸ”’ Include security checkpoints for sensitive data'
            ];
            
            const randomOptimizations = optimizations.sort(() => 0.5 - Math.random()).slice(0, 4);
            showAISuggestions(randomOptimizations);
            
            // Simulate AI analysis
            setTimeout(() => {
                validateWorkflow();
            }, 1000);
        }

        function showStepLibrary() {
            const stepTypes = Object.entries(workflowLibrary.stepTypes);
            const libraryHtml = stepTypes.map(([key, step]) => 
                `<button onclick="addWorkflowStep('${key}')" class="text-left p-3 bg-white/10 rounded-lg hover:bg-white/20 transition-colors w-full">
                    <div class="flex items-center space-x-3">
                        <i class="${step.icon} text-blue-400"></i>
                        <div>
                            <div class="text-sm font-medium text-white">${step.name}</div>
                            <div class="text-xs text-white/70">${step.description}</div>
                        </div>
                    </div>
                </button>`
            ).join('');
            
            // Create modal or popup for step library
            showAISuggestions([
                'ðŸ“š Step Library - Click to add:',
                libraryHtml
            ]);
        }

        function showAISuggestions(suggestions) {
            const aiSuggestions = document.getElementById('aiSuggestions');
            const suggestionsList = document.getElementById('suggestionsList');
            
            suggestionsList.innerHTML = suggestions.map(s => 
                s.includes('<button') ? s : `<div class="flex items-start space-x-2"><span>â€¢</span><span>${s}</span></div>`
            ).join('');
            
            aiSuggestions.classList.remove('hidden');
            
            // Auto-hide after 15 seconds unless it contains interactive elements
            if (!suggestions.some(s => s.includes('<button'))) {
                setTimeout(() => {
                    aiSuggestions.classList.add('hidden');
                }, 15000);
            }
        }

        function validateWorkflow() {
            const steps = document.querySelectorAll('.workflow-step');
            const issues = [];
            
            if (steps.length === 0) {
                issues.push('Workflow must have at least one step');
            }
            
            if (steps.length === 1) {
                issues.push('Consider adding more steps for a complete workflow');
            }
            
            // Check for missing step types
            let hasApproval = false;
            let hasCompletion = false;
            let hasNotification = false;
            
            steps.forEach(step => {
                const stepType = step.querySelector('select').value;
                if (stepType === 'approval') hasApproval = true;
                if (stepType === 'completion') hasCompletion = true;
                if (stepType === 'notification') hasNotification = true;
                
                const description = step.querySelector('input[placeholder*="Describe"]').value;
                if (!description.trim()) {
                    issues.push(`Step ${step.querySelector('.bg-gradient-to-r').textContent} needs a description`);
                }
            });
            
            if (steps.length > 2 && !hasCompletion) {
                issues.push('Consider adding a completion step to properly close the workflow');
            }
            
            if (steps.length > 3 && !hasNotification) {
                issues.push('Add notification steps to keep stakeholders informed');
            }
            
            const validation = document.getElementById('workflowValidation');
            const validationIssues = document.getElementById('validationIssues');
            
            if (issues.length > 0) {
                validationIssues.innerHTML = issues.map(issue => 
                    `<div class="flex items-start space-x-2 mb-1"><i class="fas fa-exclamation-triangle text-yellow-400 mt-0.5"></i><span>${issue}</span></div>`
                ).join('');
                validation.classList.remove('hidden');
            } else {
                validation.classList.add('hidden');
                showAISuggestions(['âœ… Workflow validation passed! Ready for deployment.']);
            }
        }

        function updateWorkflowPreview() {
            const steps = document.querySelectorAll('.workflow-step');
            const canvas = document.getElementById('workflowPreviewCanvas');
            
            if (steps.length === 0) {
                canvas.innerHTML = `
                    <div class="text-white/60 text-center">
                        <i class="fas fa-sitemap text-4xl mb-4"></i>
                        <p>Add workflow steps to see preview</p>
                    </div>
                `;
                return;
            }
            
            const previewHtml = Array.from(steps).map((step, index) => {
                const stepType = step.querySelector('select').value;
                const description = step.querySelector('input[placeholder*="Describe"]').value;
                const icon = stepType && workflowLibrary.stepTypes[stepType] ? workflowLibrary.stepTypes[stepType].icon : 'fas fa-circle';
                
                return `
                    <div class="flex items-center ${index < steps.length - 1 ? 'mb-4' : ''}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-sm font-bold">
                                ${index + 1}
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="${icon} text-blue-400"></i>
                                <span class="text-white text-sm">${description || 'Untitled Step'}</span>
                            </div>
                        </div>
                        ${index < steps.length - 1 ? '<div class="ml-4 w-px h-6 bg-white/20"></div>' : ''}
                    </div>
                `;
            }).join('');
            
            canvas.innerHTML = `<div class="p-4">${previewHtml}</div>`;
        }

        function testWorkflow() {
            const steps = document.querySelectorAll('.workflow-step');
            if (steps.length === 0) {
                showAISuggestions(['âš ï¸ Add workflow steps before testing']);
                return;
            }
            
            showAISuggestions([
                'ðŸ§ª Running workflow simulation...',
                'âœ… All steps executed successfully',
                'â±ï¸ Estimated completion time: 2.5 business days',
                'ðŸ“Š No bottlenecks detected',
                'ðŸŽ¯ Ready for production deployment'
            ]);
        }

        function exportWorkflow() {
            const workflowName = document.getElementById('workflowName').value || 'Untitled Workflow';
            const department = document.getElementById('department').value;
            const workflowData = {
                name: workflowName,
                department: department,
                steps: Array.from(document.querySelectorAll('.workflow-step')).map((step, index) => ({
                    id: index + 1,
                    type: step.querySelector('select').value,
                    description: step.querySelector('input[placeholder*="Describe"]').value,
                    assignedTo: step.querySelectorAll('select')[1]?.value,
                    timeLimit: step.querySelector('input[type="number"]')?.value,
                    conditions: step.querySelector('textarea')?.value
                }))
            };
            
            // Create downloadable JSON
            const blob = new Blob([JSON.stringify(workflowData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${workflowName.replace(/[^a-z0-9]/gi, '_').toLowerCase()}_workflow.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function saveWorkflowDraft() {
            const workflowName = document.getElementById('workflowName').value;
            if (!workflowName.trim()) {
                showAISuggestions(['âš ï¸ Please enter a workflow name before saving draft']);
                return;
            }
            
            showAISuggestions([`ðŸ’¾ Draft "${workflowName}" saved successfully`, 'ðŸ“ You can continue editing later']);
        }

        function saveWorkflow() {
            const workflowName = document.getElementById('workflowName').value;
            const department = document.getElementById('department').value;
            const steps = document.querySelectorAll('.workflow-step');
            
            if (!workflowName.trim()) {
                showAISuggestions(['âš ï¸ Please enter a workflow name']);
                return;
            }
            
            if (!department) {
                showAISuggestions(['âš ï¸ Please select a department']);
                return;
            }
            
            if (steps.length === 0) {
                showAISuggestions(['âš ï¸ Please add at least one workflow step']);
                return;
            }
            
            // Validate workflow before deploying
            validateWorkflow();
            
            // Simulate deployment
            setTimeout(() => {
                addAdminChatMessage(`ðŸš€ Workflow "${workflowName}" deployed successfully! Now processing requests automatically.`, 'ai');
                closeModal();
                
                // Reset form
                document.getElementById('workflowName').value = '';
                document.getElementById('department').value = '';
                document.getElementById('workflowStepsBuilder').innerHTML = '';
                workflowStepCount = 0;
                
                // Update dashboard stats
                const activeWorkflows = document.querySelector('#dashboard-content .text-3xl');
                if (activeWorkflows) {
                    const current = parseInt(activeWorkflows.textContent);
                    activeWorkflows.textContent = current + 1;
                }
            }, 1500);
        }
        
        // Chat functions
        function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                // Smart responses based on message content
                const lowerMessage = message.toLowerCase();
                let response = '';
                
                if (lowerMessage.includes('permit') || lowerMessage.includes('building')) {
                    response = "For building permits, you'll need property surveys, construction plans, and a licensed contractor. Would you like me to open the building permit form for you?";
                } else if (lowerMessage.includes('license') || lowerMessage.includes('business')) {
                    response = "Business licenses typically require your business registration, zoning approval, and tax ID. Processing usually takes 3-5 business days. Shall I help you start the application?";
                } else if (lowerMessage.includes('pothole') || lowerMessage.includes('road') || lowerMessage.includes('street')) {
                    response = "For road issues like potholes, please provide the exact location and photos if possible. Our Public Works team responds within 1-3 business days. Would you like to submit a repair request?";
                } else if (lowerMessage.includes('tax') || lowerMessage.includes('property tax')) {
                    response = "For tax inquiries, I can connect you with the Finance Department. They handle property assessments, payment plans, and exemptions. What specific tax issue can I help with?";
                } else if (lowerMessage.includes('tree') || lowerMessage.includes('park')) {
                    response = "Tree services and park maintenance are handled by Parks & Recreation. For tree removal, you'll need property ownership verification. Would you like me to start that request?";
                } else if (lowerMessage.includes('noise') || lowerMessage.includes('complaint')) {
                    response = "For noise complaints, please provide specific times, dates, and any evidence. Code Enforcement typically responds within 1-2 business days. Should I open a complaint form?";
                } else if (lowerMessage.includes('trash') || lowerMessage.includes('garbage') || lowerMessage.includes('recycling')) {
                    response = "For trash and recycling issues, I can help you contact Sanitation Services. They handle missed pickups, damaged bins, and schedule changes. What's the specific issue?";
                } else {
                    const genericResponses = [
                        "I can help you find the right city service! Try asking about permits, licenses, road repairs, or reporting issues.",
                        "What service are you looking for? I can help with building permits, business licenses, reporting problems, or connecting you with the right department.",
                        "I'm here to help you navigate city services. You can ask about permits, file complaints, request services, or get information about any department.",
                        "Need help with city services? I can assist with applications, direct you to the right department, or help you submit requests quickly."
                    ];
                    response = genericResponses[Math.floor(Math.random() * genericResponses.length)];
                }
                
                addChatMessage(response, 'ai');
            }, 800);
        }
        
        function addChatMessage(message, sender) {
            const chatHistory = document.getElementById('chatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'text-blue-300 mb-2' : 'text-green-300 mb-2';
            
            const icon = sender === 'user' ? 'fas fa-user' : 'fas fa-brain';
            const senderName = sender === 'user' ? 'You' : 'AI';
            const senderClass = sender === 'user' ? '' : 'text-blue-300';
            
            messageDiv.innerHTML = `
                <i class="${icon} mr-2"></i>
                <span class="font-semibold ${senderClass}">${senderName}:</span>
                <span>${message}</span>
            `;
            
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        function startTypingAnimation() {
            const element = document.getElementById('welcomeMessage');
            if (!element) return; // Element doesn't exist on all tabs
            const text = "Hello! I'm here to help you find the right city service. What can I help you with today?";

            element.innerHTML = '';
            element.classList.add('typing');
            let i = 0;
            
            function type() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(type, 30);
                } else {
                    element.classList.remove('typing');
                }
            }
            type();
        }

        // Citizen Portal Functions
        function openNewRequestModal() {
            document.getElementById('newRequestModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeNewRequestModal() {
            document.getElementById('newRequestModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            document.getElementById('newRequestForm').reset();
            document.getElementById('charCount').textContent = '0';
            document.getElementById('routingPreview').classList.add('hidden');
            document.getElementById('aiSuggestion').classList.add('hidden');
        }

        function quickRequest(serviceType) {
            openNewRequestModal();
            document.getElementById('serviceType').value = serviceType;
            updateAIRouting();
        }

        function populateRecentRequests() {
            const container = document.getElementById('recentRequestsList');
            if (!container) return;

            const recentRequests = userRequests.slice(0, 3);

            container.innerHTML = recentRequests.map(request => `
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-colors cursor-pointer" onclick="viewRequestDetails('${request.id}')">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <span class="text-white font-medium">${request.type}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-${request.statusColor}-500/20 text-${request.statusColor}-300">${request.status}</span>
                        </div>
                        <p class="text-sm text-white/70">${request.description}</p>
                        <div class="flex items-center space-x-4 mt-2 text-xs text-white/60">
                            <span><i class="fas fa-calendar mr-1"></i>${new Date(request.date).toLocaleDateString()}</span>
                            <span><i class="fas fa-building mr-1"></i>${request.department}</span>
                        </div>
                    </div>
                    <div class="text-white/60">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            `).join('');
        }

        function viewAllRequests() {
            // This would open a modal or navigate to a requests page
            alert('Opening full request history...');
        }

        function viewRequestDetails(requestId) {
            const request = userRequests.find(r => r.id === requestId);
            if (request) {
                alert(`Request Details:\n\nID: ${request.id}\nType: ${request.type}\nStatus: ${request.status}\nDepartment: ${request.department}\nDescription: ${request.description}`);
            }
        }

        function initializeNewRequestForm() {
            const form = document.getElementById('newRequestForm');
            const serviceType = document.getElementById('serviceType');
            const description = document.getElementById('description');
            const charCount = document.getElementById('charCount');

            // Character counter
            description.addEventListener('input', function() {
                const count = this.value.length;
                charCount.textContent = count;
                if (count > 500) {
                    charCount.style.color = '#ef4444';
                } else {
                    charCount.style.color = '';
                }
            });

            // Service type change - AI routing
            serviceType.addEventListener('change', updateAIRouting);

            // Form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                submitNewRequest();
            });

            // File upload handling
            const fileUpload = document.getElementById('fileUpload');
            if (fileUpload) {
                fileUpload.addEventListener('change', handleFileUpload);
            }

            // Document intelligence upload handling
            const docProcessingFileInput = document.getElementById('docProcessingFileInput');
            const docProcessingDropZone = document.getElementById('docProcessingDropZone');

            if (docProcessingFileInput && docProcessingDropZone) {
                docProcessingFileInput.addEventListener('change', handleDocumentIntelligenceUpload);

                // Drag and drop support
                docProcessingDropZone.addEventListener('click', () => docProcessingFileInput.click());
                docProcessingDropZone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    docProcessingDropZone.style.borderColor = '#3b82f6';
                    docProcessingDropZone.style.background = 'rgba(59, 130, 246, 0.1)';
                });
                docProcessingDropZone.addEventListener('dragleave', () => {
                    docProcessingDropZone.style.borderColor = '';
                    docProcessingDropZone.style.background = '';
                });
                docProcessingDropZone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    docProcessingDropZone.style.borderColor = '';
                    docProcessingDropZone.style.background = '';
                    if (e.dataTransfer.files.length > 0) {
                        handleDocumentIntelligenceFile(e.dataTransfer.files[0]);
                    }
                });
            }
        }

        function updateAIRouting() {
            const serviceType = document.getElementById('serviceType').value;
            const routingPreview = document.getElementById('routingPreview');
            const routingInfo = document.getElementById('routingInfo');
            const aiSuggestion = document.getElementById('aiSuggestion');
            const aiSuggestionText = document.getElementById('aiSuggestionText');

            const routingMap = {
                'building_permit': {
                    department: 'Building & Safety Department',
                    estimatedTime: '5-7 business days',
                    requirements: 'Property survey, construction plans, contractor license',
                    color: 'orange'
                },
                'business_license': {
                    department: 'Business Licensing Office',
                    estimatedTime: '3-5 business days',
                    requirements: 'Business registration, zoning approval, tax ID',
                    color: 'green'
                },
                'pothole_repair': {
                    department: 'Public Works Department',
                    estimatedTime: '1-3 business days',
                    requirements: 'Location details, photos recommended',
                    color: 'blue'
                },
                'tree_service': {
                    department: 'Parks & Recreation',
                    estimatedTime: '7-10 business days',
                    requirements: 'Property ownership verification, photos',
                    color: 'green'
                },
                'noise_complaint': {
                    department: 'Code Enforcement',
                    estimatedTime: '1-2 business days',
                    requirements: 'Specific times, dates, evidence if available',
                    color: 'yellow'
                }
            };

            if (serviceType && routingMap[serviceType]) {
                const routing = routingMap[serviceType];
                routingInfo.innerHTML = `
                    <div class="space-y-2">
                        <div><strong>Routed to:</strong> ${routing.department}</div>
                        <div><strong>Est. Processing Time:</strong> ${routing.estimatedTime}</div>
                        <div><strong>Required Information:</strong> ${routing.requirements}</div>
                    </div>
                `;
                routingPreview.classList.remove('hidden');

                // AI suggestion
                aiSuggestionText.textContent = `Based on your selection, I recommend including ${routing.requirements.toLowerCase()} to expedite processing.`;
                aiSuggestion.classList.remove('hidden');
            } else {
                routingPreview.classList.add('hidden');
                aiSuggestion.classList.add('hidden');
            }
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            const fileList = document.getElementById('fileList');
            
            fileList.innerHTML = '';
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileDiv = document.createElement('div');
                fileDiv.className = 'flex items-center justify-between p-2 bg-white/5 rounded text-sm';
                fileDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-file text-blue-400"></i>
                        <span class="text-white">${file.name}</span>
                        <span class="text-white/60">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-red-400 hover:text-red-300">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                fileList.appendChild(fileDiv);
            }
        }

        function submitNewRequest() {
            const formData = new FormData(document.getElementById('newRequestForm'));
            const serviceType = document.getElementById('serviceType').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const description = document.getElementById('description').value;
            const priority = document.querySelector('input[name="priority"]:checked').value;

            // Generate new request ID
            const newId = `REQ-2024-${String(userRequests.length + 1).padStart(3, '0')}`;
            
            // Create new request object
            const newRequest = {
                id: newId,
                type: document.querySelector(`#serviceType option[value="${serviceType}"]`).textContent,
                description: description,
                status: 'Submitted',
                statusColor: 'blue',
                date: new Date().toISOString().split('T')[0],
                department: getServiceDepartment(serviceType),
                priority: priority,
                submitter: `${firstName} ${lastName}`,
                email: email
            };

            // Add to requests array
            userRequests.unshift(newRequest);

            // Update UI
            populateRecentRequests();
            document.getElementById('userRequestCount').textContent = userRequests.length;

            // Show success message
            addChatMessage(`âœ… Request submitted successfully! Your request ID is ${newId}. You'll receive updates via email at ${email}.`, 'ai');

            // Close modal
            closeNewRequestModal();

            // Switch to dashboard to show the new request
            switchTab('dashboard');
        }

        function getServiceDepartment(serviceType) {
            const departmentMap = {
                'building_permit': 'Building & Safety',
                'renovation_permit': 'Building & Safety',
                'business_license': 'Business Licensing',
                'event_permit': 'Special Events',
                'sign_permit': 'Planning Department',
                'pothole_repair': 'Public Works',
                'streetlight_issue': 'Public Works',
                'tree_service': 'Parks & Recreation',
                'trash_pickup': 'Sanitation',
                'water_sewer': 'Public Utilities',
                'noise_complaint': 'Code Enforcement',
                'property_maintenance': 'Code Enforcement',
                'zoning_violation': 'Planning Department',
                'tax_inquiry': 'Finance Department',
                'general_inquiry': 'City Clerk',
                'document_request': 'City Clerk'
            };
            return departmentMap[serviceType] || 'General Services';
        }

        // Document Intelligence Functions - Added 2025-10-27
        // MOCK DATA - Replace in production
        // TODO: Connect to AI document intelligence API endpoint

        let extractedDocumentData = null;

        function handleDocumentIntelligenceUpload(e) {
            if (e.target.files.length > 0) {
                handleDocumentIntelligenceFile(e.target.files[0]);
            }
        }

        function handleDocumentIntelligenceFile(file) {
            console.log('Processing document:', file.name);

            // Show processing UI
            document.getElementById('docProcessingStatus').classList.remove('hidden');
            document.getElementById('docClassificationResult').classList.add('hidden');
            document.getElementById('docProcessingExtractedPanel').classList.add('hidden');

            // Simulate AI processing stages
            const stages = ['docStage1', 'docStage2', 'docStage3', 'docStage4'];
            let currentStage = 0;

            const progressInterval = setInterval(() => {
                if (currentStage > 0) {
                    // Mark previous stage complete
                    const prevStage = document.getElementById(stages[currentStage - 1]);
                    prevStage.innerHTML = '<i class="fas fa-check-circle text-green-400"></i>';
                }

                if (currentStage < stages.length) {
                    // Mark current stage active
                    const stage = document.getElementById(stages[currentStage]);
                    stage.innerHTML = '<i class="fas fa-spinner fa-spin text-blue-400"></i>';
                    currentStage++;

                    // Update progress bar
                    const progress = (currentStage / stages.length) * 100;
                    document.getElementById('docProcessingProgressBar').style.width = progress + '%';
                } else {
                    clearInterval(progressInterval);
                    // Processing complete
                    setTimeout(() => {
                        displayDocumentIntelligenceResults(file.name);
                    }, 500);
                }
            }, 700);
        }

        function displayDocumentIntelligenceResults(filename) {
            // MOCK DATA - Simulate document classification and extraction
            // TODO: Replace with actual AI API response
            const mockDocuments = {
                residential: {
                    type: 'Residential Building Permit',
                    confidence: 98.5,
                    pages: 3,
                    fields: [
                        { name: 'Property Address', value: '1847 Oak Street, Springfield', confidence: 98.2 },
                        { name: 'Owner Name', value: 'Sarah Johnson', confidence: 97.5 },
                        { name: 'Construction Type', value: 'New Single Family Dwelling', confidence: 99.1 },
                        { name: 'Square Footage', value: '2,450 sq ft', confidence: 96.8 },
                        { name: 'Estimated Cost', value: '$485,000', confidence: 98.9 },
                        { name: 'Contractor License', value: 'CA-LIC-847261', confidence: 99.2 },
                        { name: 'Phone Number', value: '(555) 234-5678', confidence: 97.8 },
                        { name: 'Email', value: 'sarah.johnson@email.com', confidence: 96.3 }
                    ]
                },
                commercial: {
                    type: 'Commercial Building Permit',
                    confidence: 99.2,
                    pages: 5,
                    fields: [
                        { name: 'Business Name', value: 'Springfield Medical Center', confidence: 98.7 },
                        { name: 'Property Address', value: '4500 Commerce Blvd, Springfield', confidence: 99.1 },
                        { name: 'Building Type', value: 'Healthcare Facility', confidence: 97.9 },
                        { name: 'Total Area', value: '35,000 sq ft', confidence: 98.5 },
                        { name: 'Contact Name', value: 'Dr. Robert Chen', confidence: 97.4 },
                        { name: 'Phone Number', value: '(555) 876-5432', confidence: 98.9 },
                        { name: 'Email', value: 'rchen@springfieldmed.com', confidence: 97.1 }
                    ]
                }
            };

            // Randomly select a document type for demo
            const docType = Math.random() > 0.5 ? 'residential' : 'commercial';
            const docData = mockDocuments[docType];
            extractedDocumentData = docData;

            // Hide processing, show results
            document.getElementById('docProcessingStatus').classList.add('hidden');
            document.getElementById('docClassificationResult').classList.remove('hidden');
            document.getElementById('docProcessingExtractedPanel').classList.remove('hidden');

            // Display classification
            document.getElementById('docDetectedType').textContent = docData.type;
            document.getElementById('docTypeConfidence').textContent = docData.confidence + '% confidence';
            document.getElementById('docPages').textContent = `${docData.pages} page${docData.pages > 1 ? 's' : ''} â€¢ Processed in 2.3s`;

            // Display extracted fields
            document.getElementById('docProcessingFieldCount').textContent = docData.fields.length;

            const fieldsHTML = docData.fields.map(field => {
                const confidenceColor = field.confidence >= 95 ? 'green' : field.confidence >= 90 ? 'yellow' : 'orange';
                return `
                    <div class="flex items-center justify-between p-2 glass rounded">
                        <div class="flex-1">
                            <div class="text-xs text-white/60">${field.name}</div>
                            <div class="text-sm text-white font-medium">${field.value}</div>
                        </div>
                        <div class="text-${confidenceColor}-400 text-xs ml-2">${field.confidence}%</div>
                    </div>
                `;
            }).join('');

            document.getElementById('docProcessingFields').innerHTML = fieldsHTML;

            // Auto-set service type based on document
            const serviceTypeMapping = {
                'Residential Building Permit': 'building_permit',
                'Commercial Building Permit': 'building_permit',
                'Business License Application': 'business_license'
            };

            const serviceType = serviceTypeMapping[docData.type];
            if (serviceType) {
                document.getElementById('serviceType').value = serviceType;
                updateAIRouting();
            }
        }

        function autoFillFromDocument() {
            if (!extractedDocumentData) return;

            // Map extracted fields to form fields
            const fieldMapping = {
                'Owner Name': (value) => {
                    const parts = value.split(' ');
                    if (parts.length >= 2) {
                        document.getElementById('firstName').value = parts[0];
                        document.getElementById('lastName').value = parts.slice(1).join(' ');
                    }
                },
                'Contact Name': (value) => {
                    const parts = value.replace('Dr. ', '').split(' ');
                    if (parts.length >= 2) {
                        document.getElementById('firstName').value = parts[0];
                        document.getElementById('lastName').value = parts.slice(1).join(' ');
                    }
                },
                'Property Address': (value) => {
                    const addressField = document.getElementById('address');
                    if (addressField) addressField.value = value;
                },
                'Phone Number': (value) => {
                    const phoneField = document.getElementById('phone');
                    if (phoneField) phoneField.value = value;
                },
                'Email': (value) => {
                    const emailField = document.getElementById('email');
                    if (emailField) emailField.value = value;
                },
                'Business Name': (value) => {
                    // Could map to a business name field if it exists
                }
            };

            // Apply extracted data to form
            let filledCount = 0;
            extractedDocumentData.fields.forEach(field => {
                if (fieldMapping[field.name]) {
                    fieldMapping[field.name](field.value);
                    filledCount++;
                }
            });

            // Show success notification
            showNotification(`âœ“ Auto-filled ${filledCount} fields from your document`, 'success');

            // Scroll to form to show filled fields
            setTimeout(() => {
                document.getElementById('firstName').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 500);
        }

        function viewFullDocumentAnalysis() {
            // Open the full document intelligence interface in a new window
            window.open('document-intelligence-test.html', '_blank');
        }

        function showNotification(message, type = 'success') {
            const colors = {
                success: 'green',
                error: 'red',
                info: 'blue',
                warning: 'yellow'
            };
            const color = colors[type] || 'blue';
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                info: 'info-circle',
                warning: 'exclamation-triangle'
            };
            const icon = icons[type] || 'info-circle';

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 glass rounded-lg p-4 text-white bg-${color}-500/20 border border-${color}-400 z-50 animate-fade-in`;
            notification.innerHTML = `<i class="fas fa-${icon} mr-2"></i>${message}`;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function quickChat(topic) {
            document.getElementById('userInput').value = `I need help with ${topic}`;
            sendMessage();
        }

        // Constituent Inbox Functions - Added 2025-10-27
        // MOCK DATA - Replace in production
        // TODO: Connect to constituent inbox API endpoint
        // TODO: Connect to CRM API endpoint for constituent profiles
        // SECURITY TODO: Validate all constituent data before processing
        // Enhanced 2024-10-30: Added CRM integration and relationship intelligence

        const CONSTITUENT_MESSAGES = [
            {
                id: 'MSG-2024-001847',
                channel: 'email',
                from: 'sarah.johnson@email.com',
                name: 'Sarah Johnson',
                subject: 'Question about building permit timeline',
                preview: 'I submitted a building permit application two weeks ago (Permit #RES-2024-00184) and wanted to check on the status...',
                timestamp: new Date('2024-10-27T09:23:00'),
                unread: true,
                intent: 'inquiry',
                department: 'Building & Safety',
                urgency: 'low',
                sentiment: 0.72,
                confidence: 98.5,
                tags: ['permit', 'status check', 'residential'],
                // Enhanced CRM Profile Data
                constituentProfile: {
                    id: 'CRM-2024-4721',
                    phone: '(555) 847-2910',
                    address: '1847 Oak Street, Springfield, IL 62701',
                    residency: '3 years',
                    previousContacts: 2,
                    totalRequests: 3,
                    avgResponseTime: '1.2 days',
                    satisfactionScore: 4.5,
                    lastContact: new Date('2024-09-15T14:30:00'),
                    preferredChannel: 'email',
                    language: 'English',
                    demographics: {
                        age: '35-44',
                        householdSize: 4,
                        propertyOwner: true
                    }
                },
                // Relationship Intelligence
                relationshipData: {
                    lifetimeValue: 'High',
                    engagementLevel: 'Active',
                    riskScore: 'Low',
                    activeServices: ['Building Permit', 'Property Tax'],
                    associatedRecords: [
                        { type: 'Permit', id: 'RES-2024-00184', status: 'Under Review', date: '2024-10-13' },
                        { type: 'Tax Payment', id: 'TAX-2024-7821', status: 'Paid', date: '2024-08-01' }
                    ],
                    relatedContacts: [
                        { name: 'John Johnson', relationship: 'Spouse', phone: '(555) 847-2911' }
                    ],
                    interactionHistory: [
                        { date: '2024-09-15', type: 'Phone Call', topic: 'Permit Requirements', duration: '12 min' },
                        { date: '2024-08-22', type: 'Email', topic: 'Property Tax Question', responded: true }
                    ]
                }
            },
            {
                id: 'MSG-2024-001846',
                channel: 'web',
                from: 'contact-form',
                name: 'Michael Rodriguez',
                subject: 'Pothole on Elm Street needs urgent repair',
                preview: 'There is a large pothole at the intersection of Elm Street and 5th Avenue that is causing damage to vehicles...',
                timestamp: new Date('2024-10-27T08:45:00'),
                unread: true,
                intent: 'complaint',
                department: 'Public Works',
                urgency: 'high',
                sentiment: 0.35,
                confidence: 96.2,
                tags: ['pothole', 'road repair', 'urgent'],
                // Enhanced CRM Profile Data
                constituentProfile: {
                    id: 'CRM-2024-8473',
                    phone: '(555) 293-8471',
                    address: '892 Maple Drive, Springfield, IL 62704',
                    residency: '7 years',
                    previousContacts: 5,
                    totalRequests: 8,
                    avgResponseTime: '3.1 days',
                    satisfactionScore: 3.2,
                    lastContact: new Date('2024-09-28T11:15:00'),
                    preferredChannel: 'web',
                    language: 'English',
                    demographics: {
                        age: '45-54',
                        householdSize: 3,
                        propertyOwner: true
                    }
                },
                // Relationship Intelligence
                relationshipData: {
                    lifetimeValue: 'Medium',
                    engagementLevel: 'Frequent',
                    riskScore: 'Medium',
                    activeServices: ['Public Works Requests'],
                    associatedRecords: [
                        { type: 'Service Request', id: 'PW-2024-3847', status: 'In Progress', date: '2024-10-27' },
                        { type: 'Service Request', id: 'PW-2024-2193', status: 'Completed', date: '2024-09-28' },
                        { type: 'Service Request', id: 'PW-2024-1056', status: 'Completed', date: '2024-07-15' }
                    ],
                    relatedContacts: [],
                    interactionHistory: [
                        { date: '2024-09-28', type: 'Web Form', topic: 'Street Light Outage', responded: true },
                        { date: '2024-07-15', type: 'Web Form', topic: 'Sidewalk Repair', responded: true },
                        { date: '2024-05-02', type: 'Phone Call', topic: 'Trash Schedule', duration: '5 min' }
                    ]
                }
            },
            {
                id: 'MSG-2024-001845',
                channel: 'social',
                from: '@springfield_resident',
                name: 'Jennifer Lee',
                subject: 'Park hours extension request',
                preview: 'Would it be possible to extend the hours at Central Park? Many families would benefit from evening access during summer...',
                timestamp: new Date('2024-10-27T07:12:00'),
                unread: true,
                intent: 'request',
                department: 'Parks & Recreation',
                urgency: 'low',
                sentiment: 0.88,
                confidence: 94.7,
                tags: ['park', 'hours', 'community request'],
                constituentProfile: {
                    id: 'CRM-2024-5102',
                    phone: '(555) 921-3847',
                    address: '2145 Elm Street, Springfield, IL 62702',
                    residency: '7 years',
                    previousContacts: 5,
                    totalRequests: 6,
                    avgResponseTime: '0.8 days',
                    satisfactionScore: 4.8,
                    demographics: {
                        age: '30-39',
                        householdSize: 4,
                        propertyOwner: true
                    }
                },
                relationshipData: {
                    lifetimeValue: 'High',
                    engagementLevel: 'Very Active',
                    riskScore: 'Low',
                    activeServices: ['Parks & Recreation', 'Community Programs'],
                    associatedRecords: [
                        { type: 'Community Program', id: 'CP-2024-892', status: 'Active', date: '2024-06-15' },
                        { type: 'Park Reservation', id: 'PR-2024-445', status: 'Completed', date: '2024-08-20' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-27', type: 'Social Media', topic: 'Park Hours Extension', responded: false },
                        { date: '2024-08-20', type: 'Web Form', topic: 'Park Reservation', responded: true },
                        { date: '2024-06-15', type: 'Email', topic: 'Summer Program Registration', responded: true },
                        { date: '2024-03-10', type: 'Phone Call', topic: 'Park Facilities Inquiry', duration: '8 min' }
                    ]
                }
            },
            {
                id: 'MSG-2024-001844',
                channel: 'email',
                from: 'robert.chen@business.com',
                name: 'Dr. Robert Chen',
                subject: 'Business license renewal - payment issue',
                preview: 'I attempted to renew my business license online but the payment portal is showing an error. License #BUS-2024-8473...',
                timestamp: new Date('2024-10-27T06:54:00'),
                unread: false,
                intent: 'complaint',
                department: 'Finance Department',
                urgency: 'medium',
                sentiment: 0.42,
                confidence: 97.8,
                tags: ['business license', 'payment', 'technical issue'],
                constituentProfile: {
                    id: 'CRM-2024-3298',
                    phone: '(555) 673-1209',
                    address: '4720 Business Park Drive, Springfield, IL 62704',
                    residency: '12 years',
                    previousContacts: 8,
                    totalRequests: 12,
                    avgResponseTime: '1.5 days',
                    satisfactionScore: 4.0,
                    demographics: {
                        age: '45-54',
                        householdSize: 2,
                        propertyOwner: true,
                        businessOwner: true
                    }
                },
                relationshipData: {
                    lifetimeValue: 'Very High',
                    engagementLevel: 'Active',
                    riskScore: 'Medium',
                    activeServices: ['Business License', 'Property Tax', 'Zoning Compliance'],
                    associatedRecords: [
                        { type: 'Business License', id: 'BUS-2024-8473', status: 'Pending Renewal', date: '2024-10-15' },
                        { type: 'Payment', id: 'PAY-2024-7721', status: 'Failed', date: '2024-10-27', amount: '$450' },
                        { type: 'Zoning Permit', id: 'ZN-2023-2910', status: 'Active', date: '2023-05-20' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-27', type: 'Email', topic: 'License Renewal Payment Issue', responded: false },
                        { date: '2024-09-15', type: 'Web Form', topic: 'Business Hours Change', responded: true },
                        { date: '2024-07-10', type: 'Phone Call', topic: 'Tax Payment Inquiry', duration: '12 min' },
                        { date: '2023-05-20', type: 'In Person', topic: 'Zoning Application', responded: true }
                    ]
                }
            },
            {
                id: 'MSG-2024-001843',
                channel: 'sms',
                from: '+1-555-234-5678',
                name: 'Maria Garcia',
                subject: 'Trash pickup missed this week',
                preview: 'Our trash was not picked up on our scheduled day (Tuesday). Address: 892 Oak Drive...',
                timestamp: new Date('2024-10-26T18:32:00'),
                unread: false,
                intent: 'complaint',
                department: 'Public Works',
                urgency: 'medium',
                sentiment: 0.51,
                confidence: 95.3,
                tags: ['trash', 'missed pickup', 'sanitation'],
                constituentProfile: {
                    id: 'CRM-2024-6891',
                    phone: '(555) 234-5678',
                    address: '892 Oak Drive, Springfield, IL 62703',
                    residency: '2 years',
                    previousContacts: 3,
                    totalRequests: 4,
                    avgResponseTime: '0.5 days',
                    satisfactionScore: 3.8,
                    demographics: {
                        age: '25-34',
                        householdSize: 3,
                        propertyOwner: false,
                        rentalProperty: true
                    }
                },
                relationshipData: {
                    lifetimeValue: 'Medium',
                    engagementLevel: 'Moderate',
                    riskScore: 'Low',
                    activeServices: ['Trash Collection', 'Recycling'],
                    associatedRecords: [
                        { type: 'Service Request', id: 'SR-2024-3341', status: 'Open', date: '2024-10-26' },
                        { type: 'Service Request', id: 'SR-2024-1892', status: 'Resolved', date: '2024-06-12' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-26', type: 'SMS', topic: 'Missed Trash Pickup', responded: false },
                        { date: '2024-06-12', type: 'SMS', topic: 'Recycling Bin Damaged', responded: true },
                        { date: '2024-03-05', type: 'Web Form', topic: 'Trash Schedule Change', responded: true }
                    ]
                }
            },
            {
                id: 'MSG-2024-001842',
                channel: 'web',
                from: 'contact-form',
                name: 'David Thompson',
                subject: 'Request for public records',
                preview: 'I would like to request copies of all building permits issued on my street (Maple Avenue) in the last 6 months...',
                timestamp: new Date('2024-10-26T16:18:00'),
                unread: false,
                intent: 'request',
                department: 'City Clerk',
                urgency: 'low',
                sentiment: 0.78,
                confidence: 99.1,
                tags: ['public records', 'FOIA', 'permits'],
                constituentProfile: {
                    id: 'CRM-2024-4456',
                    phone: '(555) 789-4521',
                    address: '3412 Maple Avenue, Springfield, IL 62701',
                    residency: '15 years',
                    previousContacts: 4,
                    totalRequests: 5,
                    avgResponseTime: '2.3 days',
                    satisfactionScore: 4.2,
                    demographics: {
                        age: '55-64',
                        householdSize: 2,
                        propertyOwner: true
                    }
                },
                relationshipData: {
                    lifetimeValue: 'Medium',
                    engagementLevel: 'Low',
                    riskScore: 'Low',
                    activeServices: ['Public Records Requests', 'Property Tax'],
                    associatedRecords: [
                        { type: 'Public Records Request', id: 'PRR-2024-891', status: 'Processing', date: '2024-10-26' },
                        { type: 'Public Records Request', id: 'PRR-2023-2341', status: 'Fulfilled', date: '2023-11-10' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-26', type: 'Web Form', topic: 'Public Records - Building Permits', responded: false },
                        { date: '2023-11-10', type: 'Email', topic: 'Public Records - Zoning Maps', responded: true },
                        { date: '2022-08-15', type: 'In Person', topic: 'Property Deed Copies', responded: true }
                    ]
                }
            },
            {
                id: 'MSG-2024-001841',
                channel: 'email',
                from: 'concerned.citizen@email.com',
                name: 'Anonymous',
                subject: 'Noise complaint - ongoing construction',
                preview: 'There has been construction noise starting at 6 AM every morning for the past week at 1500 Commerce Blvd...',
                timestamp: new Date('2024-10-26T14:45:00'),
                unread: false,
                intent: 'complaint',
                department: 'Code Enforcement',
                urgency: 'medium',
                sentiment: 0.28,
                confidence: 93.6,
                tags: ['noise', 'construction', 'code violation'],
                constituentProfile: {
                    id: 'CRM-ANON-8721',
                    phone: 'Not Provided',
                    address: 'Not Disclosed',
                    residency: 'Unknown',
                    previousContacts: 2,
                    totalRequests: 2,
                    avgResponseTime: '1.0 days',
                    satisfactionScore: 3.0,
                    demographics: {
                        age: 'Unknown',
                        householdSize: 'Unknown',
                        propertyOwner: 'Unknown'
                    }
                },
                relationshipData: {
                    lifetimeValue: 'Low',
                    engagementLevel: 'Anonymous',
                    riskScore: 'Medium',
                    activeServices: ['Code Enforcement'],
                    associatedRecords: [
                        { type: 'Code Complaint', id: 'CE-2024-1156', status: 'Under Investigation', date: '2024-10-26' },
                        { type: 'Code Complaint', id: 'CE-2024-0892', status: 'Resolved', date: '2024-08-05' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-26', type: 'Email', topic: 'Noise Complaint - Construction', responded: false },
                        { date: '2024-08-05', type: 'Email', topic: 'Parking Violation', responded: true }
                    ]
                }
            },
            {
                id: 'MSG-2024-001840',
                channel: 'social',
                from: '@local_business_owner',
                name: 'James Wilson',
                subject: 'Thank you for quick permit approval!',
                preview: 'Just wanted to say thanks to the Building & Safety team for processing my sign permit so quickly. Great service!',
                timestamp: new Date('2024-10-26T13:22:00'),
                unread: false,
                intent: 'inquiry',
                department: 'Building & Safety',
                urgency: 'low',
                sentiment: 0.95,
                confidence: 98.9,
                tags: ['positive feedback', 'permit', 'appreciation'],
                constituentProfile: {
                    id: 'CRM-2024-2873',
                    phone: '(555) 445-8821',
                    address: '780 Main Street, Springfield, IL 62701',
                    residency: '8 years',
                    previousContacts: 11,
                    totalRequests: 15,
                    avgResponseTime: '1.8 days',
                    satisfactionScore: 4.7,
                    demographics: {
                        age: '40-49',
                        householdSize: 3,
                        propertyOwner: true,
                        businessOwner: true
                    }
                },
                relationshipData: {
                    lifetimeValue: 'Very High',
                    engagementLevel: 'Very Active',
                    riskScore: 'Low',
                    activeServices: ['Building Permits', 'Business License', 'Sign Permits', 'Property Tax'],
                    associatedRecords: [
                        { type: 'Sign Permit', id: 'SP-2024-445', status: 'Approved', date: '2024-10-25' },
                        { type: 'Business License', id: 'BUS-2024-3389', status: 'Active', date: '2024-01-15' },
                        { type: 'Building Permit', id: 'BP-2023-7721', status: 'Completed', date: '2023-09-20' }
                    ],
                    interactionHistory: [
                        { date: '2024-10-26', type: 'Social Media', topic: 'Positive Feedback - Sign Permit', responded: false },
                        { date: '2024-10-20', type: 'Web Form', topic: 'Sign Permit Application', responded: true },
                        { date: '2024-08-12', type: 'Phone Call', topic: 'Permit Status Inquiry', duration: '6 min' },
                        { date: '2024-01-15', type: 'In Person', topic: 'Business License Renewal', responded: true }
                    ]
                }
            }
        ];

        let currentInboxFilter = 'all';
        let activeInboxChannelFilters = new Set();

        function initializeConstituentInbox() {
            renderInboxMessages();
            setupInboxSearch();
        }

        function renderInboxMessages() {
            const container = document.getElementById('inboxMessagesList');
            if (!container) return;

            let filteredMessages = CONSTITUENT_MESSAGES;

            // Apply tab filter
            if (currentInboxFilter === 'unread') {
                filteredMessages = filteredMessages.filter(m => m.unread);
            } else if (currentInboxFilter === 'urgent') {
                filteredMessages = filteredMessages.filter(m => m.urgency === 'high');
            }

            // Apply channel filters
            if (activeInboxChannelFilters.size > 0) {
                filteredMessages = filteredMessages.filter(m => activeInboxChannelFilters.has(m.channel));
            }

            const channelIcons = {
                email: { icon: 'fa-envelope', color: 'blue' },
                web: { icon: 'fa-globe', color: 'green' },
                social: { icon: 'fa-comments', color: 'purple' },
                sms: { icon: 'fa-sms', color: 'yellow' }
            };

            const urgencyColors = {
                high: 'red',
                medium: 'yellow',
                low: 'green'
            };

            const intentIcons = {
                request: 'fa-hand-holding-heart',
                complaint: 'fa-exclamation-triangle',
                inquiry: 'fa-question-circle'
            };

            const messagesHTML = filteredMessages.map(msg => {
                const channel = channelIcons[msg.channel];
                const urgencyColor = urgencyColors[msg.urgency];
                const timeAgo = getTimeAgo(msg.timestamp);

                return `
                    <div class="inbox-message-card glass rounded-xl p-4 ${msg.unread ? 'unread' : ''}" onclick="viewInboxMessage('${msg.id}')">
                        <div class="flex items-start gap-4">
                            <div class="w-10 h-10 bg-${channel.color}-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                                <i class="fas ${channel.icon} text-${channel.color}-400"></i>
                            </div>

                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between mb-2">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="text-white font-semibold">${msg.name}</span>
                                            ${msg.unread ? '<span class="pulse-dot bg-blue-400"></span>' : ''}
                                        </div>
                                        <h4 class="text-white/90 font-medium mb-1">${msg.subject}</h4>
                                        <p class="text-white/60 text-sm">${msg.preview}</p>
                                    </div>
                                    <span class="text-white/50 text-xs ml-2 flex-shrink-0">${timeAgo}</span>
                                </div>

                                <div class="flex flex-wrap items-center gap-2 mt-3">
                                    <span class="bg-${urgencyColor}-500/20 text-${urgencyColor}-400 px-3 py-1 rounded-full text-xs font-semibold">
                                        <i class="fas fa-flag mr-1"></i>${msg.urgency}
                                    </span>
                                    <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-semibold">
                                        <i class="fas ${intentIcons[msg.intent]} mr-1"></i>${msg.intent}
                                    </span>
                                    <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full text-xs font-semibold">
                                        <i class="fas fa-building mr-1"></i>${msg.department}
                                    </span>
                                    <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-semibold">
                                        <i class="fas fa-robot mr-1"></i>${msg.confidence}% AI
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = messagesHTML || '<div class="glass rounded-xl p-12 text-center"><p class="text-white/60">No messages found</p></div>';
        }

        function filterInboxMessages(tab) {
            currentInboxFilter = tab;

            // Update tab buttons
            document.querySelectorAll('.inbox-tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.inboxTab === tab) {
                    btn.classList.add('active');
                }
            });

            renderInboxMessages();
        }

        function toggleInboxFilter(channel) {
            const btn = document.querySelector(`[data-inbox-filter="${channel}"]`);

            if (activeInboxChannelFilters.has(channel)) {
                activeInboxChannelFilters.delete(channel);
                btn.classList.remove('active');
            } else {
                activeInboxChannelFilters.add(channel);
                btn.classList.add('active');
            }

            renderInboxMessages();
        }

        function viewInboxMessage(messageId) {
            const message = CONSTITUENT_MESSAGES.find(m => m.id === messageId);
            if (!message) return;

            // Mark as read
            message.unread = false;
            renderInboxMessages();

            // Show message details with AI classification
            const sentimentColor = message.sentiment >= 0.7 ? 'green' : message.sentiment >= 0.4 ? 'yellow' : 'red';
            const sentimentLabel = message.sentiment >= 0.7 ? 'Positive' : message.sentiment >= 0.4 ? 'Neutral' : 'Negative';

            const channelLabels = {
                email: 'Email',
                web: 'Web Form',
                social: 'Social Media',
                sms: 'SMS'
            };

            const urgencyColors = {
                high: 'red',
                medium: 'yellow',
                low: 'green'
            };

            const intentIcons = {
                request: 'fa-hand-holding-heart',
                complaint: 'fa-exclamation-triangle',
                inquiry: 'fa-question-circle'
            };

            // Enhanced 2024-10-30: Build modal content with CRM data
            const modalContent = `
                <div class="space-y-4">
                    <!-- Message Header -->
                    <div class="glass rounded-lg p-4">
                        <div class="flex items-start justify-between mb-3">
                            <div>
                                <h3 class="text-xl font-bold text-white mb-1">${message.subject}</h3>
                                <p class="text-white/70 text-sm">From: ${message.name} (${message.from})</p>
                                <p class="text-white/70 text-sm">Received: ${message.timestamp.toLocaleString()}</p>
                            </div>
                            <div class="text-right">
                                <span class="bg-${urgencyColors[message.urgency]}-500/20 text-${urgencyColors[message.urgency]}-400 px-3 py-1 rounded-full text-xs font-semibold inline-block mb-2">
                                    <i class="fas fa-flag mr-1"></i>${message.urgency} priority
                                </span>
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-2">
                            <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-semibold">
                                <i class="fas ${intentIcons[message.intent]} mr-1"></i>${message.intent}
                            </span>
                            <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full text-xs font-semibold">
                                <i class="fas fa-building mr-1"></i>${message.department}
                            </span>
                            <span class="bg-${sentimentColor}-500/20 text-${sentimentColor}-400 px-3 py-1 rounded-full text-xs font-semibold">
                                <i class="fas fa-smile mr-1"></i>${sentimentLabel} (${Math.round(message.sentiment * 100)}%)
                            </span>
                            <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs font-semibold">
                                <i class="fas fa-robot mr-1"></i>${message.confidence}% AI Confidence
                            </span>
                        </div>
                    </div>

                    <!-- Message Content -->
                    <div class="glass rounded-lg p-4">
                        <h4 class="text-white font-semibold mb-2 flex items-center">
                            <i class="fas fa-message mr-2 text-blue-400"></i>
                            Message Content
                        </h4>
                        <p class="text-white/80">${message.preview}</p>
                        ${message.tags ? `
                            <div class="mt-3 pt-3 border-t border-white/10">
                                <p class="text-white/70 text-xs mb-2">Tags:</p>
                                <div class="flex flex-wrap gap-2">
                                    ${message.tags.map(tag => `<span class="bg-white/10 text-white/70 px-2 py-1 rounded text-xs">#${tag}</span>`).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>

                    <!-- CRM Integration: Constituent Profile -->
                    ${message.constituentProfile ? renderConstituentProfile(message.constituentProfile) : ''}

                    <!-- CRM Integration: Relationship Intelligence -->
                    ${message.relationshipData ? renderRelationshipIntelligence(message.relationshipData) : ''}

                    <!-- Action Buttons -->
                    <div class="glass rounded-lg p-4 flex flex-wrap gap-3">
                        <button class="glass px-4 py-2 rounded-lg text-white hover:bg-blue-500/30 transition flex items-center gap-2">
                            <i class="fas fa-reply"></i>Reply
                        </button>
                        <button class="glass px-4 py-2 rounded-lg text-white hover:bg-purple-500/30 transition flex items-center gap-2">
                            <i class="fas fa-share"></i>Forward
                        </button>
                        <button class="glass px-4 py-2 rounded-lg text-white hover:bg-green-500/30 transition flex items-center gap-2">
                            <i class="fas fa-check"></i>Mark Resolved
                        </button>
                        <button class="glass px-4 py-2 rounded-lg text-white hover:bg-yellow-500/30 transition flex items-center gap-2">
                            <i class="fas fa-user-plus"></i>Assign
                        </button>
                        <button class="glass px-4 py-2 rounded-lg text-white hover:bg-red-500/30 transition flex items-center gap-2">
                            <i class="fas fa-flag"></i>Escalate
                        </button>
                    </div>
                </div>
            `;

            // Show modal
            const modal = document.getElementById('messageDetailModal');
            const content = document.getElementById('messageDetailContent');
            if (modal && content) {
                content.innerHTML = modalContent;
                modal.classList.remove('hidden');
            }
        }

        function closeMessageDetail() {
            const modal = document.getElementById('messageDetailModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        function setupInboxSearch() {
            const searchInput = document.getElementById('inboxSearchInput');
            if (!searchInput) return;

            let debounceTimer;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    const query = e.target.value.toLowerCase();
                    // TODO: Implement search functionality
                    console.log('Searching inbox for:', query);
                }, 300);
            });
        }

        function getTimeAgo(timestamp) {
            const seconds = Math.floor((new Date() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            return `${Math.floor(seconds / 86400)}d ago`;
        }

        // Enhanced 2024-10-30: CRM Integration Functions
        // MOCK DATA - Replace in production
        // TODO: Connect to CRM API endpoint

        function renderConstituentProfile(profile) {
            if (!profile) return '<div class="text-white/60 text-sm">No profile data available</div>';

            const stars = 'â˜…'.repeat(Math.floor(profile.satisfactionScore)) + 'â˜†'.repeat(5 - Math.floor(profile.satisfactionScore));

            return `
                <div class="glass rounded-lg p-4 mb-4">
                    <h4 class="text-white font-semibold mb-3 flex items-center">
                        <i class="fas fa-user-circle mr-2 text-blue-400"></i>
                        Constituent Profile
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-white/70 text-sm mb-1">CRM ID</p>
                            <p class="text-white font-medium">${profile.id}</p>
                        </div>
                        <div>
                            <p class="text-white/70 text-sm mb-1">Phone</p>
                            <p class="text-white font-medium">${profile.phone}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="text-white/70 text-sm mb-1">Address</p>
                            <p class="text-white font-medium">${profile.address}</p>
                        </div>
                        <div>
                            <p class="text-white/70 text-sm mb-1">Residency</p>
                            <p class="text-white font-medium">${profile.residency}</p>
                        </div>
                        <div>
                            <p class="text-white/70 text-sm mb-1">Previous Contacts</p>
                            <p class="text-white font-medium">${profile.previousContacts} contacts</p>
                        </div>
                        <div>
                            <p class="text-white/70 text-sm mb-1">Total Requests</p>
                            <p class="text-white font-medium">${profile.totalRequests} requests</p>
                        </div>
                        <div>
                            <p class="text-white/70 text-sm mb-1">Avg Response Time</p>
                            <p class="text-white font-medium">${profile.avgResponseTime}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="text-white/70 text-sm mb-1">Satisfaction Score</p>
                            <p class="text-yellow-400 text-lg">${stars} <span class="text-white text-sm">${profile.satisfactionScore}/5.0</span></p>
                        </div>
                        ${profile.demographics ? `
                        <div class="col-span-2 pt-3 border-t border-white/10">
                            <p class="text-white/70 text-sm mb-2">Demographics</p>
                            <div class="flex flex-wrap gap-2">
                                ${profile.demographics.age !== 'Unknown' ? `<span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full text-xs">Age: ${profile.demographics.age}</span>` : ''}
                                ${profile.demographics.householdSize !== 'Unknown' ? `<span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs">Household: ${profile.demographics.householdSize}</span>` : ''}
                                ${profile.demographics.propertyOwner === true ? '<span class="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-xs">Property Owner</span>' : ''}
                                ${profile.demographics.businessOwner === true ? '<span class="bg-yellow-500/20 text-yellow-400 px-3 py-1 rounded-full text-xs">Business Owner</span>' : ''}
                                ${profile.demographics.rentalProperty === true ? '<span class="bg-orange-500/20 text-orange-400 px-3 py-1 rounded-full text-xs">Rental Property</span>' : ''}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function renderRelationshipIntelligence(data) {
            if (!data) return '<div class="text-white/60 text-sm">No relationship data available</div>';

            const lifetimeColors = {
                'Very High': 'green',
                'High': 'blue',
                'Medium': 'yellow',
                'Low': 'red'
            };

            const engagementColors = {
                'Very Active': 'green',
                'Active': 'blue',
                'Moderate': 'yellow',
                'Low': 'orange',
                'Anonymous': 'purple'
            };

            const riskColors = {
                'Low': 'green',
                'Medium': 'yellow',
                'High': 'red'
            };

            return `
                <div class="glass rounded-lg p-4">
                    <h4 class="text-white font-semibold mb-3 flex items-center">
                        <i class="fas fa-chart-line mr-2 text-purple-400"></i>
                        Relationship Intelligence
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div class="glass rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">Lifetime Value</p>
                            <p class="text-${lifetimeColors[data.lifetimeValue]}-400 font-bold text-lg">${data.lifetimeValue}</p>
                        </div>
                        <div class="glass rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">Engagement Level</p>
                            <p class="text-${engagementColors[data.engagementLevel]}-400 font-bold text-lg">${data.engagementLevel}</p>
                        </div>
                        <div class="glass rounded-lg p-3">
                            <p class="text-white/70 text-xs mb-1">Risk Score</p>
                            <p class="text-${riskColors[data.riskScore]}-400 font-bold text-lg">${data.riskScore}</p>
                        </div>
                    </div>

                    ${data.activeServices && data.activeServices.length > 0 ? `
                    <div class="mb-4">
                        <p class="text-white/70 text-sm mb-2">Active Services</p>
                        <div class="flex flex-wrap gap-2">
                            ${data.activeServices.map(service => `
                                <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-briefcase mr-1"></i>${service}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                    ` : ''}

                    ${data.associatedRecords && data.associatedRecords.length > 0 ? `
                    <div class="mb-4">
                        <p class="text-white/70 text-sm mb-2">Associated Records</p>
                        <div class="space-y-2">
                            ${data.associatedRecords.map(record => {
                                const statusColors = {
                                    'Active': 'green',
                                    'Completed': 'blue',
                                    'Approved': 'green',
                                    'Pending': 'yellow',
                                    'Pending Renewal': 'yellow',
                                    'Open': 'yellow',
                                    'Failed': 'red',
                                    'Resolved': 'blue',
                                    'Processing': 'yellow',
                                    'Fulfilled': 'green',
                                    'Under Investigation': 'orange'
                                };
                                const statusColor = statusColors[record.status] || 'gray';
                                return `
                                    <div class="glass rounded-lg p-2 flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="text-white text-sm font-medium">${record.type} #${record.id}</p>
                                            <p class="text-white/60 text-xs">${record.date}${record.amount ? ` â€¢ ${record.amount}` : ''}</p>
                                        </div>
                                        <span class="bg-${statusColor}-500/20 text-${statusColor}-400 px-2 py-1 rounded text-xs font-semibold">
                                            ${record.status}
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}

                    ${data.interactionHistory && data.interactionHistory.length > 0 ? `
                    <div>
                        <p class="text-white/70 text-sm mb-2">Interaction History</p>
                        <div class="space-y-2 max-h-60 overflow-y-auto">
                            ${data.interactionHistory.map((interaction, index) => {
                                const typeIcons = {
                                    'Email': 'fa-envelope',
                                    'Phone Call': 'fa-phone',
                                    'Web Form': 'fa-globe',
                                    'SMS': 'fa-sms',
                                    'Social Media': 'fa-comments',
                                    'In Person': 'fa-user'
                                };
                                const icon = typeIcons[interaction.type] || 'fa-circle';
                                const isFirst = index === 0;
                                return `
                                    <div class="flex items-start gap-3 ${isFirst ? 'opacity-100' : 'opacity-70'}">
                                        <div class="w-8 h-8 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                                            <i class="fas ${icon} text-blue-400 text-xs"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="text-white text-sm">${interaction.topic}</p>
                                            <p class="text-white/60 text-xs">
                                                ${interaction.date} â€¢ ${interaction.type}
                                                ${interaction.duration ? ` â€¢ ${interaction.duration}` : ''}
                                                ${interaction.responded !== undefined ? ` â€¢ ${interaction.responded ? '<span class="text-green-400">Responded</span>' : '<span class="text-yellow-400">Pending</span>'}` : ''}
                                            </p>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        // CJIS Security Configuration Functions - Added 2025-10-29
        // MOCK DATA - Replace in production
        // TODO: Connect to CJIS security API endpoint

        function openCJISConfig() {
            const cjisConfig = document.getElementById('cjisSecurityConfig');
            if (cjisConfig) {
                cjisConfig.classList.remove('hidden');
                // Scroll to the configuration section
                cjisConfig.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function closeCJISConfig() {
            const cjisConfig = document.getElementById('cjisSecurityConfig');
            if (cjisConfig) {
                cjisConfig.classList.add('hidden');
            }
        }

        function switchCJISTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.cjis-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.cjis-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`cjis${tabName}Tab`).classList.remove('hidden');
        }

        function saveCJISConfiguration() {
            // TODO: Send configuration to backend API
            // For now, show success notification
            showNotification('âœ“ CJIS Security Configuration saved successfully', 'success');

            // Log configuration for development
            console.log('CJIS Configuration saved:', {
                mfa: document.querySelector('#cjisSecurityConfig input[type="checkbox"]').checked,
                timestamp: new Date().toISOString()
            });
        }

        function toggleMFA(checkbox) {
            const status = checkbox.checked ? 'enabled' : 'disabled';
            console.log(`MFA ${status}`);
            // TODO: Update MFA configuration via API
        }

        function toggleBiometric(checkbox) {
            const status = checkbox.checked ? 'enabled' : 'disabled';
            console.log(`Biometric authentication ${status}`);
            // TODO: Update biometric configuration via API
        }

        function toggleHardwareKeys(checkbox) {
            const status = checkbox.checked ? 'enabled' : 'disabled';
            console.log(`Hardware key support ${status}`);
            // TODO: Update hardware key configuration via API
        }

        function updatePasswordPolicy() {
            const minLength = document.getElementById('passwordMinLength').value;
            const expiration = document.getElementById('passwordExpiration').value;
            const lockout = document.getElementById('passwordLockout').value;

            console.log('Password policy updated:', { minLength, expiration, lockout });
            // TODO: Send password policy to backend API
        }

        function updateSessionTimeout() {
            const timeout = document.getElementById('sessionTimeout').value;
            console.log('Session timeout updated:', timeout);
            // TODO: Send session timeout to backend API
        }

        function exportAuditLogs(format) {
            showNotification(`Exporting audit logs as ${format.toUpperCase()}...`, 'info');

            // TODO: Connect to API endpoint to export actual logs
            // MOCK: Simulate export
            setTimeout(() => {
                showNotification(`âœ“ Audit logs exported successfully as ${format.toUpperCase()}`, 'success');
                console.log(`Audit logs exported in ${format} format`);
            }, 1500);
        }

        // Regulation Assistant Functions - Added 2025-10-07
        // MOCK DATA - Replace in production
        // TODO: Connect to city regulations API endpoint

        let regulationConversationHistory = [];

        const regulationDatabase = {
            'fence': {
                question: 'Do I need a permit to build a fence?',
                answer: `Great question! Here's what you need to know about building a fence:\n\n<strong>âš ï¸ Permit Required</strong> for fences over 6 feet tall\n\n<strong>âœ“ No Permit Needed</strong> for fences 6 feet or shorter\n\n<strong>Important Rules:</strong>\nâ€¢ Front yard fences: Maximum 4 feet tall\nâ€¢ Side/back yard fences: Maximum 8 feet tall\nâ€¢ Must be 2 feet from property line (unless on the line with neighbor's agreement)\nâ€¢ Corner lots: Special visibility requirements apply\nâ€¢ HOA approval may be required in some neighborhoods\n\n<strong>Estimated Timeline:</strong> Permit approval takes 5-7 business days`,
                department: 'Building & Safety Department',
                phone: '(555) 123-4567',
                email: 'building@cityname.gov',
                forms: ['Fence Permit Application', 'Property Survey'],
                citation: 'City Code Â§ 18.42.090 - Fence Regulations'
            },
            'home business': {
                question: 'How do I start a home business?',
                answer: `Starting a home business is easier than you think! Here's what you need:\n\n<strong>âœ“ Home Occupation Permit</strong> (Required for all home businesses)\n\n<strong>Requirements:</strong>\nâ€¢ Business must be conducted entirely indoors\nâ€¢ No employees visiting your home (family members OK)\nâ€¢ No signs visible from the street\nâ€¢ No increased traffic or parking issues\nâ€¢ Business activities shouldn't disturb neighbors\n\n<strong>âš ï¸ Also Need:</strong>\nâ€¢ Business license ($50-$200 depending on business type)\nâ€¢ Zoning clearance (free, usually approved same day)\nâ€¢ Sales tax permit (if selling goods)\n\n<strong>Not Allowed from Home:</strong>\nâœ— Auto repair shops\nâœ— Restaurants or food service\nâœ— Retail stores with foot traffic\n\n<strong>Processing Time:</strong> 2-3 weeks for full approval`,
                department: 'Economic Development Office',
                phone: '(555) 234-5678',
                email: 'business@cityname.gov',
                forms: ['Home Occupation Permit Application', 'Business License Application'],
                citation: 'City Code Â§ 17.228.330 - Home Occupations'
            },
            'chickens': {
                question: 'What are the rules for keeping chickens?',
                answer: `You can keep chickens in the city! Here are the rules:\n\n<strong>âœ“ Allowed</strong> - Hens only (up to 6)\n\n<strong>âœ— Not Allowed</strong> - Roosters (due to noise)\n\n<strong>Requirements:</strong>\nâ€¢ Maximum 6 hens per property\nâ€¢ Coop must be at least 20 feet from any neighboring home\nâ€¢ Coop must be clean, sanitary, and secure from predators\nâ€¢ Lot size must be at least 6,000 square feet\nâ€¢ Free-range chickens OK, but must stay on your property\n\n<strong>âš ï¸ Permit Required:</strong>\nâ€¢ Urban Chicken Permit (one-time fee: $35)\nâ€¢ Annual inspection may be required\n\n<strong>Good to Know:</strong>\nâ€¢ Chickens are quiet and make great pets\nâ€¢ Fresh eggs daily!\nâ€¢ Many neighbors won't even notice\n\n<strong>Processing Time:</strong> Permit issued same day if requirements met`,
                department: 'Animal Control Services',
                phone: '(555) 345-6789',
                email: 'animals@cityname.gov',
                forms: ['Urban Chicken Permit Application', 'Coop Specifications Form'],
                citation: 'Municipal Code Â§ 6.04.115 - Keeping of Chickens'
            },
            'deck': {
                question: 'Do I need a permit to add a deck?',
                answer: `Yes, most decks require a permit. Here's the breakdown:\n\n<strong>âš ï¸ Permit Required</strong> for decks that are:\nâ€¢ More than 30 inches above ground\nâ€¢ Attached to your house\nâ€¢ Larger than 200 square feet\n\n<strong>âœ“ No Permit Needed</strong> for:\nâ€¢ Ground-level decks (less than 30 inches high)\nâ€¢ Smaller than 200 square feet\nâ€¢ Not attached to house\n\n<strong>What You'll Need:</strong>\nâ€¢ Site plan showing deck location\nâ€¢ Deck design drawings with dimensions\nâ€¢ Foundation details\nâ€¢ Railing plans (required for decks over 30" high)\n\n<strong>Important:</strong>\nâ€¢ Inspections required during construction\nâ€¢ Must meet current building codes\nâ€¢ Setback requirements apply (usually 5 feet from property line)\n\n<strong>Processing Time:</strong> 7-10 business days\n<strong>Permit Cost:</strong> $150-$400 (based on deck size)`,
                department: 'Building & Safety Department',
                phone: '(555) 123-4567',
                email: 'building@cityname.gov',
                forms: ['Building Permit Application', 'Deck Plan Requirements'],
                citation: 'Building Code Â§ 105.2 - Deck Construction Permits'
            },
            'business license': {
                question: 'How do I get a business license?',
                answer: `Getting a business license is straightforward! Here's the process:\n\n<strong>Step 1: Determine Your Business Type</strong>\nDifferent businesses have different fees ($50-$500 annually)\n\n<strong>Step 2: Gather Documents</strong>\nâ€¢ Valid ID or driver's license\nâ€¢ Business name and address\nâ€¢ Owner's Social Security Number or Federal EIN\nâ€¢ Zoning clearance (for physical locations)\n\n<strong>Step 3: Apply</strong>\nâ€¢ Online: cityname.gov/business-license (fastest!)\nâ€¢ In-person: City Hall, 2nd floor\nâ€¢ By mail: Business License Office, 123 Main St.\n\n<strong>âš ï¸ Additional Requirements May Include:</strong>\nâ€¢ Sellers permit (for retail)\nâ€¢ Health permit (for food businesses)\nâ€¢ Professional licenses (contractors, etc.)\nâ€¢ Fire inspection (for restaurants, retail)\n\n<strong>Processing Time:</strong>\nâ€¢ Online: 1-2 business days\nâ€¢ In-person: Same day\nâ€¢ Mail: 5-7 business days\n\n<strong>Good to Know:</strong> Licenses renew annually every January`,
                department: 'City Clerk\'s Office',
                phone: '(555) 456-7890',
                email: 'clerk@cityname.gov',
                forms: ['Business License Application', 'Zoning Clearance Form'],
                citation: 'Municipal Code Â§ 5.02 - Business Licenses'
            },
            'rv parking': {
                question: 'Can I park an RV in my driveway?',
                answer: `The rules for RV parking depend on how long you plan to keep it there:\n\n<strong>âœ“ Allowed (Short-term):</strong>\nâ€¢ Park in your driveway for up to 72 hours for loading/unloading\nâ€¢ Must be actively preparing for a trip or just returned\n\n<strong>âš ï¸ Long-term Storage Rules:</strong>\nâ€¢ RVs cannot be parked on street for more than 72 consecutive hours\nâ€¢ Driveway storage OK if:\n  - Vehicle is fully on your property (not blocking sidewalk)\n  - Not being used as living space\n  - Properly registered and operational\n\n<strong>âœ— Not Allowed:</strong>\nâ€¢ Living in an RV on residential property\nâ€¢ Parking on front lawn\nâ€¢ Blocking sidewalk or street access\nâ€¢ Commercial RV storage on residential property\n\n<strong>Alternative:</strong>\nMany homeowners use side yards (if wide enough) or rent storage spaces at RV facilities.\n\n<strong>âš ï¸ Violation Fine:</strong> $100 for first offense\n\n<strong>Good to Know:</strong> HOA rules may be stricter than city rules`,
                department: 'Code Enforcement',
                phone: '(555) 567-8901',
                email: 'code@cityname.gov',
                forms: ['RV Parking Appeal Form'],
                citation: 'Zoning Code Â§ 20.48.060 - Vehicle Parking Standards'
            },
            'block party': {
                question: 'What permits do I need for a block party?',
                answer: `Block parties are a great way to build community! Here's what you need:\n\n<strong>âš ï¸ Required Permits:</strong>\n\n<strong>1. Street Closure Permit (Free!)</strong>\nâ€¢ Apply at least 14 days before event\nâ€¢ Requires signatures from 75% of affected residents\nâ€¢ Usually approved for 4-6 hours\n\n<strong>2. Special Event Permit</strong>\nâ€¢ Free for non-commercial neighborhood events\nâ€¢ Required if you're:\n  - Using amplified music\n  - Setting up tents or structures\n  - Expecting more than 100 people\n\n<strong>âœ“ No Permit Needed for:</strong>\nâ€¢ Small gatherings (under 25 people) in yards or parks\nâ€¢ Events that don't block streets\n\n<strong>What the City Provides:</strong>\nâ€¢ Barricades and "Street Closed" signs\nâ€¢ Help with traffic routing\nâ€¢ Police notification (for safety)\n\n<strong>Your Responsibilities:</strong>\nâ€¢ Keep emergency access clear\nâ€¢ Clean up after event\nâ€¢ Respect noise curfew (10 PM weekdays, 11 PM weekends)\n\n<strong>Processing Time:</strong> 7-10 business days\n<strong>Pro Tip:</strong> Apply early during summer - permits go fast!`,
                department: 'Special Events Office',
                phone: '(555) 678-9012',
                email: 'events@cityname.gov',
                forms: ['Street Closure Application', 'Neighborhood Signature Sheet'],
                citation: 'Municipal Code Â§ 12.32 - Street Closures for Events'
            },
            'tree': {
                question: 'Can I cut down a tree on my property?',
                answer: `Tree removal rules protect our urban forest. Here's what you need to know:\n\n<strong>âš ï¸ Permit Required</strong> for removing:\nâ€¢ Trees with trunk diameter over 8 inches (measured 4.5 feet from ground)\nâ€¢ Any heritage trees (over 50 years old)\nâ€¢ Trees in protected areas\n\n<strong>âœ“ No Permit Needed</strong> for:\nâ€¢ Small trees (trunk under 8 inches diameter)\nâ€¢ Dead or dangerous trees posing immediate hazard\nâ€¢ Trimming and pruning (within reason)\n\n<strong>Application Process:</strong>\nâ€¢ Submit photos of tree from 4 angles\nâ€¢ Arborist report (required for trees over 24" diameter)\nâ€¢ Reason for removal\nâ€¢ Replacement tree plan (usually 2 new trees required)\n\n<strong>Valid Reasons for Removal:</strong>\nâ€¢ Tree is diseased or dying\nâ€¢ Causing structural damage to home\nâ€¢ Creating safety hazard\nâ€¢ Interfering with approved construction\n\n<strong>âœ— Not Valid Reasons:</strong>\nâ€¢ "Too many leaves"\nâ€¢ Blocking view\nâ€¢ Don't like it\n\n<strong>Processing Time:</strong> 15-30 days\n<strong>Permit Cost:</strong> $75-$250\n<strong>Emergency Removals:</strong> Call 24/7 hotline for dangerous trees`,
                department: 'Urban Forestry Division',
                phone: '(555) 789-0123',
                email: 'trees@cityname.gov',
                forms: ['Tree Removal Permit Application', 'Arborist Report Template'],
                citation: 'Tree Protection Ordinance Â§ 12.36.080'
            },
            'short-term rental': {
                question: 'What are the rules for short-term rentals?',
                answer: `Short-term rentals (like Airbnb) are regulated to balance tourism and neighborhood quality. Here's what's allowed:\n\n<strong>âš ï¸ Permit Required</strong> - Short-Term Rental License ($500/year)\n\n<strong>âœ“ Allowed (with permit):</strong>\nâ€¢ Renting your primary residence while you're away\nâ€¢ Renting a room while you're home (home-share)\nâ€¢ Maximum 180 days per year (for full-unit rentals)\n\n<strong>Requirements:</strong>\nâ€¢ Must be your primary residence (live there 275+ days/year)\nâ€¢ Register with city and pay TOT tax (12%)\nâ€¢ $1 million liability insurance required\nâ€¢ Post emergency contact info for guests\nâ€¢ Respond to complaints within 60 minutes\nâ€¢ Maximum 2 guests per bedroom + 2\n\n<strong>âœ— Not Allowed:</strong>\nâ€¢ Converting apartments/condos to hotels\nâ€¢ Renting out investment properties short-term\nâ€¢ Operating multiple short-term rentals\n\n<strong>Good Neighbor Rules:</strong>\nâ€¢ No parties or events\nâ€¢ Quiet hours 10 PM - 8 AM\nâ€¢ Provide parking for guests\nâ€¢ Keep accurate guest records\n\n<strong>Penalties:</strong>\nâ€¢ Operating without permit: $1,000/day fine\nâ€¢ Repeat violations: License revocation\n\n<strong>Processing Time:</strong> 3-4 weeks`,
                department: 'Planning & Zoning',
                phone: '(555) 890-1234',
                email: 'planning@cityname.gov',
                forms: ['Short-Term Rental Application', 'Good Neighbor Agreement'],
                citation: 'Zoning Ordinance Â§ 5.35 - Short-Term Residential Occupancy'
            },
            'garage sale': {
                question: 'Do I need a permit for a garage sale?',
                answer: `Good news - garage sales are easy!\n\n<strong>âœ“ No Permit Required!</strong>\n\nYou can have a garage sale without a permit, but there are some rules:\n\n<strong>Rules:</strong>\nâ€¢ Maximum 3 garage sales per year at your home\nâ€¢ Each sale can last up to 3 consecutive days\nâ€¢ Hours: 7 AM - 7 PM only\nâ€¢ Must be at your residence (items from your home)\n\n<strong>âœ“ Allowed:</strong>\nâ€¢ Yard signs on your property\nâ€¢ One temporary sign at nearest intersection (remove after sale)\nâ€¢ Selling personal household items\nâ€¢ Multi-family sales with neighbors\n\n<strong>âœ— Not Allowed:</strong>\nâ€¢ Selling new merchandise\nâ€¢ Operating as a business (buying items to resell)\nâ€¢ Signs on utility poles or public property\nâ€¢ Blocking sidewalks or streets\n\n<strong>Signs:</strong>\nâ€¢ Must be removed within 24 hours after sale\nâ€¢ Maximum size: 6 square feet\nâ€¢ Must be secured (can't blow away)\n\n<strong>Pro Tips:</strong>\nâ€¢ Advertise on free community boards online\nâ€¢ Team up with neighbors for more traffic\nâ€¢ Price items to sell (remember, people are looking for deals!)\nâ€¢ Have small bills for change\n\n<strong>âš ï¸ What if I want more than 3 sales per year?</strong>\nYou'd need a business license (then it becomes a business, not a garage sale).`,
                department: 'Code Enforcement',
                phone: '(555) 567-8901',
                email: 'code@cityname.gov',
                forms: ['No forms needed!'],
                citation: 'Municipal Code Â§ 5.80.020 - Garage Sales'
            }
        };

        function initializeRegulationAssistant() {
            const container = document.getElementById('regulationAssistant');
            if (!container) return;

            container.innerHTML = `
                <!-- Compact Header Card -->
                <div class="glass rounded-xl p-5 mb-4">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center flex-shrink-0">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h2 class="text-xl font-bold text-white">Ask About City Regulations</h2>
                            <p class="text-white/70 text-sm">Get instant answers about permits and city requirements</p>
                        </div>
                    </div>
                </div>

                <!-- Compact Sample Questions (horizontal scroll) -->
                <div class="glass rounded-xl p-4 mb-4">
                    <p class="text-white/70 text-xs mb-2 font-semibold">Popular Questions:</p>
                    <div class="regulation-questions-container">
                        <!-- Left scroll button -->
                        <button id="regScrollLeft" class="regulation-scroll-btn regulation-scroll-btn-left hidden" onclick="scrollRegulationQuestions('left')" aria-label="Scroll left">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                            </svg>
                        </button>

                        <!-- Right scroll button -->
                        <button id="regScrollRight" class="regulation-scroll-btn regulation-scroll-btn-right" onclick="scrollRegulationQuestions('right')" aria-label="Scroll right">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                            </svg>
                        </button>

                        <div id="regQuestionsScroll" class="regulation-questions-scroll flex gap-2 overflow-x-auto pb-2 pr-2" style="scrollbar-width: thin; -webkit-overflow-scrolling: touch;">
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('Do I need a permit to build a fence?')">
                                ðŸ¡ Fence Permit?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('How do I start a home business?')">
                                ðŸ’¼ Home Business?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('What are the rules for keeping chickens?')">
                                ðŸ” Keeping Chickens?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('Do I need a permit to add a deck?')">
                                ðŸ”¨ Deck Permit?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('How do I get a business license?')">
                                ðŸ“‹ Business License?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('Can I park an RV in my driveway?')">
                                ðŸš RV Parking?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('What permits do I need for a block party?')">
                                ðŸŽ‰ Block Party?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('Can I cut down a tree on my property?')">
                                ðŸŒ² Tree Removal?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('What are the rules for short-term rentals?')">
                                ðŸ  Airbnb Rules?
                            </button>
                            <button class="regulation-sample-question whitespace-nowrap flex-shrink-0 text-xs px-3 py-2" onclick="askRegulationQuestion('Do I need a permit for a garage sale?')">
                                ðŸ›’ Garage Sale?
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Compact Chat Interface -->
                <div class="glass rounded-xl p-4 mb-4 h-[400px] overflow-y-auto regulation-chat-container" id="regChatContainer">
                    <div id="regChatMessages">
                        <!-- Welcome message -->
                        <div class="flex items-start mb-4">
                            <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center mr-2 flex-shrink-0">
                                <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                            </div>
                            <div class="regulation-chat-bubble-assistant p-3 max-w-[85%]">
                                <p class="text-white font-semibold mb-1 text-sm">ðŸ‘‹ Hi! I'm your Regulation Assistant</p>
                                <p class="text-white/90 text-sm">Ask me about permits, licenses, property rules, or click a question above!</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compact Input Area -->
                <div class="glass rounded-xl p-3">
                    <div class="flex gap-2">
                        <input
                            type="text"
                            id="regQuestionInput"
                            class="flex-1 px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm placeholder-white/50 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/50"
                            placeholder="Ask your question here..."
                            onkeypress="if(event.key === 'Enter') sendRegulationMessage()"
                            aria-label="Question input"
                        >
                        <button onclick="sendRegulationMessage()" class="px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-blue-500 text-white text-sm font-semibold hover:shadow-lg hover:shadow-purple-500/50 transition-all" aria-label="Send message">
                            Send
                        </button>
                    </div>
                </div>
            `;

            // Initialize scroll buttons after DOM is created
            setTimeout(updateRegulationScrollButtons, 100);
        }

        function findRegulation(question) {
            const lowerQuestion = question.toLowerCase();

            if (lowerQuestion.includes('fence')) return regulationDatabase['fence'];
            if (lowerQuestion.includes('home business') || lowerQuestion.includes('work from home')) return regulationDatabase['home business'];
            if (lowerQuestion.includes('chicken') || lowerQuestion.includes('poultry')) return regulationDatabase['chickens'];
            if (lowerQuestion.includes('deck') || lowerQuestion.includes('patio')) return regulationDatabase['deck'];
            if (lowerQuestion.includes('business license')) return regulationDatabase['business license'];
            if (lowerQuestion.includes('rv') || lowerQuestion.includes('motor home') || lowerQuestion.includes('park')) return regulationDatabase['rv parking'];
            if (lowerQuestion.includes('block party') || lowerQuestion.includes('street party') || lowerQuestion.includes('event permit')) return regulationDatabase['block party'];
            if (lowerQuestion.includes('tree') || lowerQuestion.includes('cut down')) return regulationDatabase['tree'];
            if (lowerQuestion.includes('short-term rental') || lowerQuestion.includes('airbnb') || lowerQuestion.includes('vrbo')) return regulationDatabase['short-term rental'];
            if (lowerQuestion.includes('garage sale') || lowerQuestion.includes('yard sale')) return regulationDatabase['garage sale'];

            return {
                question: question,
                answer: `I'd be happy to help you with that question! While I don't have specific information about that topic in my database yet, here's what I can do:\n\n<strong>I can help you with questions about:</strong>\nâ€¢ Building permits (fences, decks, additions)\nâ€¢ Business licenses and home businesses\nâ€¢ Property regulations (trees, parking, structures)\nâ€¢ Pet ownership rules (chickens, dogs, etc.)\nâ€¢ Event permits (block parties, garage sales)\nâ€¢ Zoning questions (short-term rentals, home businesses)\n\nPlease try asking one of the sample questions above, or rephrase your question to match one of these topics!`,
                department: 'City Information Desk',
                phone: '(555) 311-CITY',
                email: 'info@cityname.gov',
                forms: [],
                citation: 'For specific regulations, please contact the appropriate department'
            };
        }

        function askRegulationQuestion(question) {
            document.getElementById('regQuestionInput').value = question;
            sendRegulationMessage();
        }

        function sendRegulationMessage() {
            const input = document.getElementById('regQuestionInput');
            const question = input.value.trim();

            if (!question) return;

            addRegulationUserMessage(question);
            input.value = '';

            showRegulationTypingIndicator();

            setTimeout(() => {
                hideRegulationTypingIndicator();
                const regulation = findRegulation(question);
                addRegulationAssistantMessage(regulation);
            }, 400 + Math.random() * 300);
        }

        function addRegulationUserMessage(text) {
            const chatMessages = document.getElementById('regChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start mb-4 justify-end';
            messageDiv.innerHTML = `
                <div class="regulation-chat-bubble-user p-3 max-w-[85%]">
                    <p class="text-white text-sm">${text}</p>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            scrollRegulationToBottom();

            regulationConversationHistory.push({
                role: 'user',
                content: text,
                timestamp: new Date().toISOString()
            });
        }

        function addRegulationAssistantMessage(regulation) {
            const chatMessages = document.getElementById('regChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start mb-4';

            const formattedAnswer = regulation.answer
                .replace(/âœ“/g, '<span class="regulation-indicator-allowed">âœ“</span>')
                .replace(/âœ—/g, '<span class="regulation-indicator-not-allowed">âœ—</span>')
                .replace(/âš ï¸/g, '<span class="regulation-indicator-permit">âš ï¸</span>');

            const formsHTML = regulation.forms && regulation.forms.length > 0
                ? `<div class="regulation-info-card">
                    <p class="text-blue-300 font-semibold text-xs mb-1">ðŸ“‹ Required Forms:</p>
                    ${regulation.forms.map(form => `<p class="text-white/80 text-xs">â€¢ ${form}</p>`).join('')}
                    <a href="#" class="regulation-link-button text-xs px-3 py-1 mt-2">Download Forms</a>
                </div>`
                : '';

            messageDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center mr-2 flex-shrink-0">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <div class="regulation-chat-bubble-assistant p-3 max-w-[85%]">
                    <div class="text-white/90 text-sm leading-relaxed mb-3 whitespace-pre-line">${formattedAnswer}</div>

                    ${formsHTML}

                    <div class="regulation-contact-card">
                        <p class="text-purple-300 font-semibold text-xs mb-1">ðŸ“ž Need Help?</p>
                        <p class="text-white/90 text-xs font-semibold">${regulation.department}</p>
                        <p class="text-white/70 text-xs">${regulation.phone} â€¢ ${regulation.email}</p>
                    </div>

                    ${regulation.citation ? `
                        <div class="mt-2 text-white/50 text-xs">
                            ðŸ“– ${regulation.citation}
                        </div>
                    ` : ''}
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            scrollRegulationToBottom();

            regulationConversationHistory.push({
                role: 'assistant',
                content: regulation.answer,
                department: regulation.department,
                timestamp: new Date().toISOString()
            });
        }

        function showRegulationTypingIndicator() {
            const chatMessages = document.getElementById('regChatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'regTypingIndicator';
            typingDiv.className = 'flex items-start mb-4';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center mr-2 flex-shrink-0">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <div class="regulation-chat-bubble-assistant p-3">
                    <div class="regulation-typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            scrollRegulationToBottom();
        }

        function hideRegulationTypingIndicator() {
            const indicator = document.getElementById('regTypingIndicator');
            if (indicator) indicator.remove();
        }

        function scrollRegulationToBottom() {
            const container = document.getElementById('regChatContainer');
            container.scrollTop = container.scrollHeight;
        }

        function scrollRegulationQuestions(direction) {
            const container = document.getElementById('regQuestionsScroll');
            const scrollAmount = 300;

            if (direction === 'left') {
                container.scrollLeft -= scrollAmount;
            } else {
                container.scrollLeft += scrollAmount;
            }

            setTimeout(updateRegulationScrollButtons, 100);
        }

        function updateRegulationScrollButtons() {
            const container = document.getElementById('regQuestionsScroll');
            const leftBtn = document.getElementById('regScrollLeft');
            const rightBtn = document.getElementById('regScrollRight');

            if (!container || !leftBtn || !rightBtn) return;

            if (container.scrollLeft <= 10) {
                leftBtn.classList.add('hidden');
            } else {
                leftBtn.classList.remove('hidden');
            }

            const maxScroll = container.scrollWidth - container.clientWidth;
            if (container.scrollLeft >= maxScroll - 10) {
                rightBtn.classList.add('hidden');
            } else {
                rightBtn.classList.remove('hidden');
            }
        }

        // Policy Intelligence Center Functions - Added 2025-10-07
        // MOCK DATA - Replace in production
        // TODO: Connect to legal database API
        // TODO: Implement real NLP model for policy analysis
        // TODO: Add authentication for legal team access only
        // TODO: Integrate with document management system

        const policyDatabase = [
            // Federal (15)
            { id: 1, title: 'Americans with Disabilities Act (ADA) - Title II Public Services', jurisdiction: 'Federal', department: 'Civil Rights', effectiveDate: '1990-07-26', lastAmended: '2010-03-15', status: 'Active', citation: '42 U.S.C. Â§ 12101', category: 'accessibility' },
            { id: 2, title: 'Occupational Safety and Health Act (OSHA) - Workplace Safety Standards', jurisdiction: 'Federal', department: 'Labor', effectiveDate: '1970-12-29', lastAmended: '2023-01-15', status: 'Active', citation: '29 CFR Â§ 1910', category: 'safety' },
            { id: 3, title: 'Fair Labor Standards Act (FLSA) - Wage and Hour Division', jurisdiction: 'Federal', department: 'Labor', effectiveDate: '1938-06-25', lastAmended: '2024-01-01', status: 'Active', citation: '29 U.S.C. Â§ 201', category: 'employment' },
            { id: 4, title: 'Family and Medical Leave Act (FMLA) - Employee Leave Requirements', jurisdiction: 'Federal', department: 'Labor', effectiveDate: '1993-02-05', lastAmended: '2023-08-12', status: 'Active', citation: '29 U.S.C. Â§ 2601', category: 'employment' },
            { id: 5, title: 'Clean Air Act (CAA) - EPA Emissions Standards', jurisdiction: 'Federal', department: 'EPA', effectiveDate: '1963-12-17', lastAmended: '2023-06-20', status: 'Active', citation: '42 U.S.C. Â§ 7401', category: 'environmental' },
            { id: 6, title: 'Clean Water Act (CWA) - Water Quality Regulations', jurisdiction: 'Federal', department: 'EPA', effectiveDate: '1972-10-18', lastAmended: '2024-03-10', status: 'Active', citation: '33 U.S.C. Â§ 1251', category: 'environmental' },
            { id: 7, title: 'Resource Conservation and Recovery Act (RCRA) - Waste Management', jurisdiction: 'Federal', department: 'EPA', effectiveDate: '1976-10-21', lastAmended: '2023-11-05', status: 'Active', citation: '42 U.S.C. Â§ 6901', category: 'environmental' },
            { id: 8, title: 'National Environmental Policy Act (NEPA) - Environmental Reviews', jurisdiction: 'Federal', department: 'EPA', effectiveDate: '1970-01-01', lastAmended: '2023-04-25', status: 'Active', citation: '42 U.S.C. Â§ 4321', category: 'environmental' },
            { id: 9, title: 'Federal Acquisition Regulation (FAR) - Government Procurement', jurisdiction: 'Federal', department: 'GSA', effectiveDate: '1984-04-01', lastAmended: '2024-01-15', status: 'Active', citation: '48 CFR Chapter 1', category: 'procurement' },
            { id: 10, title: 'Privacy Act - Personal Information Protection', jurisdiction: 'Federal', department: 'Justice', effectiveDate: '1974-12-31', lastAmended: '2023-09-18', status: 'Active', citation: '5 U.S.C. Â§ 552a', category: 'privacy' },
            { id: 11, title: 'Freedom of Information Act (FOIA) - Public Records Access', jurisdiction: 'Federal', department: 'Justice', effectiveDate: '1967-07-04', lastAmended: '2023-12-08', status: 'Active', citation: '5 U.S.C. Â§ 552', category: 'transparency' },
            { id: 12, title: 'Equal Employment Opportunity (EEO) - Non-Discrimination', jurisdiction: 'Federal', department: 'EEOC', effectiveDate: '1964-07-02', lastAmended: '2023-07-22', status: 'Active', citation: '42 U.S.C. Â§ 2000e', category: 'employment' },
            { id: 13, title: 'Uniformed Services Employment and Reemployment Rights Act (USERRA)', jurisdiction: 'Federal', department: 'Labor', effectiveDate: '1994-10-13', lastAmended: '2023-05-14', status: 'Active', citation: '38 U.S.C. Â§ 4301', category: 'employment' },
            { id: 14, title: 'Section 508 - Electronic Accessibility Requirements', jurisdiction: 'Federal', department: 'GSA', effectiveDate: '1998-08-07', lastAmended: '2023-10-30', status: 'Active', citation: '29 U.S.C. Â§ 794d', category: 'accessibility' },
            { id: 15, title: 'Davis-Bacon Act - Prevailing Wage Requirements', jurisdiction: 'Federal', department: 'Labor', effectiveDate: '1931-03-03', lastAmended: '2024-02-01', status: 'Active', citation: '40 U.S.C. Â§ 3141', category: 'employment' },
            // State (10)
            { id: 16, title: 'State Building Code - Chapter 34: Structural Standards', jurisdiction: 'State', department: 'Building', effectiveDate: '2015-01-01', lastAmended: '2024-01-01', status: 'Active', citation: 'SBC Ch. 34', category: 'safety' },
            { id: 17, title: 'Environmental Quality Act - Section 15: Impact Assessments', jurisdiction: 'State', department: 'Environment', effectiveDate: '1970-01-01', lastAmended: '2023-06-15', status: 'Active', citation: 'EQA Â§ 15', category: 'environmental' },
            { id: 18, title: 'Public Records Law - Chapter 66: Document Retention', jurisdiction: 'State', department: 'Secretary of State', effectiveDate: '1963-01-01', lastAmended: '2023-09-01', status: 'Active', citation: 'PRL Ch. 66', category: 'transparency' },
            { id: 19, title: 'Civil Service Law - Article 5: Personnel Management', jurisdiction: 'State', department: 'HR', effectiveDate: '1884-05-04', lastAmended: '2023-12-20', status: 'Active', citation: 'CSL Art. 5', category: 'employment' },
            { id: 20, title: 'Workers Compensation Law - Title 2: Injury Claims', jurisdiction: 'State', department: 'Labor', effectiveDate: '1914-07-01', lastAmended: '2024-01-01', status: 'Active', citation: 'WCL Title 2', category: 'employment' },
            { id: 21, title: 'State Fire Code - Chapter 9: Fire Safety Requirements', jurisdiction: 'State', department: 'Fire Marshal', effectiveDate: '1975-01-01', lastAmended: '2023-11-10', status: 'Active', citation: 'SFC Ch. 9', category: 'safety' },
            { id: 22, title: 'Zoning Enabling Act - Article 7: Land Use Planning', jurisdiction: 'State', department: 'Planning', effectiveDate: '1926-01-01', lastAmended: '2023-08-25', status: 'Active', citation: 'ZEA Art. 7', category: 'zoning' },
            { id: 23, title: 'Public Health Law - Title 4: Health and Safety Standards', jurisdiction: 'State', department: 'Health', effectiveDate: '1909-01-01', lastAmended: '2024-02-15', status: 'Active', citation: 'PHL Title 4', category: 'safety' },
            { id: 24, title: 'Motor Vehicle Code - Chapter 90: Traffic Regulations', jurisdiction: 'State', department: 'Transportation', effectiveDate: '1903-01-01', lastAmended: '2023-10-05', status: 'Active', citation: 'MVC Ch. 90', category: 'safety' },
            { id: 25, title: 'Open Meeting Law - Chapter 30A: Public Access to Government', jurisdiction: 'State', department: 'Attorney General', effectiveDate: '1975-07-01', lastAmended: '2023-07-30', status: 'Active', citation: 'OML Ch. 30A', category: 'transparency' },
            // Municipal (15)
            { id: 26, title: 'Zoning Ordinance Â§12.34 - Residential Height Restrictions', jurisdiction: 'Municipal', department: 'Planning', effectiveDate: '2010-03-15', lastAmended: '2025-10-05', status: 'Active', citation: 'MCC Â§12.34', category: 'zoning' },
            { id: 27, title: 'Building Code Â§45.67 - Permit Requirements', jurisdiction: 'Municipal', department: 'Building', effectiveDate: '2008-06-01', lastAmended: '2023-12-10', status: 'Active', citation: 'MCC Â§45.67', category: 'safety' },
            { id: 28, title: 'Business License Ordinance Â§23.45', jurisdiction: 'Municipal', department: 'Finance', effectiveDate: '2005-01-01', lastAmended: '2024-01-01', status: 'Active', citation: 'MCC Â§23.45', category: 'business' },
            { id: 29, title: 'Noise Control Ordinance Â§67.89', jurisdiction: 'Municipal', department: 'Police', effectiveDate: '2012-08-20', lastAmended: '2023-06-15', status: 'Active', citation: 'MCC Â§67.89', category: 'safety' },
            { id: 30, title: 'Sign Regulations Â§34.56', jurisdiction: 'Municipal', department: 'Planning', effectiveDate: '2015-04-01', lastAmended: '2023-11-20', status: 'Active', citation: 'MCC Â§34.56', category: 'zoning' },
            { id: 31, title: 'Parking Regulations Â§78.90', jurisdiction: 'Municipal', department: 'Planning', effectiveDate: '2010-05-15', lastAmended: '2024-02-28', status: 'Active', citation: 'MCC Â§78.90', category: 'zoning' },
            { id: 32, title: 'Tree Protection Ordinance Â§56.78', jurisdiction: 'Municipal', department: 'Parks', effectiveDate: '2018-09-10', lastAmended: '2023-08-05', status: 'Active', citation: 'MCC Â§56.78', category: 'environmental' },
            { id: 33, title: 'Home Occupation Permit Â§89.01', jurisdiction: 'Municipal', department: 'Planning', effectiveDate: '2013-02-20', lastAmended: '2023-10-12', status: 'Active', citation: 'MCC Â§89.01', category: 'business' },
            { id: 34, title: 'Fence Ordinance Â§12.23', jurisdiction: 'Municipal', department: 'Building', effectiveDate: '2011-07-01', lastAmended: '2023-09-18', status: 'Active', citation: 'MCC Â§12.23', category: 'zoning' },
            { id: 35, title: 'Sidewalk CafÃ© Permit Â§45.67', jurisdiction: 'Municipal', department: 'Health', effectiveDate: '2016-05-10', lastAmended: '2024-01-05', status: 'Active', citation: 'MCC Â§45.67', category: 'business' },
            { id: 36, title: 'Special Event Permit Â§23.78', jurisdiction: 'Municipal', department: 'Recreation', effectiveDate: '2014-03-25', lastAmended: '2023-07-22', status: 'Active', citation: 'MCC Â§23.78', category: 'events' },
            { id: 37, title: 'Alcoholic Beverage License Â§67.12', jurisdiction: 'Municipal', department: 'Licensing', effectiveDate: '2009-11-15', lastAmended: '2023-12-01', status: 'Active', citation: 'MCC Â§67.12', category: 'business' },
            { id: 38, title: 'Rental Property Registration Â§34.89', jurisdiction: 'Municipal', department: 'Housing', effectiveDate: '2017-06-01', lastAmended: '2024-01-15', status: 'Active', citation: 'MCC Â§34.89', category: 'housing' },
            { id: 39, title: 'Stormwater Management Â§90.12', jurisdiction: 'Municipal', department: 'Public Works', effectiveDate: '2019-04-10', lastAmended: '2023-11-30', status: 'Active', citation: 'MCC Â§90.12', category: 'environmental' },
            { id: 40, title: 'Historic Preservation Â§56.34', jurisdiction: 'Municipal', department: 'Planning', effectiveDate: '2020-08-05', lastAmended: '2023-10-20', status: 'Active', citation: 'MCC Â§56.34', category: 'preservation' }
        ];

        const policySampleResponses = {
            'parking ada': {
                confidence: 87,
                status: 'needs-review',
                analysis: `The proposed parking ordinance shows partial compliance with ADA Standards (2010). Accessible parking space requirements meet federal standards (Â§208.2), but van-accessible space width (96 inches) falls short of required 132 inches. Signage specifications comply with Â§502.6.`,
                plainEnglish: `Your parking plan mostly follows ADA rules, but van-accessible spaces need to be wider. Regular accessible spaces are correct, but you need to add 36 more inches to the van spaces. The signs meet requirements.`,
                citations: ['28 CFR Â§35.151', 'ADA Standards Â§208.2', 'ADA Standards Â§502.3', 'MCC Â§78.90'],
                recommendations: ['Increase van-accessible space width from 96" to 132"', 'Ensure 5-foot access aisle adjacent to each accessible space', 'Verify signage height and reflectivity comply with Â§502.6', 'Update site plan drawings to reflect changes'],
                relatedPolicies: ['Municipal Parking Code Â§78.90', 'State Accessibility Standards', 'Federal ADA Â§208']
            },
            'building height': {
                confidence: 94,
                status: 'compliant',
                analysis: `Found 8 regulations governing building heights. Municipal Zoning Ordinance Â§12.34 sets residential height limit at 35 feet. Downtown Overlay Â§12.45 permits 65 feet for commercial buildings. State Building Code Chapter 34 addresses structural requirements for tall buildings. FAA Part 77 applies near airports. No conflicts detected between regulations.`,
                plainEnglish: `There are clear height rules for buildings. Homes can be up to 35 feet tall. Downtown commercial buildings can go up to 65 feet. If you're near an airport, FAA rules also apply. All these rules work together without conflicts.`,
                citations: ['MCC Â§12.34', 'MCC Â§12.45', 'SBC Ch. 34', 'FAA Part 77'],
                recommendations: ['Verify exact zone classification for property', 'Check distance from airport if within 10 miles', 'Review State structural requirements for buildings over 3 stories', 'Consult planning department for overlay district applicability'],
                relatedPolicies: ['Zoning Map', 'Downtown Overlay District', 'Airport Height Zoning']
            },
            'work from home': {
                confidence: 92,
                status: 'compliant',
                analysis: `Remote work is permitted under Personnel Policy Â§4.56, subject to department head approval and completion of ergonomic assessment. OSHA regulations require employers to ensure home workspaces meet safety standards. Municipal union contract Article 12.3 addresses telework equipment reimbursement up to $500 annually.`,
                plainEnglish: `Employees can work from home with their manager's approval. The city must make sure the home workspace is safe and ergonomic. Employees can get up to $500 per year for equipment like chairs and monitors. Some training is required before starting.`,
                citations: ['Personnel Policy Â§4.56', 'OSHA Guidelines 3990', 'Collective Bargaining Agreement Art. 12.3'],
                recommendations: ['Complete manager approval form (Form HR-205)', 'Schedule ergonomic assessment within 30 days', 'Submit equipment inventory to IT department', 'Complete data security training module online'],
                relatedPolicies: ['IT Security Policy', 'Workers Compensation Coverage', 'Equipment Policy']
            }
        };

        let policyRecentQueries = ['Does this policy comply with ADA requirements?', 'Find all regulations about building heights', 'Can employees work from home under current policies?', 'What are OSHA requirements for new construction?', 'Environmental review requirements for development'];

        function initializePolicyIntelligence() {
            const container = document.getElementById('policyIntelligenceCenter');
            if (!container) return;

            container.innerHTML = getPolicyIntelligenceHTML();
            populatePolicyTable();
            updatePolicyRecentQueries();
        }

        function getPolicyIntelligenceHTML() {
            return `
                <div class="glass rounded-xl p-6 mb-6" style="animation: fadeIn 0.5s ease;">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h2 class="text-3xl font-bold text-white mb-2">
                                <i class="fas fa-brain text-purple-400 mr-3"></i>
                                AI-Powered Policy Intelligence Center
                            </h2>
                            <p class="text-white/70">Natural language policy analysis, compliance checking, and regulatory intelligence</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                        <div class="glass-dark rounded-lg p-4">
                            <div class="text-white/60 text-xs mb-1">Policy Database</div>
                            <div class="text-white text-2xl font-bold">28,547</div>
                            <div class="text-white/50 text-xs">regulations indexed</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="text-white/60 text-xs mb-1">Last Updated</div>
                            <div class="text-white text-2xl font-bold">Today</div>
                            <div class="text-white/50 text-xs">${new Date().toLocaleTimeString()}</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="text-white/60 text-xs mb-1">AI Confidence</div>
                            <div class="text-green-400 text-2xl font-bold">94.2%</div>
                            <div class="text-white/50 text-xs">average accuracy</div>
                        </div>
                        <div class="glass-dark rounded-lg p-4">
                            <div class="text-white/60 text-xs mb-1">Queries Today</div>
                            <div class="text-white text-2xl font-bold">1,247</div>
                            <div class="text-white/50 text-xs">+18% vs yesterday</div>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2">
                        <button onclick="showNewPolicyAnalysis()" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition-all">
                            <i class="fas fa-plus mr-2"></i>New Analysis
                        </button>
                        <button onclick="showPolicySearch()" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 text-white font-semibold transition-all">
                            <i class="fas fa-search mr-2"></i>Policy Search
                        </button>
                        <button onclick="showPolicyConflictScan()" class="px-4 py-2 rounded-lg bg-yellow-600 hover:bg-yellow-700 text-white font-semibold transition-all">
                            <i class="fas fa-exclamation-triangle mr-2"></i>Conflict Scan
                        </button>
                        <button onclick="exportPolicyReport()" class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-semibold transition-all">
                            <i class="fas fa-file-export mr-2"></i>Export Report
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <div class="glass rounded-xl p-6">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center">
                            <i class="fas fa-comments text-blue-400 mr-2"></i>
                            Natural Language Query
                        </h3>

                        <div class="mb-4">
                            <div class="flex gap-2 mb-3">
                                <input
                                    type="text"
                                    id="policyQuery"
                                    class="flex-1 px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/50"
                                    placeholder="Ask: 'Does this policy comply with ADA requirements?' or 'Find all regulations about building heights'"
                                    onkeypress="if(event.key==='Enter') analyzePolicyQuery()"
                                >
                                <button onclick="togglePolicyVoiceInput()" class="px-4 py-3 rounded-lg bg-red-500/20 border border-red-500/40 text-red-400 hover:bg-red-500/30 transition-all" title="Voice input">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                <select id="policyQueryType" class="px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:border-purple-500">
                                    <option value="general">General Inquiry</option>
                                    <option value="compliance">Compliance Check</option>
                                    <option value="conflict">Conflict Detection</option>
                                    <option value="citation">Citation Search</option>
                                    <option value="drafting">Policy Drafting</option>
                                </select>

                                <select id="policyDepartment" class="px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:border-purple-500">
                                    <option value="">All Departments</option>
                                    <option value="building">Building & Safety</option>
                                    <option value="planning">Planning & Zoning</option>
                                    <option value="health">Public Health</option>
                                    <option value="hr">Human Resources</option>
                                    <option value="finance">Finance</option>
                                </select>
                            </div>

                            <button onclick="analyzePolicyQuery()" class="w-full px-6 py-3 rounded-lg bg-gradient-to-r from-blue-600 to-purple-600 text-white font-bold hover:shadow-lg hover:shadow-blue-500/50 transition-all">
                                <i class="fas fa-search-plus mr-2"></i>Analyze Policy
                            </button>
                        </div>

                        <div class="glass-dark rounded-lg p-4">
                            <h4 class="text-white font-semibold mb-3 text-sm">Recent Queries</h4>
                            <div class="space-y-2" id="policyRecentQueries"></div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6" id="policyAnalysisPanel" style="display: none;">
                        <h3 class="text-xl font-bold text-white mb-4 flex items-center justify-between">
                            <span>
                                <i class="fas fa-brain text-purple-400 mr-2"></i>
                                AI Analysis
                            </span>
                            <button onclick="closePolicyAnalysis()" class="text-white/60 hover:text-white">
                                <i class="fas fa-times"></i>
                            </button>
                        </h3>

                        <div id="policyAnalysisContent"></div>
                    </div>
                </div>

                <div class="glass rounded-xl p-6 mb-6" id="policyConflictDetector" style="display: none;">
                    <h3 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                        Policy Conflict Detector
                    </h3>
                    <div id="policyConflictContent"></div>
                </div>

                <div class="glass rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-white">
                            <i class="fas fa-database text-blue-400 mr-2"></i>
                            Regulatory Database
                        </h3>
                        <div class="flex gap-2">
                            <input
                                type="text"
                                id="policyTableSearch"
                                placeholder="Search policies..."
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm placeholder-white/50 focus:outline-none focus:border-purple-500"
                                oninput="filterPolicyTable()"
                            >
                            <select id="policyTableFilter" onchange="filterPolicyTable()" class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white text-sm focus:outline-none focus:border-purple-500">
                                <option value="">All Jurisdictions</option>
                                <option value="Federal">Federal</option>
                                <option value="State">State</option>
                                <option value="Municipal">Municipal</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="policy-table" id="policyTableMain">
                            <thead>
                                <tr>
                                    <th>Policy Title</th>
                                    <th>Jurisdiction</th>
                                    <th>Department</th>
                                    <th>Effective Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="policyTableBody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="glass rounded-xl p-6">
                        <h4 class="text-white font-semibold mb-3">Top Searched Policies</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between items-center">
                                <span class="text-white/80 text-sm">ADA Compliance</span>
                                <span class="text-blue-400 font-semibold">847</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                            </div>

                            <div class="flex justify-between items-center">
                                <span class="text-white/80 text-sm">Building Heights</span>
                                <span class="text-blue-400 font-semibold">632</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 64%"></div>
                            </div>

                            <div class="flex justify-between items-center">
                                <span class="text-white/80 text-sm">Parking Requirements</span>
                                <span class="text-blue-400 font-semibold">521</span>
                            </div>
                            <div class="w-full bg-white/10 rounded-full h-2">
                                <div class="bg-blue-500 h-2 rounded-full" style="width: 52%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6">
                        <h4 class="text-white font-semibold mb-3">Compliance Score</h4>
                        <div class="text-center">
                            <div class="text-5xl font-bold text-green-400 mb-2">92%</div>
                            <div class="text-white/60 text-sm mb-4">Overall Compliance</div>
                            <div class="policy-confidence-meter">
                                <div class="policy-confidence-fill policy-confidence-high" style="width: 92%"></div>
                            </div>
                            <div class="text-white/50 text-xs mt-2">+3% from last month</div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6">
                        <h4 class="text-white font-semibold mb-3">Recent Changes</h4>
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <div class="w-2 h-2 rounded-full bg-green-400 mt-2 mr-3"></div>
                                <div>
                                    <div class="text-white/90 text-sm">Zoning Â§12.34 Updated</div>
                                    <div class="text-white/50 text-xs">2 days ago</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="w-2 h-2 rounded-full bg-blue-400 mt-2 mr-3"></div>
                                <div>
                                    <div class="text-white/90 text-sm">New OSHA Standard</div>
                                    <div class="text-white/50 text-xs">1 week ago</div>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <div class="w-2 h-2 rounded-full bg-purple-400 mt-2 mr-3"></div>
                                <div>
                                    <div class="text-white/90 text-sm">ADA Guidelines Revised</div>
                                    <div class="text-white/50 text-xs">2 weeks ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="glass rounded-xl p-6">
                        <h4 class="text-white font-semibold mb-3">Query Activity</h4>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-white/70 text-sm">Building & Safety</span>
                                <span class="text-white font-semibold">42%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white/70 text-sm">Planning & Zoning</span>
                                <span class="text-white font-semibold">28%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white/70 text-sm">Public Health</span>
                                <span class="text-white font-semibold">18%</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-white/70 text-sm">Human Resources</span>
                                <span class="text-white font-semibold">12%</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function populatePolicyTable() {
            const tbody = document.getElementById('policyTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            policyDatabase.forEach(policy => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${policy.title}</td>
                    <td><span class="px-2 py-1 rounded text-xs ${getPolicyJurisdictionClass(policy.jurisdiction)}">${policy.jurisdiction}</span></td>
                    <td>${policy.department}</td>
                    <td>${new Date(policy.effectiveDate).toLocaleDateString()}</td>
                    <td><span class="px-2 py-1 rounded text-xs policy-status-compliant">Active</span></td>
                    <td>
                        <button class="text-blue-400 hover:text-blue-300 mr-2" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="text-purple-400 hover:text-purple-300 mr-2" title="Analyze">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="text-green-400 hover:text-green-300" title="Compare">
                            <i class="fas fa-code-compare"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function getPolicyJurisdictionClass(jurisdiction) {
            switch(jurisdiction) {
                case 'Federal': return 'bg-purple-500/20 text-purple-300 border border-purple-500/40';
                case 'State': return 'bg-green-500/20 text-green-300 border border-green-500/40';
                case 'Municipal': return 'bg-blue-500/20 text-blue-300 border border-blue-500/40';
                default: return '';
            }
        }

        function updatePolicyRecentQueries() {
            const container = document.getElementById('policyRecentQueries');
            if (!container) return;

            container.innerHTML = policyRecentQueries.slice(0, 5).map(query => `
                <div class="flex items-center justify-between p-2 rounded hover:bg-white/10 cursor-pointer transition-all" onclick="runRecentPolicyQuery('${query}')">
                    <span class="text-white/70 text-sm flex-1">${query}</span>
                    <button class="text-blue-400 hover:text-blue-300 text-xs">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            `).join('');
        }

        function analyzePolicyQuery() {
            const query = document.getElementById('policyQuery').value.trim();
            if (!query) return;

            if (!policyRecentQueries.includes(query)) {
                policyRecentQueries.unshift(query);
                if (policyRecentQueries.length > 5) policyRecentQueries.pop();
                updatePolicyRecentQueries();
            }

            const panel = document.getElementById('policyAnalysisPanel');
            panel.style.display = 'block';

            let response;
            const lowerQuery = query.toLowerCase();

            if (lowerQuery.includes('parking') && lowerQuery.includes('ada')) {
                response = policySampleResponses['parking ada'];
            } else if (lowerQuery.includes('height') || lowerQuery.includes('building')) {
                response = policySampleResponses['building height'];
            } else if (lowerQuery.includes('work from home') || lowerQuery.includes('remote') || lowerQuery.includes('telework')) {
                response = policySampleResponses['work from home'];
            } else {
                response = {
                    confidence: 85,
                    status: 'compliant',
                    analysis: `Based on analysis of relevant regulations, your query appears to align with current policies. However, specific implementation details should be reviewed by the legal department.`,
                    plainEnglish: `Your question relates to established regulations that are generally permissive. For specific guidance tailored to your situation, please consult with the appropriate department.`,
                    citations: ['Various Municipal Codes', 'State Regulations', 'Federal Guidelines'],
                    recommendations: ['Review specific department policies', 'Consult with legal counsel for detailed interpretation', 'Check for recent regulatory updates', 'Document compliance procedures'],
                    relatedPolicies: ['See regulatory database for related policies']
                };
            }

            displayPolicyAnalysis(response, query);
        }

        function displayPolicyAnalysis(response, query) {
            const content = document.getElementById('policyAnalysisContent');
            if (!content) return;

            const confidenceClass = response.confidence >= 90 ? 'policy-confidence-high' :
                                   response.confidence >= 70 ? 'policy-confidence-medium' : 'policy-confidence-low';

            const statusClass = `policy-status-${response.status}`;
            const statusText = response.status.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
            const statusIcon = response.status === 'compliant' ? 'âœ“' :
                             response.status === 'needs-review' ? 'âš ï¸' :
                             response.status === 'non-compliant' ? 'âœ—' : '?';

            content.innerHTML = `
                <div class="mb-4">
                    <div class="text-white/60 text-sm mb-2">Query:</div>
                    <div class="glass-dark p-3 rounded-lg text-white">${query}</div>
                </div>

                <div class="mb-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-white/60 text-sm">AI Confidence</span>
                        <span class="text-white font-bold">${response.confidence}%</span>
                    </div>
                    <div class="policy-confidence-meter">
                        <div class="policy-confidence-fill ${confidenceClass}" style="width: ${response.confidence}%"></div>
                    </div>
                </div>

                <div class="mb-4">
                    <div class="text-white/60 text-sm mb-2">Compliance Status</div>
                    <span class="px-4 py-2 rounded-lg ${statusClass} font-semibold inline-block">
                        ${statusIcon} ${statusText}
                    </span>
                </div>

                <div class="mb-4">
                    <div class="text-white/60 text-sm mb-2">Professional Analysis</div>
                    <div class="glass-dark p-4 rounded-lg text-white/90 leading-relaxed">
                        ${response.analysis}
                    </div>
                </div>

                <details class="mb-4">
                    <summary class="cursor-pointer text-white font-semibold mb-2 hover:text-blue-400">
                        <i class="fas fa-chevron-right mr-2"></i>Plain English Summary
                    </summary>
                    <div class="glass-dark p-4 rounded-lg text-white/90 leading-relaxed ml-6">
                        ${response.plainEnglish}
                    </div>
                </details>

                <div class="mb-4">
                    <div class="text-white/60 text-sm mb-2">Relevant Citations</div>
                    <div class="flex flex-wrap gap-2">
                        ${response.citations.map(cit => {
                            const citClass = cit.includes('CFR') || cit.includes('U.S.C') ? 'policy-citation-federal' :
                                           cit.includes('SBC') || cit.includes('Ch.') ? 'policy-citation-state' : 'policy-citation-municipal';
                            return `<span class="${citClass}">${cit}</span>`;
                        }).join(' ')}
                    </div>
                </div>

                <div class="mb-4">
                    <div class="text-white/60 text-sm mb-2">Recommendations</div>
                    <div class="glass-dark p-4 rounded-lg">
                        <ul class="space-y-2">
                            ${response.recommendations.map(rec => `
                                <li class="text-white/90 flex items-start">
                                    <i class="fas fa-check-circle text-green-400 mr-2 mt-1"></i>
                                    <span>${rec}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                </div>

                <div class="flex gap-3 mt-6">
                    <button onclick="exportPolicyAnalysis()" class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-700 text-white font-semibold transition-all flex items-center">
                        <i class="fas fa-file-pdf mr-2"></i>Export PDF
                    </button>
                    <button onclick="emailPolicyAnalysis()" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-semibold transition-all flex items-center">
                        <i class="fas fa-envelope mr-2"></i>Email Summary
                    </button>
                </div>
            `;
        }

        function closePolicyAnalysis() {
            document.getElementById('policyAnalysisPanel').style.display = 'none';
        }

        function runRecentPolicyQuery(query) {
            document.getElementById('policyQuery').value = query;
            analyzePolicyQuery();
        }

        function filterPolicyTable() {
            const searchTerm = document.getElementById('policyTableSearch').value.toLowerCase();
            const filter = document.getElementById('policyTableFilter').value;
            const rows = document.querySelectorAll('#policyTableBody tr');

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                const jurisdiction = row.children[1].textContent;

                const matchesSearch = text.includes(searchTerm);
                const matchesFilter = !filter || jurisdiction === filter;

                row.style.display = (matchesSearch && matchesFilter) ? '' : 'none';
            });
        }

        function togglePolicyVoiceInput() {
            alert('Voice input simulation: "Does this policy comply with ADA requirements?"');
            document.getElementById('policyQuery').value = 'Does this policy comply with ADA requirements?';
        }

        function showNewPolicyAnalysis() {
            document.getElementById('policyQuery').focus();
        }

        function showPolicySearch() {
            document.getElementById('policyTableSearch').focus();
        }

        function showPolicyConflictScan() {
            const detector = document.getElementById('policyConflictDetector');
            if (!detector) return;

            detector.style.display = 'block';

            const content = document.getElementById('policyConflictContent');
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="glass-dark rounded-lg p-4 policy-conflict-critical">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-red-400 font-bold">Critical Conflicts</span>
                            <span class="text-2xl font-bold text-red-400">2</span>
                        </div>
                        <div class="text-white/70 text-sm">Require immediate resolution</div>
                    </div>
                    <div class="glass-dark rounded-lg p-4 policy-conflict-moderate">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-yellow-400 font-bold">Moderate Conflicts</span>
                            <span class="text-2xl font-bold text-yellow-400">5</span>
                        </div>
                        <div class="text-white/70 text-sm">Should be reviewed soon</div>
                    </div>
                    <div class="glass-dark rounded-lg p-4 policy-conflict-minor">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-green-400 font-bold">Minor Conflicts</span>
                            <span class="text-2xl font-bold text-green-400">8</span>
                        </div>
                        <div class="text-white/70 text-sm">Low priority items</div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="glass-dark rounded-lg p-4 policy-conflict-critical">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-white font-semibold">Parking Space Width Discrepancy</h4>
                            <span class="px-3 py-1 rounded-full bg-red-500/20 text-red-300 text-xs border border-red-500/40">Critical</span>
                        </div>
                        <div class="text-white/80 text-sm mb-3">
                            Municipal Code Â§78.90 specifies 96-inch van-accessible spaces, conflicting with ADA Standards Â§502.3 requiring 132 inches.
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-blue-500/10 p-3 rounded border border-blue-500/30">
                                <div class="text-blue-400 text-xs mb-1">Municipal Code</div>
                                <div class="text-white text-sm">96 inches wide</div>
                            </div>
                            <div class="bg-purple-500/10 p-3 rounded border border-purple-500/30">
                                <div class="text-purple-400 text-xs mb-1">Federal ADA</div>
                                <div class="text-white text-sm">132 inches wide</div>
                            </div>
                        </div>
                    </div>

                    <div class="glass-dark rounded-lg p-4 policy-conflict-moderate">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-white font-semibold">Building Height Measurement Baseline</h4>
                            <span class="px-3 py-1 rounded-full bg-yellow-500/20 text-yellow-300 text-xs border border-yellow-500/40">Moderate</span>
                        </div>
                        <div class="text-white/80 text-sm mb-3">
                            State Building Code measures from average grade, while Municipal Zoning Â§12.34 measures from lowest point.
                        </div>
                    </div>
                </div>
            `;
        }

        function exportPolicyReport() {
            alert('Exporting comprehensive policy analysis report...\n\nMOCK: This would generate a PDF report with all current analysis, compliance scores, and regulatory information.');
        }

        function exportPolicyAnalysis() {
            alert('Exporting analysis as PDF legal memo...\n\nMOCK: This would create a formatted PDF with the complete analysis.');
        }

        function emailPolicyAnalysis() {
            alert('Email summary functionality\n\nMOCK: This would send the analysis summary to specified recipients.');
        }

        // Citizen Portal specific functions
        function sendCitizenMessage() {
            const input = document.getElementById('citizenUserInput');
            const message = input.value.trim();
            if (!message) return;
            
            addCitizenChatMessage(message, 'user');
            input.value = '';
            
            setTimeout(() => {
                // Smart responses based on message content
                const lowerMessage = message.toLowerCase();
                let response = '';
                
                if (lowerMessage.includes('permit') || lowerMessage.includes('building')) {
                    response = "For building permits, you'll need property surveys, construction plans, and a licensed contractor. Would you like me to open the building permit form for you?";
                } else if (lowerMessage.includes('license') || lowerMessage.includes('business')) {
                    response = "Business licenses typically require your business registration, zoning approval, and tax ID. Processing usually takes 3-5 business days. Shall I help you start the application?";
                } else if (lowerMessage.includes('pothole') || lowerMessage.includes('road') || lowerMessage.includes('street')) {
                    response = "For road issues like potholes, please provide the exact location and photos if possible. Our Public Works team responds within 1-3 business days. Would you like to submit a repair request?";
                } else if (lowerMessage.includes('tax') || lowerMessage.includes('property tax')) {
                    response = "For tax inquiries, I can connect you with the Finance Department. They handle property assessments, payment plans, and exemptions. What specific tax issue can I help with?";
                } else if (lowerMessage.includes('tree') || lowerMessage.includes('park')) {
                    response = "Tree services and park maintenance are handled by Parks & Recreation. For tree removal, you'll need property ownership verification. Would you like me to start that request?";
                } else if (lowerMessage.includes('noise') || lowerMessage.includes('complaint')) {
                    response = "For noise complaints, please provide specific times, dates, and any evidence. Code Enforcement typically responds within 1-2 business days. Should I open a complaint form?";
                } else if (lowerMessage.includes('trash') || lowerMessage.includes('garbage') || lowerMessage.includes('recycling')) {
                    response = "For trash and recycling issues, I can help you contact Sanitation Services. They handle missed pickups, damaged bins, and schedule changes. What's the specific issue?";
                } else {
                    const genericResponses = [
                        "I can help you find the right city service! Try asking about permits, licenses, road repairs, or reporting issues.",
                        "What service are you looking for? I can help with building permits, business licenses, reporting problems, or connecting you with the right department.",
                        "I'm here to help you navigate city services. You can ask about permits, file complaints, request services, or get information about any department.",
                        "Need help with city services? I can assist with applications, direct you to the right department, or help you submit requests quickly."
                    ];
                    response = genericResponses[Math.floor(Math.random() * genericResponses.length)];
                }
                
                addCitizenChatMessage(response, 'ai');
            }, 800);
        }

        function addCitizenChatMessage(message, sender) {
            const chatHistory = document.getElementById('citizenChatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'text-blue-300 mb-2' : 'text-green-300 mb-2';
            
            const icon = sender === 'user' ? 'fas fa-user' : 'fas fa-robot';
            const senderName = sender === 'user' ? 'You' : 'Assistant';
            const senderClass = sender === 'user' ? '' : 'text-blue-300';
            
            messageDiv.innerHTML = `
                <i class="${icon} mr-2"></i>
                <span class="font-semibold ${senderClass}">${senderName}:</span>
                <span>${message}</span>
            `;
            
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function quickCitizenChat(topic) {
            document.getElementById('citizenUserInput').value = `I need help with ${topic}`;
            sendCitizenMessage();
        }

        // ===== INTELLIGENT DOCUMENT PROCESSING - Added 2025-10-18 =====
        // MOCK DATA - Replace in production
        // TODO: Connect to OCR service (Tesseract, Google Vision, AWS Textract)
        // TODO: Implement document classification ML model
        // TODO: Add secure document storage with encryption
        // TODO: Integrate with form auto-fill API
        // TODO: Add audit logging for all extractions
        // TODO: Implement user correction feedback loop for ML improvement

        const DOC_PROCESSING_TEMPLATES = {
            drivers_license: {
                name: "Driver's License",
                fields: { firstName: 0.98, lastName: 0.97, address: 0.89, city: 0.95, state: 0.99, zip: 0.96, phone: 0.92 },
                sampleData: { firstName: "John", lastName: "Smith", address: "123 Oak Street", city: "Springfield", state: "IL", zip: "62701", phone: "(555) 555-5555" }
            },
            utility_bill: {
                name: "Utility Bill",
                fields: { firstName: 0.91, lastName: 0.93, address: 0.96, city: 0.94, state: 0.97, zip: 0.95 },
                sampleData: { firstName: "Sarah", lastName: "Johnson", address: "456 Maple Avenue", city: "Springfield", state: "IL", zip: "62702" }
            },
            business_card: {
                name: "Business Card",
                fields: { firstName: 0.88, lastName: 0.90, email: 0.95, phone: 0.87 },
                sampleData: { firstName: "Mike", lastName: "Chen", email: "mike@example.com", phone: "(555) 123-4567" }
            }
        };

        let currentDocProcessingData = null;

        // Setup document processing drag and drop
        function initializeDocumentProcessing() {
            const dropZone = document.getElementById('docProcessingDropZone');
            const fileInput = document.getElementById('docProcessingFileInput');

            if (!dropZone || !fileInput) return;

            dropZone.addEventListener('click', () => fileInput.click());

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#3b82f6';
                dropZone.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = '';
                dropZone.style.backgroundColor = '';
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '';
                dropZone.style.backgroundColor = '';
                handleDocProcessingFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                handleDocProcessingFiles(e.target.files);
            });

            // Keyboard accessibility
            dropZone.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    fileInput.click();
                }
            });
        }

        async function handleDocProcessingFiles(files) {
            if (files.length === 0) return;

            // Validate file
            const file = files[0];
            const maxSize = 10 * 1024 * 1024;
            const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];

            if (!allowedTypes.includes(file.type)) {
                alert(`âŒ Invalid file type: ${file.name}\n\nPlease upload PDF, JPG, or PNG files only.`);
                return;
            }

            if (file.size > maxSize) {
                alert(`âŒ File too large: ${file.name}\n\nMaximum file size is 10MB.`);
                return;
            }

            await processDocumentForAutoFill(file);
        }

        async function processDocumentForAutoFill(file) {
            // Show processing status
            const statusEl = document.getElementById('docProcessingStatus');
            const progressBar = document.getElementById('docProcessingProgressBar');
            const progressText = document.getElementById('docProcessingProgressText');

            statusEl.classList.remove('hidden');

            // Simulate processing
            const steps = [
                { progress: 20, text: 'Detecting document type...' },
                { progress: 40, text: 'Extracting text...' },
                { progress: 60, text: 'Analyzing fields...' },
                { progress: 80, text: 'Validating data...' },
                { progress: 100, text: 'Complete!' }
            ];

            for (let step of steps) {
                await new Promise(resolve => setTimeout(resolve, 300));
                progressBar.style.width = step.progress + '%';
                progressText.textContent = step.text;
            }

            // Randomly select a document type for demo
            const types = Object.keys(DOC_PROCESSING_TEMPLATES);
            const randomType = types[Math.floor(Math.random() * types.length)];
            const template = DOC_PROCESSING_TEMPLATES[randomType];

            // Create extracted data
            currentDocProcessingData = {
                documentType: randomType,
                fileName: file.name,
                template: template,
                fields: {}
            };

            Object.keys(template.fields).forEach(fieldKey => {
                currentDocProcessingData.fields[fieldKey] = {
                    value: template.sampleData[fieldKey] || '',
                    confidence: template.fields[fieldKey]
                };
            });

            // Hide processing, show results
            statusEl.classList.add('hidden');
            displayDocProcessingResults(currentDocProcessingData);
        }

        function displayDocProcessingResults(data) {
            const panel = document.getElementById('docProcessingExtractedPanel');
            const fieldsPreview = document.getElementById('docProcessingFields');
            const confidenceEl = document.getElementById('docProcessingConfidence');
            const fieldCountEl = document.getElementById('docProcessingFieldCount');

            panel.classList.remove('hidden');

            // Calculate overall confidence
            const confidences = Object.values(data.fields).map(f => f.confidence);
            const avgConfidence = (confidences.reduce((a, b) => a + b, 0) / confidences.length) * 100;

            const confidenceClass = avgConfidence >= 90 ? 'text-green-400' : avgConfidence >= 70 ? 'text-yellow-400' : 'text-red-400';
            confidenceEl.className = `text-xs font-bold ${confidenceClass}`;
            confidenceEl.textContent = `${avgConfidence.toFixed(0)}% Confidence`;

            // Display fields preview
            const fieldNames = Object.keys(data.fields).map(key => {
                const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                return label;
            });
            fieldsPreview.innerHTML = `<strong>${data.template.name} detected:</strong> ${fieldNames.join(', ')}`;

            fieldCountEl.textContent = Object.keys(data.fields).length;
        }

        function autoFillFromDocument() {
            if (!currentDocProcessingData) return;

            let filledCount = 0;

            // Fill form fields
            Object.keys(currentDocProcessingData.fields).forEach(fieldKey => {
                const field = currentDocProcessingData.fields[fieldKey];
                const input = document.getElementById(fieldKey);
                if (input && field.value) {
                    input.value = field.value;

                    // Add visual feedback
                    input.style.borderColor = '#3b82f6';
                    input.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';

                    setTimeout(() => {
                        input.style.borderColor = '';
                        input.style.backgroundColor = '';
                    }, 2000);

                    filledCount++;
                }
            });

            // Show success message
            if (filledCount > 0) {
                alert(`âœ¨ Auto-filled ${filledCount} fields from ${currentDocProcessingData.template.name}!\n\nPlease review the information and complete any remaining fields.`);
            }
        }
        // ===== END INTELLIGENT DOCUMENT PROCESSING =====

        // Advanced AI Assistant with sophisticated prompting
        function sendAdvancedAdminMessage() {
            const input = document.getElementById('adminUserInput');
            const commandType = document.getElementById('commandType').value;
            const message = input.value.trim();
            if (!message) return;
            
            addAdminChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            addTypingIndicator();
            
            setTimeout(() => {
                removeTypingIndicator();
                const response = processAdvancedCommand(message, commandType);
                addAdminChatMessage(response, 'ai');
                
                // Execute any automation if triggered
                executeAutomation(message, commandType);
            }, 1200);
        }

        function processAdvancedCommand(message, type) {
            const prompts = {
                natural: processNaturalLanguage(message),
                automation: processAutomationScript(message),
                workflow: processWorkflowCommand(message),
                security: processSecurityAnalysis(message),
                optimization: processOptimizationCommand(message)
            };
            
            return prompts[type] || prompts.natural;
        }

        function processNaturalLanguage(message) {
            const lowerMessage = message.toLowerCase();
            
            // Intent recognition with sophisticated responses
            if (lowerMessage.includes('analyze') || lowerMessage.includes('report')) {
                return generateAnalysisResponse(message);
            } else if (lowerMessage.includes('automate') || lowerMessage.includes('script')) {
                return generateAutomationResponse(message);
            } else if (lowerMessage.includes('security') || lowerMessage.includes('protect')) {
                return generateSecurityResponse(message);
            } else if (lowerMessage.includes('optimize') || lowerMessage.includes('improve')) {
                return generateOptimizationResponse(message);
            } else if (lowerMessage.includes('workflow')) {
                return generateWorkflowResponse(message);
            } else {
                return generateContextualResponse(message);
            }
        }

        function processAutomationScript(message) {
            if (message.startsWith('auto:')) {
                return `ðŸ¤– Parsing automation script: "${message.substr(5)}"\n\nâœ… Script validated\nâœ… Dependencies checked\nâœ… Security scan passed\n\nðŸš€ Automation queued for execution. Estimated completion: 2-5 minutes.`;
            }
            
            return `ðŸ”§ Creating automation for: "${message}"\n\nðŸ“‹ Suggested automation steps:\n1. Input validation and sanitization\n2. Process orchestration with error handling\n3. Real-time monitoring and logging\n4. Completion notification and reporting\n\nReady to implement? Reply 'execute' to proceed.`;
        }

        function processWorkflowCommand(message) {
            const workflows = {
                'create': 'Initiating workflow creation wizard. Define triggers, actions, and conditions.',
                'optimize': 'Analyzing current workflows for optimization opportunities...',
                'deploy': 'Preparing workflow deployment with validation checks...',
                'monitor': 'Activating real-time workflow monitoring and alerting...'
            };
            
            for (const [key, response] of Object.entries(workflows)) {
                if (message.toLowerCase().includes(key)) {
                    return `ðŸ”„ ${response}\n\nðŸŽ¯ Advanced features available:\nâ€¢ Multi-stage approval chains\nâ€¢ Conditional branching logic\nâ€¢ Real-time data integration\nâ€¢ Automated escalation protocols`;
                }
            }
            
            return `âš¡ Workflow Command Center ready. Available commands:\nâ€¢ create [name] - New workflow\nâ€¢ optimize [workflow] - Performance tuning\nâ€¢ deploy [workflow] - Production deployment\nâ€¢ monitor [workflow] - Real-time tracking`;
        }

        function processSecurityAnalysis(message) {
            return `ðŸ›¡ï¸ Advanced Security Analysis Initiated\n\nðŸ” Scanning for:\nâ€¢ Vulnerability patterns\nâ€¢ Access control anomalies\nâ€¢ Data flow security\nâ€¢ Compliance violations\n\nðŸ“Š Results: 97% security score\nâš ï¸ 3 minor recommendations identified\nðŸ”’ All critical systems secure\n\nDetailed report available in Security Dashboard.`;
        }

        function processOptimizationCommand(message) {
            return `âš¡ System Optimization Engine Activated\n\nðŸŽ¯ Performance analysis:\nâ€¢ Resource utilization: 72% (optimal)\nâ€¢ Response times: <200ms average\nâ€¢ Throughput: 15,000 req/min\nâ€¢ Error rate: 0.02%\n\nðŸ’¡ Optimization opportunities:\nâ€¢ Cache optimization (+15% speed)\nâ€¢ Database indexing (+8% efficiency)\nâ€¢ Load balancing refinement\n\nImplement recommendations? Reply 'optimize now'.`;
        }

        // Context-aware response generators
        function generateAnalysisResponse(message) {
            const analyses = [
                `ðŸ“Š Deep Analysis Complete\n\nðŸ” Key findings:\nâ€¢ System efficiency: 94.2%\nâ€¢ Security posture: Excellent\nâ€¢ User satisfaction: 4.8/5\nâ€¢ Cost optimization: 23% savings identified\n\nðŸ“ˆ Trending metrics show consistent improvement across all KPIs.`,
                `ðŸ§  Intelligent Analysis Results\n\nðŸ’¡ Insights discovered:\nâ€¢ Peak usage patterns identified\nâ€¢ Bottleneck predictions available\nâ€¢ Resource allocation optimized\nâ€¢ Predictive scaling configured\n\nðŸŽ¯ Next steps: Implement automated scaling policies?`,
                `ðŸ”¬ Advanced Analytics Summary\n\nðŸ“‹ Multi-dimensional analysis:\nâ€¢ Performance vectors: All green\nâ€¢ Risk assessment: Low\nâ€¢ Compliance status: 100%\nâ€¢ Innovation index: High\n\nðŸš€ System performing at 98% of theoretical maximum.`
            ];
            
            return analyses[Math.floor(Math.random() * analyses.length)];
        }

        function generateAutomationResponse(message) {
            return `ðŸ¤– Automation Framework Engaged\n\nâš™ï¸ Building intelligent automation:\nâ€¢ Natural language processing\nâ€¢ Machine learning integration\nâ€¢ Adaptive workflow generation\nâ€¢ Real-time performance optimization\n\nðŸŽ¯ Target efficiency gain: 45-60%\nâ±ï¸ Implementation time: 30 minutes\n\nShall I proceed with automation deployment?`;
        }

        function generateSecurityResponse(message) {
            return `ðŸ” Advanced Security Protocol Active\n\nðŸ›¡ï¸ Multi-layer protection:\nâ€¢ Zero-trust architecture verified\nâ€¢ AI-powered threat detection online\nâ€¢ Quantum-resistant encryption enabled\nâ€¢ Behavioral analysis monitoring\n\nâœ… Current threat level: GREEN\nðŸ” Continuous monitoring active\nðŸ“± Mobile security optimized`;
        }

        function generateOptimizationResponse(message) {
            return `âš¡ Performance Optimization Suite\n\nðŸš€ Enhancement protocols:\nâ€¢ AI-driven resource allocation\nâ€¢ Predictive load balancing\nâ€¢ Self-healing infrastructure\nâ€¢ Continuous performance tuning\n\nðŸ“ˆ Expected improvements:\nâ€¢ 40% faster response times\nâ€¢ 30% cost reduction\nâ€¢ 99.99% uptime guarantee`;
        }

        function generateWorkflowResponse(message) {
            return `ðŸ”„ Intelligent Workflow Engine\n\nâœ¨ Advanced capabilities:\nâ€¢ Self-optimizing processes\nâ€¢ Dynamic adaptation to load\nâ€¢ Intelligent error recovery\nâ€¢ Predictive maintenance\n\nðŸŽ¯ Current workflows: 28 active\nâš¡ Average completion: 3.2 minutes\nðŸ“Š Success rate: 99.7%`;
        }

        function generateContextualResponse(message) {
            const responses = [
                `ðŸ§  AI Assistant Pro analyzing request...\n\nðŸ’¡ Contextual understanding:\nâ€¢ Intent: ${detectIntent(message)}\nâ€¢ Complexity: ${assessComplexity(message)}\nâ€¢ Priority: ${determinePriority(message)}\n\nHow can I help you achieve this goal?`,
                `ðŸŽ¯ Intelligent Response System\n\nðŸ” I understand you're looking for guidance on "${message}"\n\nðŸ“‹ Available options:\nâ€¢ Automated solution development\nâ€¢ Step-by-step guidance\nâ€¢ Resource recommendations\nâ€¢ Expert consultation\n\nWhich approach would you prefer?`,
                `âš¡ Advanced AI Processing\n\nðŸ¤– Your request has been analyzed using:\nâ€¢ Natural language understanding\nâ€¢ Context awareness algorithms\nâ€¢ Predictive modeling\nâ€¢ Optimization protocols\n\nReady to provide intelligent assistance. Please specify your preferred solution approach.`
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Utility functions for contextual analysis
        function detectIntent(message) {
            if (message.includes('help') || message.includes('how')) return 'Assistance Seeking';
            if (message.includes('create') || message.includes('build')) return 'Creation';
            if (message.includes('fix') || message.includes('solve')) return 'Problem Solving';
            return 'Information Seeking';
        }

        function assessComplexity(message) {
            const words = message.split(' ').length;
            if (words > 15) return 'High';
            if (words > 8) return 'Medium';
            return 'Low';
        }

        function determinePriority(message) {
            if (message.includes('urgent') || message.includes('critical')) return 'High';
            if (message.includes('soon') || message.includes('important')) return 'Medium';
            return 'Normal';
        }

        // Legacy function kept for compatibility
        function sendAdminMessage() {
            sendAdvancedAdminMessage();
        }


        function populateCitizenRequests() {
            const container = document.getElementById('recentRequestsListCitizen');
            const recentRequests = userRequests.slice(0, 3);
            
            container.innerHTML = recentRequests.map(request => `
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-lg hover:bg-white/10 transition-colors cursor-pointer" onclick="viewRequestDetails('${request.id}')">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-2">
                            <span class="text-white font-medium">${request.type}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-${request.statusColor}-500/20 text-${request.statusColor}-300">${request.status}</span>
                        </div>
                        <p class="text-sm text-white/70">${request.description}</p>
                        <div class="flex items-center space-x-4 mt-2 text-xs text-white/60">
                            <span><i class="fas fa-calendar mr-1"></i>${new Date(request.date).toLocaleDateString()}</span>
                            <span><i class="fas fa-building mr-1"></i>${request.department}</span>
                        </div>
                    </div>
                    <div class="text-white/60">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            `).join('');
        }
        
        function populateRecentActivity() {
            const container = document.getElementById('recentActivity');
            const activities = [
                { icon: 'fas fa-check', text: 'Permit #2847 approved automatically', time: '2 minutes ago', color: 'green' },
                { icon: 'fas fa-exclamation-triangle', text: 'Security alert: Suspicious login detected', time: '5 minutes ago', color: 'red' },
                { icon: 'fas fa-cog', text: 'Tax assessment workflow deployed', time: '12 minutes ago', color: 'blue' },
                { icon: 'fas fa-user-plus', text: 'New user registered in system', time: '15 minutes ago', color: 'purple' }
            ];
            
            container.innerHTML = activities.map(activity => `
                <div class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg">
                    <div class="w-8 h-8 bg-${activity.color}-500 rounded-lg flex items-center justify-center">
                        <i class="${activity.icon} text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-white text-sm">${activity.text}</p>
                        <p class="text-white/60 text-xs">${activity.time}</p>
                    </div>
                </div>
            `).join('');
        }

        // Advanced AI Assistant Supporting Functions
        function executeQuickAction(action) {
            addAdminChatMessage(`Quick Action: ${action}`, 'user');
            addTypingIndicator();
            
            setTimeout(() => {
                removeTypingIndicator();
                let response = '';
                
                switch(action) {
                    case 'analyze':
                        response = `ðŸ” System Analysis Complete\n\nâœ… Performance: 94.7% optimal\nâœ… Security: All green\nâœ… Workflows: 28 active, 0 errors\nâœ… Resources: 72% utilization\n\nðŸ’¡ Recommendations:\nâ€¢ Implement caching for 15% speed boost\nâ€¢ Schedule maintenance window\nâ€¢ Review user access permissions`;
                        break;
                    case 'optimize':
                        response = `âš¡ Auto-Optimization Initiated\n\nðŸš€ Implementing:\nâ€¢ Database query optimization\nâ€¢ Cache warm-up procedures\nâ€¢ Load balancer fine-tuning\nâ€¢ Memory allocation adjustment\n\nðŸ“Š Expected improvements:\nâ€¢ 23% faster response times\nâ€¢ 18% lower resource usage\nâ€¢ Enhanced user experience\n\nOptimization completed successfully!`;
                        break;
                    case 'secure':
                        response = `ðŸ›¡ï¸ Security Scan Complete\n\nðŸ”’ Security Status: EXCELLENT\n\nâœ… Vulnerabilities: None detected\nâœ… Access controls: Properly configured\nâœ… Encryption: AES-256 active\nâœ… Firewall: All rules optimized\nâœ… Monitoring: Real-time protection active\n\nðŸŽ¯ Security score: 98/100\nðŸ“ Full report generated`;
                        break;
                }
                
                addAdminChatMessage(response, 'ai');
            }, 1500);
        }

        function toggleAdvancedMode() {
            const panel = document.getElementById('advancedPanel');
            const btn = document.getElementById('advancedModeBtn');
            
            if (panel.classList.contains('hidden')) {
                panel.classList.remove('hidden');
                btn.innerHTML = '<i class="fas fa-magic mr-1"></i>Basic';
                btn.classList.add('bg-purple-600/40');
            } else {
                panel.classList.add('hidden');
                btn.innerHTML = '<i class="fas fa-magic mr-1"></i>Advanced';
                btn.classList.remove('bg-purple-600/40');
            }
        }

        function insertTemplate(type) {
            const input = document.getElementById('adminUserInput');
            const templates = {
                workflow: 'create workflow "Emergency Response" with triggers [citizen_request] actions [notify_department, assign_priority, track_progress] conditions [urgency_level > 3]',
                security: 'security scan --deep --check-vulnerabilities --audit-permissions --generate-report',
                automation: 'auto: optimize_database_queries() && clear_cache() && restart_services() if performance < 90%',
                api: 'api call POST /workflows/deploy {name: "new_process", enabled: true, priority: "high"}'
            };
            
            input.value = templates[type] || '';
            input.focus();
        }

        function addTypingIndicator() {
            const chatHistory = document.getElementById('adminChatHistory');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'text-green-300 mb-2 typing-indicator';
            typingDiv.innerHTML = `
                <i class="fas fa-brain mr-2"></i>
                <span class="font-semibold text-blue-300">AI Pro:</span>
                <span class="typing">Processing advanced request...</span>
            `;
            
            chatHistory.appendChild(typingDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function removeTypingIndicator() {
            const indicator = document.querySelector('.typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function executeAutomation(message, commandType) {
            // Simulate automation execution based on command type and content
            if (commandType === 'automation' && message.includes('execute')) {
                setTimeout(() => {
                    addAdminChatMessage(`ðŸš€ Automation Executed Successfully\n\nâœ… All systems updated\nâœ… Performance optimized\nâœ… Security protocols refreshed\n\nðŸ“Š Results:\nâ€¢ Processing time: 45 seconds\nâ€¢ Success rate: 100%\nâ€¢ Error rate: 0%\n\nAutomation completed without issues.`, 'ai');
                }, 3000);
            } else if (message.toLowerCase().includes('optimize now')) {
                setTimeout(() => {
                    addAdminChatMessage(`âš¡ System Optimization Complete\n\nðŸŽ¯ Optimization Results:\nâ€¢ Cache hit ratio: 95% (+12%)\nâ€¢ Database queries: 340ms avg (-67ms)\nâ€¢ Memory usage: 68% (-8%)\nâ€¢ CPU utilization: 45% (-15%)\n\nâœ¨ System is now running at peak efficiency!`, 'ai');
                }, 2500);
            }
        }

        // Enhanced chat message function with better formatting
        function addAdminChatMessage(message, sender) {
            const chatHistory = document.getElementById('adminChatHistory');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'text-blue-300 mb-3' : 'text-green-300 mb-3';
            
            const icon = sender === 'user' ? 'fas fa-user' : 'fas fa-brain';
            const senderName = sender === 'user' ? 'You' : 'AI Pro';
            const senderClass = sender === 'user' ? '' : 'text-blue-300';
            
            // Format message with proper line breaks and styling
            const formattedMessage = message.replace(/\n/g, '<br>').replace(/â€¢/g, '<span class="text-yellow-300">â€¢</span>');
            
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-2">
                    <i class="${icon} mt-1"></i>
                    <div class="flex-1">
                        <span class="font-semibold ${senderClass}">${senderName}:</span>
                        <div class="mt-1">${formattedMessage}</div>
                    </div>
                </div>
            `;
            
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        // Handle Enter key
        const userInput = document.getElementById('userInput');
        if (userInput) {
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
        }

        // Handle Enter key for admin chat
        const adminUserInput = document.getElementById('adminUserInput');
        if (adminUserInput) {
            adminUserInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendAdminMessage();
                }
            });
        }

        // Handle Enter key for citizen chat
        const citizenUserInput = document.getElementById('citizenUserInput');
        if (citizenUserInput) {
            citizenUserInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendCitizenMessage();
                }
            });
        }
        
        // Grant Management Functions
        let grantSearchResults = [];
        let activeGrants = [
            {
                id: 1,
                title: "SBIR Phase II - Advanced Cybersecurity Solutions",
                agency: "Department of Defense",
                amount: "$750,000",
                deadline: "2024-12-15",
                status: "Application Submitted",
                progress: 85,
                lastUpdate: "2024-10-01"
            },
            {
                id: 2,
                title: "NSF Innovation Corps - AI Healthcare Platform",
                agency: "National Science Foundation",
                amount: "$50,000",
                deadline: "2024-11-30",
                status: "Draft in Progress",
                progress: 45,
                lastUpdate: "2024-09-28"
            },
            {
                id: 3,
                title: "EPA SBIR - Environmental Monitoring Tech",
                agency: "Environmental Protection Agency",
                amount: "$300,000",
                deadline: "2025-01-20",
                status: "Research Phase",
                progress: 25,
                lastUpdate: "2024-09-25"
            }
        ];

        // AI Grant Search Function with Enhanced Mock Data (Browser-Compatible)
        async function searchGrants() {
            const query = document.getElementById('grant-search-input').value.trim();
            if (!query) {
                alert('Please enter a search term to find federal grants.');
                return;
            }

            console.log('Starting grant search for:', query);

            // Show loading state
            const searchButton = document.querySelector('#grant-search-input').nextElementSibling;
            const originalText = searchButton.innerHTML;
            searchButton.innerHTML = '<i class="fas fa-spinner animate-spin mr-2"></i>Searching Federal Grants...';
            searchButton.disabled = true;

            try {
                // Simulate AI search delay for realism
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Use enhanced mock data with real grant information
                const mockResults = generateRealisticGrantResults(query);
                console.log('Generated results:', mockResults);
                
                displayGrantResults(mockResults);
                showAIGrantInsights(query, mockResults, mockResults.length);
                
                console.log('Search completed successfully');
                
            } catch (error) {
                console.error('Grant search error:', error);
                alert('Search encountered an error. Please try again.');
            } finally {
                // Reset button
                searchButton.innerHTML = originalText;
                searchButton.disabled = false;
            }
        }

        // Note: Direct grants.gov API calls are disabled due to CORS restrictions in browsers
        // Using enhanced realistic mock data based on actual federal grants instead

        // Note: RAG processing functions removed - using realistic mock data instead

        // AI-powered match scoring algorithm
        function calculateAIMatchScore(grant, queryTerms, originalQuery) {
            let score = 0;
            const title = grant.title.toLowerCase();
            const agency = grant.agency.toLowerCase();
            
            // Exact keyword matches in title (highest weight)
            queryTerms.forEach(term => {
                if (title.includes(term)) {
                    score += 30;
                }
                if (agency.includes(term)) {
                    score += 15;
                }
            });
            
            // Technology-specific bonus scoring
            const techKeywords = {
                'cybersecurity': ['security', 'cyber', 'defense', 'protection', 'infrastructure'],
                'ai': ['artificial', 'intelligence', 'machine', 'learning', 'neural', 'deep'],
                'quantum': ['quantum', 'computing', 'cryptography', 'physics'],
                'biotech': ['bio', 'medical', 'health', 'pharmaceutical', 'genetic'],
                'energy': ['energy', 'renewable', 'solar', 'battery', 'grid', 'power'],
                'climate': ['climate', 'environmental', 'carbon', 'emission', 'sustainability']
            };
            
            Object.entries(techKeywords).forEach(([field, keywords]) => {
                if (originalQuery.toLowerCase().includes(field)) {
                    keywords.forEach(keyword => {
                        if (title.includes(keyword)) {
                            score += 20;
                        }
                    });
                }
            });
            
            // Agency reputation bonus
            const prestigiousAgencies = ['NSF', 'NIH', 'DOE', 'DARPA', 'NASA'];
            if (prestigiousAgencies.some(agency => grant.agencyCode.includes(agency))) {
                score += 10;
            }
            
            // Status bonus (posted grants are more valuable)
            if (grant.oppStatus === 'posted') {
                score += 15;
            }
            
            // Cap at 100 and ensure minimum of 60 for any match
            return Math.min(100, Math.max(60, score));
        }

        // Estimate grant funding amount based on agency and type
        function estimateGrantAmount(grant) {
            // Agency-based estimates (in thousands)
            const agencyEstimates = {
                'NSF': [50, 500, 2000],      // Small, Medium, Large
                'NIH': [100, 1000, 5000],
                'DOE': [75, 750, 3000],
                'DARPA': [200, 1500, 10000],
                'EPA': [25, 250, 1000],
                'DOD': [150, 1000, 5000],
                'NASA': [100, 800, 4000]
            };
            
            // Find matching agency
            let estimates = [50, 500, 2000]; // Default
            Object.keys(agencyEstimates).forEach(agency => {
                if (grant.agencyCode.includes(agency)) {
                    estimates = agencyEstimates[agency];
                }
            });
            
            // Select estimate based on title keywords
            let amount = estimates[1]; // Default to medium
            const title = grant.title.toLowerCase();
            
            if (title.includes('phase i') || title.includes('small') || title.includes('pilot')) {
                amount = estimates[0];
            } else if (title.includes('phase ii') || title.includes('large') || title.includes('center')) {
                amount = estimates[2];
            }
            
            return `$${amount.toLocaleString()},000`;
        }

        // Format grant deadline
        function formatGrantDeadline(closeDate) {
            if (!closeDate) return 'Open-ended';
            
            // Handle MM/DD/YYYY format
            const date = new Date(closeDate);
            if (isNaN(date.getTime())) return closeDate;
            
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: '2-digit', 
                day: '2-digit'
            });
        }

        // Generate AI-enhanced grant description
        function generateGrantDescription(grant) {
            const templates = {
                'research': `Advanced research initiative focusing on ${grant.title.toLowerCase()} with potential applications in cutting-edge technology development and innovation.`,
                'development': `Technology development program aimed at creating breakthrough solutions in ${grant.title.toLowerCase().replace(/[^a-z\s]/g, '')} sector.`,
                'education': `Educational excellence program supporting ${grant.title.toLowerCase()} through comprehensive training and development initiatives.`,
                'infrastructure': `Infrastructure modernization project targeting ${grant.title.toLowerCase()} to enhance national capabilities and competitiveness.`,
                'default': `Federal funding opportunity supporting innovative approaches to ${grant.title.toLowerCase()} with significant impact potential.`
            };
            
            const title = grant.title.toLowerCase();
            if (title.includes('research') || title.includes('r&d')) return templates.research;
            if (title.includes('development') || title.includes('innovation')) return templates.development;
            if (title.includes('education') || title.includes('training')) return templates.education;
            if (title.includes('infrastructure') || title.includes('modernization')) return templates.infrastructure;
            
            return templates.default;
        }

        // Determine eligibility requirements
        function determineEligibility(grant) {
            const eligibilityMap = {
                'NSF': 'Universities, research institutions, and qualified organizations',
                'NIH': 'Medical institutions, research universities, and healthcare organizations',
                'DOE': 'Energy sector organizations, research labs, and qualified institutions',
                'DARPA': 'Defense contractors, research institutions, and technology companies',
                'EPA': 'Environmental organizations, state agencies, and research institutions',
                'DOD': 'Defense contractors, military research organizations, and qualified entities',
                'NASA': 'Aerospace organizations, research institutions, and technology companies'
            };
            
            // Find matching agency
            for (const [agency, description] of Object.entries(eligibilityMap)) {
                if (grant.agencyCode.includes(agency)) {
                    return description;
                }
            }
            
            return 'Qualified organizations meeting federal grant requirements';
        }

        // Generate realistic grant results based on real federal grant data
        function generateRealisticGrantResults(query) {
            const realGrantDatabase = {
                'cybersecurity': [
                    {
                        title: "CyberCorpsÂ® Scholarship for Service",
                        agency: "U.S. National Science Foundation",
                        agencyCode: "NSF",
                        amount: "$275,000",
                        deadline: "07/15/2026",
                        matchScore: 95,
                        description: "Federal cybersecurity scholarship program supporting students pursuing cybersecurity degrees in exchange for federal service commitment.",
                        eligibility: "Universities with approved cybersecurity programs",
                        number: "23-574"
                    },
                    {
                        title: "Security, Privacy, and Trust in Cyberspace",
                        agency: "U.S. National Science Foundation",
                        agencyCode: "NSF",
                        amount: "$500,000",
                        deadline: "09/29/2025",
                        matchScore: 92,
                        description: "Research initiative focusing on foundational cybersecurity, privacy protection, and establishing trust in digital systems.",
                        eligibility: "Research institutions and universities",
                        number: "25-515"
                    },
                    {
                        title: "DHS SBIR - Cybersecurity Solutions",
                        agency: "Department of Homeland Security",
                        agencyCode: "DHS",
                        amount: "$750,000",
                        deadline: "12/20/2024",
                        matchScore: 88,
                        description: "Small business innovation research for advanced cybersecurity technologies protecting critical infrastructure.",
                        eligibility: "Small businesses with cybersecurity expertise",
                        number: "DHS-SBIR-24-01"
                    }
                ],
                'ai': [
                    {
                        title: "NSF CAREER - Advanced AI Research",
                        agency: "U.S. National Science Foundation",
                        agencyCode: "NSF",
                        amount: "$500,000",
                        deadline: "11/15/2024",
                        matchScore: 94,
                        description: "Early-career faculty development program for breakthrough artificial intelligence and machine learning research.",
                        eligibility: "Academic institutions with AI research programs",
                        number: "NSF-CAREER-AI-24"
                    },
                    {
                        title: "DARPA - Artificial Intelligence Exploration",
                        agency: "Defense Advanced Research Projects Agency",
                        agencyCode: "DARPA",
                        amount: "$1,500,000",
                        deadline: "01/30/2025",
                        matchScore: 91,
                        description: "High-risk, high-reward AI research exploring novel approaches to artificial general intelligence.",
                        eligibility: "Defense contractors and research institutions",
                        number: "HR001125A0001"
                    }
                ],
                'quantum': [
                    {
                        title: "DOE Quantum Information Science Research",
                        agency: "Department of Energy",
                        agencyCode: "DOE",
                        amount: "$2,000,000",
                        deadline: "03/15/2025",
                        matchScore: 96,
                        description: "Quantum computing and quantum information science research for next-generation computing systems.",
                        eligibility: "National laboratories and research universities",
                        number: "DE-FOA-QIS-25"
                    }
                ],
                'infrastructure': [
                    {
                        title: "Infrastructure Resilience and Sustainability Program",
                        agency: "Environmental Protection Agency",
                        agencyCode: "EPA",
                        amount: "$1,000,000",
                        deadline: "10/06/2025",
                        matchScore: 85,
                        description: "Large-scale infrastructure modernization program focusing on resilience and environmental sustainability.",
                        eligibility: "State and local governments, water utilities",
                        number: "EPA-OW-OGWDW-25-01"
                    }
                ],
                'energy': [
                    {
                        title: "Advanced Research Projects Agency Energy SBIR/STTR",
                        agency: "Advanced Research Projects Agency Energy",
                        agencyCode: "DOE-ARPAE",
                        amount: "$1,500,000",
                        deadline: "09/25/2025",
                        matchScore: 89,
                        description: "Revolutionary energy technology development through small business innovation research programs.",
                        eligibility: "Small businesses and research institutions",
                        number: "DE-FOA-0003593"
                    }
                ]
            };

            // Find matching grants based on query
            let results = [];
            const queryLower = query.toLowerCase();
            
            // Direct keyword matches
            Object.keys(realGrantDatabase).forEach(keyword => {
                if (queryLower.includes(keyword)) {
                    results = results.concat(realGrantDatabase[keyword]);
                }
            });

            // If no direct matches, search across all grants
            if (results.length === 0) {
                Object.values(realGrantDatabase).forEach(categoryGrants => {
                    categoryGrants.forEach(grant => {
                        if (grant.title.toLowerCase().includes(queryLower) || 
                            grant.description.toLowerCase().includes(queryLower)) {
                            results.push(grant);
                        }
                    });
                });
            }

            // Add some general grants if still no results
            if (results.length === 0) {
                results = [
                    {
                        title: "Microsystems Technology Office Research",
                        agency: "DARPA - Microsystems Technology Office",
                        agencyCode: "DOD-DARPA-MTO",
                        amount: "$800,000",
                        deadline: "12/01/2025",
                        matchScore: 75,
                        description: `Research opportunity in ${query} with applications to advanced technology development and innovation.`,
                        eligibility: "Research institutions and technology companies",
                        number: "HR001124S0028"
                    },
                    {
                        title: "Small Business Innovation Research Program",
                        agency: "U.S. National Science Foundation",
                        agencyCode: "NSF",
                        amount: "$400,000",
                        deadline: "02/15/2025",
                        matchScore: 70,
                        description: `Innovation research program supporting ${query} technology development for small businesses.`,
                        eligibility: "Small businesses with relevant expertise",
                        number: "NSF-SBIR-25"
                    }
                ];
            }

            return results.slice(0, 10); // Limit to 10 results
        }

        // Quick search function
        function quickSearch(tech) {
            document.getElementById('grant-search-input').value = tech;
            searchGrants();
        }

        // Generate mock grant results based on search query
        function generateMockGrantResults(query) {
            const baseGrants = [
                {
                    title: "SBIR Phase I - Quantum Computing Infrastructure",
                    agency: "Department of Energy",
                    amount: "$275,000",
                    deadline: "2024-12-31",
                    matchScore: 95,
                    description: "Development of quantum computing solutions for energy grid optimization and security applications.",
                    eligibility: "Small business with quantum research capabilities"
                },
                {
                    title: "NSF CAREER - Advanced AI Research",
                    agency: "National Science Foundation",
                    amount: "$500,000",
                    deadline: "2024-11-15",
                    matchScore: 88,
                    description: "Research grant for early-career faculty developing breakthrough AI technologies.",
                    eligibility: "Academic institutions with AI research programs"
                },
                {
                    title: "NIH R01 - Medical Device Innovation",
                    agency: "National Institutes of Health",
                    amount: "$1,200,000",
                    deadline: "2025-02-28",
                    matchScore: 82,
                    description: "Development of innovative medical devices using cutting-edge technology.",
                    eligibility: "Research institutions and medical device companies"
                },
                {
                    title: "DHS SBIR - Cybersecurity Solutions",
                    agency: "Department of Homeland Security",
                    amount: "$750,000",
                    deadline: "2024-12-20",
                    matchScore: 90,
                    description: "Advanced cybersecurity technologies for critical infrastructure protection.",
                    eligibility: "Small businesses with cybersecurity expertise"
                }
            ];

            // Filter and sort based on query relevance
            return baseGrants.filter(grant => 
                grant.title.toLowerCase().includes(query.toLowerCase()) ||
                grant.description.toLowerCase().includes(query.toLowerCase())
            ).sort((a, b) => b.matchScore - a.matchScore);
        }

        // Display grant search results
        function displayGrantResults(results) {
            const container = document.getElementById('grantSearchResults');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-search text-4xl text-white/30 mb-4"></i>
                        <p class="text-white/60">No grants found matching your search criteria.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = results.map(grant => `
                <div class="glass rounded-xl p-6 hover:bg-white/10 transition-all duration-300 border border-white/10">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-white mb-2">${grant.title}</h4>
                            <div class="flex items-center space-x-4 text-sm text-white/70 mb-3">
                                <span><i class="fas fa-building mr-1"></i>${grant.agency}</span>
                                <span><i class="fas fa-dollar-sign mr-1"></i>${grant.amount}</span>
                                <span><i class="fas fa-calendar mr-1"></i>${grant.deadline}</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="px-3 py-1 bg-gradient-to-r from-green-500/20 to-blue-500/20 rounded-full text-xs text-green-300">
                                ${grant.matchScore}% Match
                            </div>
                        </div>
                    </div>
                    <p class="text-white/80 text-sm mb-4">${grant.description}</p>
                    <div class="flex justify-between items-center">
                        <div class="text-xs text-white/60">
                            <i class="fas fa-check-circle mr-1"></i>
                            ${grant.eligibility}
                        </div>
                        <div class="space-x-2">
                            <button onclick="viewGrantDetails('${grant.title}')" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg text-white text-sm hover:from-blue-600 hover:to-purple-700 transition-all">
                                View Details
                            </button>
                            <button onclick="addToWorkflow('${grant.title}')" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg text-white text-sm hover:from-purple-600 hover:to-pink-700 transition-all">
                                Add to Workflow
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show AI insights based on search
        // Enhanced AI Grant Insights with RAG Intelligence
        function showAIGrantInsights(query, results, totalHits) {
            const container = document.getElementById('aiInsights');
            
            if (!results || results.length === 0) {
                container.innerHTML = `
                    <div class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg">
                        <div class="w-2 h-2 bg-red-400 rounded-full animate-pulse"></div>
                        <span class="text-white/90 text-sm">ðŸ” No matching grants found for "${query}". Try different keywords.</span>
                    </div>
                `;
                return;
            }

            // Calculate sophisticated metrics
            const avgMatchScore = Math.round(results.reduce((sum, r) => sum + r.matchScore, 0) / results.length);
            const topAgencies = [...new Set(results.slice(0, 5).map(r => r.agencyCode))].join(', ');
            
            // Calculate total funding potential
            let totalFunding = 0;
            results.forEach(grant => {
                const amount = grant.amount.replace(/[$,]/g, '');
                const numAmount = parseInt(amount) || 0;
                totalFunding += numAmount;
            });

            // Find upcoming deadlines
            const upcomingDeadlines = results.filter(g => {
                if (g.deadline === 'Open-ended') return false;
                const deadline = new Date(g.deadline);
                const thirtyDaysFromNow = new Date(Date.now() + 30*24*60*60*1000);
                return deadline < thirtyDaysFromNow && deadline > new Date();
            });

            // Generate intelligent insights based on query and results
            const insights = generateRAGInsights(query, results, totalHits, avgMatchScore, topAgencies, totalFunding, upcomingDeadlines);

            container.innerHTML = insights.map(insight => `
                <div class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all">
                    <div class="w-2 h-2 ${insight.color} rounded-full animate-pulse"></div>
                    <span class="text-white/90 text-sm">${insight.text}</span>
                </div>
            `).join('');
        }

        // Generate RAG-powered insights
        function generateRAGInsights(query, results, totalHits, avgMatchScore, topAgencies, totalFunding, upcomingDeadlines) {
            const insights = [];

            // Search results overview
            const hitText = totalHits ? `${totalHits} total grants` : `${results.length} grants`;
            insights.push({
                text: `ðŸŽ¯ Found ${hitText} matching "${query}" with ${avgMatchScore}% average compatibility`,
                color: 'bg-blue-400'
            });

            // Best match insight
            if (results[0]) {
                insights.push({
                    text: `ðŸ’¡ Top recommendation: ${results[0].title} (${results[0].matchScore}% match) from ${results[0].agency}`,
                    color: 'bg-green-400'
                });
            }

            // Funding potential
            if (totalFunding > 0) {
                insights.push({
                    text: `ðŸ’° Combined funding potential: $${totalFunding.toLocaleString()} across displayed opportunities`,
                    color: 'bg-purple-400'
                });
            }

            // Agency diversity
            if (topAgencies) {
                insights.push({
                    text: `ðŸ›ï¸ Key funding agencies: ${topAgencies}`,
                    color: 'bg-indigo-400'
                });
            }

            // Deadline urgency
            if (upcomingDeadlines.length > 0) {
                const nextDeadline = upcomingDeadlines.sort((a, b) => new Date(a.deadline) - new Date(b.deadline))[0];
                insights.push({
                    text: `â° Urgent: ${upcomingDeadlines.length} applications due within 30 days (next: ${nextDeadline.deadline})`,
                    color: 'bg-red-400'
                });
            } else {
                insights.push({
                    text: `ðŸ“… Good news: No immediate deadlines, allowing time for thorough application preparation`,
                    color: 'bg-cyan-400'
                });
            }

            // Technology-specific insights
            const techInsight = generateTechnologyInsights(query, results);
            if (techInsight) {
                insights.push({
                    text: techInsight,
                    color: 'bg-yellow-400'
                });
            }

            return insights;
        }

        // Generate technology-specific RAG insights
        function generateTechnologyInsights(query, results) {
            const queryLower = query.toLowerCase();
            
            if (queryLower.includes('cyber') || queryLower.includes('security')) {
                const securityGrants = results.filter(g => g.title.toLowerCase().includes('security') || g.title.toLowerCase().includes('cyber'));
                return `ðŸ” Cybersecurity focus: ${securityGrants.length} specialized security grants available`;
            }
            
            if (queryLower.includes('ai') || queryLower.includes('artificial') || queryLower.includes('machine learning')) {
                const aiGrants = results.filter(g => g.title.toLowerCase().includes('ai') || g.title.toLowerCase().includes('intelligence'));
                return `ðŸ¤– AI/ML opportunities: ${aiGrants.length} grants supporting artificial intelligence research`;
            }
            
            if (queryLower.includes('quantum')) {
                const quantumGrants = results.filter(g => g.title.toLowerCase().includes('quantum'));
                return `âš›ï¸ Quantum computing: ${quantumGrants.length} cutting-edge quantum technology grants`;
            }
            
            if (queryLower.includes('climate') || queryLower.includes('environmental')) {
                const climateGrants = results.filter(g => g.title.toLowerCase().includes('climate') || g.title.toLowerCase().includes('environment'));
                return `ðŸŒ± Climate focus: ${climateGrants.length} grants targeting environmental solutions`;
            }
            
            return null;
        }

        // View grant details (placeholder)
        function viewGrantDetails(grantTitle) {
            alert(`Viewing details for: ${grantTitle}\n\nThis would open a detailed modal with full grant information, requirements, and application guidelines.`);
        }

        // Add grant to workflow
        function addToWorkflow(grantTitle) {
            const newGrant = {
                id: activeGrants.length + 1,
                title: grantTitle,
                agency: "Federal Agency",
                amount: "$500,000",
                deadline: "2025-03-15",
                status: "Research Phase",
                progress: 10,
                lastUpdate: new Date().toISOString().split('T')[0]
            };
            
            activeGrants.unshift(newGrant);
            updateGrantPipeline();
            
            // Show success message
            alert(`âœ… "${grantTitle}" has been added to your grant workflow!`);
        }

        // Update grant pipeline display
        function updateGrantPipeline() {
            const container = document.getElementById('grantPipeline');
            container.innerHTML = activeGrants.map(grant => `
                <div class="grant-card glass rounded-xl p-4 border border-white/10 hover:bg-white/10 transition-all">
                    <div class="flex justify-between items-start mb-3">
                        <h4 class="font-semibold text-white text-sm">${grant.title}</h4>
                        <span class="text-xs px-2 py-1 rounded-full ${getStatusColor(grant.status)} text-white/90">
                            ${grant.status}
                        </span>
                    </div>
                    <div class="space-y-2 text-xs text-white/70">
                        <div class="flex justify-between">
                            <span>${grant.agency}</span>
                            <span>${grant.amount}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Deadline: ${grant.deadline}</span>
                            <span>Updated: ${grant.lastUpdate}</span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-white/60">Progress</span>
                            <span class="text-xs text-white/80">${grant.progress}%</span>
                        </div>
                        <div class="w-full bg-white/10 rounded-full h-2">
                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-500" style="width: ${grant.progress}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Get status color for grant cards
        function getStatusColor(status) {
            const colors = {
                'Research Phase': 'bg-yellow-500/20',
                'Draft in Progress': 'bg-orange-500/20',
                'Application Submitted': 'bg-blue-500/20',
                'Under Review': 'bg-purple-500/20',
                'Approved': 'bg-green-500/20',
                'Rejected': 'bg-red-500/20'
            };
            return colors[status] || 'bg-gray-500/20';
        }

        // Show add grant modal (placeholder)
        function showAddGrantModal() {
            alert('Add New Grant Modal\n\nThis would open a modal allowing users to manually add grants to their workflow with custom details and tracking.');
        }

        // Initialize grant management when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Update grant pipeline on page load
            if (document.getElementById('grantPipeline')) {
                updateGrantPipeline();
            }
            
            // Add Enter key support for search
            const searchInput = document.getElementById('grant-search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchGrants();
                    }
                });
            }
        });

        // Analytics Dashboard Functions
        let analyticsData = {
            activities: [],
            currentTimeRange: '7d',
            lastUpdate: Date.now()
        };

        // Initialize Analytics Dashboard
        function initializeAnalytics() {
            generateActivityFeed();
            startRealTimeUpdates();
            populateSystemMetrics();

            // Initialize Predictive Analytics Dashboard
            if (document.getElementById('forecastChart')) {
                console.log('Analytics tab clicked, initializing predictive analytics...');
                initializePredictiveAnalytics();
            }
        }

        // Update Analytics based on time range
        function updateAnalytics() {
            const timeRange = document.getElementById('analyticsTimeRange').value;
            analyticsData.currentTimeRange = timeRange;
            
            // Update KPIs based on time range
            updateKPIs(timeRange);
            
            // Update charts
            updatePerformanceChart(timeRange);
            
            // Refresh activity feed
            generateActivityFeed();
        }

        // Update Key Performance Indicators
        function updateKPIs(timeRange) {
            const ranges = {
                '24h': { workflows: 847, processing: '0.8s', success: '99.2%', users: 439 },
                '7d': { workflows: 2847, processing: '1.2s', success: '98.7%', users: 1439 },
                '30d': { workflows: 12847, processing: '1.5s', success: '98.3%', users: 4839 },
                '90d': { workflows: 38247, processing: '1.8s', success: '97.9%', users: 12439 }
            };
            
            const data = ranges[timeRange];
            document.getElementById('totalWorkflows').textContent = data.workflows.toLocaleString();
            document.getElementById('avgProcessingTime').textContent = data.processing;
            document.getElementById('successRate').textContent = data.success;
            document.getElementById('activeUsers').textContent = data.users.toLocaleString();
        }

        // Update Performance Chart
        function updatePerformanceChart(timeRange) {
            // Simulate chart update with animation
            const bars = document.querySelectorAll('#performanceChart .animate-pulse');
            bars.forEach((bar, index) => {
                setTimeout(() => {
                    const newHeight = Math.random() * 60 + 30;
                    bar.style.height = newHeight + '%';
                }, index * 100);
            });
        }

        // Generate Real-time Activity Feed
        function generateActivityFeed() {
            const activities = [
                { type: 'workflow', action: 'deployed', item: 'Emergency Response Workflow', time: '2 minutes ago', status: 'success' },
                { type: 'grant', action: 'discovered', item: 'NSF CAREER Grant - AI Research', time: '5 minutes ago', status: 'info' },
                { type: 'security', action: 'detected', item: 'Potential threat blocked', time: '8 minutes ago', status: 'warning' },
                { type: 'user', action: 'logged in', item: 'Admin user from City Hall', time: '12 minutes ago', status: 'info' },
                { type: 'workflow', action: 'completed', item: 'Building Permit Process', time: '15 minutes ago', status: 'success' },
                { type: 'grant', action: 'applied', item: 'DHS Cybersecurity Innovation', time: '18 minutes ago', status: 'success' },
                { type: 'security', action: 'updated', item: 'Firewall rules modified', time: '22 minutes ago', status: 'info' },
                { type: 'compliance', action: 'verified', item: 'GDPR compliance check', time: '25 minutes ago', status: 'success' },
                { type: 'user', action: 'requested', item: 'New citizen service inquiry', time: '28 minutes ago', status: 'info' },
                { type: 'workflow', action: 'optimized', item: 'Tax Processing Pipeline', time: '32 minutes ago', status: 'success' }
            ];

            const container = document.getElementById('activityFeed');
            if (!container) return;

            container.innerHTML = activities.slice(0, 8).map(activity => {
                const icons = {
                    workflow: 'fa-project-diagram',
                    grant: 'fa-dollar-sign',
                    security: 'fa-shield-alt',
                    user: 'fa-user',
                    compliance: 'fa-check-circle'
                };

                const colors = {
                    success: 'text-green-400',
                    warning: 'text-yellow-400',
                    info: 'text-blue-400',
                    error: 'text-red-400'
                };

                return `
                    <div class="flex items-center space-x-3 p-3 bg-white/5 rounded-lg hover:bg-white/10 transition-all duration-200">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas ${icons[activity.type]} text-white text-sm"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-white/90 text-sm">
                                <span class="font-medium">${activity.item}</span>
                                <span class="text-white/70">was ${activity.action}</span>
                            </p>
                            <p class="text-white/50 text-xs">${activity.time}</p>
                        </div>
                        <div class="flex-shrink-0">
                            <div class="w-2 h-2 ${colors[activity.status]} rounded-full animate-pulse"></div>
                        </div>
                    </div>
                `;
            }).join('');

            analyticsData.activities = activities;
        }

        // Load More Activity (pagination simulation)
        function loadMoreActivity() {
            const moreActivities = [
                { type: 'workflow', action: 'created', item: 'Public Records Request Process', time: '35 minutes ago', status: 'info' },
                { type: 'grant', action: 'reviewed', item: 'EPA Environmental Grant', time: '38 minutes ago', status: 'warning' },
                { type: 'security', action: 'scanned', item: 'Daily vulnerability scan', time: '42 minutes ago', status: 'success' },
                { type: 'user', action: 'updated', item: 'Department profile changes', time: '45 minutes ago', status: 'info' }
            ];

            const container = document.getElementById('activityFeed');
            const currentActivities = analyticsData.activities;
            analyticsData.activities = [...currentActivities, ...moreActivities];
            
            // Re-render with more items
            generateActivityFeed();
        }

        // Refresh Usage Data
        function refreshUsageData() {
            // Simulate data refresh with random variations
            const usageElements = document.querySelectorAll('[style*="width:"]');
            usageElements.forEach(element => {
                setTimeout(() => {
                    const currentWidth = parseInt(element.style.width);
                    const variation = (Math.random() - 0.5) * 10; // Â±5% variation
                    const newWidth = Math.max(20, Math.min(95, currentWidth + variation));
                    element.style.width = newWidth + '%';
                }, Math.random() * 1000);
            });

            // Show feedback
            const button = event.target;
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner animate-spin"></i>';
            
            setTimeout(() => {
                button.innerHTML = originalIcon;
            }, 1000);
        }

        // Populate System Metrics
        function populateSystemMetrics() {
            // Simulate real-time system metrics
            const metrics = {
                cpu: Math.floor(Math.random() * 40) + 20,
                memory: Math.floor(Math.random() * 30) + 50,
                database: Math.floor(Math.random() * 25) + 25,
                network: Math.floor(Math.random() * 20) + 70
            };

            document.getElementById('cpuUsage').textContent = metrics.cpu + '%';
            document.getElementById('memoryUsage').textContent = metrics.memory + '%';
            document.getElementById('databaseLoad').textContent = metrics.database + '%';
            document.getElementById('networkIO').textContent = metrics.network + '%';

            // Update progress bars (only if elements exist)
            const cpuBar = document.querySelector('[style*="width: 23%"]');
            const memBar = document.querySelector('[style*="width: 67%"]');
            const dbBar = document.querySelector('[style*="width: 34%"]');
            const netBar = document.querySelector('[style*="width: 89%"]');

            if (cpuBar) cpuBar.style.width = metrics.cpu + '%';
            if (memBar) memBar.style.width = metrics.memory + '%';
            if (dbBar) dbBar.style.width = metrics.database + '%';
            if (netBar) netBar.style.width = metrics.network + '%';
        }

        // Start Real-time Updates
        function startRealTimeUpdates() {
            // Update system metrics every 5 seconds
            setInterval(() => {
                populateSystemMetrics();
            }, 5000);

            // Add new activity every 30 seconds
            setInterval(() => {
                addRandomActivity();
            }, 30000);

            // Update timestamps every minute
            setInterval(() => {
                updateActivityTimestamps();
            }, 60000);
        }

        // Add Random Activity
        function addRandomActivity() {
            const randomActivities = [
                { type: 'workflow', action: 'executed', item: 'Automated Data Backup', time: 'Just now', status: 'success' },
                { type: 'grant', action: 'matched', item: 'DOE Energy Innovation Grant', time: 'Just now', status: 'info' },
                { type: 'security', action: 'monitored', item: 'Network traffic analysis', time: 'Just now', status: 'info' },
                { type: 'user', action: 'accessed', item: 'Citizen portal dashboard', time: 'Just now', status: 'info' },
                { type: 'compliance', action: 'audited', item: 'Data retention policies', time: 'Just now', status: 'success' }
            ];

            const newActivity = randomActivities[Math.floor(Math.random() * randomActivities.length)];
            analyticsData.activities.unshift(newActivity);
            
            // Re-generate feed with new activity
            generateActivityFeed();
        }

        // Update Activity Timestamps
        function updateActivityTimestamps() {
            analyticsData.activities = analyticsData.activities.map(activity => {
                let timeText = activity.time;
                if (timeText.includes('minutes ago')) {
                    const minutes = parseInt(timeText) + 1;
                    timeText = minutes + ' minutes ago';
                } else if (timeText === 'Just now') {
                    timeText = '1 minute ago';
                }
                return { ...activity, time: timeText };
            });
            
            generateActivityFeed();
        }

        // Toggle Chart View
        function toggleChart(chartType) {
            const chart = document.getElementById(chartType + 'Chart');
            if (chart.classList.contains('h-80')) {
                chart.classList.remove('h-80');
                chart.classList.add('h-96');
            } else {
                chart.classList.remove('h-96');
                chart.classList.add('h-80');
            }
        }

        // Customize Analytics (placeholder)
        function customizeAnalytics() {
            alert('Analytics Customization\n\nThis would open a modal allowing users to:\nâ€¢ Choose which metrics to display\nâ€¢ Set custom alert thresholds\nâ€¢ Configure refresh intervals\nâ€¢ Export data in various formats\nâ€¢ Create custom dashboards');
        }

        // Add Custom Scrollbar Styles
        const customScrollbarCSS = `
            <style>
                .custom-scrollbar::-webkit-scrollbar {
                    width: 4px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: rgba(255, 255, 255, 0.1);
                    border-radius: 2px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 2px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.5);
                }
            </style>
        `;
        document.head.insertAdjacentHTML('beforeend', customScrollbarCSS);

        // Initialize analytics when analytics tab is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize analytics if the elements exist
            if (document.getElementById('activityFeed')) {
                initializeAnalytics();
            }
            // Initialize CRM if the elements exist
            if (document.getElementById('contactsTableBody')) {
                initializeCRM();
            }
        });

        // CRM Functions

        function initializeCRM() {
            // Initialize real CRM module with API integration
            if (window.CRM) {
                CRM.init();
            } else {
                console.error('CRM module not loaded');
            }
        }

        // Grants Functions

        function initializeGrants() {
            // Initialize real Grants module with API integration
            if (window.Grants) {
                Grants.init();
            } else {
                console.error('Grants module not loaded');
            }
        }

        // Dashboard Functions

        function initializeDashboard() {
            // Initialize real Dashboard module with API integration
            if (window.Dashboard) {
                Dashboard.init();
            } else {
                console.error('Dashboard module not loaded');
            }
        }

        function populateContactsTable(contacts = crmContacts) {
            const tableBody = document.getElementById('contactsTableBody');
            if (!tableBody) return;

            tableBody.innerHTML = '';
            contacts.forEach(contact => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-white/5 transition-all duration-200 border-b border-white/5';
                
                const statusClass = contact.status === 'active' ? 'text-emerald-400' : 'text-gray-400';
                const typeConfig = {
                    'citizen': { color: 'text-blue-400', bg: 'bg-blue-500/20', border: 'border-blue-400/30', icon: 'fas fa-user' },
                    'official': { color: 'text-purple-400', bg: 'bg-purple-500/20', border: 'border-purple-400/30', icon: 'fas fa-user-tie' },
                    'vendor': { color: 'text-emerald-400', bg: 'bg-emerald-500/20', border: 'border-emerald-400/30', icon: 'fas fa-building' },
                    'contractor': { color: 'text-orange-400', bg: 'bg-orange-500/20', border: 'border-orange-400/30', icon: 'fas fa-hard-hat' }
                };
                
                const typeInfo = typeConfig[contact.type] || { color: 'text-white', bg: 'bg-gray-500/20', border: 'border-gray-400/30', icon: 'fas fa-user' };
                
                // Calculate engagement score (simulated)
                const engagementScore = Math.floor(Math.random() * 40) + 60;
                const engagementColor = engagementScore > 85 ? 'text-emerald-400' : engagementScore > 70 ? 'text-yellow-400' : 'text-orange-400';

                row.innerHTML = `
                    <td class="py-4 px-6">
                        <div class="flex items-center space-x-4">
                            <input type="checkbox" class="rounded border-white/30 bg-white/10">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl flex items-center justify-center">
                                <span class="text-white font-semibold">${contact.name[0]}</span>
                            </div>
                            <div class="flex-1">
                                <div class="text-white font-semibold">${contact.name}</div>
                                <div class="text-white/60 text-sm">${contact.email}</div>
                                <div class="text-white/40 text-xs">${contact.phone}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex items-center space-x-2">
                            <div class="${typeInfo.bg} ${typeInfo.border} border rounded-lg px-3 py-1.5 flex items-center space-x-2">
                                <i class="${typeInfo.icon} ${typeInfo.color} text-xs"></i>
                                <span class="${typeInfo.color} font-medium text-sm capitalize">${contact.type}</span>
                            </div>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="text-white/80 font-medium">${contact.department}</div>
                        <div class="text-white/50 text-sm">${contact.address}</div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="text-white/80">${contact.lastContact}</div>
                        <div class="flex items-center space-x-2 mt-1">
                            <div class="w-2 h-2 ${engagementColor.replace('text-', 'bg-')} rounded-full"></div>
                            <span class="${engagementColor} text-sm font-medium">${engagementScore}% engaged</span>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 ${statusClass.replace('text-', 'bg-')} rounded-full animate-pulse"></div>
                            <span class="${statusClass} font-medium capitalize">${contact.status}</span>
                        </div>
                    </td>
                    <td class="py-4 px-6">
                        <div class="flex items-center space-x-2">
                            <button onclick="viewContact(${contact.id})" class="p-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 rounded-lg transition-all duration-200 border border-blue-500/30">
                                <i class="fas fa-eye text-xs"></i>
                            </button>
                            <button onclick="editContact(${contact.id})" class="p-2 bg-emerald-600/20 hover:bg-emerald-600/40 text-emerald-300 rounded-lg transition-all duration-200 border border-emerald-500/30">
                                <i class="fas fa-edit text-xs"></i>
                            </button>
                            <button onclick="scheduleFollowUp(${contact.id})" class="p-2 bg-purple-600/20 hover:bg-purple-600/40 text-purple-300 rounded-lg transition-all duration-200 border border-purple-500/30">
                                <i class="fas fa-calendar text-xs"></i>
                            </button>
                            <button onclick="deleteContact(${contact.id})" class="p-2 bg-red-600/20 hover:bg-red-600/40 text-red-300 rounded-lg transition-all duration-200 border border-red-500/30">
                                <i class="fas fa-trash text-xs"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function setupContactSearch() {
            const searchInput = document.getElementById('contactSearch');
            const filterSelect = document.getElementById('contactFilter');

            if (searchInput) {
                searchInput.addEventListener('input', filterContacts);
            }
            if (filterSelect) {
                filterSelect.addEventListener('change', filterContacts);
            }
        }

        function filterContacts() {
            const searchTerm = document.getElementById('contactSearch')?.value.toLowerCase() || '';
            const filterType = document.getElementById('contactFilter')?.value || 'all';

            let filteredContacts = crmContacts.filter(contact => {
                const matchesSearch = contact.name.toLowerCase().includes(searchTerm) ||
                                    contact.email.toLowerCase().includes(searchTerm) ||
                                    contact.department.toLowerCase().includes(searchTerm);
                const matchesFilter = filterType === 'all' || contact.type === filterType;
                return matchesSearch && matchesFilter;
            });

            populateContactsTable(filteredContacts);
        }

        function updateCRMAnalytics() {
            // Update real-time contact analytics
            const totalContacts = crmContacts.length;
            const activeContacts = crmContacts.filter(c => c.status === 'active').length;
            const recentContacts = crmContacts.filter(c => {
                const contactDate = new Date(c.lastContact);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return contactDate >= weekAgo;
            }).length;

            // These would update the analytics display if the elements exist
            console.log(`CRM Analytics: ${totalContacts} total, ${activeContacts} active, ${recentContacts} recent`);
        }

        function processCrmAiQuery() {
            const input = document.getElementById('crmAiInput');
            if (!input) return;

            const query = input.value.trim();
            if (!query) return;

            // Simulate AI processing
            setTimeout(() => {
                const responses = [
                    "I found 3 contacts matching your query. Sarah Johnson has the most recent activity.",
                    "Based on contact patterns, I recommend following up with TechCorp Solutions this week.",
                    "Detective Chen has been flagged for a compliance review due to recent case activities.",
                    "I've identified 5 contacts that may need CJIS recertification this quarter.",
                    "Contact analytics show 78% engagement rate with recent outreach campaigns."
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                // Create AI response element
                const responseDiv = document.createElement('div');
                responseDiv.className = 'mt-3 p-3 bg-purple-500/20 rounded-lg border border-purple-400/30';
                responseDiv.innerHTML = `
                    <div class="flex items-start space-x-2">
                        <i class="fas fa-robot text-purple-400 mt-1"></i>
                        <div class="text-purple-200 text-sm">${response}</div>
                    </div>
                `;
                
                // Add response after the input
                const container = input.closest('.bg-black\\/30') || input.closest('[class*="bg-black/30"]');
                if (container) {
                    // Remove any existing response
                    const existingResponse = container.querySelector('.bg-purple-500\\/20') || container.querySelector('[class*="bg-purple-500/20"]');
                    if (existingResponse) {
                        existingResponse.remove();
                    }
                    container.appendChild(responseDiv);
                    
                    // Auto-remove after 5 seconds
                    setTimeout(() => {
                        responseDiv.remove();
                    }, 5000);
                }
                
                input.value = '';
            }, 1000);
        }

        function showNewContactModal() {
            alert('New Contact Modal - Coming Soon! This would open a secure CJIS-compliant contact creation form.');
        }

        function viewContact(contactId) {
            const contact = crmContacts.find(c => c.id === contactId);
            if (contact) {
                alert(`Contact Details:\\nName: ${contact.name}\\nEmail: ${contact.email}\\nPhone: ${contact.phone}\\nDepartment: ${contact.department}\\nNotes: ${contact.notes}`);
            }
        }

        function editContact(contactId) {
            alert(`Edit Contact ${contactId} - This would open a secure editing form with audit logging.`);
        }

        function deleteContact(contactId) {
            if (confirm('Are you sure you want to delete this contact? This action will be logged for compliance.')) {
                crmContacts = crmContacts.filter(c => c.id !== contactId);
                populateContactsTable();
                updateCRMAnalytics();
                alert('Contact deleted. Action logged for CJIS compliance.');
            }
        }

        function bulkImportContacts() {
            alert('Bulk Import - This would open a secure import interface with encryption validation and audit logging.');
        }

        function exportContacts() {
            alert('Export Contacts - This would generate an encrypted export with audit trail for compliance.');
        }

        function runComplianceAudit() {
            alert('Running CJIS Compliance Audit...\\n\\nâœ“ Data encryption verified\\nâœ“ Access controls validated\\nâœ“ Audit trails complete\\nâœ“ No violations found\\n\\nCompliance Score: 99.8%');
        }

        function generateReport() {
            alert('Generating CRM Report...\\n\\nReport will include:\\nâ€¢ Contact analytics\\nâ€¢ Engagement metrics\\nâ€¢ Compliance status\\nâ€¢ Security assessment\\n\\nReport will be encrypted and audit-logged.');
        }

        // ===== INTELLIGENT CONTACT IMPORT & ENRICHMENT - Added 2025-10-18 =====
        // SECURITY TODO: Implement secure file upload with virus scanning
        // SECURITY TODO: Add file size and type validation (max 10MB, allowed types)
        // TODO: Connect to OCR service (Google Vision, AWS Textract, Azure Computer Vision)
        // TODO: Implement LinkedIn API integration for profile enrichment
        // TODO: Add USPS address validation API
        // TODO: Connect to company database (Clearbit, ZoomInfo, D&B)
        // TODO: Implement fuzzy matching algorithm for duplicate detection
        // TODO: Add social media profile lookup services
        // TODO: Integrate with email parsing service
        // TODO: Connect to CRM database for merge operations
        // TODO: Implement machine learning model for contact scoring
        // TODO: Add relationship graph database (Neo4j)
        // SECURITY TODO: Implement PII detection and encryption at rest
        // SECURITY TODO: Add audit logging for all contact access

        function openContactImport(mode) {
            console.log(`AUDIT: Opening contact import - mode: ${mode} at ${new Date().toISOString()}`);

            const messages = {
                camera: 'ðŸ“· Business Card Scanner\n\nFeatures:\nâ€¢ Auto-detect card edges\nâ€¢ Real-time OCR processing\nâ€¢ Batch scan mode for events\nâ€¢ Works offline (queue for sync)\nâ€¢ Voice notes per contact\n\nMobile-optimized interface:\nâ€¢ Rapid-fire scanning\nâ€¢ GPS tagging (where contact met)\nâ€¢ Photo + card attachment\nâ€¢ Auto follow-up reminders\n\nTODO: Implement camera interface with edge detection',

                upload: 'â˜ï¸ Smart Document Upload\n\nSupported formats:\nâ€¢ Business Cards (JPG, PNG, PDF)\nâ€¢ Contact Sheets (PDF, DOCX)\nâ€¢ Email Signatures (EML, MSG)\nâ€¢ Spreadsheets (CSV, XLSX)\nâ€¢ VCard files (.vcf)\nâ€¢ Scanned documents\n\nAI Processing:\nâ€¢ Auto-detect document type\nâ€¢ Extract all contact fields\nâ€¢ Confidence scoring per field\nâ€¢ Duplicate detection (fuzzy matching)\nâ€¢ Social profile enrichment\nâ€¢ Company data lookup\n\nProcessing Options:\nâ€¢ Speed vs Accuracy slider\nâ€¢ Duplicate sensitivity (50-100%)\nâ€¢ Auto-merge duplicates >95%\nâ€¢ Auto-enrich with LinkedIn/social\nâ€¢ Detect relationships & org structure\n\nTODO: Open full upload interface (from test file)',

                bulk: 'ðŸ“‚ Bulk Import Processing\n\nBatch capabilities:\nâ€¢ Upload up to 50 files at once\nâ€¢ Automatic document type detection\nâ€¢ Priority-based processing queue\nâ€¢ Progress tracking per file\nâ€¢ Live activity feed\n\nAdvanced features:\nâ€¢ Conference/event mode (tag all)\nâ€¢ Company network detection\nâ€¢ Relationship mapping\nâ€¢ Organizational chart generation\nâ€¢ Smart list auto-creation\n\nResults:\nâ€¢ Success rate dashboard\nâ€¢ Duplicate merge report\nâ€¢ Enrichment coverage stats\nâ€¢ Data quality improvements\nâ€¢ Time saved vs manual entry\n\nTODO: Implement bulk processing dashboard'
            };

            alert(messages[mode] || 'Opening contact import interface...');

            // TODO: Open actual import modal/interface
            console.log('TODO: Load intelligent-contact-import interface');
        }

        function viewImportHistory() {
            console.log(`AUDIT: Viewed import history at ${new Date().toISOString()}`);

            alert('ðŸ“Š Import History\n\nRecent Imports:\n\n' +
                  '1. GovCon 2024 Conference\n' +
                  '   â€¢ 47 business cards\n' +
                  '   â€¢ 96% success rate\n' +
                  '   â€¢ 3 duplicates merged\n' +
                  '   â€¢ 2 hours ago\n\n' +
                  '2. Vendor Meeting\n' +
                  '   â€¢ 12 business cards\n' +
                  '   â€¢ 100% success rate\n' +
                  '   â€¢ 1 duplicate merged\n' +
                  '   â€¢ 1 day ago\n\n' +
                  '3. Email Signature Batch\n' +
                  '   â€¢ 28 contacts extracted\n' +
                  '   â€¢ 93% success rate\n' +
                  '   â€¢ 5 duplicates merged\n' +
                  '   â€¢ 3 days ago\n\n' +
                  'Statistics:\n' +
                  'â€¢ Total imported this month: 2,847\n' +
                  'â€¢ Success rate: 96.3%\n' +
                  'â€¢ Duplicates prevented: 418\n' +
                  'â€¢ Time saved: 87 hours\n\n' +
                  'TODO: Create full import history interface with filters and analytics');

            // TODO: Show detailed import history modal
            console.log('TODO: Display import history modal');
        }
        // ===== END INTELLIGENT CONTACT IMPORT =====

        // New Enterprise CRM Functions
        function toggleContactView(viewType) {
            // Toggle between grid and list view
            const buttons = document.querySelectorAll('[onclick^="toggleContactView"]');
            buttons.forEach(btn => {
                btn.classList.remove('bg-blue-600');
                btn.classList.add('bg-white/10');
            });
            event.target.closest('button').classList.add('bg-blue-600');
            event.target.closest('button').classList.remove('bg-white/10');
            
            // TODO: Implement actual view switching logic
            console.log(`Switched to ${viewType} view`);
        }

        function scheduleFollowUp(contactId) {
            const contact = crmContacts.find(c => c.id === contactId);
            if (contact) {
                alert(`Schedule Follow-up for ${contact.name}\\n\\nThis would open an AI-powered scheduling interface with:\\nâ€¢ Smart time suggestions\\nâ€¢ Integration with calendar systems\\nâ€¢ Automated reminder setup\\nâ€¢ Compliance logging`);
            }
        }

        function exportComplianceReport() {
            alert('Exporting Compliance Report...\\n\\nðŸ”’ Generating encrypted compliance report\\nðŸ“Š Including all audit trails\\nðŸ›¡ï¸ CJIS & FedRAMP compliance verified\\nðŸ“„ Report will be available in secure download');
        }

        function processCrmAiQuery() {
            const input = document.getElementById('crmAiInput');
            if (!input) return;

            const query = input.value.trim();
            if (!query) return;

            // Enhanced AI responses for enterprise features
            setTimeout(() => {
                const responses = [
                    "ðŸŽ¯ Identified 12 high-value prospects from last month with 94% conversion probability",
                    "ðŸ“… Scheduled 8 follow-up meetings automatically based on engagement patterns",
                    "ðŸ” Found 3 compliance risks requiring immediate attention in vendor relationships", 
                    "ðŸ“ˆ Predictive analytics show 23% increase in citizen engagement opportunity",
                    "ðŸ¤– AI recommends focusing on 5 key relationships for maximum ROI this quarter",
                    "ðŸ” Security scan complete: All contact data properly encrypted and audit-logged",
                    "ðŸ’¡ Smart insight: Contact Jennifer Martinez shows highest contractor performance metrics",
                    "âš¡ Real-time sync complete: All enterprise systems updated with latest contact data"
                ];
                
                const response = responses[Math.floor(Math.random() * responses.length)];
                
                // Create enhanced AI response element
                const responseDiv = document.createElement('div');
                responseDiv.className = 'mt-4 p-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-xl border border-purple-400/30';
                responseDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-brain text-white text-sm"></i>
                        </div>
                        <div class="flex-1">
                            <div class="text-purple-200 font-medium text-sm mb-1">CRM AI Assistant</div>
                            <div class="text-white text-sm leading-relaxed">${response}</div>
                            <div class="flex items-center space-x-4 mt-3 text-xs text-purple-300">
                                <span>ðŸ•’ Processed in 0.3s</span>
                                <span>ðŸ”’ Secure</span>
                                <span>ðŸ“Š Confidence: 96%</span>
                            </div>
                        </div>
                        <button onclick="this.parentElement.parentElement.remove()" class="text-purple-300 hover:text-white transition-colors">
                            <i class="fas fa-times text-xs"></i>
                        </button>
                    </div>
                `;
                
                // Add response after the input container
                const container = input.closest('.glass');
                if (container) {
                    // Remove any existing response
                    const existingResponse = container.querySelector('.bg-gradient-to-r.from-purple-500\\/20');
                    if (existingResponse) {
                        existingResponse.remove();
                    }
                    container.appendChild(responseDiv);
                }
                
                input.value = '';
            }, 800);
        }

        // Handle Escape key for modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Added 2024-10-05: Drag and Drop Workflow Builder JavaScript
        // MOCK DATA - Replace in production
        // TODO: Connect to API endpoint /api/workflows

        const stepTypes = [
            // Input & Data Collection
            { id: 'form-input', name: 'Form Submission', icon: 'fa-file-alt', color: 'from-blue-400 to-cyan-500', category: 'input', description: 'Collect data via forms' },
            { id: 'document-upload', name: 'Document Upload', icon: 'fa-cloud-upload-alt', color: 'from-blue-500 to-blue-600', category: 'input', description: 'Upload required documents' },
            { id: 'data-entry', name: 'Manual Data Entry', icon: 'fa-keyboard', color: 'from-cyan-500 to-teal-500', category: 'input', description: 'Manual information input' },
            { id: 'api-input', name: 'API Data Fetch', icon: 'fa-plug', color: 'from-indigo-500 to-blue-500', category: 'input', description: 'Retrieve data from external API' },
            { id: 'validation', name: 'Data Validation', icon: 'fa-check-circle', color: 'from-green-400 to-emerald-500', category: 'validation', description: 'Validate data accuracy' },
            { id: 'compliance-check', name: 'Compliance Check', icon: 'fa-shield-alt', color: 'from-green-500 to-green-600', category: 'validation', description: 'Verify regulatory compliance' },
            { id: 'duplicate-check', name: 'Duplicate Detection', icon: 'fa-copy', color: 'from-teal-500 to-green-500', category: 'validation', description: 'Check for duplicates' },
            { id: 'background-check', name: 'Background Verification', icon: 'fa-user-shield', color: 'from-emerald-500 to-teal-600', category: 'validation', description: 'FBI/CJIS background check' },
            { id: 'auto-route', name: 'Auto-Route', icon: 'fa-route', color: 'from-purple-400 to-purple-500', category: 'routing', description: 'Automatically route by rules' },
            { id: 'assignment', name: 'Task Assignment', icon: 'fa-user-tag', color: 'from-purple-500 to-purple-600', category: 'routing', description: 'Assign to user or team' },
            { id: 'load-balance', name: 'Load Balancing', icon: 'fa-balance-scale', color: 'from-violet-500 to-purple-500', category: 'routing', description: 'Distribute workload evenly' },
            { id: 'single-approval', name: 'Single Approval', icon: 'fa-user-check', color: 'from-pink-400 to-rose-500', category: 'approval', description: 'One person approval' },
            { id: 'multi-approval', name: 'Multi-Level Approval', icon: 'fa-users-cog', color: 'from-pink-500 to-pink-600', category: 'approval', description: 'Sequential approvals' },
            { id: 'parallel-approval', name: 'Parallel Approval', icon: 'fa-project-diagram', color: 'from-rose-500 to-pink-600', category: 'approval', description: 'Simultaneous approvals' },
            { id: 'conditional-approval', name: 'Conditional Approval', icon: 'fa-filter', color: 'from-fuchsia-500 to-pink-500', category: 'approval', description: 'Approval based on criteria' },
            { id: 'if-then', name: 'If/Then Logic', icon: 'fa-code-branch', color: 'from-amber-400 to-orange-500', category: 'logic', description: 'Conditional branching' },
            { id: 'threshold-check', name: 'Threshold Check', icon: 'fa-chart-line', color: 'from-yellow-500 to-amber-600', category: 'logic', description: 'Compare against threshold' },
            { id: 'scoring', name: 'Risk Scoring', icon: 'fa-calculator', color: 'from-orange-500 to-red-500', category: 'logic', description: 'Calculate risk score' },
            { id: 'ai-decision', name: 'AI Decision', icon: 'fa-brain', color: 'from-indigo-400 to-purple-500', category: 'logic', description: 'AI-powered decision' },
            { id: 'email', name: 'Email Notification', icon: 'fa-envelope', color: 'from-sky-400 to-blue-500', category: 'notification', description: 'Send email alerts' },
            { id: 'sms', name: 'SMS Alert', icon: 'fa-mobile-alt', color: 'from-blue-500 to-indigo-500', category: 'notification', description: 'Send text message' },
            { id: 'push', name: 'Push Notification', icon: 'fa-bell', color: 'from-cyan-500 to-blue-600', category: 'notification', description: 'Mobile push notification' },
            { id: 'slack', name: 'Slack Message', icon: 'fa-slack', color: 'from-teal-500 to-cyan-500', category: 'notification', description: 'Post to Slack channel' },
            { id: 'timer', name: 'Wait Timer', icon: 'fa-hourglass-half', color: 'from-slate-400 to-gray-500', category: 'timing', description: 'Pause for specified time' },
            { id: 'deadline', name: 'Set Deadline', icon: 'fa-calendar-alt', color: 'from-gray-500 to-slate-600', category: 'timing', description: 'Define due date' },
            { id: 'escalation', name: 'Auto-Escalation', icon: 'fa-level-up-alt', color: 'from-orange-400 to-red-500', category: 'timing', description: 'Escalate if overdue' },
            { id: 'reminder', name: 'Reminder', icon: 'fa-clock', color: 'from-yellow-400 to-orange-500', category: 'timing', description: 'Send reminder alerts' },
            { id: 'database-write', name: 'Save to Database', icon: 'fa-database', color: 'from-emerald-400 to-green-500', category: 'data', description: 'Store in database' },
            { id: 'update-record', name: 'Update Record', icon: 'fa-edit', color: 'from-green-500 to-teal-500', category: 'data', description: 'Modify existing data' },
            { id: 'archive', name: 'Archive Data', icon: 'fa-archive', color: 'from-teal-500 to-cyan-600', category: 'data', description: 'Move to archive' },
            { id: 'export', name: 'Export Data', icon: 'fa-download', color: 'from-blue-500 to-indigo-500', category: 'data', description: 'Export to file' },
            { id: 'api-call', name: 'API Request', icon: 'fa-exchange-alt', color: 'from-violet-400 to-purple-500', category: 'integration', description: 'Call external API' },
            { id: 'webhook', name: 'Webhook Trigger', icon: 'fa-link', color: 'from-purple-500 to-fuchsia-500', category: 'integration', description: 'Trigger webhook event' },
            { id: 'ftp-upload', name: 'FTP Transfer', icon: 'fa-server', color: 'from-indigo-500 to-violet-500', category: 'integration', description: 'Transfer via FTP' },
            { id: 'fedram-sync', name: 'FedRAMP Sync', icon: 'fa-sync', color: 'from-blue-600 to-indigo-600', category: 'integration', description: 'Sync with FedRAMP system' },
            { id: 'generate-report', name: 'Generate Report', icon: 'fa-file-pdf', color: 'from-red-400 to-pink-500', category: 'completion', description: 'Create PDF report' },
            { id: 'audit-log', name: 'Audit Trail', icon: 'fa-history', color: 'from-slate-500 to-gray-600', category: 'completion', description: 'Log audit trail' },
            { id: 'completion', name: 'Mark Complete', icon: 'fa-flag-checkered', color: 'from-green-500 to-emerald-600', category: 'completion', description: 'Workflow completion' },
            { id: 'close-ticket', name: 'Close Ticket', icon: 'fa-check-double', color: 'from-teal-500 to-green-600', category: 'completion', description: 'Close and archive' }
        ];

        let currentWorkflow = [];
        let savedWorkflowsList = [];

        function initializeStepLibrary() {
            console.log('initializeStepLibrary called');
            const library = document.getElementById('stepLibrary');
            if (!library) {
                console.error('stepLibrary element not found!');
                return;
            }

            console.log('stepLibrary element found, initializing with', stepTypes.length, 'step types');

            const categories = {
                'input': { name: 'Input & Collection', icon: 'fa-inbox', color: 'from-blue-500 to-cyan-500' },
                'validation': { name: 'Validation & Compliance', icon: 'fa-check-circle', color: 'from-green-500 to-emerald-500' },
                'routing': { name: 'Routing & Assignment', icon: 'fa-route', color: 'from-purple-500 to-violet-500' },
                'approval': { name: 'Approvals & Reviews', icon: 'fa-user-check', color: 'from-pink-500 to-rose-500' },
                'logic': { name: 'Decision Logic', icon: 'fa-brain', color: 'from-amber-500 to-orange-500' },
                'notification': { name: 'Notifications', icon: 'fa-bell', color: 'from-sky-500 to-blue-500' },
                'timing': { name: 'Time-based Actions', icon: 'fa-clock', color: 'from-gray-500 to-slate-500' },
                'data': { name: 'Data Operations', icon: 'fa-database', color: 'from-teal-500 to-cyan-500' },
                'integration': { name: 'Integration & External', icon: 'fa-plug', color: 'from-violet-500 to-purple-500' },
                'completion': { name: 'Completion & Reports', icon: 'fa-flag-checkered', color: 'from-emerald-500 to-green-500' }
            };

            let html = '';
            Object.entries(categories).forEach(([catKey, catData]) => {
                const categorySteps = stepTypes.filter(s => s.category === catKey);
                if (categorySteps.length > 0) {
                    html += `<div class="mb-4"><div class="flex items-center gap-2 mb-2 px-2"><div class="w-6 h-6 rounded-lg bg-gradient-to-r ${catData.color} flex items-center justify-center flex-shrink-0"><i class="fas ${catData.icon} text-white text-xs"></i></div><h4 class="text-xs font-bold text-white/80 uppercase tracking-wide">${catData.name}</h4></div><div class="space-y-1">${categorySteps.map(step => `<div class="workflow-step glass rounded-lg p-2 flex items-center gap-2 group hover:bg-white/20 cursor-move" draggable="true" data-step-id="${step.id}" role="button" tabindex="0" aria-label="Drag ${step.name} step"><div class="w-8 h-8 rounded-lg bg-gradient-to-r ${step.color} flex items-center justify-center flex-shrink-0 shadow-lg"><i class="fas ${step.icon} text-white text-sm"></i></div><div class="flex-1 min-w-0"><div class="text-white font-medium text-sm truncate">${step.name}</div><div class="text-white/50 text-xs truncate">${step.description}</div></div><i class="fas fa-grip-vertical text-white/30 group-hover:text-white/60 transition-all"></i></div>`).join('')}</div></div>`;
                }
            });
            library.innerHTML = html;

            console.log('Step library HTML populated, found', document.querySelectorAll('.workflow-step').length, 'workflow steps');

            document.querySelectorAll('.workflow-step').forEach(step => {
                step.addEventListener('dragstart', (e) => { e.currentTarget.classList.add('dragging'); e.dataTransfer.effectAllowed = 'copy'; e.dataTransfer.setData('stepId', e.currentTarget.dataset.stepId); });
                step.addEventListener('dragend', (e) => e.currentTarget.classList.remove('dragging'));
                step.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); addStepToWorkflow(e.currentTarget.dataset.stepId); } });
            });

            const dropZone = document.getElementById('dropZone');
            if (dropZone) {
                dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; dropZone.classList.add('drag-over'); });
                dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
                dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); const stepId = e.dataTransfer.getData('stepId'); if (stepId) addStepToWorkflow(stepId); });
            }

            const clearBtn = document.getElementById('clearBtn');
            const saveBtn = document.getElementById('saveBtn');
            const generateBtn = document.getElementById('generateBtn');
            const confirmSave = document.getElementById('confirmSave');
            const cancelSave = document.getElementById('cancelSave');

            if (clearBtn) clearBtn.addEventListener('click', () => { if (currentWorkflow.length === 0) return; if (confirm('Clear all steps?')) { currentWorkflow = []; renderWorkflow(); } });
            if (saveBtn) saveBtn.addEventListener('click', () => { if (currentWorkflow.length === 0) { showStatus('error', 'Add at least one step to save'); return; } document.getElementById('workflowName').value = ''; document.getElementById('saveModal').classList.remove('hidden'); delete document.getElementById('saveModal').dataset.editId; });
            if (confirmSave) confirmSave.addEventListener('click', () => { const workflowName = document.getElementById('workflowName').value.trim(); if (!workflowName) { showStatus('error', 'Please enter a workflow name'); return; } const modal = document.getElementById('saveModal'); const editId = modal.dataset.editId; if (editId) { const workflow = savedWorkflowsList.find(w => w.id == editId); if (workflow) { workflow.name = workflowName; workflow.steps = [...currentWorkflow]; workflow.updatedAt = new Date().toISOString(); showStatus('success', `Workflow "${workflowName}" updated!`); } } else { const workflow = { id: Date.now(), name: workflowName, steps: [...currentWorkflow], createdAt: new Date().toISOString() }; savedWorkflowsList.push(workflow); showStatus('success', `Workflow "${workflowName}" saved!`); } renderSavedWorkflows(); modal.classList.add('hidden'); });
            if (cancelSave) cancelSave.addEventListener('click', () => { document.getElementById('saveModal').classList.add('hidden'); delete document.getElementById('saveModal').dataset.editId; });
            if (generateBtn) generateBtn.addEventListener('click', () => { const input = document.getElementById('aiWorkflowInput').value.trim(); if (!input) { showStatus('error', 'Please describe your workflow'); return; } showStatus('loading', 'AI is generating your workflow...'); setTimeout(() => { const generatedSteps = parseWorkflowFromText(input); currentWorkflow = generatedSteps; renderWorkflow(); showStatus('success', `Generated ${generatedSteps.length} workflow steps!`); }, 1500); });
        }

        function addStepToWorkflow(stepId) {
            const stepType = stepTypes.find(s => s.id === stepId);
            if (!stepType) return;
            currentWorkflow.push({ id: Date.now(), typeId: stepId, name: stepType.name, icon: stepType.icon, color: stepType.color });
            renderWorkflow();
        }

        function renderWorkflow() {
            const container = document.getElementById('workflowStepsCanvas');
            const emptyState = document.getElementById('emptyState');
            if (!container || !emptyState) return;

            if (currentWorkflow.length === 0) { emptyState.classList.remove('hidden'); container.innerHTML = ''; return; }
            emptyState.classList.add('hidden');
            container.innerHTML = currentWorkflow.map((step, index) => `<div class="glass rounded-lg p-4 flex items-center gap-4" role="listitem"><div class="text-white/50 font-bold">${index + 1}</div><div class="w-10 h-10 rounded-lg bg-gradient-to-r ${step.color} flex items-center justify-center flex-shrink-0"><i class="fas ${step.icon} text-white"></i></div><div class="flex-1"><div class="text-white font-medium">${step.name}</div></div><button class="text-red-400 hover:text-red-300 transition-all p-2" onclick="removeStep(${step.id})" aria-label="Remove ${step.name} step"><i class="fas fa-times"></i></button></div>`).join('');
        }

        function removeStep(stepId) { currentWorkflow = currentWorkflow.filter(s => s.id !== stepId); renderWorkflow(); }

        function showStatus(type, message) {
            const statusDiv = document.getElementById('aiStatus');
            if (!statusDiv) return;
            statusDiv.classList.remove('hidden');
            const colors = { loading: 'bg-blue-500/20 text-blue-300 border-blue-500/30', success: 'bg-green-500/20 text-green-300 border-green-500/30', error: 'bg-red-500/20 text-red-300 border-red-500/30' };
            const icons = { loading: 'fa-spinner fa-spin', success: 'fa-check-circle', error: 'fa-exclamation-circle' };
            statusDiv.className = `mt-4 p-3 rounded-lg border ${colors[type]}`;
            statusDiv.innerHTML = `<i class="fas ${icons[type]} mr-2"></i>${message}`;
            if (type !== 'loading') setTimeout(() => statusDiv.classList.add('hidden'), 3000);
        }

        function renderSavedWorkflows() {
            const container = document.getElementById('savedWorkflows');
            if (!container) return;
            if (savedWorkflowsList.length === 0) { container.innerHTML = '<div class="text-white/50 text-sm text-center py-4">No saved workflows yet</div>'; return; }
            container.innerHTML = savedWorkflowsList.map(workflow => `<div class="saved-workflow-card w-full glass rounded-lg p-3 hover:bg-white/10 transition-all"><div class="flex items-center justify-between"><button class="flex-1 text-left" onclick="loadWorkflow(${workflow.id})" aria-label="Load ${workflow.name} workflow"><div class="text-white font-medium">${workflow.name}</div><div class="text-white/50 text-xs">${workflow.steps.length} steps</div></button><div class="flex gap-2 ml-3"><button class="action-btn p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/40 text-blue-300 transition-all" onclick="editWorkflow(${workflow.id})" aria-label="Edit workflow" title="Edit"><i class="fas fa-edit text-sm"></i></button><button class="action-btn p-2 rounded-lg bg-green-500/20 hover:bg-green-500/40 text-green-300 transition-all" onclick="duplicateWorkflow(${workflow.id})" aria-label="Duplicate workflow" title="Duplicate"><i class="fas fa-copy text-sm"></i></button><button class="action-btn p-2 rounded-lg bg-red-500/20 hover:bg-red-500/40 text-red-300 transition-all" onclick="deleteWorkflow(${workflow.id})" aria-label="Delete workflow" title="Delete"><i class="fas fa-trash text-sm"></i></button></div></div></div>`).join('');
        }

        function loadWorkflow(id) { const workflow = savedWorkflowsList.find(w => w.id === id); if (workflow) { currentWorkflow = [...workflow.steps]; renderWorkflow(); showStatus('success', `Loaded "${workflow.name}"`); } }
        function editWorkflow(id) { const workflow = savedWorkflowsList.find(w => w.id === id); if (workflow) { currentWorkflow = [...workflow.steps]; renderWorkflow(); document.getElementById('workflowName').value = workflow.name; document.getElementById('saveModal').classList.remove('hidden'); document.getElementById('saveModal').dataset.editId = id; showStatus('success', `Editing "${workflow.name}"`); } }
        function duplicateWorkflow(id) { const workflow = savedWorkflowsList.find(w => w.id === id); if (workflow) { const duplicatedWorkflow = { id: Date.now(), name: `${workflow.name} (Copy)`, steps: workflow.steps.map(step => ({ ...step, id: Date.now() + Math.random() })) }; savedWorkflowsList.push(duplicatedWorkflow); renderSavedWorkflows(); showStatus('success', `Duplicated "${workflow.name}"`); } }
        function deleteWorkflow(id) { const workflow = savedWorkflowsList.find(w => w.id === id); if (workflow) { if (confirm(`Delete workflow "${workflow.name}"? This cannot be undone.`)) { savedWorkflowsList = savedWorkflowsList.filter(w => w.id !== id); renderSavedWorkflows(); showStatus('success', `Deleted "${workflow.name}"`); } } }

        function parseWorkflowFromText(text) {
            const lower = text.toLowerCase(); const steps = [];
            if (lower.includes('form') || lower.includes('application') || lower.includes('submit')) steps.push(createStepFromType('form-input'));
            if (lower.includes('upload') || lower.includes('document') || lower.includes('attach') || lower.includes('file')) steps.push(createStepFromType('document-upload'));
            if (lower.includes('validat') || lower.includes('check data') || lower.includes('verify data')) steps.push(createStepFromType('validation'));
            if (lower.includes('complian') || lower.includes('regulation') || lower.includes('fedramp') || lower.includes('fisma') || lower.includes('cjis')) steps.push(createStepFromType('compliance-check'));
            if (lower.includes('background') || lower.includes('fbi') || lower.includes('criminal') || lower.includes('security clearance')) steps.push(createStepFromType('background-check'));
            if (lower.includes('assign to') || lower.includes('assign user') || lower.includes('assign team') || lower.includes('assign department')) steps.push(createStepFromType('assignment'));
            if (lower.includes('single approval') || lower.includes('one approval') || (lower.includes('approval') && !lower.includes('multi') && !lower.includes('parallel'))) steps.push(createStepFromType('single-approval'));
            if (lower.includes('multi') && lower.includes('approval') || lower.includes('sequential') || lower.includes('chain of approval')) steps.push(createStepFromType('multi-approval'));
            if (lower.includes('parallel approval') || lower.includes('simultaneous approval') || lower.includes('concurrent approval')) steps.push(createStepFromType('parallel-approval'));
            if (lower.includes('conditional approval') || lower.includes('approval if') || lower.includes('approval based on') || lower.match(/approval.*\$\d+/) || lower.match(/if.*\$\d+.*approval/)) steps.push(createStepFromType('conditional-approval'));
            if (lower.includes('email') || lower.includes('send notification') || lower.includes('notify via email')) steps.push(createStepFromType('email'));
            if (lower.includes('sms') || lower.includes('text message') || lower.includes('text alert') || lower.includes('mobile message')) steps.push(createStepFromType('sms'));
            if (lower.includes('escalat') || lower.includes('overdue') || lower.includes('no response') || lower.match(/after \d+ (hour|day|week)/i)) steps.push(createStepFromType('escalation'));
            if (lower.includes('save') || lower.includes('store') || lower.includes('database') || lower.includes('persist')) steps.push(createStepFromType('database-write'));
            if (lower.includes('report') || lower.includes('pdf') || lower.includes('generate document')) steps.push(createStepFromType('generate-report'));
            if (lower.includes('audit') || lower.includes('trail') || lower.includes('log') || lower.includes('track changes')) steps.push(createStepFromType('audit-log'));
            if (!steps.find(s => s.typeId === 'close-ticket' || s.typeId === 'completion')) steps.push(createStepFromType('completion'));
            if (steps.length === 0) { steps.push(createStepFromType('form-input')); steps.push(createStepFromType('validation')); steps.push(createStepFromType('single-approval')); steps.push(createStepFromType('email')); steps.push(createStepFromType('completion')); }
            return steps;
        }

        function createStepFromType(typeId) { const stepType = stepTypes.find(s => s.id === typeId); return { id: Date.now() + Math.random(), typeId: typeId, name: stepType.name, icon: stepType.icon, color: stepType.color }; }

        // Enhanced 2024-10-30: Intelligent Workflow Orchestration Functions
        // MOCK DATA - Replace in production
        // TODO: Connect to workflow orchestration API endpoint /api/workflow-orchestration
        // TODO: Connect to department routing API endpoint /api/departments
        // TODO: Connect to SLA monitoring API endpoint /api/sla-monitoring
        // TODO: Connect to workflow analytics API endpoint /api/workflow-analytics

        // Department mapping for workflow steps
        const DEPARTMENT_MAP = {
            'form-input': 'Constituent Services',
            'document-upload': 'Document Management',
            'validation': 'Data Quality',
            'compliance-check': 'Compliance Office',
            'background-check': 'FBI / Security',
            'assignment': 'Routing Engine',
            'single-approval': 'Department Manager',
            'multi-approval': 'Multi-Department Review',
            'parallel-approval': 'Cross-Department Review',
            'conditional-approval': 'Smart Routing',
            'email': 'Notification Service',
            'sms': 'SMS Gateway',
            'escalation': 'Escalation Management',
            'database-write': 'Database Services',
            'generate-report': 'Reporting Engine',
            'audit-log': 'Audit Services',
            'completion': 'Workflow Completion'
        };

        function updateDepartmentRouting() {
            const container = document.getElementById('departmentRouting');
            if (!container || currentWorkflow.length === 0) return;

            const routingHTML = currentWorkflow.map((step, index) => {
                const department = DEPARTMENT_MAP[step.typeId] || 'General Services';
                const departmentColor = index % 3 === 0 ? 'blue' : index % 3 === 1 ? 'purple' : 'green';

                return `
                    <div class="flex items-center justify-between bg-white/5 rounded-lg p-2">
                        <div class="flex items-center gap-2 flex-1">
                            <span class="text-white/70 text-xs">Step ${index + 1}:</span>
                            <span class="text-white text-sm font-medium truncate">${step.name}</span>
                        </div>
                        <span class="bg-${departmentColor}-500/20 text-${departmentColor}-400 px-2 py-1 rounded text-xs whitespace-nowrap">
                            ${department}
                        </span>
                    </div>
                `;
            }).join('');

            container.innerHTML = routingHTML || '<div class="text-white/60 text-sm">Add workflow steps to configure department routing</div>';
        }

        function calculateWorkflowMetrics() {
            if (currentWorkflow.length === 0) return null;

            // MOCK DATA - In production, calculate from historical data
            const baseTimePerStep = 0.5; // days
            const predictedTime = currentWorkflow.length * baseTimePerStep;
            const confidence = Math.min(95, 75 + (currentWorkflow.length * 2));

            return {
                predictedCompletion: predictedTime.toFixed(1) + ' days',
                confidence: confidence + '%',
                slaCompliance: '94.7%',
                atRiskCount: Math.floor(Math.random() * 5),
                avgCompletionTime: (predictedTime * 1.1).toFixed(1) + ' days',
                bottleneckStep: currentWorkflow.length > 3 ? 3 : null,
                healthScore: Math.min(95, 70 + (currentWorkflow.length * 3)),
                optimizationPotential: currentWorkflow.length > 4 ? 'High' : 'Medium'
            };
        }

        function renderWorkflowOrchestration() {
            updateDepartmentRouting();
            const metrics = calculateWorkflowMetrics();

            if (metrics) {
                // Update SLA metrics in UI if elements exist
                console.log('Workflow Orchestration Metrics:', metrics);
                // TODO: Update DOM elements with real-time metrics
            }
        }

        // Enhanced renderWorkflow to include orchestration updates
        const originalRenderWorkflow = renderWorkflow;
        renderWorkflow = function() {
            originalRenderWorkflow();
            renderWorkflowOrchestration();
        };

        // Enhanced addStepToWorkflow to include orchestration
        const originalAddStepToWorkflow = addStepToWorkflow;
        addStepToWorkflow = function(stepId) {
            originalAddStepToWorkflow(stepId);
            renderWorkflowOrchestration();
        };

        // Enhanced removeStep to update orchestration
        const originalRemoveStep = removeStep;
        removeStep = function(stepId) {
            originalRemoveStep(stepId);
            renderWorkflowOrchestration();
        };

        // Initialize workflow builder when workflows tab is shown
        let workflowBuilderInitialized = false;

        function initializeWorkflowBuilder() {
            if (workflowBuilderInitialized) return;
            workflowBuilderInitialized = true;

            console.log('Initializing workflow builder...');

            // Small delay to ensure DOM is ready
            setTimeout(() => {
                initializeStepLibrary();
            }, 100);
        }

        // Override switchTab to initialize workflow builder when needed
        const originalSwitchTab = switchTab;
        switchTab = function(tabName) {
            originalSwitchTab(tabName);
            if (tabName === 'workflows') {
                console.log('Workflows tab clicked, initializing...');
                initializeWorkflowBuilder();
            }
        };

        // Also initialize if workflows tab is already visible on page load
        document.addEventListener('DOMContentLoaded', function() {
            const workflowsContent = document.getElementById('workflows-content');
            if (workflowsContent && workflowsContent.style.display !== 'none') {
                initializeWorkflowBuilder();
            }
        });

        // ===== PREDICTIVE ANALYTICS DASHBOARD =====
        // Added 2024-12-09: Predictive Analytics Dashboard
        // MOCK DATA - Replace in production
        // TODO: Connect to AI/ML API endpoints

        let predictiveHistoricalData = [];
        let predictiveForecastData = [];

        function initializePredictiveAnalytics() {
            // Generate 6 months of historical data + 30 days forecast
            predictiveHistoricalData = [];
            predictiveForecastData = [];

            // Generate historical data (180 days)
            for (let i = 180; i >= 0; i--) {
                const baseValue = 250;
                const seasonalEffect = Math.sin(i / 30) * 50;
                const randomVariation = (Math.random() - 0.5) * 40;
                const value = Math.max(150, Math.floor(baseValue + seasonalEffect + randomVariation));

                predictiveHistoricalData.push({
                    date: new Date(Date.now() - i * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    cases: value
                });
            }

            // Generate forecast data (30 days)
            for (let i = 1; i <= 30; i++) {
                const baseValue = 270;
                const seasonalEffect = Math.sin(i / 30) * 55;
                const trendEffect = i * 2;
                const value = Math.floor(baseValue + seasonalEffect + trendEffect);

                predictiveForecastData.push({
                    date: new Date(Date.now() + i * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    cases: value,
                    confidence: Math.max(70, 90 - i)
                });
            }

            // Initialize all components
            renderPredictiveForecastChart();
            renderPredictiveResourceRecommendations();
            renderPredictiveAnomalyAlerts();
            initializePredictiveScenarioPlanning();
        }

        // Render forecast chart
        function renderPredictiveForecastChart() {
            const chart = document.getElementById('forecastChart');
            if (!chart) return;

            const lastDays = predictiveHistoricalData.slice(-15);
            const allData = [...lastDays, ...predictiveForecastData.slice(0, 15)];
            const maxValue = Math.max(...allData.map(d => d.cases));

            chart.innerHTML = allData.map((day, index) => {
                const height = (day.cases / maxValue) * 100;
                const isHistorical = index < 15;
                const isAnomaly = day.cases > 320 || day.cases < 200;

                let gradient = isHistorical
                    ? 'from-blue-400 to-cyan-500'
                    : 'from-purple-400 to-pink-500';

                if (isAnomaly) gradient = 'from-yellow-400 to-orange-500';

                return `
                    <div
                        class="forecast-bar flex-1 bg-gradient-to-t ${gradient} rounded-t cursor-pointer hover:opacity-80 transition-all"
                        style="height: ${height}%; animation-delay: ${index * 50}ms"
                        data-cases="${day.cases}"
                        data-date="${day.date}"
                        data-confidence="${day.confidence || 100}"
                        onmouseenter="showPredictiveTooltip(event, this)"
                        onmouseleave="hidePredictiveTooltip()">
                    </div>
                `;
            }).join('');
        }

        // Tooltip functions for predictive analytics
        function showPredictiveTooltip(event, element) {
            const tooltip = document.getElementById('predictiveTooltip');
            if (!tooltip) return;

            const cases = element.dataset.cases;
            const date = element.dataset.date;
            const confidence = element.dataset.confidence;

            tooltip.innerHTML = `
                <strong>${new Date(date).toLocaleDateString()}</strong><br>
                Cases: ${cases}<br>
                ${confidence < 100 ? `Confidence: ${confidence}%` : 'Historical Data'}
            `;

            tooltip.style.left = event.pageX + 10 + 'px';
            tooltip.style.top = event.pageY - 50 + 'px';
            tooltip.classList.add('show');
        }

        function hidePredictiveTooltip() {
            const tooltip = document.getElementById('predictiveTooltip');
            if (tooltip) tooltip.classList.remove('show');
        }

        // Resource recommendations
        const predictiveRecommendations = [
            {
                department: 'Permit Processing',
                current: 12,
                recommended: 15,
                impact: '+18% throughput',
                priority: 'high'
            },
            {
                department: 'Compliance Review',
                current: 8,
                recommended: 10,
                impact: '+12% efficiency',
                priority: 'medium'
            },
            {
                department: 'Public Services',
                current: 20,
                recommended: 18,
                impact: '-5% cost',
                priority: 'low'
            }
        ];

        function renderPredictiveResourceRecommendations() {
            const container = document.getElementById('resourceRecommendations');
            if (!container) return;

            container.innerHTML = predictiveRecommendations.map(rec => {
                const priorityColors = {
                    high: 'border-red-500/50 bg-red-500/10',
                    medium: 'border-yellow-500/50 bg-yellow-500/10',
                    low: 'border-green-500/50 bg-green-500/10'
                };

                const change = rec.recommended - rec.current;
                const changeText = change > 0 ? `+${change}` : change;
                const changeColor = change > 0 ? 'text-green-400' : 'text-red-400';

                return `
                    <div class="p-4 border rounded-lg ${priorityColors[rec.priority]}">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-white font-medium">${rec.department}</span>
                            <span class="text-xs px-2 py-1 rounded-full bg-white/10 text-white/70">${rec.priority.toUpperCase()}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div>
                                <span class="text-white/70">Current:</span>
                                <span class="text-white ml-2">${rec.current} staff</span>
                            </div>
                            <div>
                                <i class="fas fa-arrow-right text-white/50 mx-2"></i>
                            </div>
                            <div>
                                <span class="text-white/70">Recommended:</span>
                                <span class="text-white ml-2">${rec.recommended} staff</span>
                            </div>
                        </div>
                        <div class="mt-2 text-xs ${changeColor}">
                            <i class="fas fa-chart-line mr-1"></i>${rec.impact}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Anomaly alerts
        const predictiveAnomalies = [
            {
                type: 'Workload Spike',
                description: 'Permit applications up 45% week-over-week',
                severity: 'critical',
                time: '2 hours ago',
                department: 'Building Permits'
            },
            {
                type: 'Processing Delay',
                description: 'Average processing time increased by 28%',
                severity: 'warning',
                time: '5 hours ago',
                department: 'Tax Services'
            },
            {
                type: 'Resource Underutilization',
                description: 'Staff capacity at 42% in evening shift',
                severity: 'info',
                time: '1 day ago',
                department: 'Public Works'
            }
        ];

        function renderPredictiveAnomalyAlerts() {
            const container = document.getElementById('anomalyAlerts');
            if (!container) return;

            container.innerHTML = predictiveAnomalies.map(alert => {
                const severityConfig = {
                    critical: { color: 'red', icon: 'fa-exclamation-circle', pulse: true },
                    warning: { color: 'yellow', icon: 'fa-exclamation-triangle', pulse: false },
                    info: { color: 'blue', icon: 'fa-info-circle', pulse: false }
                };

                const config = severityConfig[alert.severity];

                return `
                    <div class="p-4 border border-${config.color}-500/30 bg-${config.color}-500/10 rounded-lg">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-full bg-${config.color}-500/20 flex items-center justify-center flex-shrink-0 ${config.pulse ? 'anomaly-pulse' : ''}">
                                <i class="fas ${config.icon} text-${config.color}-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <span class="text-white font-medium text-sm">${alert.type}</span>
                                    <span class="text-xs text-white/50">${alert.time}</span>
                                </div>
                                <p class="text-sm text-white/70 mb-2">${alert.description}</p>
                                <div class="flex items-center gap-2 text-xs text-white/50">
                                    <i class="fas fa-building"></i>
                                    <span>${alert.department}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Scenario planning
        function initializePredictiveScenarioPlanning() {
            const staffingSlider = document.getElementById('staffingSlider');
            const volumeSlider = document.getElementById('volumeSlider');
            const efficiencySlider = document.getElementById('efficiencySlider');
            const staffingValue = document.getElementById('staffingValue');
            const volumeValue = document.getElementById('volumeValue');
            const efficiencyValue = document.getElementById('efficiencyValue');
            const runScenarioBtn = document.getElementById('runScenarioBtn');
            const resetScenariosBtn = document.getElementById('resetScenariosBtn');
            const exportForecastBtn = document.getElementById('exportForecastBtn');
            const applyRecommendationsBtn = document.getElementById('applyRecommendationsBtn');

            if (!staffingSlider || !volumeSlider || !efficiencySlider) return;

            // Update slider values
            staffingSlider.addEventListener('input', (e) => {
                if (staffingValue) staffingValue.textContent = e.target.value + '%';
            });

            volumeSlider.addEventListener('input', (e) => {
                if (volumeValue) volumeValue.textContent = e.target.value + '%';
            });

            efficiencySlider.addEventListener('input', (e) => {
                if (efficiencyValue) efficiencyValue.textContent = e.target.value + '%';
            });

            // Run scenario analysis
            if (runScenarioBtn) {
                runScenarioBtn.addEventListener('click', () => {
                    const staffingLevel = parseInt(staffingSlider.value);
                    const volumeLevel = parseInt(volumeSlider.value);
                    const efficiencyLevel = parseInt(efficiencySlider.value);

                    // Calculate predicted outcomes
                    const baseProcessingTime = 2.4;
                    const baseUtilization = 78;
                    const baseBacklog = 45;

                    const processingTime = (baseProcessingTime * (100 / efficiencyLevel) * (volumeLevel / 100) * (100 / staffingLevel)).toFixed(1);
                    const utilization = Math.min(100, Math.floor(baseUtilization * (volumeLevel / 100) * (100 / staffingLevel)));
                    const backlog = Math.max(0, Math.floor(baseBacklog * (volumeLevel / 100) * (100 / staffingLevel) * (100 / efficiencyLevel)));
                    const cost = Math.floor((staffingLevel - 100) * 1000);

                    const processingChange = Math.floor(((processingTime - baseProcessingTime) / baseProcessingTime) * 100);
                    const utilizationChange = utilization - baseUtilization;
                    const backlogChange = backlog - baseBacklog;

                    const scenarioResults = document.getElementById('scenarioResults');
                    if (scenarioResults) {
                        scenarioResults.innerHTML = `
                            <div class="flex items-center justify-between p-3 bg-blue-500/10 rounded-lg">
                                <div>
                                    <div class="text-white/70 text-sm">Average Processing Time</div>
                                    <div class="text-2xl font-bold text-white mt-1">${processingTime} days</div>
                                </div>
                                <div class="${processingChange < 0 ? 'text-green-400' : 'text-red-400'}">
                                    <i class="fas fa-arrow-${processingChange < 0 ? 'down' : 'up'}"></i> ${Math.abs(processingChange)}%
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-purple-500/10 rounded-lg">
                                <div>
                                    <div class="text-white/70 text-sm">Capacity Utilization</div>
                                    <div class="text-2xl font-bold text-white mt-1">${utilization}%</div>
                                </div>
                                <div class="${utilizationChange === 0 ? 'text-white/50' : utilizationChange > 0 ? 'text-yellow-400' : 'text-green-400'}">
                                    <i class="fas fa-${utilizationChange === 0 ? 'minus' : utilizationChange > 0 ? 'arrow-up' : 'arrow-down'}"></i> ${Math.abs(utilizationChange)}%
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-green-500/10 rounded-lg">
                                <div>
                                    <div class="text-white/70 text-sm">Backlog Reduction</div>
                                    <div class="text-2xl font-bold text-white mt-1">${backlog}%</div>
                                </div>
                                <div class="${backlogChange > 0 ? 'text-red-400' : 'text-green-400'}">
                                    <i class="fas fa-arrow-${backlogChange > 0 ? 'up' : 'down'}"></i> ${Math.abs(backlogChange)}%
                                </div>
                            </div>

                            <div class="flex items-center justify-between p-3 bg-red-500/10 rounded-lg">
                                <div>
                                    <div class="text-white/70 text-sm">Resource Cost Impact</div>
                                    <div class="text-2xl font-bold text-white mt-1">${cost >= 0 ? '+' : ''}$${Math.abs(cost).toLocaleString()}</div>
                                </div>
                                <div class="${cost === 0 ? 'text-white/50' : cost > 0 ? 'text-red-400' : 'text-green-400'}">
                                    <i class="fas fa-${cost === 0 ? 'minus' : cost > 0 ? 'arrow-up' : 'arrow-down'}"></i> ${staffingLevel - 100}%
                                </div>
                            </div>
                        `;
                    }
                });

                // Initialize scenario results with default values
                runScenarioBtn.click();
            }

            // Reset scenarios
            if (resetScenariosBtn) {
                resetScenariosBtn.addEventListener('click', () => {
                    staffingSlider.value = 100;
                    volumeSlider.value = 100;
                    efficiencySlider.value = 100;

                    if (staffingValue) staffingValue.textContent = '100%';
                    if (volumeValue) volumeValue.textContent = '100%';
                    if (efficiencyValue) efficiencyValue.textContent = '100%';

                    if (runScenarioBtn) runScenarioBtn.click();
                });
            }

            // Export functionality
            if (exportForecastBtn) {
                exportForecastBtn.addEventListener('click', () => {
                    const data = {
                        historical: predictiveHistoricalData,
                        forecast: predictiveForecastData,
                        exportedAt: new Date().toISOString(),
                        mlConfidence: 87
                    };

                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `forecast-data-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);

                    alert('Forecast data exported successfully!');
                });
            }

            // Apply recommendations
            if (applyRecommendationsBtn) {
                applyRecommendationsBtn.addEventListener('click', () => {
                    alert('Resource recommendations applied! Staff assignments will be updated in the next scheduling cycle.');
                });
            }
        }
        // ===== END PREDICTIVE ANALYTICS DASHBOARD =====

        // ===== BLOCKCHAIN AUDIT TRAIL =====
        // Added 2024-12-09: Blockchain Audit Trail
        // MOCK DATA - Replace in production
        // TODO: Connect to blockchain API endpoint

        let blockchain = [];
        let blockIdCounter = 1;

        // Initialize Blockchain Audit Trail
        function initializeBlockchain() {
            const container = document.getElementById('blockchainAuditTrail');
            if (!container) return;

            container.innerHTML = getBlockchainHTML();
            addBlockchainModals();
            initializeBlockchainData();
        }

        // Get Blockchain HTML
        function getBlockchainHTML() {
            return `
                <div class="glass rounded-xl p-6 mb-6">
                    <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                        <h2 class="text-2xl font-bold flex items-center gap-2">
                            <i class="fas fa-cube text-blue-400"></i>
                            Blockchain Audit Trail
                        </h2>
                        <div class="flex items-center gap-3 flex-wrap">
                            <div class="px-4 py-2 bg-green-500/20 border border-green-500/40 rounded-lg">
                                <span class="text-green-400 text-sm">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span id="blockCount">0</span> Blocks
                                </span>
                            </div>
                            <button id="exportAuditBtn" class="px-4 py-2 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-download mr-2"></i>Export
                            </button>
                            <button id="shareAuditBtn" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-share-alt mr-2"></i>Share
                            </button>
                            <button id="createBlockBtn" class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg font-medium hover:shadow-lg transition-all neon-blue">
                                <i class="fas fa-plus mr-2"></i>Create Block
                            </button>
                        </div>
                    </div>
                    <div class="overflow-x-auto scrollbar-thin pb-4">
                        <div id="blocksList" class="flex gap-10 min-w-max py-4"></div>
                    </div>
                </div>
                <div class="glass rounded-xl p-6">
                    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
                        <i class="fas fa-file-contract text-blue-400"></i>
                        Smart Contract Status
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="smartContractsGrid"></div>
                </div>
            `;
        }

        // Add Blockchain Modals
        function addBlockchainModals() {
            if (document.getElementById('blockModal')) return;
            document.body.insertAdjacentHTML('beforeend', `
                <div id="blockModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center">
                    <div class="glass rounded-xl p-8 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto scrollbar-thin">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold">Block Details</h2>
                            <button onclick="closeBlockModal()" class="text-white/70 hover:text-white transition-all"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                        <div id="blockModalContent"></div>
                    </div>
                </div>
                <div id="exportModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center">
                    <div class="glass rounded-xl p-8 max-w-xl w-full mx-4">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-download text-green-400"></i>Export Audit Trail</h2>
                            <button onclick="closeExportModal()" class="text-white/70 hover:text-white transition-all"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                        <div class="space-y-6">
                            <div><label class="text-white/70 text-sm mb-2 block">Export Format</label>
                                <select id="exportFormat" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-blue-400">
                                    <option value="json">JSON (Complete Data)</option>
                                    <option value="csv">CSV (Spreadsheet)</option>
                                    <option value="xml">XML (Structured)</option>
                                </select>
                            </div>
                            <button onclick="confirmExport()" class="w-full px-4 py-3 bg-gradient-to-r from-green-500 to-blue-600 rounded-lg font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-download mr-2"></i>Export Audit Trail
                            </button>
                        </div>
                    </div>
                </div>
                <div id="shareModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center">
                    <div class="glass rounded-xl p-8 max-w-xl w-full mx-4">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-2xl font-bold flex items-center gap-2"><i class="fas fa-share-alt text-purple-400"></i>Share Audit Trail</h2>
                            <button onclick="closeShareModal()" class="text-white/70 hover:text-white transition-all"><i class="fas fa-times text-2xl"></i></button>
                        </div>
                        <div class="space-y-6">
                            <div><label class="text-white/70 text-sm mb-2 block">Link Expiration</label>
                                <select id="shareExpiration" class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:border-blue-400">
                                    <option value="1h">1 Hour</option>
                                    <option value="24h">24 Hours</option>
                                    <option value="7d">7 Days</option>
                                    <option value="30d">30 Days</option>
                                </select>
                            </div>
                            <div id="generatedLinkContainer" class="hidden">
                                <div class="p-4 bg-black/30 rounded-lg border border-green-500/30">
                                    <div class="font-mono text-sm text-green-400 break-all mb-3" id="generatedLink"></div>
                                    <button onclick="copyShareLink()" class="w-full px-4 py-2 bg-blue-500/20 border border-blue-500/40 rounded-lg text-blue-300 hover:bg-blue-500/30 transition-all">
                                        <i class="fas fa-copy mr-2"></i>Copy Link
                                    </button>
                                </div>
                            </div>
                            <button onclick="generateShareLink()" class="w-full px-4 py-3 bg-gradient-to-r from-purple-500 to-pink-600 rounded-lg font-medium hover:shadow-lg transition-all">
                                <i class="fas fa-link mr-2"></i>Generate Secure Link
                            </button>
                        </div>
                    </div>
                </div>
            `);
        }

        // Initialize blockchain data
        async function initializeBlockchainData() {
            const genesisBlock = await createBlockchainBlock({type: 'genesis', department: 'System', action: 'Blockchain Initialized', data: {message: 'Genesis Block'}});
            blockchain.push(genesisBlock);

            const samples = [
                {type: 'document_submit', department: 'Building Permits', action: 'Permit Application Submitted', data: {permitId: 'BP-2024-1847'}},
                {type: 'approval', department: 'EPA', action: 'Environmental Impact Approved', data: {projectId: 'ENV-2024-432'}},
                {type: 'status_update', department: 'Tax Services', action: 'Tax Return Processed', data: {returnId: 'TAX-2024-8923'}}
            ];

            for (const data of samples) {
                blockchain.push(await createBlockchainBlock(data));
            }

            renderBlockchain();
            updateBlockCount();
            initializeSmartContracts();
            attachBlockchainEventListeners();
        }

        async function createBlockchainBlock(data) {
            const previousBlock = blockchain[blockchain.length - 1];
            const block = {
                index: blockIdCounter++,
                timestamp: new Date().toISOString(),
                type: data.type,
                department: data.department,
                action: data.action,
                data: data.data,
                previousHash: previousBlock ? previousBlock.hash : '0'.repeat(64),
                nonce: Math.floor(Math.random() * 1000000)
            };
            block.hash = await generateBlockHash(block);
            return block;
        }

        async function generateBlockHash(data) {
            const encoder = new TextEncoder();
            const dataBuffer = encoder.encode(JSON.stringify(data));
            const hashBuffer = await crypto.subtle.digest('SHA-256', dataBuffer);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function renderBlockchain() {
            const container = document.getElementById('blocksList');
            if (!container) return;
            container.innerHTML = blockchain.map((block, index) => {
                const color = {genesis: 'purple', document_submit: 'blue', approval: 'green', rejection: 'red', status_update: 'yellow'}[block.type] || 'blue';
                return `
                    <div class="blockchain-block glass rounded-xl p-6 min-w-[280px] neon-${color} block-creating" onclick="showBlockchainDetails(${index})">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-cube text-${color}-400 text-2xl"></i>
                                <span class="font-bold text-lg">Block #${block.index}</span>
                            </div>
                            <span class="text-xs px-2 py-1 bg-${color}-500/20 rounded-full text-${color}-300">${block.type.toUpperCase()}</span>
                        </div>
                        <div class="space-y-3">
                            <div><div class="text-white/50 text-xs mb-1">Department</div><div class="text-white font-medium">${block.department}</div></div>
                            <div><div class="text-white/50 text-xs mb-1">Action</div><div class="text-white text-sm">${block.action}</div></div>
                            <div><div class="text-white/50 text-xs mb-1">Hash</div><div class="font-mono text-xs text-blue-300 truncate">${block.hash.substring(0, 16)}...</div></div>
                            <div><div class="text-white/50 text-xs mb-1">Timestamp</div><div class="text-white/70 text-xs">${new Date(block.timestamp).toLocaleString()}</div></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showBlockchainDetails(index) {
            const block = blockchain[index];
            document.getElementById('blockModalContent').innerHTML = `
                <div class="space-y-4">
                    <div class="p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                        <div class="text-white/70 text-sm mb-1">Block Index</div>
                        <div class="text-2xl font-bold text-white">#${block.index}</div>
                    </div>
                    <div><div class="text-white/70 text-sm mb-2">Department</div><div class="text-white font-medium">${block.department}</div></div>
                    <div><div class="text-white/70 text-sm mb-2">Action</div><div class="text-white">${block.action}</div></div>
                    <div><div class="text-white/70 text-sm mb-2">Transaction Data</div><div class="p-4 bg-black/30 rounded-lg font-mono text-sm text-green-400">${JSON.stringify(block.data, null, 2)}</div></div>
                    <div><div class="text-white/70 text-sm mb-2">Block Hash</div><div class="p-3 bg-black/30 rounded-lg font-mono text-xs text-blue-300 break-all">${block.hash}</div></div>
                    <div><div class="text-white/70 text-sm mb-2">Previous Hash</div><div class="p-3 bg-black/30 rounded-lg font-mono text-xs text-purple-300 break-all">${block.previousHash}</div></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><div class="text-white/70 text-sm mb-1">Timestamp</div><div class="text-white">${new Date(block.timestamp).toLocaleString()}</div></div>
                        <div><div class="text-white/70 text-sm mb-1">Nonce</div><div class="text-white font-mono">${block.nonce}</div></div>
                    </div>
                </div>
            `;
            document.getElementById('blockModal').classList.remove('hidden');
            document.getElementById('blockModal').classList.add('flex');
        }

        function closeBlockModal() { document.getElementById('blockModal')?.classList.add('hidden'); document.getElementById('blockModal')?.classList.remove('flex'); }
        function closeExportModal() { document.getElementById('exportModal')?.classList.add('hidden'); document.getElementById('exportModal')?.classList.remove('flex'); }
        function closeShareModal() { document.getElementById('shareModal')?.classList.add('hidden'); document.getElementById('shareModal')?.classList.remove('flex'); }

        function confirmExport() {
            const format = document.getElementById('exportFormat').value;
            const exportData = {exportDate: new Date().toISOString(), totalBlocks: blockchain.length, blocks: blockchain};
            const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `blockchain-audit-${new Date().toISOString().split('T')[0]}.${format}`;
            a.click();
            URL.revokeObjectURL(url);
            closeExportModal();
            alert('Audit trail exported successfully!');
        }

        function generateShareLink() {
            const token = Array.from({length: 32}, () => Math.floor(Math.random() * 16).toString(16)).join('');
            document.getElementById('generatedLink').textContent = `https://govli.audit/share/${token}`;
            document.getElementById('generatedLinkContainer').classList.remove('hidden');
        }

        function copyShareLink() {
            navigator.clipboard.writeText(document.getElementById('generatedLink').textContent);
            alert('Link copied to clipboard!');
        }

        function updateBlockCount() {
            const el = document.getElementById('blockCount');
            if (el) el.textContent = blockchain.length;
        }

        function initializeSmartContracts() {
            const grid = document.getElementById('smartContractsGrid');
            if (!grid) return;
            const contracts = [
                {name: 'Permit Auto-Approval', status: 'active', executions: 847, icon: 'fa-file-contract', color: 'green'},
                {name: 'Tax Filing Validator', status: 'active', executions: 1243, icon: 'fa-calculator', color: 'blue'},
                {name: 'Compliance Checker', status: 'pending', executions: 432, icon: 'fa-shield-alt', color: 'yellow'}
            ];
            grid.innerHTML = contracts.map(c => `
                <div class="glass-dark rounded-xl p-6 contract-status">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-${c.color}-500/20 rounded-lg flex items-center justify-center"><i class="fas ${c.icon} text-${c.color}-400 text-xl"></i></div>
                        <span class="px-3 py-1 bg-${c.color}-500/20 border border-${c.color}-500/40 rounded-full text-${c.color}-400 text-xs">${c.status.toUpperCase()}</span>
                    </div>
                    <h3 class="font-bold text-white mb-2">${c.name}</h3>
                    <div class="text-sm text-white/70">Executions: <span class="text-white font-medium">${c.executions.toLocaleString()}</span></div>
                </div>
            `).join('');
        }

        function attachBlockchainEventListeners() {
            document.getElementById('createBlockBtn')?.addEventListener('click', async () => {
                blockchain.push(await createBlockchainBlock({type: 'document_submit', department: 'Building Permits', action: 'Document Submitted', data: {id: `DOC-${Date.now()}`}}));
                renderBlockchain();
                updateBlockCount();
                alert('New block created!');
            });
            document.getElementById('exportAuditBtn')?.addEventListener('click', () => {
                document.getElementById('exportModal')?.classList.remove('hidden');
                document.getElementById('exportModal')?.classList.add('flex');
            });
            document.getElementById('shareAuditBtn')?.addEventListener('click', () => {
                document.getElementById('shareModal')?.classList.remove('hidden');
                document.getElementById('shareModal')?.classList.add('flex');
            });
        }
        // ===== END BLOCKCHAIN AUDIT TRAIL =====

        // ===== QUANTUM-READY SECURITY MODULE =====
        // Added 2025-10-07: Quantum-Ready Security Module
        // MOCK DATA - Replace in production
        // TODO: Connect to quantum security API endpoint /api/quantum-security
        // TODO: Implement real encryption/decryption with post-quantum libraries (liboqs, Kyber)
        // SECURITY TODO: Validate all user inputs
        // TODO: Add authentication for admin access only
        // TODO: Integrate with HSM for key management

        function initializeQuantumSecurity() {
            const container = document.getElementById('quantumSecurityModule');
            if (!container) return;

            container.innerHTML = getQuantumSecurityHTML();
            createQuantumParticles();
            calculateQuantumSecurityScore();
            updateQDayCountdown();

            // Update countdown every minute
            setInterval(updateQDayCountdown, 60000);
        }

        function getQuantumSecurityHTML() {
            return `
                <!-- Quantum particles background -->
                <div id="quantumParticles" class="fixed inset-0 pointer-events-none overflow-hidden z-0"></div>

                <div class="relative z-10">
                    <!-- Header -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h2 class="text-3xl font-bold text-white mb-2">ðŸ” Quantum-Ready Security Module</h2>
                                <p class="text-white/70">Post-Quantum Cryptography Protection</p>
                            </div>
                            <div class="text-right">
                                <div class="text-xl font-bold text-purple-400">Security Score</div>
                                <div id="quantumSecurityScore" class="text-4xl font-bold text-white">0</div>
                                <div class="text-sm text-white/60">out of 100</div>
                            </div>
                        </div>

                        <!-- Status indicators -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="text-center p-3 rounded-lg bg-white/5">
                                <div class="text-white/70 text-sm mb-1">Encryption Status</div>
                                <div class="text-green-400 font-bold">âœ“ Active</div>
                            </div>
                            <div class="text-center p-3 rounded-lg bg-white/5">
                                <div class="text-white/70 text-sm mb-1">Quantum Readiness</div>
                                <div class="text-yellow-400 font-bold">âš  Transitioning</div>
                            </div>
                            <div class="text-center p-3 rounded-lg bg-white/5">
                                <div class="text-white/70 text-sm mb-1">Keys Managed</div>
                                <div class="text-white font-bold">1,247</div>
                            </div>
                            <div class="text-center p-3 rounded-lg bg-white/5">
                                <div class="text-white/70 text-sm mb-1">Time to Q-Day</div>
                                <div id="qDayCountdown" class="text-purple-400 font-bold">~8 years</div>
                            </div>
                        </div>
                    </div>

                    <!-- Encryption Dashboard -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Current Encryption -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">ðŸ“Š Current Encryption</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">RSA-2048</span>
                                        <span class="text-yellow-400">Classical</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-yellow-500 to-orange-500" style="width: 45%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Vulnerable to quantum attacks (~2030)</div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">AES-256</span>
                                        <span class="text-green-400">Quantum-Resistant</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-green-500 to-emerald-500" style="width: 85%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Secure with increased key size</div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">ECDSA P-256</span>
                                        <span class="text-red-400">At Risk</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-red-500 to-pink-500" style="width: 30%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Highly vulnerable to Shor's algorithm</div>
                                </div>
                            </div>
                        </div>

                        <!-- Post-Quantum Encryption -->
                        <div class="glass rounded-xl p-6">
                            <h3 class="text-xl font-bold text-white mb-4">ðŸ›¡ï¸ Post-Quantum Encryption</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">CRYSTALS-Kyber</span>
                                        <span class="quantum-cert-badge text-white text-xs px-2 py-1 rounded">NIST Approved</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-purple-500 to-indigo-500" style="width: 95%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Lattice-based key encapsulation</div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">CRYSTALS-Dilithium</span>
                                        <span class="quantum-cert-badge text-white text-xs px-2 py-1 rounded">NIST Approved</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-blue-500 to-cyan-500" style="width: 93%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Digital signatures for authentication</div>
                                </div>
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="text-white/80">SPHINCS+</span>
                                        <span class="quantum-cert-badge text-white text-xs px-2 py-1 rounded">NIST Approved</span>
                                    </div>
                                    <div class="quantum-strength-bar">
                                        <div class="quantum-strength-fill bg-gradient-to-r from-indigo-500 to-purple-500" style="width: 90%"></div>
                                    </div>
                                    <div class="text-xs text-white/60 mt-1">Hash-based stateless signatures</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Visual Comparison: Classical vs Quantum -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">âš”ï¸ Encryption Strength Comparison</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 quantum-vs-divider">
                            <!-- Classical -->
                            <div>
                                <h4 class="text-lg font-bold text-yellow-400 mb-4">Classical Encryption</h4>
                                <div class="space-y-3">
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="font-bold text-white mb-1">RSA-2048</div>
                                        <div class="text-sm text-white/70">Breaking time (classical): 1 billion years</div>
                                        <div class="text-sm text-red-400">Breaking time (quantum): ~8 hours</div>
                                    </div>
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="font-bold text-white mb-1">ECC P-256</div>
                                        <div class="text-sm text-white/70">Breaking time (classical): 10 trillion years</div>
                                        <div class="text-sm text-red-400">Breaking time (quantum): ~10 minutes</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quantum-Resistant -->
                            <div>
                                <h4 class="text-lg font-bold text-purple-400 mb-4">Post-Quantum Encryption</h4>
                                <div class="space-y-3">
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="font-bold text-white mb-1">CRYSTALS-Kyber</div>
                                        <div class="text-sm text-white/70">Breaking time (classical): âˆž (computationally infeasible)</div>
                                        <div class="text-sm text-green-400">Breaking time (quantum): >1 million years</div>
                                    </div>
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="font-bold text-white mb-1">CRYSTALS-Dilithium</div>
                                        <div class="text-sm text-white/70">Breaking time (classical): âˆž (computationally infeasible)</div>
                                        <div class="text-sm text-green-400">Breaking time (quantum): >10 million years</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quantum Threat Timeline -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">â±ï¸ Quantum Threat Timeline</h3>
                        <div class="relative">
                            <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-green-500 via-yellow-500 to-red-500"></div>
                            <div class="ml-8 space-y-6">
                                <div class="quantum-timeline-point">
                                    <div class="text-green-400 font-bold mb-1">2024 - Today</div>
                                    <div class="text-white/80">Classical encryption still secure</div>
                                    <div class="text-sm text-white/60">Current systems operational</div>
                                </div>
                                <div class="quantum-timeline-point">
                                    <div class="text-yellow-400 font-bold mb-1">2028 - Early Quantum</div>
                                    <div class="text-white/80">50-100 qubit quantum computers</div>
                                    <div class="text-sm text-white/60">Can break some classical encryption</div>
                                </div>
                                <div class="quantum-timeline-point">
                                    <div class="text-orange-400 font-bold mb-1">2030 - Q-Day Approaching</div>
                                    <div class="text-white/80">1000+ qubit quantum computers</div>
                                    <div class="text-sm text-white/60">RSA-2048 and ECC vulnerable</div>
                                </div>
                                <div class="quantum-timeline-point quantum-threat-indicator">
                                    <div class="text-red-400 font-bold mb-1">2032+ - Q-Day</div>
                                    <div class="text-white/80">Cryptographically relevant quantum computer</div>
                                    <div class="text-sm text-white/60">All classical encryption broken</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Key Management Interface -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸ”‘ Key Management & Rotation</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-white/90 mb-3">Active Keys</h4>
                                <div class="space-y-3">
                                    <div class="p-3 rounded-lg bg-white/5 border-l-4 border-green-500">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="font-bold text-white">Primary RSA Key</div>
                                                <div class="text-xs text-white/60">ID: RSA-2024-001</div>
                                            </div>
                                            <span class="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">Active</span>
                                        </div>
                                        <div class="text-sm text-white/70">Next rotation: 45 days</div>
                                        <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-green-500" style="width: 65%"></div>
                                        </div>
                                    </div>
                                    <div class="p-3 rounded-lg bg-white/5 border-l-4 border-purple-500">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="font-bold text-white">Kyber-1024 Key</div>
                                                <div class="text-xs text-white/60">ID: KYBER-2024-003</div>
                                            </div>
                                            <span class="text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded">Quantum-Safe</span>
                                        </div>
                                        <div class="text-sm text-white/70">Next rotation: 89 days</div>
                                        <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-purple-500" style="width: 35%"></div>
                                        </div>
                                    </div>
                                    <div class="p-3 rounded-lg bg-white/5 border-l-4 border-yellow-500">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <div class="font-bold text-white">Certificate Authority</div>
                                                <div class="text-xs text-white/60">ID: CA-2024-ROOT</div>
                                            </div>
                                            <span class="text-xs bg-yellow-500/20 text-yellow-400 px-2 py-1 rounded">Expiring Soon</span>
                                        </div>
                                        <div class="text-sm text-white/70">Expires: 12 days</div>
                                        <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                            <div class="h-full bg-yellow-500" style="width: 90%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-white/90 mb-3">Rotation Schedule</h4>
                                <div class="space-y-3">
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-white/80">Automatic Rotation</span>
                                            <div class="w-12 h-6 bg-purple-600 rounded-full relative">
                                                <div class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full translate-x-6 transition-transform"></div>
                                            </div>
                                        </div>
                                        <div class="text-sm text-white/60">Keys rotate every 90 days</div>
                                    </div>
                                    <div class="p-3 rounded-lg bg-white/5">
                                        <div class="font-bold text-white mb-2">Upcoming Rotations</div>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between text-white/70">
                                                <span>API Gateway Keys</span>
                                                <span class="text-green-400">3 days</span>
                                            </div>
                                            <div class="flex justify-between text-white/70">
                                                <span>Database Encryption</span>
                                                <span class="text-yellow-400">18 days</span>
                                            </div>
                                            <div class="flex justify-between text-white/70">
                                                <span>SSL/TLS Certificates</span>
                                                <span class="text-orange-400">45 days</span>
                                            </div>
                                        </div>
                                    </div>
                                    <button onclick="scheduleManualRotation()" class="w-full px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold transition-colors">
                                        Schedule Manual Rotation
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Migration Planner -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸš€ Migration Planner</h3>
                        <div class="mb-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-white/80">Migration Progress</span>
                                <span class="text-purple-400 font-bold">37% Complete</span>
                            </div>
                            <div class="h-4 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-purple-600 to-blue-600" style="width: 37%"></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                                <div class="text-2xl font-bold text-green-400 mb-1">23</div>
                                <div class="text-sm text-white/70">Systems Migrated</div>
                            </div>
                            <div class="p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                                <div class="text-2xl font-bold text-yellow-400 mb-1">15</div>
                                <div class="text-sm text-white/70">In Progress</div>
                            </div>
                            <div class="p-4 rounded-lg bg-purple-500/10 border border-purple-500/30">
                                <div class="text-2xl font-bold text-purple-400 mb-1">24</div>
                                <div class="text-sm text-white/70">Pending</div>
                            </div>
                        </div>
                        <div class="space-y-3">
                            <div class="p-4 rounded-lg bg-white/5">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="font-bold text-white">Phase 1: API Gateway</div>
                                    <span class="text-green-400">âœ“ Complete</span>
                                </div>
                                <div class="text-sm text-white/60">Migrated to hybrid RSA/Kyber encryption</div>
                            </div>
                            <div class="p-4 rounded-lg bg-white/5 border-l-4 border-yellow-500">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="font-bold text-white">Phase 2: Database Layer</div>
                                    <span class="text-yellow-400">â³ In Progress</span>
                                </div>
                                <div class="text-sm text-white/60">Implementing AES-256 with increased key size</div>
                                <div class="mt-2 h-2 bg-white/10 rounded-full overflow-hidden">
                                    <div class="h-full bg-yellow-500" style="width: 60%"></div>
                                </div>
                            </div>
                            <div class="p-4 rounded-lg bg-white/5">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="font-bold text-white">Phase 3: Authentication</div>
                                    <span class="text-white/50">â¸ Pending</span>
                                </div>
                                <div class="text-sm text-white/60">Replace ECDSA with Dilithium signatures</div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Score Calculator -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸŽ¯ Security Score Calculator</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-white/80 mb-2">Data Sensitivity Level</label>
                                <select id="quantumSensitivityLevel" class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:border-purple-500 focus:outline-none" onchange="calculateQuantumSecurityScore()">
                                    <option value="public">Public (Level 1)</option>
                                    <option value="internal">Internal (Level 2)</option>
                                    <option value="confidential" selected>Confidential (Level 3)</option>
                                    <option value="secret">Secret (Level 4)</option>
                                    <option value="topsecret">Top Secret (Level 5)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-white/80 mb-2">Encryption Type</label>
                                <select id="quantumEncryptionType" class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:border-purple-500 focus:outline-none" onchange="calculateQuantumSecurityScore()">
                                    <option value="none">No Encryption</option>
                                    <option value="rsa2048">RSA-2048 (Classical)</option>
                                    <option value="aes256">AES-256 (Symmetric)</option>
                                    <option value="hybrid" selected>Hybrid (RSA + Post-Quantum)</option>
                                    <option value="fullpq">Full Post-Quantum</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-6 p-6 rounded-lg bg-gradient-to-r from-purple-500/20 to-blue-500/20 border border-purple-500/30">
                            <div class="text-center">
                                <div class="text-white/70 mb-2">Calculated Security Score</div>
                                <div id="quantumCalculatedScore" class="text-5xl font-bold text-white mb-2">72</div>
                                <div id="quantumScoreRating" class="text-purple-400 font-bold">Good - Quantum-Aware</div>
                            </div>
                            <div id="quantumScoreRecommendation" class="mt-4 p-4 rounded-lg bg-white/10 text-white/80 text-sm">
                                Your current configuration provides good protection. Consider upgrading to full post-quantum encryption for top secret data.
                            </div>
                        </div>
                    </div>

                    <!-- Encryption Decision Tree -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸŒ³ Encryption Decision Tree</h3>
                        <div class="space-y-4">
                            <div class="quantum-decision-node p-4 rounded-lg bg-white/5 border border-white/20" onclick="toggleQuantumDecisionBranch('quantum-data-type')">
                                <div class="font-bold text-white mb-2">1. What type of data are you protecting?</div>
                                <div id="quantum-data-type" class="hidden mt-3 pl-4 border-l-2 border-purple-500 space-y-2">
                                    <div class="quantum-decision-node p-3 rounded-lg bg-purple-500/10" onclick="event.stopPropagation(); toggleQuantumDecisionBranch('quantum-data-at-rest')">
                                        <div class="text-white/90">ðŸ“ Data at Rest</div>
                                    </div>
                                    <div class="quantum-decision-node p-3 rounded-lg bg-blue-500/10" onclick="event.stopPropagation(); toggleQuantumDecisionBranch('quantum-data-in-transit')">
                                        <div class="text-white/90">ðŸ”„ Data in Transit</div>
                                    </div>
                                    <div class="quantum-decision-node p-3 rounded-lg bg-green-500/10" onclick="event.stopPropagation(); toggleQuantumDecisionBranch('quantum-data-in-use')">
                                        <div class="text-white/90">âš¡ Data in Use</div>
                                    </div>
                                </div>
                            </div>
                            <div id="quantum-data-at-rest" class="hidden quantum-decision-node p-4 rounded-lg bg-purple-500/10 border border-purple-500/30">
                                <div class="font-bold text-white mb-2">Data at Rest Protection</div>
                                <div class="text-white/80 text-sm mb-3">Recommended: AES-256-GCM or ChaCha20-Poly1305</div>
                                <div class="p-3 rounded-lg bg-white/10">
                                    <div class="text-white/70 text-sm">âœ“ Use symmetric encryption for stored data</div>
                                    <div class="text-white/70 text-sm">âœ“ Implement at-rest encryption for databases</div>
                                    <div class="text-white/70 text-sm">âœ“ Consider hardware security modules (HSMs)</div>
                                </div>
                            </div>
                            <div id="quantum-data-in-transit" class="hidden quantum-decision-node p-4 rounded-lg bg-blue-500/10 border border-blue-500/30">
                                <div class="font-bold text-white mb-2">Data in Transit Protection</div>
                                <div class="text-white/80 text-sm mb-3">Recommended: TLS 1.3 with Post-Quantum KEM</div>
                                <div class="p-3 rounded-lg bg-white/10">
                                    <div class="text-white/70 text-sm">âœ“ Use hybrid key exchange (ECDHE + Kyber)</div>
                                    <div class="text-white/70 text-sm">âœ“ Enable perfect forward secrecy</div>
                                    <div class="text-white/70 text-sm">âœ“ Implement certificate pinning</div>
                                </div>
                            </div>
                            <div id="quantum-data-in-use" class="hidden quantum-decision-node p-4 rounded-lg bg-green-500/10 border border-green-500/30">
                                <div class="font-bold text-white mb-2">Data in Use Protection</div>
                                <div class="text-white/80 text-sm mb-3">Recommended: Homomorphic Encryption or TEE</div>
                                <div class="p-3 rounded-lg bg-white/10">
                                    <div class="text-white/70 text-sm">âœ“ Consider trusted execution environments</div>
                                    <div class="text-white/70 text-sm">âœ“ Explore fully homomorphic encryption</div>
                                    <div class="text-white/70 text-sm">âœ“ Implement secure enclaves (Intel SGX, AMD SEV)</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Encryption/Decryption Visualization -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸ”¬ Encryption Visualization</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-white/90 mb-3">Input Message</h4>
                                <textarea id="quantumPlaintext" class="w-full px-4 py-3 rounded-lg bg-white/10 text-white border border-white/20 focus:border-purple-500 focus:outline-none font-mono" rows="4" placeholder="Enter your message...">Confidential government data for Q-Day protection</textarea>
                                <div class="mt-3 flex gap-3">
                                    <button onclick="simulateQuantumEncryption()" class="flex-1 px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-bold transition-colors">
                                        ðŸ”’ Encrypt (Kyber)
                                    </button>
                                    <button onclick="simulateQuantumDecryption()" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition-colors">
                                        ðŸ”“ Decrypt
                                    </button>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-bold text-white/90 mb-3">Encrypted Output</h4>
                                <div id="quantumCiphertext" class="w-full px-4 py-3 rounded-lg bg-black/30 text-green-400 border border-green-500/30 font-mono text-sm h-32 overflow-auto quantum-encryption-demo">
                                    [Click encrypt to see ciphertext]
                                </div>
                                <div class="mt-3 p-3 rounded-lg bg-white/5">
                                    <div class="text-white/70 text-sm">
                                        <span class="font-bold">Algorithm:</span> <span id="quantumCurrentAlgorithm">CRYSTALS-Kyber-1024</span>
                                    </div>
                                    <div class="text-white/70 text-sm">
                                        <span class="font-bold">Key Size:</span> <span id="quantumKeySize">3168 bytes</span>
                                    </div>
                                    <div class="text-white/70 text-sm">
                                        <span class="font-bold">Security Level:</span> <span id="quantumSecurityLevel" class="text-purple-400">NIST Level 5</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Educational Content -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">ðŸ“š Understanding Quantum Threats</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="p-4 rounded-lg bg-white/5">
                                <div class="text-3xl mb-3">âš›ï¸</div>
                                <div class="font-bold text-white mb-2">What is Q-Day?</div>
                                <div class="text-white/70 text-sm">
                                    Q-Day is the point when quantum computers become powerful enough to break current encryption standards, threatening data security worldwide.
                                </div>
                            </div>
                            <div class="p-4 rounded-lg bg-white/5">
                                <div class="text-3xl mb-3">ðŸ§®</div>
                                <div class="font-bold text-white mb-2">Shor's Algorithm</div>
                                <div class="text-white/70 text-sm">
                                    Quantum algorithm that can factor large numbers exponentially faster, breaking RSA and ECC encryption that protects most of today's data.
                                </div>
                            </div>
                            <div class="p-4 rounded-lg bg-white/5">
                                <div class="text-3xl mb-3">ðŸ”</div>
                                <div class="font-bold text-white mb-2">Harvest Now, Decrypt Later</div>
                                <div class="text-white/70 text-sm">
                                    Adversaries collect encrypted data today to decrypt later with quantum computers, making immediate action critical.
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 p-4 rounded-lg bg-yellow-500/10 border border-yellow-500/30">
                            <div class="flex items-start gap-3">
                                <div class="text-2xl">âš ï¸</div>
                                <div>
                                    <div class="font-bold text-yellow-400 mb-1">Why Act Now?</div>
                                    <div class="text-white/80 text-sm">
                                        Data encrypted today with classical methods may only have 8-10 years of protection. Government agencies recommend transitioning to post-quantum cryptography immediately to protect sensitive data with long-term value.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Compliance & Certifications -->
                    <div class="glass rounded-xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-white mb-4">âœ… Compliance & Certifications</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="p-4 rounded-lg bg-gradient-to-br from-purple-500/20 to-blue-500/20 border border-purple-500/30 text-center">
                                <div class="text-2xl mb-2">ðŸ›ï¸</div>
                                <div class="font-bold text-white text-sm">NIST PQC</div>
                                <div class="text-xs text-white/60">Approved</div>
                            </div>
                            <div class="p-4 rounded-lg bg-gradient-to-br from-green-500/20 to-emerald-500/20 border border-green-500/30 text-center">
                                <div class="text-2xl mb-2">ðŸ”’</div>
                                <div class="font-bold text-white text-sm">FIPS 140-3</div>
                                <div class="text-xs text-white/60">Certified</div>
                            </div>
                            <div class="p-4 rounded-lg bg-gradient-to-br from-blue-500/20 to-cyan-500/20 border border-blue-500/30 text-center">
                                <div class="text-2xl mb-2">â˜ï¸</div>
                                <div class="font-bold text-white text-sm">FedRAMP</div>
                                <div class="text-xs text-white/60">High Impact</div>
                            </div>
                            <div class="p-4 rounded-lg bg-gradient-to-br from-indigo-500/20 to-purple-500/20 border border-indigo-500/30 text-center">
                                <div class="text-2xl mb-2">ðŸ›¡ï¸</div>
                                <div class="font-bold text-white text-sm">CISA PQC</div>
                                <div class="text-xs text-white/60">Compliant</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Create quantum particles animation
        function createQuantumParticles() {
            const container = document.getElementById('quantumParticles');
            if (!container) return;

            container.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'quantum-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animationDuration = (2 + Math.random() * 2) + 's';
                container.appendChild(particle);
            }
        }

        // Calculate quantum security score
        function calculateQuantumSecurityScore() {
            const sensitivity = document.getElementById('quantumSensitivityLevel')?.value || 'confidential';
            const encryption = document.getElementById('quantumEncryptionType')?.value || 'hybrid';

            const sensitivityScores = {
                'public': 20,
                'internal': 40,
                'confidential': 60,
                'secret': 80,
                'topsecret': 100
            };

            const encryptionScores = {
                'none': 0,
                'rsa2048': 40,
                'aes256': 70,
                'hybrid': 85,
                'fullpq': 100
            };

            const sensitivityScore = sensitivityScores[sensitivity] || 0;
            const encryptionScore = encryptionScores[encryption] || 0;

            // Calculate weighted score
            const finalScore = Math.round((encryptionScore * 0.7) + (sensitivityScore * 0.3));

            // Update UI
            const scoreElement = document.getElementById('quantumCalculatedScore');
            const headerScoreElement = document.getElementById('quantumSecurityScore');
            if (scoreElement) scoreElement.textContent = finalScore;
            if (headerScoreElement) headerScoreElement.textContent = finalScore;

            // Update rating
            let rating = '';
            let recommendation = '';

            if (finalScore >= 90) {
                rating = 'Excellent - Quantum-Ready';
                recommendation = 'Your configuration provides excellent quantum-resistant protection. Continue monitoring for NIST updates.';
            } else if (finalScore >= 75) {
                rating = 'Good - Quantum-Aware';
                recommendation = 'Your current configuration provides good protection. Consider upgrading to full post-quantum encryption for maximum security.';
            } else if (finalScore >= 50) {
                rating = 'Fair - Needs Improvement';
                recommendation = 'Your configuration has vulnerabilities. Upgrade to hybrid or post-quantum encryption immediately.';
            } else if (finalScore >= 30) {
                rating = 'Poor - At Risk';
                recommendation = 'Critical: Your data is at significant risk. Implement post-quantum encryption as soon as possible.';
            } else {
                rating = 'Critical - Immediate Action Required';
                recommendation = 'URGENT: Your data has no quantum protection. Implement encryption immediately to prevent future data breaches.';
            }

            const ratingElement = document.getElementById('quantumScoreRating');
            const recommendationElement = document.getElementById('quantumScoreRecommendation');
            if (ratingElement) ratingElement.textContent = rating;
            if (recommendationElement) recommendationElement.textContent = recommendation;
        }

        // Simulate quantum encryption
        function simulateQuantumEncryption() {
            const plaintext = document.getElementById('quantumPlaintext')?.value;
            if (!plaintext) {
                alert('Please enter a message to encrypt');
                return;
            }

            // Simulate encryption process
            const encrypted = btoa(plaintext)
                .split('')
                .map(c => String.fromCharCode(c.charCodeAt(0) + Math.floor(Math.random() * 10)))
                .join('')
                .match(/.{1,64}/g)
                .join('\n');

            const ciphertextElement = document.getElementById('quantumCiphertext');
            if (ciphertextElement) {
                ciphertextElement.textContent = encrypted;
                ciphertextElement.classList.add('quantum-encryption-flow');
                setTimeout(() => {
                    ciphertextElement.classList.remove('quantum-encryption-flow');
                }, 2000);
            }
        }

        // Simulate quantum decryption
        function simulateQuantumDecryption() {
            const plaintext = document.getElementById('quantumPlaintext')?.value;
            const ciphertextElement = document.getElementById('quantumCiphertext');
            if (ciphertextElement) {
                ciphertextElement.textContent = plaintext || '[No ciphertext to decrypt]';
            }
        }

        // Toggle decision tree branches
        function toggleQuantumDecisionBranch(id) {
            const element = document.getElementById(id);
            if (element) {
                element.classList.toggle('hidden');
            }
        }

        // Update Q-Day countdown
        function updateQDayCountdown() {
            const qDay = new Date('2032-01-01');
            const now = new Date();
            const years = Math.floor((qDay - now) / (1000 * 60 * 60 * 24 * 365));
            const countdownElement = document.getElementById('qDayCountdown');
            if (countdownElement) {
                countdownElement.textContent = `~${years} years`;
            }
        }

        // Schedule manual rotation
        function scheduleManualRotation() {
            alert('Manual key rotation scheduled. This would open a detailed rotation scheduling interface in production.');
        }
        // ===== END QUANTUM-READY SECURITY MODULE =====

        // ===== COLLABORATIVE WORKFLOW CANVAS =====
        let workflowCanvasState = {
            zoom: 1,
            panX: 0,
            panY: 0,
            mode: 'select',
            selectedNode: null,
            nodes: [],
            connections: [],
            isPanning: false,
            startPan: { x: 0, y: 0 }
        };

        // Switch between Simple and Advanced workflow modes
        function switchWorkflowMode(mode) {
            const simpleMode = document.getElementById('simpleWorkflowMode');
            const advancedMode = document.getElementById('advancedWorkflowMode');
            const simpleBtn = document.getElementById('simpleWorkflowBtn');
            const advancedBtn = document.getElementById('advancedWorkflowBtn');
            const description = document.getElementById('workflowModeDescription');

            if (mode === 'simple') {
                simpleMode.style.display = 'block';
                advancedMode.style.display = 'none';
                simpleBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white';
                advancedBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all text-white/70 hover:text-white';
                description.textContent = 'Use AI to describe your workflow';
            } else {
                simpleMode.style.display = 'none';
                advancedMode.style.display = 'block';
                simpleBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all text-white/70 hover:text-white';
                advancedBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white';
                description.textContent = 'Drag and drop to build complex workflows';

                // Initialize advanced canvas on first load
                if (advancedMode.innerHTML.trim() === '<!-- Canvas content will be inserted here -->') {
                    initializeAdvancedCanvas();
                }
            }
        }

        // Initialize the Advanced Workflow Canvas
        function initializeAdvancedCanvas() {
            const advancedMode = document.getElementById('advancedWorkflowMode');

            advancedMode.innerHTML = `
                <!-- Toolbar -->
                <div style="display: flex; gap: 8px; padding: 12px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; margin-bottom: 12px;">
                    <button class="workflow-toolbar-btn active" onclick="setCanvasMode('select')">
                        âœ‹ Select
                    </button>
                    <button class="workflow-toolbar-btn" onclick="setCanvasMode('pan')">
                        ðŸ–ï¸ Pan
                    </button>
                    <button class="workflow-toolbar-btn" onclick="toggleCanvasStepLibrary()">
                        ðŸ“š Steps
                    </button>
                    <button class="workflow-toolbar-btn" onclick="showCanvasVersionHistory()">
                        ðŸ• History
                    </button>
                    <button class="workflow-toolbar-btn" onclick="showCanvasTemplateMarketplace()">
                        ðŸª Templates
                    </button>
                    <button class="workflow-toolbar-btn" onclick="toggleCanvasPreviewMode()">
                        â–¶ï¸ Preview
                    </button>
                    <div style="flex: 1;"></div>
                    <button class="workflow-toolbar-btn" onclick="exportCanvasWorkflow('json')">
                        ðŸ’¾ Export JSON
                    </button>
                    <button class="workflow-toolbar-btn" onclick="exportCanvasWorkflow('pdf')">
                        ðŸ“„ Export PDF
                    </button>
                    <div style="display: flex; align-items: center; gap: 8px; margin-left: 16px;">
                        <span style="color: rgba(255,255,255,0.7); font-size: 0.875rem;">Collaborators:</span>
                        <div style="background: #3b82f6; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: white; border: 2px solid white;" title="You">JD</div>
                        <div style="background: #10b981; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: white; border: 2px solid white;" title="Sarah Chen - Online">SC</div>
                        <div style="background: #8b5cf6; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: white; border: 2px solid white;" title="Mike Torres - Online">MT</div>
                    </div>
                </div>

                <!-- Main Canvas Container -->
                <div id="canvasWorkflowContainer" style="position: relative; width: 100%; height: calc(100vh - 300px); overflow: hidden; background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); border-radius: 8px; cursor: grab;">
                    <div id="canvasWorkflowGrid" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(rgba(255, 255, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.05) 1px, transparent 1px); background-size: 20px 20px;"></div>

                    <!-- Step Library Panel -->
                    <div class="glass" id="canvasStepLibraryPanel" style="position: absolute; left: 20px; top: 20px; width: 220px; max-height: calc(100vh - 400px); overflow-y: auto; border-radius: 8px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2);">
                        <div style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <h3 style="font-weight: bold; color: white;">Step Library</h3>
                            <p style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); margin-top: 4px;">Drag to canvas</p>
                        </div>
                        <div style="padding: 8px;">
                            <div class="canvas-step-item" draggable="true" data-type="approval" ondragstart="handleCanvasDragStart(event)" style="background: linear-gradient(135deg, #3b82f6, #2563eb); padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: grab; transition: all 0.2s ease; border: 1px solid transparent;">
                                <div style="font-weight: bold; color: white; font-size: 0.875rem; pointer-events: none;">âœ“ Approval</div>
                                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8); pointer-events: none;">Manager review</div>
                            </div>
                            <div class="canvas-step-item" draggable="true" data-type="notification" ondragstart="handleCanvasDragStart(event)" style="background: linear-gradient(135deg, #10b981, #059669); padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: grab; transition: all 0.2s ease; border: 1px solid transparent;">
                                <div style="font-weight: bold; color: white; font-size: 0.875rem; pointer-events: none;">ðŸ“§ Notification</div>
                                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8); pointer-events: none;">Send email/SMS</div>
                            </div>
                            <div class="canvas-step-item" draggable="true" data-type="calculation" ondragstart="handleCanvasDragStart(event)" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: grab; transition: all 0.2s ease; border: 1px solid transparent;">
                                <div style="font-weight: bold; color: white; font-size: 0.875rem; pointer-events: none;">ðŸ”¢ Calculation</div>
                                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8); pointer-events: none;">Process data</div>
                            </div>
                            <div class="canvas-step-item" draggable="true" data-type="condition" ondragstart="handleCanvasDragStart(event)" style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: grab; transition: all 0.2s ease; border: 1px solid transparent;">
                                <div style="font-weight: bold; color: white; font-size: 0.875rem; pointer-events: none;">ðŸ”€ Condition</div>
                                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8); pointer-events: none;">If/then logic</div>
                            </div>
                            <div class="canvas-step-item" draggable="true" data-type="action" ondragstart="handleCanvasDragStart(event)" style="background: linear-gradient(135deg, #ef4444, #dc2626); padding: 12px; margin-bottom: 8px; border-radius: 6px; cursor: grab; transition: all 0.2s ease; border: 1px solid transparent;">
                                <div style="font-weight: bold; color: white; font-size: 0.875rem; pointer-events: none;">âš¡ Action</div>
                                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8); pointer-events: none;">Trigger event</div>
                            </div>
                        </div>
                    </div>

                    <!-- Collaboration Cursors -->
                    <div id="canvasCollaborationCursors"></div>

                    <!-- Minimap -->
                    <div style="position: absolute; bottom: 20px; right: 20px; width: 200px; height: 150px; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; overflow: hidden;">
                        <canvas id="canvasMinimapCanvas" width="200" height="150"></canvas>
                        <div id="canvasMinimapViewport" style="position: absolute; border: 2px solid #3b82f6; background: rgba(59, 130, 246, 0.1);"></div>
                    </div>

                    <!-- Zoom Controls -->
                    <div style="position: absolute; bottom: 20px; left: 20px; display: flex; gap: 8px;">
                        <button onclick="canvasZoomIn()" style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">+</button>
                        <span style="width: auto; padding: 0 12px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; display: flex; align-items: center; justify-content: center;">
                            <span id="canvasZoomLevel">100%</span>
                        </span>
                        <button onclick="canvasZoomOut()" style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">-</button>
                        <button onclick="canvasResetZoom()" style="width: 40px; height: 40px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 8px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease;">âŸ²</button>
                    </div>
                </div>

                <style>
                    .workflow-toolbar-btn {
                        padding: 8px 16px;
                        background: rgba(255, 255, 255, 0.1);
                        border: 1px solid rgba(255, 255, 255, 0.2);
                        border-radius: 6px;
                        color: white;
                        cursor: pointer;
                        transition: all 0.2s ease;
                    }
                    .workflow-toolbar-btn:hover {
                        background: rgba(255, 255, 255, 0.2);
                        border-color: rgba(255, 255, 255, 0.3);
                    }
                    .workflow-toolbar-btn.active {
                        background: rgba(59, 130, 246, 0.3);
                        border-color: #3b82f6;
                    }
                    .canvas-workflow-node {
                        position: absolute;
                        min-width: 180px;
                        padding: 16px;
                        border-radius: 8px;
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                        cursor: move;
                        transition: all 0.2s ease;
                        z-index: 10;
                    }
                    .canvas-workflow-node:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
                    }
                    .canvas-workflow-node.selected {
                        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
                    }
                    .canvas-node-approval {
                        background: linear-gradient(135deg, #3b82f6, #2563eb);
                    }
                    .canvas-node-notification {
                        background: linear-gradient(135deg, #10b981, #059669);
                    }
                    .canvas-node-calculation {
                        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                    }
                    .canvas-node-condition {
                        background: linear-gradient(135deg, #f59e0b, #d97706);
                    }
                    .canvas-node-action {
                        background: linear-gradient(135deg, #ef4444, #dc2626);
                    }
                    .canvas-step-item:hover {
                        border-color: rgba(255, 255, 255, 0.3) !important;
                        transform: translateX(4px);
                    }
                    .canvas-collab-cursor {
                        position: absolute;
                        pointer-events: none;
                        z-index: 1000;
                        transition: all 0.1s ease;
                    }
                    .canvas-cursor-pointer {
                        width: 0;
                        height: 0;
                        border-left: 8px solid;
                        border-top: 8px solid transparent;
                        border-bottom: 8px solid transparent;
                    }
                    .canvas-cursor-label {
                        position: absolute;
                        top: 16px;
                        left: 8px;
                        padding: 2px 8px;
                        border-radius: 4px;
                        font-size: 11px;
                        white-space: nowrap;
                        color: white;
                    }
                </style>
            `;

            setTimeout(() => {
                loadCanvasSampleWorkflow();
                simulateCanvasCollaborators();
                setupCanvasEvents();
            }, 100);
        }

        const canvasSampleNodes = [
            { id: 1, type: 'approval', x: 300, y: 200, title: 'Manager Approval', data: { approver: 'Department Head' } },
            { id: 2, type: 'notification', x: 550, y: 200, title: 'Send Email', data: { recipient: 'Applicant' } },
            { id: 3, type: 'condition', x: 300, y: 350, title: 'Check Amount', data: { threshold: 1000 } },
            { id: 4, type: 'calculation', x: 550, y: 350, title: 'Calculate Fee', data: { formula: 'amount * 0.05' } }
        ];

        function loadCanvasSampleWorkflow() {
            const canvas = document.getElementById('canvasWorkflowContainer');
            if (!canvas) return;

            canvasSampleNodes.forEach(node => {
                createCanvasWorkflowNode(node);
            });

            setTimeout(() => {
                createCanvasConnection(1, 2);
                createCanvasConnection(1, 3);
                createCanvasConnection(3, 4);
            }, 100);
        }

        function createCanvasWorkflowNode(nodeData) {
            const canvas = document.getElementById('canvasWorkflowContainer');
            if (!canvas) return;

            const node = document.createElement('div');
            node.className = `canvas-workflow-node canvas-node-${nodeData.type}`;
            node.id = `canvas-node-${nodeData.id}`;
            node.style.left = nodeData.x + 'px';
            node.style.top = nodeData.y + 'px';

            node.innerHTML = `
                <div style="font-weight: bold; color: white; margin-bottom: 4px;">${nodeData.title}</div>
                <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.8);">${getCanvasNodeTypeLabel(nodeData.type)}</div>
                <div style="margin-top: 8px; display: flex; align-items: center; justify-content: space-between;">
                    <button onclick="addCanvasComment(${nodeData.id})" style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); background: none; border: none; cursor: pointer;">
                        ðŸ’¬ Comment
                    </button>
                    <button onclick="deleteCanvasNode(${nodeData.id})" style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); background: none; border: none; cursor: pointer;">
                        ðŸ—‘ï¸
                    </button>
                </div>
            `;

            node.addEventListener('click', (e) => selectCanvasNode(nodeData.id, e));
            makeCanvasNodeDraggable(node, nodeData);

            canvas.appendChild(node);
            workflowCanvasState.nodes.push(nodeData);
        }

        function makeCanvasNodeDraggable(node, nodeData) {
            let isDragging = false;
            let startX, startY, initialLeft, initialTop;

            node.addEventListener('mousedown', (e) => {
                if (workflowCanvasState.mode !== 'select' || e.target.tagName === 'BUTTON') return;
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                initialLeft = parseInt(node.style.left) || 0;
                initialTop = parseInt(node.style.top) || 0;
                node.style.cursor = 'grabbing';
                e.stopPropagation();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const deltaX = (e.clientX - startX) / workflowCanvasState.zoom;
                const deltaY = (e.clientY - startY) / workflowCanvasState.zoom;
                const newLeft = initialLeft + deltaX;
                const newTop = initialTop + deltaY;
                node.style.left = newLeft + 'px';
                node.style.top = newTop + 'px';
                nodeData.x = newLeft;
                nodeData.y = newTop;
                updateCanvasNodeConnections(nodeData.id);
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    node.style.cursor = 'move';
                }
            });
        }

        function createCanvasConnection(fromId, toId) {
            const fromNode = document.getElementById(`canvas-node-${fromId}`);
            const toNode = document.getElementById(`canvas-node-${toId}`);
            if (!fromNode || !toNode) return;

            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.pointerEvents = 'none';
            svg.style.zIndex = '0';

            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            updateCanvasConnectionLine(line, fromNode, toNode);

            svg.appendChild(line);
            document.getElementById('canvasWorkflowContainer').appendChild(svg);

            workflowCanvasState.connections.push({ from: fromId, to: toId, element: svg, line: line });
        }

        function updateCanvasConnectionLine(line, fromNode, toNode) {
            if (!fromNode || !toNode || !line) return;

            const container = document.getElementById('canvasWorkflowContainer');
            if (!container) return;

            const fromRect = fromNode.getBoundingClientRect();
            const toRect = toNode.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            const x1 = fromRect.right - containerRect.left;
            const y1 = fromRect.top + fromRect.height / 2 - containerRect.top;
            const x2 = toRect.left - containerRect.left;
            const y2 = toRect.top + toRect.height / 2 - containerRect.top;

            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#3b82f6');
            line.setAttribute('stroke-width', '2');
            line.setAttribute('stroke-dasharray', '5,5');

            const svg = line.parentElement;
            if (!svg) return;

            const minX = Math.min(x1, x2);
            const minY = Math.min(y1, y2);
            const width = Math.abs(x2 - x1);
            const height = Math.abs(y2 - y1);

            svg.style.left = minX + 'px';
            svg.style.top = minY + 'px';
            svg.setAttribute('width', width);
            svg.setAttribute('height', height);
        }

        function updateCanvasNodeConnections(nodeId) {
            workflowCanvasState.connections.forEach(conn => {
                if (conn.from === nodeId || conn.to === nodeId) {
                    const fromNode = document.getElementById(`canvas-node-${conn.from}`);
                    const toNode = document.getElementById(`canvas-node-${conn.to}`);
                    updateCanvasConnectionLine(conn.line, fromNode, toNode);
                }
            });
        }

        function getCanvasNodeTypeLabel(type) {
            const labels = {
                approval: 'Requires approval',
                notification: 'Send notification',
                calculation: 'Process data',
                condition: 'Conditional logic',
                action: 'Execute action'
            };
            return labels[type] || type;
        }

        function simulateCanvasCollaborators() {
            const cursorsContainer = document.getElementById('canvasCollaborationCursors');
            if (!cursorsContainer) return;

            const users = [
                { name: 'Sarah Chen', color: '#10b981', x: 400, y: 300, baseX: 400, baseY: 300 },
                { name: 'Mike Torres', color: '#8b5cf6', x: 600, y: 250, baseX: 600, baseY: 250 }
            ];

            users.forEach((user) => {
                const cursor = document.createElement('div');
                cursor.className = 'canvas-collab-cursor';
                cursor.innerHTML = `
                    <div class="canvas-cursor-pointer" style="border-left-color: ${user.color};"></div>
                    <div class="canvas-cursor-label" style="background: ${user.color};">${user.name}</div>
                `;
                cursor.style.left = user.x + 'px';
                cursor.style.top = user.y + 'px';
                cursorsContainer.appendChild(cursor);

                setInterval(() => {
                    const newX = user.baseX + (Math.random() - 0.5) * 50;
                    const newY = user.baseY + (Math.random() - 0.5) * 50;
                    cursor.style.left = newX + 'px';
                    cursor.style.top = newY + 'px';
                }, 5000);
            });
        }

        function setupCanvasEvents() {
            const container = document.getElementById('canvasWorkflowContainer');
            if (!container) return;

            container.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'copy';
            });

            container.addEventListener('drop', (e) => {
                e.preventDefault();
                const stepType = e.dataTransfer.getData('stepType');
                if (stepType) {
                    const rect = container.getBoundingClientRect();
                    const x = e.clientX - rect.left - workflowCanvasState.panX;
                    const y = e.clientY - rect.top - workflowCanvasState.panY;

                    const newNode = {
                        id: Date.now(),
                        type: stepType,
                        x: x / workflowCanvasState.zoom,
                        y: y / workflowCanvasState.zoom,
                        title: getCanvasNodeTitle(stepType),
                        data: {}
                    };

                    createCanvasWorkflowNode(newNode);
                }

                document.querySelectorAll('.canvas-step-item').forEach(item => {
                    item.style.opacity = '1';
                });
            });
        }

        function handleCanvasDragStart(e) {
            const type = e.target.getAttribute('data-type');
            e.dataTransfer.setData('stepType', type);
            e.dataTransfer.effectAllowed = 'copy';
            e.target.style.opacity = '0.5';
        }

        function getCanvasNodeTitle(type) {
            const titles = {
                approval: 'New Approval',
                notification: 'New Notification',
                calculation: 'New Calculation',
                condition: 'New Condition',
                action: 'New Action'
            };
            return titles[type] || 'New Step';
        }

        function selectCanvasNode(id, event) {
            event.stopPropagation();
            document.querySelectorAll('.canvas-workflow-node').forEach(n => n.classList.remove('selected'));
            const node = document.getElementById(`canvas-node-${id}`);
            if (node) node.classList.add('selected');
            workflowCanvasState.selectedNode = id;
        }

        function deleteCanvasNode(id) {
            if (confirm('Delete this workflow step?')) {
                const node = document.getElementById(`canvas-node-${id}`);
                if (node) node.remove();
                workflowCanvasState.nodes = workflowCanvasState.nodes.filter(n => n.id !== id);
            }
        }

        function addCanvasComment(nodeId) {
            alert(`ðŸ’¬ Comment on Node ${nodeId}\n\n[In production, this would open a comment thread]\n\nSample comments:\nâ€¢ "Should we add a timeout here?" - Sarah\nâ€¢ "Approved, looks good!" - Mike\nâ€¢ "Changed threshold to 1000" - You`);
        }

        function setCanvasMode(mode) {
            workflowCanvasState.mode = mode;
            document.querySelectorAll('.workflow-toolbar-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function canvasZoomIn() {
            workflowCanvasState.zoom = Math.min(3, workflowCanvasState.zoom * 1.2);
            updateCanvasZoomDisplay();
        }

        function canvasZoomOut() {
            workflowCanvasState.zoom = Math.max(0.1, workflowCanvasState.zoom / 1.2);
            updateCanvasZoomDisplay();
        }

        function canvasResetZoom() {
            workflowCanvasState.zoom = 1;
            workflowCanvasState.panX = 0;
            workflowCanvasState.panY = 0;
            updateCanvasZoomDisplay();
        }

        function updateCanvasZoomDisplay() {
            const zoomEl = document.getElementById('canvasZoomLevel');
            if (zoomEl) {
                zoomEl.textContent = Math.round(workflowCanvasState.zoom * 100) + '%';
            }
        }

        function toggleCanvasStepLibrary() {
            const library = document.getElementById('canvasStepLibraryPanel');
            if (library) {
                library.style.display = library.style.display === 'none' ? 'block' : 'none';
            }
        }

        function showCanvasVersionHistory() {
            alert('ðŸ“œ Version History\n\nv2.3 - Current (2 hours ago - Sarah Chen)\nUpdated approval flow\n\nv2.2 (1 day ago - Mike Torres)\nAdded notification step\n\nv2.1 (3 days ago - You)\nFixed condition logic\n\n[In production, this would show a detailed version history modal]');
        }

        function showCanvasTemplateMarketplace() {
            alert('ðŸª Template Marketplace\n\nAvailable Templates:\nâ€¢ Permit Approval (â˜…4.8, 245 uses)\nâ€¢ Invoice Processing (â˜…4.9, 892 uses)\nâ€¢ Onboarding (â˜…4.7, 567 uses)\nâ€¢ Incident Response (â˜…5.0, 178 uses)\nâ€¢ Report Generation (â˜…4.6, 423 uses)\nâ€¢ Data Sync (â˜…4.5, 334 uses)\n\n[In production, this would show a full template marketplace modal]');
        }

        function toggleCanvasPreviewMode() {
            alert('â–¶ï¸ Preview Mode\n\nSimulating workflow execution...\n\n1. Manager Approval (2s)\n2. Send Email Notification (1s)\n3. Check Amount Condition (1s)\n4. Calculate Fee (1s)\n\nTotal execution time: ~5 seconds\n\n[In production, this would show live step-by-step execution]');
        }

        function exportCanvasWorkflow(format) {
            if (format === 'json') {
                const data = JSON.stringify({
                    nodes: workflowCanvasState.nodes,
                    connections: workflowCanvasState.connections.map(c => ({ from: c.from, to: c.to })),
                    version: '2.3',
                    metadata: { created: new Date().toISOString(), author: 'Govli User' }
                }, null, 2);
                alert('ðŸ“¥ Export to JSON\n\nWorkflow exported successfully!\n\n' + data.substring(0, 200) + '...\n\n[In production, this would download a JSON file]');
            } else if (format === 'pdf') {
                alert('ðŸ“„ Export to PDF\n\nGenerating visual diagram...\n\nâœ“ Canvas captured\nâœ“ Nodes rendered\nâœ“ Connections drawn\nâœ“ Metadata included\n\n[In production, this would generate and download a PDF]');
            }
        }
        // ===== END COLLABORATIVE WORKFLOW CANVAS =====

        // ===== DOCUMENT PROCESSING CENTER - Added 2025-10-18 =====
        // SECURITY TODO: Implement document storage with AES-256 encryption at rest (CJIS requirement)
        // SECURITY TODO: Add role-based access control (RBAC) for CJIS compliance
        // TODO: Integrate with audit logging system - all actions must be logged (CJIS requirement)
        // SECURITY TODO: Implement session timeout (15 minutes per CJIS standards)
        // SECURITY TODO: Add two-factor authentication for document access
        // SECURITY TODO: Encrypt all data in transit with TLS 1.2+ (CJIS requirement)
        // TODO: Connect to real document processing API endpoint /api/documents/queue
        // TODO: Implement PII masking/redaction features for sensitive fields

        // MOCK DATA - Replace in production
        const MOCK_DOC_PROCESSING_DATA = {
            high: [
                {
                    id: 'DOC-2024-001847',
                    filename: 'BuildingPermit_SmithConstruction.pdf',
                    type: 'Building Permit Application',
                    uploadedBy: 'John Smith',
                    uploadDate: '2024-10-18T09:23:00Z',
                    confidence: 68,
                    priority: 'high',
                    fields: [
                        { name: 'Owner Name', value: 'John Smith', confidence: 94, status: 'approved' },
                        { name: 'Property Address', value: '742 Evergreen Terrace', confidence: 89, status: 'approved' },
                        { name: 'Project Description', value: '[unclear]', confidence: 42, status: 'rejected', note: 'Handwriting illegible' },
                        { name: 'Contractor License', value: 'IL-CON-8472', confidence: 78, status: 'pending' },
                        { name: 'Estimated Cost', value: '$45,000', confidence: 91, status: 'approved' },
                        { name: 'Start Date', value: '11/01/2024', confidence: 55, status: 'rejected', note: 'Date format unclear' }
                    ]
                },
                {
                    id: 'DOC-2024-001852',
                    filename: 'PoliceReport_TrafficIncident.pdf',
                    type: 'Police Report',
                    uploadedBy: 'Officer Williams',
                    uploadDate: '2024-10-18T10:15:00Z',
                    confidence: 65,
                    priority: 'high',
                    fields: [
                        { name: 'Incident Date', value: '10/17/2024', confidence: 92, status: 'approved' },
                        { name: 'Location', value: 'Main St & Oak Ave', confidence: 88, status: 'approved' },
                        { name: 'License Plate', value: 'ABC [smudged]', confidence: 48, status: 'rejected', note: 'Partially obscured' },
                        { name: 'Driver Name', value: 'Jane Doe', confidence: 73, status: 'pending' },
                        { name: 'Insurance Policy', value: '[illegible]', confidence: 32, status: 'rejected', note: 'Poor scan quality' }
                    ]
                }
            ],
            medium: [
                {
                    id: 'DOC-2024-001849',
                    filename: 'TaxAppeal_Johnson.pdf',
                    type: 'Property Tax Appeal',
                    uploadedBy: 'Mary Johnson',
                    uploadDate: '2024-10-18T09:45:00Z',
                    confidence: 82,
                    priority: 'medium'
                },
                {
                    id: 'DOC-2024-001850',
                    filename: 'BusinessLicense_GreenCafe.pdf',
                    type: 'Business License Application',
                    uploadedBy: 'Sarah Green',
                    uploadDate: '2024-10-18T10:02:00Z',
                    confidence: 78,
                    priority: 'medium'
                }
            ],
            auto: [
                {
                    id: 'DOC-2024-001851',
                    filename: 'ParkingPermit_Downtown.pdf',
                    type: 'Parking Permit',
                    uploadedBy: 'Mike Davis',
                    uploadDate: '2024-10-18T10:08:00Z',
                    confidence: 97,
                    priority: 'auto'
                },
                {
                    id: 'DOC-2024-001853',
                    filename: 'WaterBill_Payment.pdf',
                    type: 'Utility Bill',
                    uploadedBy: 'System Auto-Upload',
                    uploadDate: '2024-10-18T10:30:00Z',
                    confidence: 99,
                    priority: 'auto'
                }
            ]
        };

        function openDocQueue(priority) {
            // CJIS AUDIT LOG - Log queue access
            console.log(`AUDIT: User accessed ${priority} priority document queue at ${new Date().toISOString()}`);

            const docs = MOCK_DOC_PROCESSING_DATA[priority] || [];

            let docList = docs.map(doc => {
                const confidenceColor = doc.confidence >= 85 ? 'ðŸŸ¢' : doc.confidence >= 70 ? 'ðŸŸ¡' : 'ðŸ”´';
                return `${confidenceColor} ${doc.filename}\n   Type: ${doc.type}\n   Confidence: ${doc.confidence}%\n   Uploaded: ${new Date(doc.uploadDate).toLocaleString()}`;
            }).join('\n\n');

            const priorityLabel = priority === 'high' ? 'High Priority (< 70%)' :
                                priority === 'medium' ? 'Medium Priority (70-85%)' :
                                'Auto-Processed (> 85%)';

            alert(`ðŸ“‹ ${priorityLabel} Queue\n\n${docs.length} documents\n\n${docList}\n\n[In production, this would open a detailed queue management interface with document review capabilities]`);

            // TODO: Open modal with full queue interface
            // TODO: Connect to API endpoint /api/documents/queue?priority=${priority}
        }

        function showBatchUpload() {
            alert('ðŸ“¤ Batch Document Upload\n\nThis feature allows you to upload multiple documents at once for processing.\n\nâ€¢ Drag and drop up to 50 files\nâ€¢ Automatic document type detection\nâ€¢ Priority routing based on confidence\nâ€¢ Real-time processing status\n\n[In production, this would open a batch upload interface with drag-and-drop support and progress tracking]\n\nTODO: Implement batch upload modal');

            // TODO: Show batch upload modal
            // TODO: Connect to API endpoint /api/documents/batch-upload
            console.log('TODO: Implement batch upload UI');
        }

        function exportDocProcessingReport() {
            const reportData = {
                generatedAt: new Date().toISOString(),
                totalProcessed: 2847,
                accuracyRate: 94.7,
                avgProcessingTime: 2.3,
                queues: {
                    high: MOCK_DOC_PROCESSING_DATA.high.length,
                    medium: MOCK_DOC_PROCESSING_DATA.medium.length,
                    auto: MOCK_DOC_PROCESSING_DATA.auto.length
                }
            };

            console.log(`AUDIT: User exported document processing report at ${new Date().toISOString()}`);
            alert('ðŸ“Š Export Processing Report\n\nGenerating comprehensive report...\n\n' +
                  `â€¢ Total Processed: ${reportData.totalProcessed}\n` +
                  `â€¢ Accuracy: ${reportData.accuracyRate}%\n` +
                  `â€¢ Avg Time: ${reportData.avgProcessingTime}s\n` +
                  `â€¢ Time Saved: 142 hours\n\n` +
                  `Queues:\n` +
                  `â€¢ High Priority: ${reportData.queues.high}\n` +
                  `â€¢ Medium Priority: ${reportData.queues.medium}\n` +
                  `â€¢ Auto-Processed: ${reportData.queues.auto}\n\n` +
                  `[In production, this would generate and download a comprehensive PDF/CSV report]\n\n` +
                  `TODO: Generate PDF/CSV export`);

            // TODO: Generate and download report
            // TODO: POST to /api/reports/document-processing
            console.log('TODO: POST to /api/reports/generate', reportData);
        }

        function configureDocProcessing() {
            alert('âš™ï¸ Document Processing Settings\n\nConfigure OCR and automation parameters:\n\n' +
                  'â€¢ Confidence thresholds (High/Medium/Auto)\n' +
                  'â€¢ Auto-approval rules\n' +
                  'â€¢ Field validation patterns\n' +
                  'â€¢ Document type templates\n' +
                  'â€¢ Quality control settings\n' +
                  'â€¢ PII detection sensitivity\n' +
                  'â€¢ Duplicate detection rules\n\n' +
                  '[In production, this would open a comprehensive settings interface]\n\n' +
                  'TODO: Implement settings configuration UI');

            // TODO: Show settings modal
            // TODO: Connect to API endpoint /api/documents/settings
            console.log('TODO: Implement settings configuration UI');
        }

        function enterDocTrainingMode() {
            console.log(`AUDIT: User entered AI training mode at ${new Date().toISOString()}`);
            alert('ðŸ§  AI Training Mode\n\nTrain the document processing AI:\n\n' +
                  'â€¢ Upload sample documents\n' +
                  'â€¢ Correct field extractions\n' +
                  'â€¢ Define new document types\n' +
                  'â€¢ Improve accuracy over time\n' +
                  'â€¢ Export trained models\n' +
                  'â€¢ Review training history\n\n' +
                  '[In production, this would open an interactive AI training interface with document annotation tools]\n\n' +
                  'TODO: Implement AI training interface');

            // TODO: Show training interface
            // TODO: Connect to API endpoint /api/documents/training
            console.log('TODO: Implement AI training UI');
        }
        // ===== END DOCUMENT PROCESSING CENTER =====

        // ===== INTELLIGENCE HUB =====
        // TODO: Connect to all platform sections via unified API
        // TODO: Implement real-time WebSocket for live insights
        // TODO: Add machine learning model for automation suggestions
        // TODO: Integrate with knowledge graph database (Neo4j)
        // TODO: Implement cross-section workflow orchestration
        // TODO: Add AI explainability interface
        // TODO: Connect to integration monitoring system
        // SECURITY TODO: Add RBAC for sensitive cross-section data
        // SECURITY TODO: Implement audit logging for all actions
        // TODO: Add export functionality for insights and reports

        // MOCK DATA - Replace in production
        const MOCK_INSIGHTS = [
            {
                id: 'INS001',
                source: 'Predictive Needs Engine',
                icon: 'fas fa-bullseye',
                color: 'blue',
                priority: 'high',
                title: '15 citizens likely to need building permits next week',
                description: 'Based on recent property purchases and historical patterns',
                action: 'Pre-send permit guide emails',
                confidence: 89,
                timestamp: '2 minutes ago'
            },
            {
                id: 'INS002',
                source: 'Document Processor',
                icon: 'fas fa-file-alt',
                color: 'purple',
                priority: 'medium',
                title: '47 business license renewals processed overnight',
                description: '3 documents need manual review due to low confidence',
                action: 'Open review queue',
                confidence: 96,
                timestamp: '1 hour ago'
            },
            {
                id: 'INS003',
                source: 'Policy Interpreter',
                icon: 'fas fa-gavel',
                color: 'yellow',
                priority: 'high',
                title: 'New ADA regulation affects 12 active permits',
                description: 'Federal accessibility standards updated yesterday',
                action: 'Notify affected applicants',
                confidence: 94,
                timestamp: '3 hours ago'
            },
            {
                id: 'INS004',
                source: 'Grant Discovery',
                icon: 'fas fa-hand-holding-usd',
                color: 'green',
                priority: 'high',
                title: '$2.5M cybersecurity grant matches your profile',
                description: '96% compatibility score - deadline in 14 days',
                action: 'Start application workflow',
                confidence: 96,
                timestamp: '5 hours ago'
            },
            {
                id: 'INS005',
                source: 'Sentiment Analysis',
                icon: 'fas fa-chart-line',
                color: 'red',
                priority: 'medium',
                title: 'Citizen satisfaction dropped 8% in permit department',
                description: 'Trend detected over past 2 weeks',
                action: 'View detailed sentiment report',
                confidence: 87,
                timestamp: '1 day ago'
            }
        ];

        const MOCK_ACTIONS = [
            {
                id: 'ACT001',
                title: 'Proactive Citizen Service',
                insight: 'Sarah Johnson moved (Address Change) + has active permit (Workflows)',
                aiAction: 'Auto-update permit address + send voter registration reminder',
                sections: ['CRM', 'Workflows', 'Citizen Portal'],
                status: 'pending',
                confidence: 92
            },
            {
                id: 'ACT002',
                title: 'Vendor Intelligence',
                insight: 'TechCorp contract expiring (CRM) + similar vendor grant available (Grants)',
                aiAction: 'Notify procurement + suggest grant application for replacement',
                sections: ['CRM', 'Grants', 'Procurement'],
                status: 'pending',
                confidence: 88
            },
            {
                id: 'ACT003',
                title: 'Compliance Monitoring',
                insight: 'OSHA policy changed (Policy Engine) + affects 8 active projects (Workflows)',
                aiAction: 'Flag affected projects + notify contractors + update checklists',
                sections: ['Policy', 'Workflows', 'CRM'],
                status: 'pending',
                confidence: 95
            }
        ];

        const MOCK_AUTOMATIONS = [
            {
                id: 'AUTO001',
                pattern: 'Staff manually routing 47 similar documents per day',
                suggestion: 'Create workflow: Building permits >$50K â†’ Auto-route to senior inspector',
                roi: 'Save 2.3 hours/day',
                accuracy: '99%',
                confidence: 94
            },
            {
                id: 'AUTO002',
                pattern: 'Document processor finding vendor info + manually entering to CRM',
                suggestion: 'Auto-create CRM contacts from processed vendor documents',
                roi: 'Eliminate 15 min/day duplicate entry',
                accuracy: '96%',
                confidence: 91
            },
            {
                id: 'AUTO003',
                pattern: 'Analyzed 6 months of permit data - can now predict approval time',
                suggestion: 'Show citizens estimated approval time when applying',
                roi: 'Reduce inquiry calls by 40%',
                accuracy: '89% within 1 day',
                confidence: 89
            }
        ];

        // Initialize Intelligence Hub on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadInsightsFeed();
            loadActionCenter();
            loadAutomationSuggestions();
            renderKnowledgeGraph();
        });

        function loadInsightsFeed() {
            const feed = document.getElementById('insightsFeed');
            console.log('Intelligence Hub: loadInsightsFeed() called, feed element:', feed);
            if (!feed) {
                console.error('Intelligence Hub: insightsFeed element not found!');
                return;
            }
            feed.innerHTML = MOCK_INSIGHTS.map(insight => `
                <div class="insight-card glass rounded-lg p-4" onclick="viewInsightDetails('${insight.id}')">
                    <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-${insight.color}-500/20 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="${insight.icon} text-${insight.color}-400"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs text-white/60">${insight.source}</span>
                                <span class="priority-badge priority-${insight.priority}">${insight.priority.toUpperCase()}</span>
                                <span class="text-xs text-white/50 ml-auto">${insight.timestamp}</span>
                            </div>
                            <div class="font-semibold text-white mb-1">${insight.title}</div>
                            <div class="text-sm text-white/70 mb-2">${insight.description}</div>
                            <div class="flex items-center justify-between">
                                <button class="bg-${insight.color}-600 hover:bg-${insight.color}-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all">
                                    ${insight.action}
                                </button>
                                <div class="flex items-center gap-2 text-xs text-white/60">
                                    <span>Confidence:</span>
                                    <span class="text-${insight.color}-400 font-semibold">${insight.confidence}%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadActionCenter() {
            const center = document.getElementById('actionCenter');
            if (!center) return;
            center.innerHTML = MOCK_ACTIONS.map(action => `
                <div class="glass rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="font-semibold text-white">${action.title}</h4>
                        <div class="flex gap-1">
                            ${action.sections.map(s => `<span class="text-xs bg-blue-500/20 text-blue-400 px-2 py-1 rounded border border-blue-500/30">${s}</span>`).join('')}
                        </div>
                    </div>
                    <div class="text-sm text-white/70 mb-2">
                        <i class="fas fa-lightbulb text-yellow-400 mr-1"></i>${action.insight}
                    </div>
                    <div class="text-sm text-white/80 mb-3">
                        <i class="fas fa-robot text-purple-400 mr-1"></i>${action.aiAction}
                    </div>
                    <div class="flex gap-2">
                        <button onclick="executeAction('${action.id}')" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all">
                            <i class="fas fa-check mr-1"></i>Approve & Execute
                        </button>
                        <button onclick="reviewAction('${action.id}')" class="flex-1 bg-white/10 hover:bg-white/20 text-white px-3 py-2 rounded-lg text-sm font-medium border border-white/20 transition-all">
                            <i class="fas fa-eye mr-1"></i>Review Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAutomationSuggestions() {
            const suggestions = document.getElementById('automationSuggestions');
            if (!suggestions) return;
            suggestions.innerHTML = MOCK_AUTOMATIONS.map(auto => `
                <div class="automation-card">
                    <div class="flex items-start gap-3 mb-3">
                        <i class="fas fa-robot text-purple-400 text-xl"></i>
                        <div class="flex-1">
                            <div class="font-semibold text-white mb-1">AUTOMATION OPPORTUNITY DETECTED</div>
                            <div class="text-sm text-white/70 mb-2">
                                <strong>Pattern:</strong> ${auto.pattern}
                            </div>
                            <div class="text-sm text-white/80 mb-2">
                                <strong>Suggestion:</strong> ${auto.suggestion}
                            </div>
                            <div class="flex gap-4 text-xs text-white/60 mb-3">
                                <div><strong>ROI:</strong> ${auto.roi}</div>
                                <div><strong>Accuracy:</strong> ${auto.accuracy}</div>
                                <div><strong>Confidence:</strong> ${auto.confidence}%</div>
                            </div>
                            <button onclick="buildAutomation('${auto.id}')" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-all">
                                <i class="fas fa-magic mr-2"></i>Build This Automation
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderKnowledgeGraph() {
            const preview = document.getElementById('knowledgeGraphPreview');
            const full = document.getElementById('knowledgeGraphFull');

            // Simple network visualization
            const nodes = [
                { id: 'citizen', label: 'John Smith', color: 'blue', x: 150, y: 150 },
                { id: 'permit', label: 'Building Permit', color: 'green', x: 250, y: 100 },
                { id: 'contractor', label: 'Chen Construction', color: 'purple', x: 250, y: 200 },
                { id: 'property', label: '123 Oak St', color: 'blue', x: 50, y: 150 }
            ];

            [preview, full].forEach(container => {
                if (!container) return;
                container.innerHTML = '';

                // Draw lines
                const lines = [
                    { from: nodes[0], to: nodes[1] },
                    { from: nodes[0], to: nodes[2] },
                    { from: nodes[0], to: nodes[3] },
                    { from: nodes[1], to: nodes[2] }
                ];

                lines.forEach(line => {
                    const lineEl = document.createElement('div');
                    lineEl.className = 'knowledge-line';
                    const length = Math.sqrt(Math.pow(line.to.x - line.from.x, 2) + Math.pow(line.to.y - line.from.y, 2));
                    const angle = Math.atan2(line.to.y - line.from.y, line.to.x - line.from.x);
                    lineEl.style.width = length + 'px';
                    lineEl.style.left = line.from.x + 'px';
                    lineEl.style.top = line.from.y + 'px';
                    lineEl.style.transform = `rotate(${angle}rad)`;
                    container.appendChild(lineEl);
                });

                // Draw nodes
                nodes.forEach(node => {
                    const nodeEl = document.createElement('div');
                    nodeEl.className = 'knowledge-node';
                    nodeEl.style.left = (node.x - 40) + 'px';
                    nodeEl.style.top = (node.y - 40) + 'px';
                    nodeEl.style.background = `linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3))`;
                    nodeEl.textContent = node.label;
                    nodeEl.onclick = () => viewNodeDetails(node.id);
                    container.appendChild(nodeEl);
                });
            });
        }

        function performPlatformSearch() {
            const query = document.getElementById('platformSearch').value;
            if (!query) return;

            console.log('Searching platform for:', query);
            document.getElementById('searchModal').classList.add('active');

            const results = document.getElementById('searchResults');
            results.innerHTML = `
                <div class="search-result-group">
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                        <i class="fas fa-sitemap text-blue-400"></i>
                        Workflows (3 results)
                    </h3>
                    <div class="search-result-item">
                        <div class="font-semibold text-white">Active permit: ${query}</div>
                        <div class="text-sm text-white/60">Status: Under Review â€¢ Updated 2 hours ago</div>
                    </div>
                </div>
                <div class="search-result-group">
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                        <i class="fas fa-users text-green-400"></i>
                        CRM Contacts (2 results)
                    </h3>
                    <div class="search-result-item">
                        <div class="font-semibold text-white">John Smith - Applicant</div>
                        <div class="text-sm text-white/60">Email: john@example.com â€¢ Phone: (555) 123-4567</div>
                    </div>
                </div>
                <div class="bg-purple-500/10 border border-purple-500/30 rounded-lg p-4 mt-4">
                    <h3 class="text-sm font-bold text-white mb-2 flex items-center gap-2">
                        <i class="fas fa-lightbulb text-yellow-400"></i>
                        AI Insights
                    </h3>
                    <div class="text-sm text-white/70">
                        â€¢ Pattern detected: 3x more permit activity than average - possible development trend<br>
                        â€¢ Related: Chen Construction works on 67% of similar projects
                    </div>
                </div>
            `;
        }

        function filterInsights(filter) {
            console.log('Filtering insights by:', filter);
            // TODO: Implement filtering logic
        }

        function viewInsightDetails(id) {
            console.log('Viewing insight:', id);
            alert('Insight Details\n\nThis would show detailed information about the insight including:\n\nâ€¢ Full context and data sources\nâ€¢ Historical patterns\nâ€¢ Confidence breakdown\nâ€¢ Recommended actions\nâ€¢ Similar past insights\n\nTODO: Implement insight details modal');
        }

        function executeAction(id) {
            console.log('Executing action:', id);
            alert('Action Executed\n\nCross-section action has been executed successfully.\n\nâ€¢ Notifications sent\nâ€¢ Records updated\nâ€¢ Workflows triggered\n\nTODO: Implement actual action execution');
        }

        function reviewAction(id) {
            console.log('Reviewing action:', id);
            alert('Action Review\n\nReview mode would show:\n\nâ€¢ Detailed impact analysis\nâ€¢ Affected records preview\nâ€¢ Rollback plan\nâ€¢ Approval workflow\n\nTODO: Implement action review interface');
        }

        function buildAutomation(id) {
            console.log('Building automation:', id);
            alert('Build Automation\n\nThis would open the workflow builder with:\n\nâ€¢ Pre-configured automation template\nâ€¢ Suggested triggers and actions\nâ€¢ Test data for validation\nâ€¢ Deployment options\n\nTODO: Integrate with workflow builder');
        }

        function openFullGraph() {
            document.getElementById('graphModal').classList.add('active');
        }

        function closeGraphModal() {
            document.getElementById('graphModal').classList.remove('active');
        }

        function closeSearchModal() {
            document.getElementById('searchModal').classList.remove('active');
        }

        function viewNodeDetails(id) {
            console.log('Viewing node:', id);
            alert(`Node Details: ${id}\n\nWould show:\nâ€¢ All connections\nâ€¢ Associated records\nâ€¢ Timeline of interactions\nâ€¢ Related insights\n\nTODO: Implement node details view`);
        }

        function viewExplainability() {
            alert('AI Explainability\n\nFor any AI decision, we show:\n\nâ€¢ Why did AI make this decision?\nâ€¢ What data was used?\nâ€¢ Confidence factors\nâ€¢ Similar past decisions\nâ€¢ Override options\n\nExample: "Why route to senior inspector?"\nâœ“ Project value >$100K\nâœ“ Structural changes detected\nâœ“ Historical pattern match\n\nTODO: Implement explainability interface');
        }

        function viewIntegrationDetails() {
            alert('Integration Configuration\n\nWould show:\n\nâ€¢ Current integration status\nâ€¢ Data flow diagrams\nâ€¢ Configuration options\nâ€¢ Performance metrics\nâ€¢ Troubleshooting tools\n\nTODO: Implement integration management interface');
        }

        // Close modals on escape - Intelligence Hub
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
        // ===== END INTELLIGENCE HUB =====

        // ===== API INTEGRATION PLATFORM - Added 2024-10-22 =====
        // TODO: Connect to API management backend
        // TODO: Integrate with government API catalogs (data.gov, api.gov)
        // SECURITY TODO: Implement credential encryption and rotation

        // MOCK DATA - Replace in production
        const MOCK_APIS = [{id:'api001',name:'FBI NCIC Database',category:'Public Safety',description:'National Crime Information Center - Criminal records and warrants',compatibility:92,auth:'OAuth 2.0 + CJIS',rateLimit:'1000 req/hour',uptime:99.9,latency:245,status:'healthy',compliance:['CJIS','FISMA'],cost:'$0.05/call'},{id:'api002',name:'State DMV Registry',category:'Administrative',description:'Vehicle registration, drivers license verification',compatibility:87,auth:'API Key',rateLimit:'5000 req/hour',uptime:98.5,latency:180,status:'healthy',compliance:['FISMA'],cost:'$0.02/call'},{id:'api003',name:'Grants.gov API',category:'Administrative',description:'Federal grant opportunities and application tracking',compatibility:95,auth:'OAuth 2.0',rateLimit:'10000 req/hour',uptime:99.7,latency:320,status:'healthy',compliance:['FedRAMP','FISMA'],cost:'Free'},{id:'api004',name:'IRS Tax API',category:'Regulatory',description:'Tax assessment and payment processing',compatibility:89,auth:'JWT + 2FA',rateLimit:'500 req/hour',uptime:99.95,latency:410,status:'healthy',compliance:['FISMA','IRS 1075'],cost:'$0.10/call'},{id:'api005',name:'Property Records',category:'Administrative',description:'Land records, deeds, property assessments',compatibility:84,auth:'API Key',rateLimit:'2000 req/hour',uptime:97.8,latency:290,status:'degraded',compliance:['FISMA'],cost:'$0.03/call'},{id:'api006',name:'Court Case Mgmt',category:'Public Safety',description:'Court records, case status, scheduling',compatibility:91,auth:'SAML 2.0',rateLimit:'3000 req/hour',uptime:99.2,latency:265,status:'healthy',compliance:['CJIS','FISMA'],cost:'$0.04/call'},{id:'api007',name:'911 Dispatch',category:'Public Safety',description:'Emergency call routing and resource dispatch',compatibility:93,auth:'OAuth 2.0 + CJIS',rateLimit:'10000 req/hour',uptime:99.99,latency:125,status:'healthy',compliance:['CJIS','NENA','FISMA'],cost:'$0.08/call'},{id:'api008',name:'NOAA Weather API',category:'Infrastructure',description:'Weather forecasts and disaster alerts',compatibility:96,auth:'API Key',rateLimit:'50000 req/hour',uptime:99.6,latency:195,status:'healthy',compliance:['FISMA'],cost:'Free'}];

        const MOCK_ERRORS = [{type:'Timeout',count:45,percentage:35,color:'red'},{type:'Auth Failure',count:28,percentage:22,color:'yellow'},{type:'Rate Limit',count:23,percentage:18,color:'orange'},{type:'Bad Request',count:18,percentage:14,color:'blue'},{type:'Server Error',count:13,percentage:11,color:'purple'}];

        function switchAPIModule(moduleName) {
            document.querySelectorAll('.api-tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-api-module="${moduleName}"]`).classList.add('active');
            document.querySelectorAll('.api-module-content').forEach(module => module.classList.add('hidden'));
            document.getElementById(`api-module-${moduleName}`).classList.remove('hidden');
        }

        function renderAPIResults(apis) {
            const container = document.getElementById('apiResults');
            if (!container) return;
            container.innerHTML = apis.map(api => `<div class="glass rounded-xl p-6 hover:scale-105 transition-all cursor-pointer"><div class="flex items-start justify-between mb-3"><div><h4 class="font-bold text-white mb-1">${api.name}</h4><p class="text-xs text-white/60">${api.category}</p></div><div class="w-2 h-2 bg-${api.status === 'healthy' ? 'green' : 'yellow'}-400 rounded-full animate-pulse"></div></div><p class="text-sm text-white/70 mb-3">${api.description}</p><div class="mb-3"><div class="flex justify-between text-xs mb-1"><span class="text-white/60">Compatibility</span><span class="text-white font-medium">${api.compatibility}%</span></div><div class="compatibility-score relative overflow-hidden"><div class="absolute inset-0 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500"></div><div class="absolute inset-0 bg-black/50" style="width: ${100 - api.compatibility}%; margin-left: ${api.compatibility}%"></div></div></div><div class="grid grid-cols-2 gap-2 text-xs mb-3"><div><span class="text-white/50">Auth:</span> <span class="text-white">${api.auth}</span></div><div><span class="text-white/50">Uptime:</span> <span class="text-green-400">${api.uptime}%</span></div></div><div class="flex gap-1 mb-3 flex-wrap">${api.compliance.map(badge => `<span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full border border-green-500/30">${badge}</span>`).join('')}</div><div class="flex items-center justify-between"><span class="text-sm text-yellow-400 font-medium">${api.cost}</span><button onclick="connectAPI('${api.id}')" class="px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white text-sm font-medium hover:shadow-lg transition-all">Connect</button></div></div>`).join('');
        }

        function renderHealthDashboard() {
            const container = document.getElementById('healthDashboard');
            if (!container) return;
            const healthyAPIs = MOCK_APIS.filter(api => api.status === 'healthy').length;
            const degradedAPIs = MOCK_APIS.filter(api => api.status === 'degraded').length;
            container.innerHTML = `<div class="flex items-center justify-between p-3 bg-green-600/10 border border-green-500/30 rounded-lg"><div class="flex items-center gap-3"><i class="fas fa-check-circle text-green-400 text-xl"></i><div><div class="text-white font-medium">Healthy APIs</div><div class="text-xs text-white/60">${healthyAPIs} systems operational</div></div></div><div class="text-2xl font-bold text-green-400">${healthyAPIs}</div></div><div class="flex items-center justify-between p-3 bg-yellow-600/10 border border-yellow-500/30 rounded-lg mt-3"><div class="flex items-center gap-3"><i class="fas fa-exclamation-triangle text-yellow-400 text-xl"></i><div><div class="text-white font-medium">Degraded APIs</div><div class="text-xs text-white/60">Performance issues</div></div></div><div class="text-2xl font-bold text-yellow-400">${degradedAPIs}</div></div>`;
        }

        function renderErrorCategories() {
            const container = document.getElementById('errorCategories');
            if (!container) return;
            container.innerHTML = MOCK_ERRORS.map(error => `<div class="p-3 bg-white/5 rounded-lg"><div class="flex justify-between mb-2"><span class="text-white font-medium">${error.type}</span><span class="text-${error.color}-400">${error.count} errors</span></div><div class="w-full h-2 bg-white/10 rounded-full overflow-hidden"><div class="h-full bg-${error.color}-500" style="width: ${error.percentage}%"></div></div></div>`).join('');
        }

        function renderDeadLetterQueue() {
            const container = document.getElementById('deadLetterQueue');
            if (!container) return;
            const errors = [{id:'err001',title:'DMV API Timeout',description:'Failed after 3 retry attempts - Request ID: req_8472hdj',time:'5 min ago',severity:'critical',api:'State DMV Registry',endpoint:'/api/v2/vehicles/registration',method:'POST',statusCode:504,requestPayload:{vin:'1HGBH41JXMN109186',plate:'ABC1234',state:'IL'},errorMessage:'Gateway Timeout - Upstream server failed to respond within 30s',retryAttempts:3,lastRetry:'2024-10-21 14:18:32',stackTrace:'Error: ETIMEDOUT\\n  at TLSSocket.emit (events.js:400:28)\\n  at Socket._onTimeout (net.js:482:8)',recommendations:['Check DMV API server status','Verify network connectivity','Consider increasing timeout threshold','Contact DMV API support if issue persists']},{id:'err002',title:'Auth Token Expired',description:'FBI NCIC API - Token refresh required',time:'12 min ago',severity:'high',api:'FBI NCIC Database',endpoint:'/api/ncic/v1/warrants/search',method:'GET',statusCode:401,requestPayload:{query:'John Doe',jurisdiction:'IL',recordType:'warrant'},errorMessage:'Unauthorized - JWT token expired at 2024-10-21 14:10:00 UTC',retryAttempts:0,lastRetry:null,stackTrace:'Error: 401 Unauthorized\\n  at validateToken (auth.js:156)\\n  at middleware (index.js:89)',recommendations:['Refresh OAuth token using refresh_token','Verify CJIS credentials are still valid','Check token expiration policies','Implement automatic token rotation']}];
            container.innerHTML = errors.map(error => `<div class="p-4 bg-${error.severity === 'critical' ? 'red' : 'yellow'}-600/10 border border-${error.severity === 'critical' ? 'red' : 'yellow'}-500/30 rounded-lg"><div class="flex items-start justify-between mb-2"><div class="flex-1"><div class="text-white font-medium mb-1">${error.title}</div><div class="text-xs text-white/60">${error.description}</div></div><span class="text-xs text-${error.severity === 'critical' ? 'red' : 'yellow'}-400">${error.time}</span></div><div class="flex gap-2 mt-3"><button onclick="retryFromQueue('${error.id}')" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-white text-xs transition-all">${error.id === 'err002' ? 'Refresh Token' : 'Retry'}</button><button onclick="showErrorDetails('${error.id}')" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded text-white text-xs transition-all">View Details</button></div></div>`).join('');
            window.DEAD_LETTER_ERRORS = errors;
        }

        function renderConnectorGallery() {
            const container = document.getElementById('connectorGallery');
            if (!container) return;
            container.innerHTML = MOCK_APIS.map(api => `<div class="glass rounded-xl p-6 hover:scale-105 transition-all cursor-pointer"><div class="flex items-start justify-between mb-3"><div class="flex items-center gap-3"><div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-500 rounded-lg flex items-center justify-center"><i class="fas fa-plug text-white text-xl"></i></div><div><h4 class="font-bold text-white">${api.name}</h4><p class="text-xs text-white/60">${api.category}</p></div></div></div><p class="text-sm text-white/70 mb-3">${api.description}</p><div class="flex gap-1 mb-3 flex-wrap">${api.compliance.map(badge => `<span class="text-xs px-2 py-1 bg-green-500/20 text-green-400 rounded-full border border-green-500/30">${badge}</span>`).join('')}</div><button onclick="installConnector('${api.id}')" class="w-full py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white text-sm font-medium hover:shadow-lg transition-all"><i class="fas fa-download mr-2"></i>Install Connector</button></div>`).join('');
        }

        function showErrorDetails(errorId) {
            const error = window.DEAD_LETTER_ERRORS.find(e => e.id === errorId);
            if (!error) return;
            document.getElementById('modalTitle').textContent = error.title;
            document.getElementById('modalSubtitle').textContent = `${error.api} â€¢ ${error.time}`;
            const modalContent = document.getElementById('modalContent');
            modalContent.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="glass rounded-lg p-4"><div class="text-white/70 text-sm mb-1">Severity</div><div class="text-xl font-bold text-${error.severity === 'critical' ? 'red' : 'yellow'}-400 uppercase">${error.severity}</div></div><div class="glass rounded-lg p-4"><div class="text-white/70 text-sm mb-1">Status Code</div><div class="text-xl font-bold text-white">${error.statusCode}</div></div><div class="glass rounded-lg p-4"><div class="text-white/70 text-sm mb-1">Retry Attempts</div><div class="text-xl font-bold text-white">${error.retryAttempts}/3</div></div></div><div class="glass rounded-lg p-4"><h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-info-circle text-blue-400"></i>Request Details</h4><div class="space-y-2 text-sm"><div class="flex"><span class="text-white/70 w-32">API:</span><span class="text-white font-medium">${error.api}</span></div><div class="flex"><span class="text-white/70 w-32">Endpoint:</span><span class="text-blue-400 font-mono text-xs">${error.endpoint}</span></div><div class="flex"><span class="text-white/70 w-32">Method:</span><span class="text-green-400 font-bold">${error.method}</span></div>${error.lastRetry ? `<div class="flex"><span class="text-white/70 w-32">Last Retry:</span><span class="text-white">${error.lastRetry}</span></div>` : ''}</div></div><div class="glass rounded-lg p-4"><h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-exclamation-circle text-red-400"></i>Error Message</h4><div class="bg-black/30 rounded-lg p-3 text-red-400 font-mono text-xs">${error.errorMessage}</div></div><div class="glass rounded-lg p-4"><h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-code text-purple-400"></i>Request Payload</h4><div class="bg-black/30 rounded-lg p-3 terminal overflow-x-auto"><pre class="text-green-400 text-xs">${JSON.stringify(error.requestPayload, null, 2)}</pre></div></div><div class="glass rounded-lg p-4"><h4 class="text-lg font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-lightbulb text-green-400"></i>Recommendations</h4><ul class="space-y-2">${error.recommendations.map(rec => `<li class="flex items-start gap-2 text-sm"><i class="fas fa-check text-green-400 mt-1"></i><span class="text-white/80">${rec}</span></li>`).join('')}</ul></div>`;
            document.getElementById('errorModal').style.display = 'flex';
            window.currentErrorId = errorId;
        }

        function closeErrorModal() {
            document.getElementById('errorModal').style.display = 'none';
            window.currentErrorId = null;
        }

        function retryError() {
            const errorId = window.currentErrorId;
            if (!errorId) return;
            const error = window.DEAD_LETTER_ERRORS.find(e => e.id === errorId);
            alert(`Retrying: ${error.title}\\n\\nSending request to: ${error.endpoint}\\nMethod: ${error.method}\\n\\nTODO: Connect to retry service`);
            closeErrorModal();
        }

        function escalateError() {
            const errorId = window.currentErrorId;
            if (!errorId) return;
            const error = window.DEAD_LETTER_ERRORS.find(e => e.id === errorId);
            alert(`Escalating to Team\\n\\nError: ${error.title}\\nSeverity: ${error.severity}\\nAPI: ${error.api}\\n\\nNotifications will be sent to:\\nâ€¢ DevOps Team\\nâ€¢ API Support\\nâ€¢ Security Team (CJIS compliance)\\n\\nTODO: Connect to incident management system`);
            closeErrorModal();
        }

        function retryFromQueue(errorId) {
            const error = window.DEAD_LETTER_ERRORS.find(e => e.id === errorId);
            alert(`Retrying: ${error.title}\\n\\nTODO: Connect to retry service`);
        }

        function searchAPIs() {
            const query = document.getElementById('apiSearch').value;
            alert(`Searching for: "${query}"\\n\\nFound ${MOCK_APIS.length} matching APIs\\n\\nTODO: Connect to API catalog search engine`);
        }

        function quickSearch(category) {
            const filtered = MOCK_APIS.filter(api => api.name.toLowerCase().includes(category.toLowerCase()) || api.description.toLowerCase().includes(category.toLowerCase()));
            renderAPIResults(filtered);
        }

        function connectAPI(apiId) {
            const api = MOCK_APIS.find(a => a.id === apiId);
            alert(`Connecting to ${api.name}\\n\\nAuthentication: ${api.auth}\\nRate Limit: ${api.rateLimit}\\n\\nTODO: Open connection wizard with credential configuration`);
        }

        function installConnector(apiId) {
            const api = MOCK_APIS.find(a => a.id === apiId);
            alert(`Installing ${api.name} Connector\\n\\nTODO: Open installation wizard`);
        }

        // Initialize API Integration Platform when tab is opened
        document.addEventListener('DOMContentLoaded', () => {
            const apiTab = document.querySelector('[onclick*="api-integration"]');
            if (apiTab) {
                apiTab.addEventListener('click', () => {
                    setTimeout(() => {
                        renderAPIResults(MOCK_APIS);
                        renderHealthDashboard();
                        renderErrorCategories();
                        renderDeadLetterQueue();
                        renderConnectorGallery();
                    }, 100);
                });
            }
        });
        // ===== END API INTEGRATION PLATFORM =====

        // ===== AUTONOMOUS GOVERNMENT OPERATIONS =====
        // Added 2024-10-31: Module switching function for Autonomous Operations
        function switchAutonomousModule(moduleName) {
            // Hide all modules
            document.querySelectorAll('.autonomous-module-content').forEach(module => {
                module.classList.remove('active');
                module.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.autonomous-module-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected module
            const selectedModule = document.getElementById('autonomous-module-' + moduleName);
            if (selectedModule) {
                selectedModule.classList.add('active');
                selectedModule.classList.remove('hidden');
            }

            // Add active class to selected tab
            const selectedTab = document.querySelector('[data-autonomous-module="' + moduleName + '"]');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
        }
        // ===== END AUTONOMOUS GOVERNMENT OPERATIONS =====

        // ===== GOVERNMENT DIGITAL TWIN =====
        // Added 2024-10-31: Module switching function for Digital Twin
        function switchDigitalTwinModule(moduleName) {
            // MOCK DATA - Replace in production
            // TODO: Connect to real-time government data feeds
            // TODO: Integrate with actual simulation engine API

            // Hide all modules
            document.querySelectorAll('.digital-twin-module-content').forEach(module => {
                module.classList.remove('active');
                module.classList.add('hidden');
            });

            // Remove active class from all tabs
            document.querySelectorAll('.digital-twin-module-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected module
            const selectedModule = document.getElementById('digital-twin-module-' + moduleName);
            if (selectedModule) {
                selectedModule.classList.add('active');
                selectedModule.classList.remove('hidden');
            }

            // Add active class to clicked tab
            event.target.closest('.digital-twin-module-tab').classList.add('active');
        }
        // ===== END GOVERNMENT DIGITAL TWIN =====

        // ===== START PUBLIC ENGAGEMENT PORTAL =====
        // Added 2024-11-04: Public Engagement Portal JavaScript

        // MOCK DATA - Replace in production
        // TODO: Connect to API endpoint /api/public-engagement/*
        const MOCK_PUBLIC_PROJECTS = [
            {
                id: 1,
                name: "Main Street Bridge Reconstruction",
                department: "Department of Transportation",
                status: "In Progress",
                progress: 65,
                budget: 8500000,
                spent: 5525000,
                startDate: "2024-01-15",
                estimatedCompletion: "2024-12-20",
                description: "Complete reconstruction of Main Street Bridge including structural upgrades and pedestrian walkways"
            },
            {
                id: 2,
                name: "City Hall Renovation",
                department: "Public Works",
                status: "Planning",
                progress: 15,
                budget: 12000000,
                spent: 1800000,
                startDate: "2024-06-01",
                estimatedCompletion: "2025-09-30",
                description: "Comprehensive renovation of City Hall building with energy efficiency upgrades"
            },
            {
                id: 3,
                name: "Greenway Trail Expansion",
                department: "Parks & Recreation",
                status: "In Progress",
                progress: 85,
                budget: 3200000,
                spent: 2720000,
                startDate: "2023-09-01",
                estimatedCompletion: "2024-11-15",
                description: "5-mile extension of the existing Greenway Trail system"
            }
        ];

        const MOCK_REQUEST_CATEGORIES = [
            { name: "Potholes & Road Issues", count: 847, percentage: 30 },
            { name: "Trash & Sanitation", count: 624, percentage: 22 },
            { name: "Streetlight Issues", count: 453, percentage: 16 },
            { name: "Building Permits", count: 397, percentage: 14 },
            { name: "Other Services", count: 526, percentage: 18 }
        ];

        const MOCK_RESOLUTION_TIMES = [
            { category: "Potholes", days: 2.1, trend: "down" },
            { category: "Trash Collection", days: 1.5, trend: "stable" },
            { category: "Streetlights", days: 3.2, trend: "down" },
            { category: "Building Permits", days: 5.8, trend: "up" }
        ];

        const MOCK_RECORD_REQUESTS = [
            {
                id: "PR-2024-1247",
                type: "Police Report",
                status: "Processing",
                progress: 60,
                submitted: "2024-10-28",
                estimated: "2024-11-05",
                description: "Traffic accident report from October 15, 2024"
            },
            {
                id: "PR-2024-1198",
                type: "Building Records",
                status: "Ready",
                progress: 100,
                submitted: "2024-10-20",
                completed: "2024-10-25",
                description: "Building permits for 123 Main Street"
            },
            {
                id: "PR-2024-1156",
                type: "Financial Records",
                status: "Under Review",
                progress: 30,
                submitted: "2024-10-15",
                estimated: "2024-11-12",
                description: "City expenditures Q3 2024"
            }
        ];

        const MOCK_COMMUNITY_FEEDBACK = [
            {
                id: 1,
                title: "Install bike lanes on Highland Avenue",
                author: "Sarah Johnson",
                category: "infrastructure",
                status: "Under Review",
                upvotes: 287,
                comments: 42,
                submitted: "2024-10-15",
                description: "Highland Avenue is heavily used by cyclists but lacks dedicated bike lanes. Installing protected bike lanes would improve safety and encourage more cycling.",
                department: "Department of Transportation",
                estimatedCost: "$450,000"
            },
            {
                id: 2,
                title: "Extend library hours on weekends",
                author: "Michael Chen",
                category: "education",
                status: "Implemented",
                upvotes: 423,
                comments: 67,
                submitted: "2024-09-02",
                description: "Many residents work weekdays and would benefit from extended library hours on Saturday and Sunday.",
                department: "Library Services",
                implementedDate: "2024-10-15"
            },
            {
                id: 3,
                title: "Add dog park to Riverside Park",
                author: "Jennifer Martinez",
                category: "recreation",
                status: "Planned",
                upvotes: 512,
                comments: 89,
                submitted: "2024-08-20",
                description: "Riverside Park is perfect for a dedicated dog park area. This would provide a safe space for dogs and create a community gathering spot.",
                department: "Parks & Recreation",
                estimatedCompletion: "Spring 2025"
            },
            {
                id: 4,
                title: "Improve downtown parking availability",
                author: "David Thompson",
                category: "infrastructure",
                status: "New",
                upvotes: 198,
                comments: 34,
                submitted: "2024-10-28",
                description: "Downtown parking is extremely limited during business hours. Consider a multi-story parking structure or better signage for existing lots.",
                department: "Parking Authority"
            }
        ];

        const MOCK_LIVE_MEETINGS = [
            {
                id: 1,
                title: "City Council Regular Meeting",
                type: "City Council",
                viewers: 342,
                started: "7:00 PM",
                agenda: ["Budget Discussion", "Zoning Changes", "Public Comments"]
            },
            {
                id: 2,
                title: "Planning Commission Public Hearing",
                type: "Planning Commission",
                viewers: 87,
                started: "6:30 PM",
                agenda: ["Residential Development Proposal", "Environmental Impact Review"]
            }
        ];

        const MOCK_UPCOMING_MEETINGS = [
            {
                id: 1,
                title: "Town Hall: Climate Action Plan",
                date: "2024-11-08",
                time: "7:00 PM",
                location: "City Hall Auditorium / Virtual",
                description: "Discuss the city's new climate action plan and hear community input",
                rsvp: 234
            },
            {
                id: 2,
                title: "Budget Workshop Session",
                date: "2024-11-12",
                time: "6:00 PM",
                location: "Council Chambers / Virtual",
                description: "Review proposed budget for fiscal year 2025",
                rsvp: 89
            },
            {
                id: 3,
                title: "Parks & Recreation Master Plan Meeting",
                date: "2024-11-15",
                time: "7:30 PM",
                location: "Community Center / Virtual",
                description: "Present the 10-year parks and recreation master plan",
                rsvp: 156
            }
        ];

        const MOCK_PAST_MEETINGS = [
            {
                id: 1,
                title: "City Council Meeting - October 28",
                date: "2024-10-28",
                duration: "2h 15m",
                views: 1247
            },
            {
                id: 2,
                title: "Transportation Committee - October 25",
                date: "2024-10-25",
                duration: "1h 45m",
                views: 423
            },
            {
                id: 3,
                title: "Public Safety Forum - October 22",
                date: "2024-10-22",
                duration: "2h 30m",
                views: 892
            }
        ];

        const MOCK_DATASETS = [
            {
                id: 1,
                name: "Crime Statistics 2024",
                category: "public-safety",
                description: "Comprehensive crime data including incidents, types, locations, and trends",
                format: ["CSV", "JSON", "API"],
                size: "12.4 MB",
                lastUpdated: "2024-11-03",
                downloads: 2847,
                featured: true
            },
            {
                id: 2,
                name: "Building Permits Database",
                category: "public-works",
                description: "All building permits issued from 2020-2024 including type, location, and value",
                format: ["CSV", "JSON"],
                size: "8.7 MB",
                lastUpdated: "2024-11-02",
                downloads: 1523,
                featured: true
            },
            {
                id: 3,
                name: "Traffic Volume Data",
                category: "transportation",
                description: "Real-time and historical traffic volume data from city sensors",
                format: ["CSV", "API"],
                size: "45.2 MB",
                lastUpdated: "2024-11-04",
                downloads: 4291,
                featured: true
            },
            {
                id: 4,
                name: "City Budget FY2024",
                category: "finance",
                description: "Complete city budget including revenues, expenditures, and department allocations",
                format: ["CSV", "JSON", "XML"],
                size: "3.2 MB",
                lastUpdated: "2024-07-01",
                downloads: 1876
            },
            {
                id: 5,
                name: "Environmental Monitoring",
                category: "environment",
                description: "Air quality, water quality, and environmental sensor data",
                format: ["CSV", "JSON", "API"],
                size: "23.8 MB",
                lastUpdated: "2024-11-03",
                downloads: 923
            }
        ];

        // Initialize on switchTab when citizen tab is activated
        let publicEngagementInitialized = false;

        function initializePublicEngagement() {
            if (publicEngagementInitialized) return;

            // Populate transparency dashboard
            populatePublicProjects();
            populateRequestCategories();
            populateResolutionTimes();

            // Populate public records
            populateRecordRequests();

            // Populate community feedback
            populateCommunityFeedback();

            // Populate meetings
            populateLiveMeetings();
            populateUpcomingMeetings();
            populatePastMeetings();

            // Populate open data
            populateFeaturedDatasets();
            populateAllDatasets();

            publicEngagementInitialized = true;
            console.log('Public Engagement Portal initialized');
        }

        function switchEngagementModule(moduleName) {
            // Remove active class from all tabs
            document.querySelectorAll('.engagement-tab-button').forEach(tab => {
                tab.classList.remove('active');
            });

            // Add active class to clicked tab
            const clickedTab = document.querySelector(`[data-engagement-module="${moduleName}"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }

            // Hide all modules
            document.querySelectorAll('.engagement-module-content').forEach(module => {
                module.classList.remove('active');
            });

            // Show selected module
            const selectedModule = document.getElementById(`engagement-module-${moduleName}`);
            if (selectedModule) {
                selectedModule.classList.add('active');
            }

            console.log(`Switched to engagement module: ${moduleName}`);
        }

        function populatePublicProjects() {
            const container = document.getElementById('publicProjectsList');
            if (!container) return;

            container.innerHTML = MOCK_PUBLIC_PROJECTS.map(project => `
                <div class="glass-dark rounded-lg p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h4 class="text-white font-bold text-lg mb-1">${project.name}</h4>
                            <p class="text-white/60 text-sm">${project.department}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                            project.status === 'In Progress' ? 'bg-blue-500/20 text-blue-400' :
                            project.status === 'Planning' ? 'bg-yellow-500/20 text-yellow-400' :
                            'bg-green-500/20 text-green-400'
                        }">${project.status}</span>
                    </div>
                    <p class="text-white/70 text-sm mb-4">${project.description}</p>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <div class="text-white/50 text-xs mb-1">Budget</div>
                            <div class="text-white font-semibold">$${(project.budget / 1000000).toFixed(1)}M</div>
                        </div>
                        <div>
                            <div class="text-white/50 text-xs mb-1">Spent</div>
                            <div class="text-green-400 font-semibold">$${(project.spent / 1000000).toFixed(1)}M</div>
                        </div>
                        <div>
                            <div class="text-white/50 text-xs mb-1">Started</div>
                            <div class="text-white text-sm">${new Date(project.startDate).toLocaleDateString()}</div>
                        </div>
                        <div>
                            <div class="text-white/50 text-xs mb-1">Est. Completion</div>
                            <div class="text-white text-sm">${new Date(project.estimatedCompletion).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="flex justify-between text-xs mb-1">
                            <span class="text-white/60">Progress</span>
                            <span class="text-white font-medium">${project.progress}%</span>
                        </div>
                        <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-gradient-to-r from-blue-500 to-green-400 transition-all" style="width: ${project.progress}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function populateRequestCategories() {
            const container = document.getElementById('topRequestCategories');
            if (!container) return;

            container.innerHTML = MOCK_REQUEST_CATEGORIES.map(cat => `
                <div class="flex items-center justify-between text-sm">
                    <span class="text-white/80">${cat.name}</span>
                    <div class="flex items-center gap-2">
                        <div class="w-20 h-2 bg-white/10 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500" style="width: ${cat.percentage}%"></div>
                        </div>
                        <span class="text-white font-medium w-12 text-right">${cat.count}</span>
                    </div>
                </div>
            `).join('');
        }

        function populateResolutionTimes() {
            const container = document.getElementById('resolutionTimes');
            if (!container) return;

            container.innerHTML = MOCK_RESOLUTION_TIMES.map(item => `
                <div class="flex items-center justify-between text-sm">
                    <span class="text-white/80">${item.category}</span>
                    <div class="flex items-center gap-2">
                        <span class="text-white font-medium">${item.days} days</span>
                        <i class="fas fa-arrow-${item.trend === 'down' ? 'down text-green-400' : item.trend === 'up' ? 'up text-red-400' : 'right text-white/50'}"></i>
                    </div>
                </div>
            `).join('');
        }

        function populateRecordRequests() {
            const container = document.getElementById('myRecordRequestsList');
            if (!container) return;

            container.innerHTML = MOCK_RECORD_REQUESTS.map(request => `
                <div class="glass-dark rounded-lg p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <div class="text-white font-bold mb-1">${request.id}</div>
                            <div class="text-white/60 text-sm">${request.type}</div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                            request.status === 'Ready' ? 'bg-green-500/20 text-green-400' :
                            request.status === 'Processing' ? 'bg-blue-500/20 text-blue-400' :
                            'bg-yellow-500/20 text-yellow-400'
                        }">${request.status}</span>
                    </div>
                    <p class="text-white/70 text-sm mb-4">${request.description}</p>
                    <div class="grid grid-cols-2 gap-4 mb-3">
                        <div>
                            <div class="text-white/50 text-xs mb-1">Submitted</div>
                            <div class="text-white text-sm">${new Date(request.submitted).toLocaleDateString()}</div>
                        </div>
                        <div>
                            <div class="text-white/50 text-xs mb-1">${request.status === 'Ready' ? 'Completed' : 'Estimated'}</div>
                            <div class="text-white text-sm">${new Date(request.estimated || request.completed).toLocaleDateString()}</div>
                        </div>
                    </div>
                    ${request.status !== 'Ready' ? `
                        <div>
                            <div class="flex justify-between text-xs mb-1">
                                <span class="text-white/60">Progress</span>
                                <span class="text-white font-medium">${request.progress}%</span>
                            </div>
                            <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                                <div class="h-full bg-gradient-to-r from-blue-500 to-purple-400" style="width: ${request.progress}%"></div>
                            </div>
                        </div>
                    ` : `
                        <button class="w-full px-4 py-2 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                            <i class="fas fa-download mr-2"></i>Download Documents
                        </button>
                    `}
                </div>
            `).join('');
        }

        function populateCommunityFeedback() {
            const container = document.getElementById('communityFeedbackList');
            if (!container) return;

            container.innerHTML = MOCK_COMMUNITY_FEEDBACK.map(feedback => `
                <div class="glass rounded-xl p-6">
                    <div class="flex gap-4">
                        <!-- Upvote Section -->
                        <div class="flex flex-col items-center">
                            <button class="upvote-button w-12 h-12 rounded-lg bg-white/10 flex items-center justify-center mb-2" onclick="toggleUpvote(${feedback.id})">
                                <i class="fas fa-arrow-up text-white"></i>
                            </button>
                            <div class="text-white font-bold">${feedback.upvotes}</div>
                        </div>

                        <!-- Feedback Content -->
                        <div class="flex-1">
                            <div class="flex items-start justify-between mb-2">
                                <div>
                                    <h4 class="text-white font-bold text-lg mb-1">${feedback.title}</h4>
                                    <div class="flex items-center gap-3 text-sm text-white/60">
                                        <span><i class="fas fa-user mr-1"></i>${feedback.author}</span>
                                        <span><i class="fas fa-calendar mr-1"></i>${new Date(feedback.submitted).toLocaleDateString()}</span>
                                        <span class="px-2 py-1 rounded bg-white/10 text-xs">${feedback.category}</span>
                                    </div>
                                </div>
                                <span class="px-3 py-1 rounded-full text-xs font-semibold ${
                                    feedback.status === 'Implemented' ? 'bg-green-500/20 text-green-400' :
                                    feedback.status === 'Planned' ? 'bg-purple-500/20 text-purple-400' :
                                    feedback.status === 'Under Review' ? 'bg-blue-500/20 text-blue-400' :
                                    'bg-white/20 text-white'
                                }">${feedback.status}</span>
                            </div>
                            <p class="text-white/80 mb-4">${feedback.description}</p>
                            <div class="flex items-center gap-4">
                                <button class="text-blue-400 hover:text-blue-300 text-sm">
                                    <i class="fas fa-comment mr-1"></i>${feedback.comments} Comments
                                </button>
                                <button class="text-white/60 hover:text-white text-sm">
                                    <i class="fas fa-share mr-1"></i>Share
                                </button>
                                ${feedback.department ? `<span class="text-white/50 text-xs ml-auto"><i class="fas fa-building mr-1"></i>${feedback.department}</span>` : ''}
                            </div>
                            ${feedback.implementedDate ? `
                                <div class="mt-3 p-3 bg-green-500/10 border border-green-500/30 rounded-lg">
                                    <div class="text-green-400 text-sm font-semibold mb-1">
                                        <i class="fas fa-check-circle mr-2"></i>Implemented ${new Date(feedback.implementedDate).toLocaleDateString()}
                                    </div>
                                    <div class="text-white/70 text-xs">This suggestion has been implemented. Thank you for your input!</div>
                                </div>
                            ` : ''}
                            ${feedback.estimatedCompletion ? `
                                <div class="mt-3 p-3 bg-purple-500/10 border border-purple-500/30 rounded-lg">
                                    <div class="text-purple-400 text-sm font-semibold mb-1">
                                        <i class="fas fa-calendar-check mr-2"></i>Planned for ${feedback.estimatedCompletion}
                                    </div>
                                    <div class="text-white/70 text-xs">Estimated cost: ${feedback.estimatedCost}</div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function populateLiveMeetings() {
            const container = document.getElementById('liveMeetingsList');
            if (!container) return;

            container.innerHTML = MOCK_LIVE_MEETINGS.map(meeting => `
                <div class="glass-dark rounded-lg p-5">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-3 h-3 bg-red-400 rounded-full live-indicator"></div>
                        <span class="text-red-400 text-sm font-semibold">LIVE</span>
                        <span class="text-white/50 text-sm ml-auto">${meeting.viewers} watching</span>
                    </div>
                    <h4 class="text-white font-bold text-lg mb-2">${meeting.title}</h4>
                    <div class="text-white/60 text-sm mb-3">Started at ${meeting.started}</div>
                    <div class="mb-4">
                        <div class="text-white/70 text-sm mb-2">Agenda:</div>
                        <ul class="space-y-1">
                            ${meeting.agenda.map(item => `<li class="text-white/60 text-sm"><i class="fas fa-check-circle text-green-400 mr-2"></i>${item}</li>`).join('')}
                        </ul>
                    </div>
                    <button class="w-full px-4 py-3 bg-gradient-to-r from-red-600 to-pink-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                        <i class="fas fa-play mr-2"></i>Join Live Stream
                    </button>
                </div>
            `).join('');
        }

        function populateUpcomingMeetings() {
            const container = document.getElementById('upcomingMeetingsList');
            if (!container) return;

            container.innerHTML = MOCK_UPCOMING_MEETINGS.map(meeting => `
                <div class="glass-dark rounded-lg p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <h4 class="text-white font-bold text-lg mb-2">${meeting.title}</h4>
                            <div class="flex flex-wrap gap-4 text-sm text-white/60 mb-2">
                                <span><i class="fas fa-calendar mr-2"></i>${new Date(meeting.date).toLocaleDateString()}</span>
                                <span><i class="fas fa-clock mr-2"></i>${meeting.time}</span>
                                <span><i class="fas fa-map-marker-alt mr-2"></i>${meeting.location}</span>
                            </div>
                            <p class="text-white/70 text-sm mb-3">${meeting.description}</p>
                            <div class="text-blue-400 text-xs"><i class="fas fa-users mr-1"></i>${meeting.rsvp} people registered</div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button class="flex-1 px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                            <i class="fas fa-calendar-plus mr-2"></i>Add to Calendar
                        </button>
                        <button class="flex-1 px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white font-semibold hover:bg-white/20 transition-all">
                            <i class="fas fa-bell mr-2"></i>Remind Me
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function populatePastMeetings() {
            const container = document.getElementById('pastMeetingsList');
            if (!container) return;

            container.innerHTML = MOCK_PAST_MEETINGS.map(meeting => `
                <div class="glass-dark rounded-lg p-4 hover:scale-105 transition-all cursor-pointer">
                    <h4 class="text-white font-semibold mb-2">${meeting.title}</h4>
                    <div class="text-white/60 text-xs mb-2">${new Date(meeting.date).toLocaleDateString()}</div>
                    <div class="flex justify-between items-center text-xs text-white/50">
                        <span><i class="fas fa-clock mr-1"></i>${meeting.duration}</span>
                        <span><i class="fas fa-eye mr-1"></i>${meeting.views} views</span>
                    </div>
                    <button class="w-full mt-3 px-3 py-2 bg-white/10 rounded-lg text-white text-sm hover:bg-white/20 transition-all">
                        <i class="fas fa-play mr-2"></i>Watch Recording
                    </button>
                </div>
            `).join('');
        }

        function populateFeaturedDatasets() {
            const container = document.getElementById('featuredDatasetsList');
            if (!container) return;

            const featured = MOCK_DATASETS.filter(d => d.featured);
            container.innerHTML = featured.map(dataset => `
                <div class="glass-dark rounded-lg p-5 hover:scale-105 transition-all">
                    <div class="flex items-start justify-between mb-3">
                        <h4 class="text-white font-bold">${dataset.name}</h4>
                        <i class="fas fa-star text-yellow-400"></i>
                    </div>
                    <p class="text-white/70 text-sm mb-4">${dataset.description}</p>
                    <div class="grid grid-cols-2 gap-2 text-xs mb-4">
                        <div>
                            <span class="text-white/50">Size:</span>
                            <span class="text-white ml-1">${dataset.size}</span>
                        </div>
                        <div>
                            <span class="text-white/50">Downloads:</span>
                            <span class="text-white ml-1">${dataset.downloads.toLocaleString()}</span>
                        </div>
                        <div class="col-span-2">
                            <span class="text-white/50">Updated:</span>
                            <span class="text-white ml-1">${new Date(dataset.lastUpdated).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="flex gap-1 mb-3">
                        ${dataset.format.map(fmt => `<span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">${fmt}</span>`).join('')}
                    </div>
                    <button class="w-full px-4 py-2 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg text-white text-sm font-semibold hover:shadow-lg transition-all">
                        <i class="fas fa-download mr-2"></i>Download
                    </button>
                </div>
            `).join('');
        }

        function populateAllDatasets() {
            const container = document.getElementById('allDatasetsList');
            if (!container) return;

            container.innerHTML = MOCK_DATASETS.map(dataset => `
                <div class="glass-dark rounded-lg p-4 flex items-center justify-between hover:bg-white/15 transition-all">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h4 class="text-white font-semibold">${dataset.name}</h4>
                            ${dataset.featured ? '<i class="fas fa-star text-yellow-400 text-xs"></i>' : ''}
                        </div>
                        <p class="text-white/60 text-sm mb-2">${dataset.description}</p>
                        <div class="flex gap-4 text-xs text-white/50">
                            <span><i class="fas fa-hdd mr-1"></i>${dataset.size}</span>
                            <span><i class="fas fa-download mr-1"></i>${dataset.downloads.toLocaleString()}</span>
                            <span><i class="fas fa-clock mr-1"></i>${new Date(dataset.lastUpdated).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        ${dataset.format.map(fmt => `<span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs">${fmt}</span>`).join('')}
                        <button class="px-4 py-2 bg-gradient-to-r from-green-600 to-blue-600 rounded-lg text-white text-sm font-semibold hover:shadow-lg transition-all">
                            <i class="fas fa-download mr-2"></i>Download
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // TODO: Connect to API endpoint /api/public-records/request
        function openNewRecordRequestModal() {
            alert('New Public Records Request modal would open here. TODO: Implement modal UI.');
            console.log('Opening new record request modal');
        }

        // TODO: Connect to API endpoint /api/community-feedback/submit
        function openNewFeedbackModal() {
            alert('New Community Feedback modal would open here. TODO: Implement modal UI.');
            console.log('Opening new feedback modal');
        }

        // TODO: Connect to API endpoint /api/datasets/suggest
        function suggestDataset() {
            alert('Dataset suggestion modal would open here. TODO: Implement modal UI.');
            console.log('Opening dataset suggestion modal');
        }

        function quickRecordRequest(type) {
            alert(`Quick record request for ${type}. TODO: Implement quick request flow.`);
            console.log(`Quick record request: ${type}`);
        }

        // TODO: Connect to API endpoint /api/community-feedback/upvote
        // SECURITY TODO: Validate user authentication before allowing upvotes
        function toggleUpvote(id) {
            const button = event.target.closest('.upvote-button');
            if (button) {
                button.classList.toggle('voted');
                console.log(`Toggled upvote for feedback ${id}`);
            }
        }

        // Enhanced switchTab to initialize public engagement
        const originalSwitchTabForEngagement = switchTab;
        switchTab = function(tabName) {
            originalSwitchTabForEngagement(tabName);
            if (tabName === 'citizen') {
                initializePublicEngagement();
            }
        };
        // ===== END PUBLIC ENGAGEMENT PORTAL =====

        // ===== SECUREMESH JAVASCRIPT =====
        // Added 2024-11-06: SecureMesh Secure Communications Platform

        // MOCK DATA - Replace in production
        // TODO: Connect to WebSocket server for real-time communications
        // TODO: Connect to AI NLP API endpoint /api/ai/classify
        // TODO: Connect to blockchain verification service /api/blockchain/verify
        // SECURITY TODO: Implement clearance-based access control

        const MOCK_CONVERSATIONS = [
            {
                id: 1,
                name: "Chief Sarah Martinez",
                department: "Police Department",
                clearance: "secret",
                lastMessage: "Emergency response protocols updated",
                timestamp: "2024-11-06T14:30:00Z",
                unread: 2,
                online: true
            },
            {
                id: 2,
                name: "Fire Chief Robert Johnson",
                department: "Fire & Rescue",
                clearance: "confidential",
                lastMessage: "Equipment inspection scheduled",
                timestamp: "2024-11-06T13:15:00Z",
                unread: 0,
                online: true
            },
            {
                id: 3,
                name: "Director Jennifer Lee",
                department: "Emergency Management",
                clearance: "top-secret",
                lastMessage: "Critical infrastructure assessment",
                timestamp: "2024-11-06T12:45:00Z",
                unread: 5,
                online: false
            },
            {
                id: 4,
                name: "Captain Michael Davis",
                department: "State Police",
                clearance: "secret",
                lastMessage: "Task force meeting tomorrow",
                timestamp: "2024-11-06T11:20:00Z",
                unread: 1,
                online: true
            }
        ];

        const MOCK_MESSAGES = [
            {
                id: 1,
                sender: "Chief Sarah Martinez",
                content: "We need to coordinate on the emergency response drill scheduled for next week.",
                timestamp: "2024-11-06T14:25:00Z",
                classification: "confidential",
                sentiment: "neutral",
                urgency: "medium",
                blockchainHash: "0x7f9fade1c0d57a7af66ab4ead7c2c2fb7b3df2f3a17bdf4e1a3a3b8e2b1e4c5d",
                verified: true,
                sent: false
            },
            {
                id: 2,
                sender: "me",
                content: "Agreed. I've reviewed the protocols and we're ready on our end. All units will be briefed by Friday.",
                timestamp: "2024-11-06T14:27:00Z",
                classification: "confidential",
                sentiment: "positive",
                urgency: "medium",
                blockchainHash: "0x8a1fade2d1e68b8bg77bc5fbe8d3d3gc8c4eg3g4b28ceg5f2b4b4c9f3c2f5d6e",
                verified: true,
                sent: true
            },
            {
                id: 3,
                sender: "Chief Sarah Martinez",
                content: "Excellent. Let's ensure all communication channels are tested before the drill.",
                timestamp: "2024-11-06T14:30:00Z",
                classification: "confidential",
                sentiment: "positive",
                urgency: "medium",
                blockchainHash: "0x9b2gbef3e2f79c9ch88cd6gde9e4e4hd9d5fh4h5c39dfh6g3c5c5d0g4d3g6e7f",
                verified: true,
                sent: false
            }
        ];

        const MOCK_CHANNELS = [
            {
                id: 1,
                name: "Law Enforcement Coordination",
                department: "Multi-Agency",
                members: 247,
                clearance: "secret",
                lastActivity: "5m ago",
                unread: 12
            },
            {
                id: 2,
                name: "Fire & EMS Operations",
                department: "Public Safety",
                members: 189,
                clearance: "confidential",
                lastActivity: "12m ago",
                unread: 3
            },
            {
                id: 3,
                name: "Public Works Updates",
                department: "Infrastructure",
                members: 156,
                clearance: "unclassified",
                lastActivity: "1h ago",
                unread: 0
            },
            {
                id: 4,
                name: "IT Security Team",
                department: "Technology",
                members: 34,
                clearance: "secret",
                lastActivity: "3h ago",
                unread: 8
            }
        ];

        const MOCK_EMERGENCY_CHANNELS = [
            {
                id: 1,
                name: "CRITICAL: Active Incident",
                status: "active",
                clearance: "top-secret",
                members: 45,
                priority: "high"
            },
            {
                id: 2,
                name: "Emergency Operations Center",
                status: "standby",
                clearance: "secret",
                members: 128,
                priority: "medium"
            }
        ];

        const MOCK_DIRECTORY = [
            {
                id: 1,
                name: "Sarah Martinez",
                title: "Chief of Police",
                department: "Police Department",
                clearance: "secret",
                phone: "(555) 123-4567",
                email: "s.martinez@city.gov",
                online: true
            },
            {
                id: 2,
                name: "Robert Johnson",
                title: "Fire Chief",
                department: "Fire & Rescue",
                clearance: "confidential",
                phone: "(555) 234-5678",
                email: "r.johnson@city.gov",
                online: true
            },
            {
                id: 3,
                name: "Jennifer Lee",
                title: "Emergency Management Director",
                department: "Emergency Management",
                clearance: "top-secret",
                phone: "(555) 345-6789",
                email: "j.lee@city.gov",
                online: false
            },
            {
                id: 4,
                name: "Michael Davis",
                title: "State Police Captain",
                department: "State Police",
                clearance: "secret",
                phone: "(555) 456-7890",
                email: "m.davis@state.gov",
                online: true
            },
            {
                id: 5,
                name: "Amanda Rodriguez",
                title: "Public Works Director",
                department: "Public Works",
                clearance: "confidential",
                phone: "(555) 567-8901",
                email: "a.rodriguez@city.gov",
                online: false
            },
            {
                id: 6,
                name: "David Chen",
                title: "IT Security Manager",
                department: "Technology Services",
                clearance: "secret",
                phone: "(555) 678-9012",
                email: "d.chen@city.gov",
                online: true
            }
        ];

        const MOCK_AUDIT_LOGS = [
            {
                id: 1,
                action: "Message Sent",
                user: "Chief Sarah Martinez",
                timestamp: "2024-11-06T14:30:15Z",
                classification: "confidential",
                blockchainHash: "0x9b2gbef3e2f79c9ch88cd6gde9e4e4hd9d5fh4h5c39dfh6g3c5c5d0g4d3g6e7f",
                verified: true
            },
            {
                id: 2,
                action: "Channel Created",
                user: "System Administrator",
                timestamp: "2024-11-06T14:15:42Z",
                classification: "unclassified",
                blockchainHash: "0x8a1fade2d1e68b8bg77bc5fbe8d3d3gc8c4eg3g4b28ceg5f2b4b4c9f3c2f5d6e",
                verified: true
            },
            {
                id: 3,
                action: "Clearance Verification",
                user: "Jennifer Lee",
                timestamp: "2024-11-06T14:00:23Z",
                classification: "top-secret",
                blockchainHash: "0x7f9fade1c0d57a7af66ab4ead7c2c2fb7b3df2f3a17bdf4e1a3a3b8e2b1e4c5d",
                verified: true
            },
            {
                id: 4,
                action: "Message Read",
                user: "Michael Davis",
                timestamp: "2024-11-06T13:45:10Z",
                classification: "secret",
                blockchainHash: "0x6e8ecde0b1c46a6ae55ab3dbd6c1b1ea6a2ce1e2a06ace3d0a2a2a7d1a0d3b4c",
                verified: true
            }
        ];

        // AI Classification Keywords and Rules
        // TODO: Replace with actual NLP model
        const CLASSIFICATION_KEYWORDS = {
            'top-secret': ['classified', 'critical infrastructure', 'national security', 'intelligence', 'covert'],
            'secret': ['restricted', 'law enforcement sensitive', 'investigation', 'surveillance', 'tactical'],
            'confidential': ['internal', 'department only', 'personnel', 'budget', 'planning'],
            'unclassified': ['public', 'general', 'routine', 'administrative']
        };

        const SENTIMENT_KEYWORDS = {
            positive: ['excellent', 'great', 'good', 'ready', 'agreed', 'thank', 'appreciate'],
            negative: ['urgent', 'critical', 'emergency', 'problem', 'issue', 'concern', 'delay'],
            neutral: ['update', 'meeting', 'scheduled', 'review', 'coordinate']
        };

        const URGENCY_KEYWORDS = {
            high: ['urgent', 'immediate', 'critical', 'emergency', 'asap', 'now'],
            medium: ['soon', 'today', 'this week', 'coordinate', 'schedule'],
            low: ['eventually', 'when possible', 'routine', 'general', 'fyi']
        };

        // Initialize on page load
        let secureMeshInitialized = false;

        // Enhanced switchTab to initialize SecureMesh
        const originalSwitchTabForSecureMesh = switchTab;
        switchTab = function(tabName) {
            originalSwitchTabForSecureMesh(tabName);
            if (tabName === 'securemesh') {
                initializeSecureMesh();
            }
        };

        function initializeSecureMesh() {
            if (secureMeshInitialized) return;

            // Populate all modules
            populateConversations();
            populateMessages();
            populateChannels();
            populateDirectory();
            populateAuditLogs();

            secureMeshInitialized = true;
            console.log('SecureMesh initialized');
        }

        function switchMeshModule(moduleName) {
            // Remove active class from all tabs
            document.querySelectorAll('.mesh-tab-button').forEach(tab => {
                tab.classList.remove('active');
            });

            // Add active class to clicked tab
            const clickedTab = document.querySelector(`[data-mesh-module="${moduleName}"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }

            // Hide all modules
            document.querySelectorAll('.mesh-module-content').forEach(module => {
                module.classList.remove('active');
            });

            // Show selected module
            const selectedModule = document.getElementById(`mesh-module-${moduleName}`);
            if (selectedModule) {
                selectedModule.classList.add('active');
            }

            console.log(`Switched to SecureMesh module: ${moduleName}`);
        }

        function populateConversations() {
            const container = document.getElementById('conversationsList');
            if (!container) return;

            container.innerHTML = MOCK_CONVERSATIONS.map(conv => `
                <div class="glass-dark rounded-lg p-3 hover:bg-white/15 transition-all cursor-pointer" onclick="selectConversation(${conv.id})">
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                <span class="text-white font-bold text-sm">${conv.name.split(' ').map(n => n[0]).join('')}</span>
                            </div>
                            ${conv.online ? '<div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-gray-900"></div>' : ''}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between mb-1">
                                <div class="text-white font-semibold text-sm truncate">${conv.name}</div>
                                ${conv.unread > 0 ? `<span class="bg-blue-500 text-white text-xs font-bold px-2 py-0.5 rounded-full">${conv.unread}</span>` : ''}
                            </div>
                            <div class="text-white/60 text-xs truncate">${conv.lastMessage}</div>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="px-2 py-0.5 rounded-full text-xs clearance-${conv.clearance}">${conv.clearance.toUpperCase()}</span>
                                <span class="text-white/40 text-xs">${formatTimestamp(conv.timestamp)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function populateMessages() {
            const container = document.getElementById('messagesArea');
            if (!container) return;

            container.innerHTML = MOCK_MESSAGES.map(msg => `
                <div class="flex ${msg.sent ? 'justify-end' : 'justify-start'}">
                    <div class="${msg.sent ? 'message-sent' : 'message-received'} max-w-md p-4">
                        ${!msg.sent ? `<div class="text-white/80 text-xs font-semibold mb-1">${msg.sender}</div>` : ''}
                        <div class="text-white mb-2">${msg.content}</div>
                        <div class="flex items-center justify-between gap-3 text-xs">
                            <div class="flex items-center gap-2">
                                <span class="text-white/60">${formatTimestamp(msg.timestamp)}</span>
                                <span class="px-2 py-0.5 rounded-full clearance-${msg.classification}">${msg.classification.toUpperCase()}</span>
                            </div>
                            <div class="flex items-center gap-1">
                                <i class="fas fa-smile sentiment-${msg.sentiment}" title="Sentiment: ${msg.sentiment}"></i>
                                <span class="px-1.5 py-0.5 rounded text-xs urgency-${msg.urgency}">${msg.urgency[0].toUpperCase()}</span>
                                ${msg.verified ? '<i class="fas fa-check-circle text-green-400" title="Blockchain verified"></i>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function populateChannels() {
            const channelsContainer = document.getElementById('channelsList');
            const emergencyContainer = document.getElementById('emergencyChannelsList');

            if (channelsContainer) {
                channelsContainer.innerHTML = MOCK_CHANNELS.map(channel => `
                    <div class="glass-dark rounded-lg p-4 hover:scale-105 transition-all cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-hashtag text-blue-400"></i>
                                <span class="text-white font-semibold">${channel.name}</span>
                            </div>
                            ${channel.unread > 0 ? `<span class="bg-blue-500 text-white text-xs font-bold px-2 py-1 rounded-full">${channel.unread}</span>` : ''}
                        </div>
                        <div class="text-white/60 text-sm mb-3">${channel.department}</div>
                        <div class="flex items-center justify-between text-xs">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users text-white/50"></i>
                                <span class="text-white/70">${channel.members} members</span>
                            </div>
                            <span class="px-2 py-1 rounded-full clearance-${channel.clearance}">${channel.clearance.toUpperCase()}</span>
                        </div>
                        <div class="text-white/40 text-xs mt-2">Last activity: ${channel.lastActivity}</div>
                    </div>
                `).join('');
            }

            if (emergencyContainer) {
                emergencyContainer.innerHTML = MOCK_EMERGENCY_CHANNELS.map(channel => `
                    <div class="glass-dark rounded-lg p-4 border-2 ${channel.status === 'active' ? 'border-red-500' : 'border-yellow-500'} hover:scale-105 transition-all cursor-pointer">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-exclamation-triangle ${channel.status === 'active' ? 'text-red-400' : 'text-yellow-400'}"></i>
                                <span class="text-white font-bold">${channel.name}</span>
                            </div>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${channel.status === 'active' ? 'bg-red-500/20 text-red-400' : 'bg-yellow-500/20 text-yellow-400'}">${channel.status.toUpperCase()}</span>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-users text-white/50"></i>
                                <span class="text-white/70">${channel.members} active</span>
                            </div>
                            <span class="px-2 py-1 rounded-full clearance-${channel.clearance}">${channel.clearance.toUpperCase()}</span>
                        </div>
                    </div>
                `).join('');
            }
        }

        function populateDirectory() {
            const container = document.getElementById('directoryGrid');
            if (!container) return;

            container.innerHTML = MOCK_DIRECTORY.map(person => `
                <div class="glass rounded-xl p-6 hover:scale-105 transition-all">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="relative">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                    <span class="text-white font-bold">${person.name.split(' ').map(n => n[0]).join('')}</span>
                                </div>
                                ${person.online ? '<div class="absolute bottom-0 right-0 w-3 h-3 bg-green-400 rounded-full border-2 border-gray-900"></div>' : ''}
                            </div>
                            <div>
                                <div class="text-white font-bold">${person.name}</div>
                                <div class="text-white/60 text-sm">${person.title}</div>
                            </div>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold clearance-${person.clearance}">${person.clearance.toUpperCase()}</span>
                    </div>
                    <div class="space-y-2 mb-4">
                        <div class="text-white/70 text-sm">${person.department}</div>
                        <div class="text-white/60 text-xs flex items-center gap-2">
                            <i class="fas fa-phone"></i>
                            ${person.phone}
                        </div>
                        <div class="text-white/60 text-xs flex items-center gap-2">
                            <i class="fas fa-envelope"></i>
                            ${person.email}
                        </div>
                    </div>
                    <button onclick="startConversationWith(${person.id})" class="w-full px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white font-semibold hover:shadow-lg transition-all">
                        <i class="fas fa-comment mr-2"></i>Message
                    </button>
                </div>
            `).join('');
        }

        function populateAuditLogs() {
            const container = document.getElementById('auditLogsList');
            if (!container) return;

            container.innerHTML = MOCK_AUDIT_LOGS.map(log => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                                <i class="fas fa-file-alt text-blue-400"></i>
                            </div>
                            <div>
                                <div class="text-white font-semibold">${log.action}</div>
                                <div class="text-white/60 text-sm">${log.user}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-white/70 text-xs">${formatTimestamp(log.timestamp)}</div>
                            <span class="px-2 py-1 rounded-full text-xs clearance-${log.classification}">${log.classification.toUpperCase()}</span>
                        </div>
                    </div>
                    <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/10">
                        <div class="text-white/50 text-xs font-mono">${log.blockchainHash}</div>
                        ${log.verified ? '<i class="fas fa-check-circle text-green-400 blockchain-verified" title="Blockchain verified"></i>' : ''}
                    </div>
                </div>
            `).join('');
        }

        // TODO: Connect to WebSocket for real-time messaging
        function sendMessage() {
            const input = document.getElementById('messageInput');
            if (!input || !input.value.trim()) return;

            const message = input.value.trim();

            // AI Classification
            const classification = classifyMessage(message);
            const sentiment = analyzeSentiment(message);
            const urgency = detectUrgency(message);

            console.log('Message sent:', {
                content: message,
                classification,
                sentiment,
                urgency,
                timestamp: new Date().toISOString()
            });

            // Show AI classification
            showAIClassification(classification, sentiment, urgency);

            // Clear input
            input.value = '';

            // TODO: Send to backend via WebSocket
            // TODO: Generate blockchain hash
            // SECURITY TODO: Encrypt message before sending
        }

        // AI Classification Engine
        // TODO: Replace with actual NLP model from /api/ai/classify
        function classifyMessage(text) {
            const lowerText = text.toLowerCase();

            for (const [level, keywords] of Object.entries(CLASSIFICATION_KEYWORDS)) {
                if (keywords.some(keyword => lowerText.includes(keyword))) {
                    return level;
                }
            }

            return 'unclassified';
        }

        function analyzeSentiment(text) {
            const lowerText = text.toLowerCase();
            let positiveScore = 0;
            let negativeScore = 0;

            SENTIMENT_KEYWORDS.positive.forEach(word => {
                if (lowerText.includes(word)) positiveScore++;
            });

            SENTIMENT_KEYWORDS.negative.forEach(word => {
                if (lowerText.includes(word)) negativeScore++;
            });

            if (positiveScore > negativeScore) return 'positive';
            if (negativeScore > positiveScore) return 'negative';
            return 'neutral';
        }

        function detectUrgency(text) {
            const lowerText = text.toLowerCase();

            if (URGENCY_KEYWORDS.high.some(word => lowerText.includes(word))) {
                return 'high';
            }
            if (URGENCY_KEYWORDS.medium.some(word => lowerText.includes(word))) {
                return 'medium';
            }
            return 'low';
        }

        function showAIClassification(classification, sentiment, urgency) {
            const container = document.getElementById('aiClassification');
            const levelSpan = document.getElementById('aiClassLevel');
            const sentimentIcon = document.getElementById('aiSentiment');

            if (container && levelSpan && sentimentIcon) {
                levelSpan.textContent = classification.toUpperCase();
                levelSpan.className = `px-2 py-1 rounded-full font-semibold clearance-${classification}`;

                const sentimentIcons = {
                    positive: 'fa-smile',
                    neutral: 'fa-meh',
                    negative: 'fa-frown'
                };
                sentimentIcon.className = `fas ${sentimentIcons[sentiment]} sentiment-${sentiment}`;

                container.classList.remove('hidden');

                setTimeout(() => {
                    container.classList.add('hidden');
                }, 5000);
            }
        }

        // Demo Functions for AI Analysis Module
        function demoClassification() {
            const input = document.getElementById('classificationInput');
            const result = document.getElementById('classificationResult');

            if (!input || !result || !input.value.trim()) return;

            const text = input.value.trim();
            const classification = classifyMessage(text);
            const urgency = detectUrgency(text);

            result.innerHTML = `
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-white font-semibold mb-2">AI Analysis Result:</div>
                    <div class="space-y-2">
                        <div class="flex items-center justify-between">
                            <span class="text-white/70 text-sm">Security Classification:</span>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold clearance-${classification}">${classification.toUpperCase()}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-white/70 text-sm">Urgency Level:</span>
                            <span class="px-3 py-1 rounded-full text-xs font-semibold urgency-${urgency}">${urgency.toUpperCase()}</span>
                        </div>
                        <div class="text-white/60 text-xs mt-3">
                            <i class="fas fa-info-circle mr-1"></i>
                            This message will be routed only to personnel with ${classification.toUpperCase()} clearance or higher.
                        </div>
                    </div>
                </div>
            `;
            result.classList.remove('hidden');
        }

        function demoSentiment() {
            const input = document.getElementById('sentimentInput');
            const result = document.getElementById('sentimentResult');

            if (!input || !result || !input.value.trim()) return;

            const text = input.value.trim();
            const sentiment = analyzeSentiment(text);

            const sentimentColors = {
                positive: 'green',
                neutral: 'blue',
                negative: 'red'
            };

            const sentimentIcons = {
                positive: 'fa-smile',
                neutral: 'fa-meh',
                negative: 'fa-frown'
            };

            result.innerHTML = `
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-white font-semibold mb-2">Sentiment Analysis Result:</div>
                    <div class="flex items-center justify-center py-4">
                        <div class="text-center">
                            <i class="fas ${sentimentIcons[sentiment]} sentiment-${sentiment} text-5xl mb-3"></i>
                            <div class="text-white text-xl font-bold capitalize">${sentiment}</div>
                        </div>
                    </div>
                    <div class="text-white/60 text-xs mt-3">
                        <i class="fas fa-info-circle mr-1"></i>
                        ${sentiment === 'negative' ? 'This message may require priority attention or follow-up.' :
                          sentiment === 'positive' ? 'Positive communication detected.' :
                          'Neutral tone detected - standard processing.'}
                    </div>
                </div>
            `;
            result.classList.remove('hidden');
        }

        // Utility Functions
        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return date.toLocaleDateString();
        }

        function selectConversation(id) {
            const conv = MOCK_CONVERSATIONS.find(c => c.id === id);
            if (!conv) return;

            document.getElementById('chatName').textContent = conv.name;
            document.getElementById('chatInitials').textContent = conv.name.split(' ').map(n => n[0]).join('');
            document.getElementById('chatStatus').textContent = conv.online ? 'Online' : 'Offline';
            document.getElementById('chatClearance').textContent = conv.clearance.toUpperCase();
            document.getElementById('chatClearance').className = `px-3 py-1 rounded-full text-xs font-semibold clearance-${conv.clearance}`;

            populateMessages();
        }

        // TODO: Implement real conversation starter
        function startNewConversation() {
            alert('New conversation modal would open here. TODO: Implement modal with contact selection.');
        }

        function startConversationWith(personId) {
            alert(`Starting conversation with person ID: ${personId}. TODO: Open messenger with selected contact.`);
        }

        // ========== NEW FEATURES - Added 2024-11-06 ==========

        // Clearance Selector Functions
        let currentClearanceLevel = 'secret';

        function changeClearance(level) {
            currentClearanceLevel = level;
            const clearanceBtn = document.getElementById('clearanceDropdownBtn');
            const clearanceText = document.getElementById('chatClearance');
            const clearanceDropdown = document.getElementById('clearanceDropdown');

            // Update display
            clearanceText.textContent = level.toUpperCase().replace('-', ' ');

            // Update button styling
            clearanceBtn.className = `px-3 py-1 rounded-full text-xs font-semibold clearance-${level} flex items-center gap-1 cursor-pointer hover:opacity-80 transition-all`;

            // Close dropdown
            clearanceDropdown.classList.add('hidden');

            // Show notification
            showNotification(`Security clearance changed to ${level.toUpperCase().replace('-', ' ')}`, 'success');
        }

        // Toggle clearance dropdown - Setup event listeners on DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            const clearanceBtn = document.getElementById('clearanceDropdownBtn');
            const clearanceDropdown = document.getElementById('clearanceDropdown');
            const chatOptionsBtn = document.getElementById('chatOptionsBtn');
            const chatOptionsMenu = document.getElementById('chatOptionsMenu');

            if (clearanceBtn && clearanceDropdown) {
                clearanceBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    clearanceDropdown.classList.toggle('hidden');
                    // Close other menus
                    if (chatOptionsMenu) chatOptionsMenu.classList.add('hidden');
                });
            }

            if (chatOptionsBtn && chatOptionsMenu) {
                chatOptionsBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    chatOptionsMenu.classList.toggle('hidden');
                    // Close other menus
                    if (clearanceDropdown) clearanceDropdown.classList.add('hidden');
                });
            }

            // Close dropdowns when clicking outside
            document.addEventListener('click', () => {
                if (clearanceDropdown) clearanceDropdown.classList.add('hidden');
                if (chatOptionsMenu) chatOptionsMenu.classList.add('hidden');
            });
        });

        // Chat Options Menu Functions
        function viewConversationInfo() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            showNotification('Conversation info would be displayed here. TODO: Implement conversation details modal.', 'info');
        }

        function exportToEmail() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            openEmailCompose();
        }

        function shareExternally() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            showNotification('External sharing requires security clearance approval. TODO: Implement approval workflow.', 'warning');
        }

        function viewAuditTrail() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            switchMeshModule('audit');
            showNotification('Viewing audit trail for this conversation', 'info');
        }

        function muteConversation() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            showNotification('Conversation muted. You will not receive notifications.', 'success');
        }

        function archiveConversation() {
            document.getElementById('chatOptionsMenu').classList.add('hidden');
            showNotification('Conversation archived successfully', 'success');
        }

        // Voice Recording Functions
        // MOCK DATA - Replace with real MediaRecorder API in production
        let isRecording = false;
        let recordingStartTime = null;
        let recordingTimer = null;
        let mediaRecorder = null;
        let audioChunks = [];

        function toggleVoiceRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        // TODO: Connect to MediaRecorder API for real audio recording
        async function startRecording() {
            try {
                // Check if browser supports MediaRecorder
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    showNotification('Voice recording not supported in this browser', 'error');
                    return;
                }

                // For now, just show the UI
                isRecording = true;
                recordingStartTime = Date.now();

                // Show recording UI
                document.getElementById('voiceRecordingUI').classList.remove('hidden');
                document.getElementById('voiceMemoBtn').classList.add('bg-red-500');

                // Start timer
                updateRecordingTimer();
                recordingTimer = setInterval(updateRecordingTimer, 1000);

                showNotification('Recording voice memo...', 'info');

            } catch (error) {
                showNotification('Error accessing microphone: ' + error.message, 'error');
                console.error('Recording error:', error);
            }
        }

        function updateRecordingTimer() {
            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const seconds = (elapsed % 60).toString().padStart(2, '0');
            document.getElementById('recordingTimer').textContent = `${minutes}:${seconds}`;
        }

        function stopRecording() {
            if (!isRecording) return;

            isRecording = false;
            clearInterval(recordingTimer);

            // Hide recording UI
            document.getElementById('voiceRecordingUI').classList.add('hidden');
            document.getElementById('voiceMemoBtn').classList.remove('bg-red-500');

            // For now, simulate sending voice memo
            const duration = Math.floor((Date.now() - recordingStartTime) / 1000);
            sendVoiceMessage(duration);

            showNotification('Voice memo sent successfully', 'success');
        }

        function cancelRecording() {
            if (!isRecording) return;

            isRecording = false;
            clearInterval(recordingTimer);

            // Hide recording UI
            document.getElementById('voiceRecordingUI').classList.add('hidden');
            document.getElementById('voiceMemoBtn').classList.remove('bg-red-500');

            showNotification('Recording cancelled', 'info');
        }

        // MOCK DATA - Simulate sending voice message
        function sendVoiceMessage(duration) {
            const messagesArea = document.getElementById('messagesArea');
            if (!messagesArea) return;

            const timestamp = new Date().toISOString();
            const voiceMessage = document.createElement('div');
            voiceMessage.className = 'flex justify-end';
            voiceMessage.innerHTML = `
                <div class="message-sent max-w-md p-4">
                    <div class="flex items-center gap-3">
                        <button class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-all">
                            <i class="fas fa-play text-white"></i>
                        </button>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-microphone text-white/70 text-sm"></i>
                                <span class="text-white text-sm font-medium">Voice Memo</span>
                            </div>
                            <div class="h-8 flex items-center gap-1">
                                ${Array(20).fill(0).map((_, i) =>
                                    `<div class="w-1 bg-white/50 rounded-full" style="height: ${Math.random() * 100}%"></div>`
                                ).join('')}
                            </div>
                            <div class="text-white/60 text-xs mt-1">${duration}s</div>
                        </div>
                    </div>
                    <div class="text-white/50 text-xs mt-2">${formatTimestamp(timestamp)}</div>
                </div>
            `;

            messagesArea.appendChild(voiceMessage);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // Email Compose Functions
        function openEmailCompose() {
            document.getElementById('emailComposeUI').classList.remove('hidden');
            document.getElementById('chatOptionsMenu')?.classList.add('hidden');
        }

        function closeEmailCompose() {
            document.getElementById('emailComposeUI').classList.add('hidden');
            // Clear form
            document.getElementById('emailRecipient').value = '';
            document.getElementById('emailSubject').value = '';
            document.getElementById('emailMessage').value = '';
        }

        // TODO: Connect to secure email gateway API
        function sendEmailMessage() {
            const recipient = document.getElementById('emailRecipient').value.trim();
            const subject = document.getElementById('emailSubject').value.trim();
            const message = document.getElementById('emailMessage').value.trim();

            if (!recipient || !message) {
                showNotification('Please fill in recipient and message fields', 'error');
                return;
            }

            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(recipient)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }

            closeEmailCompose();

            // Add to messages as sent email
            const messagesArea = document.getElementById('messagesArea');
            if (messagesArea) {
                const timestamp = new Date().toISOString();
                const emailMsg = document.createElement('div');
                emailMsg.className = 'flex justify-end';
                emailMsg.innerHTML = `
                    <div class="message-sent max-w-md p-4">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="fas fa-envelope text-white"></i>
                            <span class="text-white font-semibold text-sm">Email to External Agency</span>
                        </div>
                        <div class="text-white/80 text-sm mb-2">
                            <strong>To:</strong> ${recipient}
                        </div>
                        <div class="text-white/80 text-sm mb-2">
                            <strong>Subject:</strong> ${subject || 'Secure Communication'}
                        </div>
                        <div class="text-white text-sm whitespace-pre-wrap">${message}</div>
                        <div class="flex items-center justify-between mt-3 pt-2 border-t border-white/20">
                            <div class="flex items-center gap-1 text-xs text-white/60">
                                <i class="fas fa-lock"></i>
                                <span>Encrypted</span>
                            </div>
                            <span class="text-white/50 text-xs">${formatTimestamp(timestamp)}</span>
                        </div>
                    </div>
                `;
                messagesArea.appendChild(emailMsg);
                messagesArea.scrollTop = messagesArea.scrollHeight;
            }

            showNotification(`Secure email sent to ${recipient}`, 'success');
        }

        // File Attachment Function
        function attachFile() {
            // TODO: Implement file picker and upload
            showNotification('File attachment feature coming soon. TODO: Implement secure file upload.', 'info');
        }

        // Notification Helper
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            const bgColors = {
                info: 'bg-blue-500',
                success: 'bg-green-500',
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            const icons = {
                info: 'fa-info-circle',
                success: 'fa-check-circle',
                warning: 'fa-exclamation-triangle',
                error: 'fa-times-circle'
            };

            notification.className = `fixed top-4 right-4 ${bgColors[type]} text-white px-6 py-3 rounded-lg shadow-xl z-50 flex items-center gap-3 animate-fade-in`;
            notification.innerHTML = `
                <i class="fas ${icons[type]}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            // Remove after 4 seconds
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-500');
                setTimeout(() => notification.remove(), 500);
            }, 4000);
        }

        console.log('SecureMesh module loaded successfully');
        // ===== END SECUREMESH JAVASCRIPT =====

        // ===== DEPARTMENT PROCESS CENTER & WORKFLOW BUILDER JAVASCRIPT =====
        // Added 2024-11-06: Department-Focused Process Center & AI Workflow Builder

        // Workflow View Switcher
        let currentWorkflowView = 'department'; // 'department' or 'builder'

        function switchWorkflowView(view) {
            currentWorkflowView = view;

            // Update button styles
            const deptBtn = document.getElementById('departmentModeBtn');
            const builderBtn = document.getElementById('builderModeBtn');
            const description = document.getElementById('workflowViewDescription');

            if (view === 'department') {
                deptBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white';
                builderBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all text-white/70 hover:text-white';
                description.textContent = 'Department-focused process management';

                // Show department mode, hide builder mode
                document.getElementById('departmentProcessCenterMode').classList.remove('hidden');
                document.getElementById('workflowBuilderMode').classList.add('hidden');
            } else {
                deptBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all text-white/70 hover:text-white';
                builderBtn.className = 'px-4 py-2 rounded-lg text-sm font-medium transition-all bg-gradient-to-r from-blue-500 to-purple-600 text-white';
                description.textContent = 'Build custom workflows with AI assistance';

                // Show builder mode, hide department mode
                document.getElementById('departmentProcessCenterMode').classList.add('hidden');
                document.getElementById('workflowBuilderMode').classList.remove('hidden');

                // Load saved workflows
                loadSavedWorkflows();
            }
        }

        // ===== WORKFLOW BUILDER FUNCTIONS =====

        function createBlankWorkflow() {
            // TODO: Implement blank workflow creator
            alert('Blank workflow builder would open here. TODO: Implement visual workflow canvas.');
        }

        function loadWorkflowExample(type) {
            const examples = {
                permit: 'Create a building permit approval workflow that validates submitted documents, routes to plan review, requires supervisor approval, and sends email notifications to the applicant.',
                hr: 'Create an employee onboarding workflow that collects new hire paperwork, sets up IT accounts, schedules orientation, and assigns a mentor.',
                invoice: 'Create an invoice approval workflow that verifies line items, routes to department manager, requires finance approval for amounts over $5000, and triggers payment processing.'
            };

            document.getElementById('aiWorkflowInput').value = examples[type] || '';
        }

        function generateWorkflowFromAI() {
            const input = document.getElementById('aiWorkflowInput').value.trim();
            if (!input) {
                alert('Please describe your workflow first.');
                return;
            }

            // TODO: Connect to AI API endpoint /api/ai/generate-workflow
            // MOCK: Simulate AI workflow generation
            const canvas = document.getElementById('workflowCanvas');
            canvas.innerHTML = `
                <div class="space-y-4">
                    <div class="text-white mb-4">
                        <i class="fas fa-magic text-purple-400 mr-2"></i>
                        <span class="font-semibold">AI Generated Workflow</span>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="glass rounded-lg p-4 flex-1">
                            <div class="text-white font-medium mb-1">Step 1: Document Validation</div>
                            <div class="text-white/60 text-sm">Verify all required documents are submitted</div>
                        </div>
                        <i class="fas fa-arrow-right text-blue-400"></i>
                        <div class="glass rounded-lg p-4 flex-1">
                            <div class="text-white font-medium mb-1">Step 2: Review Process</div>
                            <div class="text-white/60 text-sm">Route to appropriate department reviewer</div>
                        </div>
                        <i class="fas fa-arrow-right text-blue-400"></i>
                        <div class="glass rounded-lg p-4 flex-1">
                            <div class="text-white font-medium mb-1">Step 3: Approval</div>
                            <div class="text-white/60 text-sm">Supervisor approval required</div>
                        </div>
                        <i class="fas fa-arrow-right text-blue-400"></i>
                        <div class="glass rounded-lg p-4 flex-1">
                            <div class="text-white font-medium mb-1">Step 4: Notification</div>
                            <div class="text-white/60 text-sm">Send email to applicant</div>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button onclick="saveGeneratedWorkflow()" class="px-4 py-2 bg-green-500 rounded-lg text-white hover:bg-green-600 transition-all">
                            <i class="fas fa-save mr-2"></i>Save Workflow
                        </button>
                        <button onclick="editWorkflow()" class="px-4 py-2 bg-blue-500 rounded-lg text-white hover:bg-blue-600 transition-all">
                            <i class="fas fa-edit mr-2"></i>Edit Steps
                        </button>
                    </div>
                </div>
            `;
        }

        function saveGeneratedWorkflow() {
            // TODO: Implement workflow save
            alert('Workflow would be saved here. TODO: Connect to /api/workflows/save');
        }

        function editWorkflow() {
            // TODO: Implement workflow editor
            alert('Visual workflow editor would open here. TODO: Implement drag-and-drop canvas.');
        }

        function loadSavedWorkflows() {
            // MOCK DATA - Replace with API call
            const savedWorkflows = [
                { id: 1, name: 'Building Permit Approval', steps: 8, status: 'active', uses: 247 },
                { id: 2, name: 'Employee Onboarding', steps: 12, status: 'active', uses: 89 },
                { id: 3, name: 'Invoice Processing', steps: 6, status: 'active', uses: 534 }
            ];

            const container = document.getElementById('savedWorkflowsList');
            if (!container) return;

            if (savedWorkflows.length === 0) {
                container.innerHTML = `
                    <div class="col-span-3 text-center text-white/60 py-8">
                        <i class="fas fa-folder-open text-4xl mb-3"></i>
                        <p>No saved workflows yet</p>
                        <p class="text-sm">Create your first workflow using the AI builder above</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = savedWorkflows.map(wf => `
                <div class="glass rounded-xl p-4 hover:bg-white/15 transition-all cursor-pointer" onclick="loadWorkflow(${wf.id})">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-white">${wf.name}</h4>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-500/20 text-green-400">${wf.status.toUpperCase()}</span>
                    </div>
                    <div class="space-y-1 text-xs text-white/60 mb-3">
                        <div><i class="fas fa-list-ol mr-2"></i>${wf.steps} steps</div>
                        <div><i class="fas fa-chart-line mr-2"></i>${wf.uses} executions</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadWorkflow(${wf.id}); event.stopPropagation();" class="flex-1 px-3 py-1 bg-blue-500/20 rounded-lg text-blue-300 hover:bg-blue-500/30 transition-all text-xs">
                            <i class="fas fa-play mr-1"></i>Run
                        </button>
                        <button onclick="editWorkflow(${wf.id}); event.stopPropagation();" class="flex-1 px-3 py-1 bg-purple-500/20 rounded-lg text-purple-300 hover:bg-purple-500/30 transition-all text-xs">
                            <i class="fas fa-edit mr-1"></i>Edit
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadWorkflow(workflowId) {
            // TODO: Load workflow from API
            alert(`Loading workflow ${workflowId}. TODO: Connect to /api/workflows/${workflowId}`);
        }

        // ===== DEPARTMENT PROCESS CENTER FUNCTIONS =====

        // MOCK DATA - Replace in production
        // TODO: Connect to API endpoint /api/departments
        // TODO: Connect to API endpoint /api/workflows
        // TODO: Connect to AI optimization API /api/ai/optimize
        // SECURITY TODO: Implement role-based permissions

        const DEPARTMENTS = [
            {
                id: 'building',
                name: 'Building & Permits',
                icon: 'fa-building',
                color: 'dept-building',
                colorLight: 'dept-building-light',
                description: 'Construction permits, inspections, and code enforcement',
                activeWorkflows: 23,
                complianceScore: 97.8
            },
            {
                id: 'tax',
                name: 'Tax & Finance',
                icon: 'fa-dollar-sign',
                color: 'dept-tax',
                colorLight: 'dept-tax-light',
                description: 'Tax collection, budgeting, and financial reporting',
                activeWorkflows: 18,
                complianceScore: 99.2
            },
            {
                id: 'public-works',
                name: 'Public Works',
                icon: 'fa-road',
                color: 'dept-public-works',
                colorLight: 'dept-public-works-light',
                description: 'Infrastructure maintenance, utilities, and transportation',
                activeWorkflows: 31,
                complianceScore: 96.5
            },
            {
                id: 'health',
                name: 'Health Department',
                icon: 'fa-heart-pulse',
                color: 'dept-health',
                colorLight: 'dept-health-light',
                description: 'Public health services, inspections, and emergency response',
                activeWorkflows: 27,
                complianceScore: 98.9
            },
            {
                id: 'planning',
                name: 'Planning & Zoning',
                icon: 'fa-map',
                color: 'dept-planning',
                colorLight: 'dept-planning-light',
                description: 'Land use planning, zoning regulations, and development review',
                activeWorkflows: 15,
                complianceScore: 97.3
            },
            {
                id: 'legal',
                name: 'Legal Department',
                icon: 'fa-gavel',
                color: 'dept-legal',
                colorLight: 'dept-legal-light',
                description: 'Legal counsel, contract review, and litigation management',
                activeWorkflows: 12,
                complianceScore: 99.5
            },
            {
                id: 'hr',
                name: 'Human Resources',
                icon: 'fa-users',
                color: 'dept-hr',
                colorLight: 'dept-hr-light',
                description: 'Employee management, benefits, and recruitment',
                activeWorkflows: 19,
                complianceScore: 98.1
            },
            {
                id: 'it',
                name: 'IT Department',
                icon: 'fa-server',
                color: 'dept-it',
                colorLight: 'dept-it-light',
                description: 'Technology infrastructure, cybersecurity, and support',
                activeWorkflows: 25,
                complianceScore: 99.8
            }
        ];

        // Current selected department
        let currentDepartment = null;

        // Initialize department hub on workflows tab show
        function initializeDepartmentProcessCenter() {
            populateDepartmentHub();
        }

        function populateDepartmentHub() {
            const container = document.getElementById('departmentHub');
            if (!container) return;

            container.innerHTML = DEPARTMENTS.map(dept => `
                <div onclick="selectDepartment('${dept.id}')" class="glass rounded-xl p-6 cursor-pointer hover:bg-white/15 transition-all group">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="${dept.color} w-12 h-12 rounded-lg flex items-center justify-center text-white">
                            <i class="fas ${dept.icon} text-xl"></i>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white group-hover:text-blue-300 transition-all">${dept.name}</h4>
                            <p class="text-xs text-white/60">${dept.activeWorkflows} active workflows</p>
                        </div>
                    </div>
                    <p class="text-sm text-white/70 mb-3">${dept.description}</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xs text-white/60">Compliance</span>
                        <span class="text-sm font-bold text-green-400">${dept.complianceScore}%</span>
                    </div>
                    <div class="w-full h-2 bg-white/10 rounded-full mt-2 overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-green-500 to-green-400" style="width: ${dept.complianceScore}%"></div>
                    </div>
                </div>
            `).join('');
        }

        function selectDepartment(deptId) {
            currentDepartment = DEPARTMENTS.find(d => d.id === deptId);
            if (!currentDepartment) return;

            // Show department dashboard
            document.getElementById('departmentDashboard').classList.remove('hidden');

            // Update header
            const iconDiv = document.getElementById('deptIcon');
            iconDiv.className = `w-16 h-16 ${currentDepartment.color} rounded-xl flex items-center justify-center text-white text-2xl`;
            iconDiv.innerHTML = `<i class="fas ${currentDepartment.icon}"></i>`;

            document.getElementById('deptName').textContent = currentDepartment.name;
            document.getElementById('deptDescription').textContent = currentDepartment.description;

            // Load department-specific data
            loadDepartmentData(currentDepartment.id);
        }

        function backToDepartments() {
            document.getElementById('departmentDashboard').classList.add('hidden');
            currentDepartment = null;
        }

        function switchDeptModule(moduleName) {
            // Update active tab
            document.querySelectorAll('.dept-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.dept-tab-button').classList.add('active');

            // Show selected module
            document.querySelectorAll('.dept-module-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`dept-module-${moduleName}`).classList.add('active');
        }

        function loadDepartmentData(deptId) {
            // Load KPIs, workflows, and other data based on department
            // This would fetch from API in production
            loadDepartmentKPIs(deptId);
            loadActiveWorkflows(deptId);
            loadQuickActions(deptId);
            loadRecentActivity(deptId);
            loadWorkflowTemplates(deptId);
            loadRunningWorkflows(deptId);
            loadComplianceData(deptId);
            loadKnowledgeBase(deptId);
            loadIntegrations(deptId);
        }

        function loadDepartmentKPIs(deptId) {
            // MOCK DATA - Replace with API call
            const kpis = {
                'building': [
                    { label: 'Permits Issued', value: '847', change: '+12%', trend: 'up' },
                    { label: 'Inspections Complete', value: '1,234', change: '+8%', trend: 'up' },
                    { label: 'Avg Processing Time', value: '3.2 days', change: '-15%', trend: 'down' },
                    { label: 'Compliance Rate', value: '97.8%', change: '+2%', trend: 'up' }
                ],
                'tax': [
                    { label: 'Revenue Collected', value: '$12.4M', change: '+5%', trend: 'up' },
                    { label: 'Returns Processed', value: '3,421', change: '+7%', trend: 'up' },
                    { label: 'Avg Response Time', value: '2.1 days', change: '-10%', trend: 'down' },
                    { label: 'Accuracy Rate', value: '99.2%', change: '+1%', trend: 'up' }
                ]
            };

            const deptKPIs = kpis[deptId] || kpis['building'];
            const container = document.getElementById('deptKPIs');
            if (!container) return;

            container.innerHTML = deptKPIs.map(kpi => `
                <div class="glass rounded-xl p-6">
                    <div class="text-white/70 text-xs mb-2">${kpi.label}</div>
                    <div class="text-3xl font-bold text-white mb-2">${kpi.value}</div>
                    <div class="text-xs ${kpi.trend === 'up' ? 'text-green-400' : 'text-red-400'}">
                        <i class="fas fa-arrow-${kpi.trend === 'up' ? 'up' : 'down'} mr-1"></i>${kpi.change}
                    </div>
                </div>
            `).join('');
        }

        function loadActiveWorkflows(deptId) {
            // MOCK DATA
            const workflows = [
                { name: 'Permit Application Review', status: 'active', progress: 75, dueIn: '2 hours' },
                { name: 'Inspection Scheduling', status: 'active', progress: 45, dueIn: '1 day' },
                { name: 'Code Violation Processing', status: 'pending', progress: 30, dueIn: '3 days' }
            ];

            const container = document.getElementById('activeWorkflowsList');
            if (!container) return;

            container.innerHTML = workflows.map(wf => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-white font-semibold text-sm">${wf.name}</span>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold workflow-status-${wf.status}">${wf.status.toUpperCase()}</span>
                    </div>
                    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden mb-2">
                        <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 progress-bar" style="width: ${wf.progress}%"></div>
                    </div>
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-white/60">${wf.progress}% complete</span>
                        <span class="text-white/60">Due in ${wf.dueIn}</span>
                    </div>
                </div>
            `).join('');
        }

        function loadQuickActions(deptId) {
            // MOCK DATA
            const actions = [
                { name: 'New Permit', icon: 'fa-file-circle-plus', color: 'blue' },
                { name: 'Schedule Inspection', icon: 'fa-calendar-check', color: 'green' },
                { name: 'Generate Report', icon: 'fa-chart-bar', color: 'purple' },
                { name: 'View Analytics', icon: 'fa-chart-line', color: 'yellow' }
            ];

            const container = document.getElementById('quickActionsList');
            if (!container) return;

            container.innerHTML = actions.map(action => `
                <button onclick="quickAction('${action.name}')" class="glass rounded-lg p-4 hover:bg-white/15 transition-all text-center">
                    <i class="fas ${action.icon} text-${action.color}-400 text-2xl mb-2"></i>
                    <div class="text-white text-sm font-medium">${action.name}</div>
                </button>
            `).join('');
        }

        function loadRecentActivity(deptId) {
            // MOCK DATA
            const activities = [
                { action: 'Permit #2847 approved', user: 'Sarah Martinez', time: '15 min ago', icon: 'fa-check-circle', color: 'green' },
                { action: 'Inspection scheduled for 123 Main St', user: 'John Smith', time: '1 hour ago', icon: 'fa-calendar', color: 'blue' },
                { action: 'Code violation report submitted', user: 'Mike Johnson', time: '2 hours ago', icon: 'fa-exclamation-triangle', color: 'yellow' }
            ];

            const container = document.getElementById('recentActivityList');
            if (!container) return;

            container.innerHTML = activities.map(act => `
                <div class="flex items-center gap-3 glass-dark rounded-lg p-3">
                    <div class="w-10 h-10 bg-${act.color}-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas ${act.icon} text-${act.color}-400"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white text-sm">${act.action}</div>
                        <div class="text-white/60 text-xs">${act.user} â€¢ ${act.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function loadWorkflowTemplates(deptId) {
            // MOCK DATA - Department-specific templates
            const templates = {
                'building': [
                    { name: 'Building Permit Application', steps: 8, avgTime: '5 days', uses: 847 },
                    { name: 'Electrical Inspection', steps: 5, avgTime: '2 days', uses: 423 },
                    { name: 'Plumbing Permit Review', steps: 6, avgTime: '3 days', uses: 312 },
                    { name: 'Code Violation Processing', steps: 7, avgTime: '4 days', uses: 156 },
                    { name: 'Certificate of Occupancy', steps: 9, avgTime: '6 days', uses: 234 }
                ]
            };

            const deptTemplates = templates[deptId] || templates['building'];
            const container = document.getElementById('workflowTemplatesList');
            if (!container) return;

            container.innerHTML = deptTemplates.map(tmpl => `
                <div class="glass rounded-xl p-4 hover:bg-white/15 transition-all cursor-pointer" onclick="useTemplate('${tmpl.name}')">
                    <h4 class="font-bold text-white mb-2">${tmpl.name}</h4>
                    <div class="space-y-1 text-xs text-white/60 mb-3">
                        <div><i class="fas fa-list-ol mr-2"></i>${tmpl.steps} steps</div>
                        <div><i class="fas fa-clock mr-2"></i>Avg: ${tmpl.avgTime}</div>
                        <div><i class="fas fa-chart-line mr-2"></i>${tmpl.uses} uses</div>
                    </div>
                    <button class="w-full px-3 py-2 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg text-white text-sm font-semibold hover:shadow-lg transition-all">
                        Use Template
                    </button>
                </div>
            `).join('');
        }

        function loadRunningWorkflows(deptId) {
            // MOCK DATA
            const running = [
                { id: 'WF-2847', name: 'Residential Permit - 456 Oak Ave', status: 'active', progress: 65, currentStep: 'Plan Review', assignee: 'Sarah Martinez' },
                { id: 'WF-2848', name: 'Commercial Inspection - 789 Main St', status: 'active', progress: 40, currentStep: 'Field Inspection', assignee: 'John Smith' }
            ];

            const container = document.getElementById('runningWorkflowsList');
            if (!container) return;

            container.innerHTML = running.map(wf => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <div class="text-white font-bold">${wf.id}: ${wf.name}</div>
                            <div class="text-white/60 text-sm">Current: ${wf.currentStep} â€¢ Assigned: ${wf.assignee}</div>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold workflow-status-${wf.status}">${wf.status.toUpperCase()}</span>
                    </div>
                    <div class="w-full h-3 bg-white/10 rounded-full overflow-hidden">
                        <div class="h-full bg-gradient-to-r from-blue-500 to-purple-500 progress-bar" style="width: ${wf.progress}%"></div>
                    </div>
                    <div class="flex items-center justify-between mt-2">
                        <span class="text-xs text-white/60">${wf.progress}% complete</span>
                        <div class="flex gap-2">
                            <button onclick="viewWorkflow('${wf.id}')" class="text-blue-400 hover:text-blue-300 text-sm">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="pauseWorkflow('${wf.id}')" class="text-yellow-400 hover:text-yellow-300 text-sm">
                                <i class="fas fa-pause"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadComplianceData(deptId) {
            // MOCK DATA
            const compliance = [
                { regulation: 'OSHA Safety Standards', status: 'good', lastCheck: '2024-11-05', nextReview: '2024-12-05' },
                { regulation: 'ADA Accessibility Requirements', status: 'good', lastCheck: '2024-11-04', nextReview: '2024-12-04' },
                { regulation: 'Building Code 2024', status: 'warning', lastCheck: '2024-11-03', nextReview: '2024-11-10' }
            ];

            const container = document.getElementById('complianceMonitoringList');
            if (!container) return;

            container.innerHTML = compliance.map(comp => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-white font-semibold">${comp.regulation}</span>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold compliance-${comp.status}">${comp.status.toUpperCase()}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-xs text-white/60">
                        <div>
                            <div>Last Check</div>
                            <div class="text-white mt-1">${comp.lastCheck}</div>
                        </div>
                        <div>
                            <div>Next Review</div>
                            <div class="text-white mt-1">${comp.nextReview}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Load audit trail
            const audits = [
                { action: 'Compliance check completed', regulation: 'OSHA Standards', user: 'System', timestamp: '2024-11-05T14:30:00Z' },
                { action: 'Policy update applied', regulation: 'ADA Requirements', user: 'Admin', timestamp: '2024-11-04T10:15:00Z' }
            ];

            const auditContainer = document.getElementById('auditTrailList');
            if (!auditContainer) return;

            auditContainer.innerHTML = audits.map(audit => `
                <div class="flex items-center gap-3 glass-dark rounded-lg p-3">
                    <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clipboard-check text-blue-400"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white text-sm">${audit.action}</div>
                        <div class="text-white/60 text-xs">${audit.regulation} â€¢ ${audit.user} â€¢ ${new Date(audit.timestamp).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        function loadKnowledgeBase(deptId) {
            // MOCK DATA
            const bestPractices = [
                { title: 'Permit Review Best Practices', views: 234 },
                { title: 'Inspection Efficiency Guide', views: 189 },
                { title: 'Customer Service Standards', views: 156 }
            ];

            const regulations = [
                { title: '2024 Building Code Updates', updated: 'Oct 2024' },
                { title: 'Fire Safety Requirements', updated: 'Sep 2024' },
                { title: 'Accessibility Standards', updated: 'Aug 2024' }
            ];

            const aiSuggestions = [
                { suggestion: 'Automate permit pre-screening', impact: 'High' },
                { suggestion: 'Implement digital inspections', impact: 'Medium' },
                { suggestion: 'Streamline approval workflow', impact: 'High' }
            ];

            document.getElementById('bestPracticesList').innerHTML = bestPractices.map(bp => `
                <div class="glass-dark rounded-lg p-3 hover:bg-white/10 transition-all cursor-pointer">
                    <div class="text-white text-sm font-medium mb-1">${bp.title}</div>
                    <div class="text-white/60 text-xs"><i class="fas fa-eye mr-1"></i>${bp.views} views</div>
                </div>
            `).join('');

            document.getElementById('regulationsList').innerHTML = regulations.map(reg => `
                <div class="glass-dark rounded-lg p-3 hover:bg-white/10 transition-all cursor-pointer">
                    <div class="text-white text-sm font-medium mb-1">${reg.title}</div>
                    <div class="text-white/60 text-xs"><i class="fas fa-calendar mr-1"></i>${reg.updated}</div>
                </div>
            `).join('');

            document.getElementById('aiSuggestionsList').innerHTML = aiSuggestions.map(ai => `
                <div class="glass-dark rounded-lg p-3 hover:bg-white/10 transition-all cursor-pointer">
                    <div class="text-white text-sm font-medium mb-1">${ai.suggestion}</div>
                    <div class="text-white/60 text-xs">
                        <span class="px-2 py-0.5 rounded-full ${ai.impact === 'High' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'} text-xs">${ai.impact} Impact</span>
                    </div>
                </div>
            `).join('');

            // Document Library
            const documents = [
                { name: 'Permit Application Forms', type: 'PDF', size: '2.4 MB', date: '2024-11-01' },
                { name: 'Inspection Checklists', type: 'PDF', size: '1.8 MB', date: '2024-10-28' },
                { name: 'Code Reference Guide', type: 'PDF', size: '5.2 MB', date: '2024-10-15' }
            ];

            document.getElementById('documentLibraryList').innerHTML = documents.map(doc => `
                <div class="glass-dark rounded-lg p-4 hover:bg-white/10 transition-all cursor-pointer">
                    <div class="flex items-center gap-3 mb-2">
                        <i class="fas fa-file-pdf text-red-400 text-2xl"></i>
                        <div class="flex-1">
                            <div class="text-white font-medium text-sm">${doc.name}</div>
                            <div class="text-white/60 text-xs">${doc.type} â€¢ ${doc.size}</div>
                        </div>
                    </div>
                    <div class="text-white/60 text-xs">Modified: ${doc.date}</div>
                </div>
            `).join('');
        }

        function loadIntegrations(deptId) {
            // MOCK DATA
            const connections = [
                { dept: 'Legal Department', workflows: 12, status: 'active' },
                { dept: 'Public Works', workflows: 8, status: 'active' },
                { dept: 'Tax & Finance', workflows: 5, status: 'active' }
            ];

            document.getElementById('crossDeptConnectionsList').innerHTML = connections.map(conn => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-white font-semibold">${conn.dept}</span>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold workflow-status-${conn.status}">${conn.status.toUpperCase()}</span>
                    </div>
                    <div class="text-white/60 text-sm">${conn.workflows} shared workflows</div>
                </div>
            `).join('');

            // Workflow Handoffs
            const handoffs = [
                { from: 'Building & Permits', to: 'Legal Department', workflow: 'Permit Appeal Review', status: 'pending' },
                { from: 'Building & Permits', to: 'Public Works', workflow: 'Road Closure Approval', status: 'active' }
            ];

            document.getElementById('workflowHandoffsList').innerHTML = handoffs.map(ho => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <span class="text-white font-semibold">${ho.workflow}</span>
                        <span class="px-2 py-1 rounded-full text-xs font-semibold workflow-status-${ho.status}">${ho.status.toUpperCase()}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-white/60">
                        <span>${ho.from}</span>
                        <i class="fas fa-arrow-right text-blue-400"></i>
                        <span>${ho.to}</span>
                    </div>
                </div>
            `).join('');

            // Shared Documents
            const sharedDocs = [
                { name: 'Inter-Department Forms', departments: 3, files: 24 },
                { name: 'Shared Policy Documents', departments: 5, files: 18 }
            ];

            document.getElementById('sharedDocsList').innerHTML = sharedDocs.map(doc => `
                <div class="glass-dark rounded-lg p-4">
                    <div class="text-white font-semibold mb-2">${doc.name}</div>
                    <div class="flex items-center justify-between text-sm text-white/60">
                        <span><i class="fas fa-building mr-1"></i>${doc.departments} departments</span>
                        <span><i class="fas fa-file mr-1"></i>${doc.files} files</span>
                    </div>
                </div>
            `).join('');
        }

        // Action Functions
        function quickAction(actionName) {
            alert(`Quick action: ${actionName}. TODO: Implement action handler.`);
        }

        function createCustomWorkflow() {
            alert('Custom workflow builder would open here. TODO: Implement workflow builder modal.');
        }

        function useTemplate(templateName) {
            alert(`Using template: ${templateName}. TODO: Implement template instantiation.`);
        }

        function viewWorkflow(workflowId) {
            alert(`Viewing workflow ${workflowId}. TODO: Implement workflow viewer.`);
        }

        function pauseWorkflow(workflowId) {
            alert(`Pausing workflow ${workflowId}. TODO: Implement workflow control.`);
        }

        function searchKnowledge() {
            const query = document.getElementById('knowledgeSearch').value;
            alert(`Searching for: ${query}. TODO: Implement knowledge base search.`);
        }

        // Enhanced switchTab to initialize Department Process Center
        const originalSwitchTabForDeptCenter = switchTab;
        switchTab = function(tabName) {
            originalSwitchTabForDeptCenter(tabName);
            if (tabName === 'workflows') {
                initializeDepartmentProcessCenter();
            }
        };

        console.log('Department Process Center loaded successfully');
        // ===== END DEPARTMENT PROCESS CENTER JAVASCRIPT =====

        // ===== MOBILE COMMAND CENTER JAVASCRIPT =====
        // Added 2024-11-07: Mobile Command Center for Field Operations

        // TODO: Connect to device GPS API
        // TODO: Implement offline storage (IndexedDB/SQLite)
        // TODO: Add background sync service worker
        // TODO: Connect to camera API
        // TODO: Integrate biometric authentication (Touch ID/Face ID)
        // TODO: Add push notifications
        // TODO: Connect to mapping service (Google Maps/Mapbox)
        // TODO: Implement route optimization algorithm
        // TODO: Add speech-to-text service
        // TODO: Connect to OCR service
        // TODO: Implement encrypted local storage (FIPS 140-2)
        // TODO: Add remote wipe capability

        // MOCK DATA - Replace in production
        const MOBILE_TODAYS_ASSIGNMENTS = [
            {
                id: 'INSP-2024-00847',
                type: 'Building Inspection',
                subtype: 'Final - Residential Addition',
                address: '123 Oak Street, Springfield, IL 62701',
                time: '9:00 AM',
                duration: '45 min',
                owner: 'John Smith',
                phone: '(217) 555-0100',
                notes: 'Large dog on property - call before entering',
                offline: true
            },
            {
                id: 'INSP-2024-00848',
                type: 'Plumbing Inspection',
                subtype: 'Rough-In - Commercial',
                address: '456 Maple Avenue, Springfield, IL 62702',
                time: '10:30 AM',
                duration: '60 min',
                owner: 'ABC Construction LLC',
                phone: '(217) 555-0101',
                notes: 'Meet contractor on site',
                offline: true
            },
            {
                id: 'INSP-2024-00849',
                type: 'Electrical Inspection',
                subtype: 'Service Upgrade - Residential',
                address: '789 Pine Road, Springfield, IL 62703',
                time: '12:00 PM',
                duration: '30 min',
                owner: 'Sarah Johnson',
                phone: '(217) 555-0102',
                notes: '',
                offline: false
            },
            {
                id: 'INSP-2024-00850',
                type: 'Fire Safety Inspection',
                subtype: 'Annual - Restaurant',
                address: '321 Birch Lane, Springfield, IL 62704',
                time: '1:30 PM',
                duration: '90 min',
                owner: 'Downtown Diner Inc',
                phone: '(217) 555-0103',
                notes: 'Previous violation: Fire suppression system',
                offline: false
            },
            {
                id: 'INSP-2024-00851',
                type: 'Building Inspection',
                subtype: 'Re-Inspection',
                address: '654 Cedar Drive, Springfield, IL 62705',
                time: '3:30 PM',
                duration: '30 min',
                owner: 'Michael Davis',
                phone: '(217) 555-0104',
                notes: 'Follow-up on HVAC repairs',
                offline: false
            },
            {
                id: 'INSP-2024-00852',
                type: 'Health Inspection',
                subtype: 'Routine - Grocery Store',
                address: '159 Elm Street, Springfield, IL 62706',
                time: '4:30 PM',
                duration: '75 min',
                owner: 'Fresh Foods Market',
                phone: '(217) 555-0105',
                notes: 'Refrigeration units require attention',
                offline: false
            },
            {
                id: 'INSP-2024-00853',
                type: 'Electrical Inspection',
                subtype: 'Final - New Construction',
                address: '951 Ash Court, Springfield, IL 62707',
                time: '6:00 PM',
                duration: '45 min',
                owner: 'Green Valley Homes',
                phone: '(217) 555-0106',
                notes: 'Final walk-through for occupancy permit',
                offline: false
            },
            {
                id: 'INSP-2024-00854',
                type: 'Building Inspection',
                subtype: 'Complaint - Code Violation',
                address: '753 Walnut Place, Springfield, IL 62708',
                time: '7:00 PM',
                duration: '30 min',
                owner: 'Robert Williams',
                phone: '(217) 555-0107',
                notes: 'Neighbor complaint: Fence height violation',
                offline: false
            }
        ];

        const MOBILE_SYNC_QUEUE = {
            pending: [
                { type: 'inspection_complete', photos: 12, size: '2.3 MB', priority: 'normal' },
                { type: 'violation_issued', photos: 3, size: '456 KB', priority: 'high' },
                { type: 'field_notes', photos: 0, size: '1.2 MB', priority: 'normal' }
            ]
        };

        const MOBILE_ROUTE_OPTIMIZATION = {
            original: { distance: 47.3, time: 6.5, order: [1,2,3,4,5,6,7,8] },
            optimized: { distance: 35.1, time: 5.75, order: [1,4,7,2,5,3,8,6], savings: '45 min, 12.2 mi' }
        };

        const MOBILE_PROPERTY_DATA = {
            owner: 'John Smith',
            phone: '(217) 555-0100',
            history: [
                { date: '2023-03-15', type: 'Annual Inspection', result: 'Passed' },
                { date: '2022-08-22', type: 'Re-Inspection', result: 'Passed' },
                { date: '2022-07-10', type: 'Building Inspection', result: 'Failed (HVAC)' },
                { date: '2021-04-05', type: 'Annual Inspection', result: 'Passed' },
                { date: '2020-09-30', type: 'Electrical Inspection', result: 'Passed' }
            ]
        };

        // Initialize Mobile Command Center on page load
        let mobileCommandInitialized = false;

        function initializeMobileCommand() {
            if (mobileCommandInitialized) return;

            populateMobileAssignments();
            updateMobileConnectivity();
            initializeMobileChecklist();

            mobileCommandInitialized = true;
            console.log('Mobile Command Center initialized');
        }

        // Populate assignments list
        function populateMobileAssignments() {
            const assignmentsList = document.getElementById('mobileAssignmentsList');
            if (!assignmentsList) return;

            assignmentsList.innerHTML = '';

            MOBILE_TODAYS_ASSIGNMENTS.forEach(assignment => {
                const card = document.createElement('div');
                card.className = 'mobile-glass rounded-2xl p-4 relative';

                card.innerHTML = `
                    ${assignment.offline ? '<div class="absolute top-3 right-3 bg-green-500 text-white px-2 py-1 rounded-lg text-xs font-bold">CACHED</div>' : ''}
                    <div class="flex justify-between items-start mb-2">
                        <div class="text-base font-bold text-white">${assignment.type}</div>
                        <div class="bg-blue-500 px-3 py-1 rounded-xl text-xs font-semibold text-white">${assignment.time}</div>
                    </div>
                    <div class="text-xs text-white/70 mb-2">${assignment.subtype}</div>
                    <div class="text-sm text-white/70 mb-2">${assignment.address}</div>
                    <div class="text-sm text-white mb-1">ðŸ‘¤ ${assignment.owner} â€¢ ${assignment.phone}</div>
                    <div class="text-xs text-white/70">â±ï¸ ${assignment.duration} â€¢ ID: ${assignment.id}</div>
                    ${assignment.notes ? `<div class="bg-yellow-500/20 border-l-4 border-yellow-500 px-3 py-2 mt-3 rounded text-xs text-yellow-400">âš ï¸ Note: ${assignment.notes}</div>` : ''}
                `;

                assignmentsList.appendChild(card);
            });
        }

        // Mobile Quick Action Functions
        function mobileShowAssignments() {
            const assignmentsList = document.getElementById('mobileAssignmentsList');
            if (assignmentsList) {
                assignmentsList.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function mobileQuickCapture() {
            // TODO: Connect to camera API
            alert('Quick Capture: Opening camera with GPS auto-tagging and voice notes');
        }

        function mobileShowRouteOptimizer() {
            const routeOptimizer = document.querySelector('#mobile-command-content .mobile-glass:has(button:contains("Start Navigation"))');
            if (routeOptimizer) {
                routeOptimizer.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function mobileDocumentScanner() {
            // TODO: Connect to OCR service
            alert('Document Scanner: Opening camera with OCR capabilities');
        }

        function mobileChecklistMode() {
            const checklist = document.querySelector('#mobile-command-content h2:contains("Inspection Checklist")');
            if (checklist) {
                checklist.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function mobileOpenCamera() {
            // TODO: Connect to camera API
            alert('Opening camera with auto-categorization and GPS tagging');
        }

        function mobileShowEmergencyModal() {
            // TODO: Create emergency modal
            // TODO: Connect to device GPS API
            // TODO: Start audio/video recording
            // TODO: Alert dispatch system
            alert('ðŸš¨ Emergency Report Activated\n\nGPS captured\nRecording started\nDispatch alerted\n\nSelect incident type:\n- Immediate Danger\n- Public Safety\n- Officer Safety\n- Medical Emergency\n- Fire Hazard\n- Structural Failure\n- Chemical Spill\n- Other Emergency');

            // Haptic feedback simulation
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
        }

        // Connectivity Status Simulation
        function updateMobileConnectivity() {
            const statuses = ['online', 'offline', 'limited', 'syncing'];
            const statusText = ['Online', 'Offline', 'Limited', 'Syncing'];
            let currentIndex = 3; // Start with syncing

            setInterval(() => {
                currentIndex = (currentIndex + 1) % statuses.length;
                const dots = document.querySelectorAll('.mobile-status-dot');
                const texts = document.querySelectorAll('#mobile-command-content .connectivity-status span:last-child');

                dots.forEach(dot => {
                    dot.className = 'mobile-status-dot mobile-status-' + statuses[currentIndex];
                });

                texts.forEach(text => {
                    if (text) text.textContent = statusText[currentIndex];
                });
            }, 5000);
        }

        // Checklist Button Interactions
        function initializeMobileChecklist() {
            // This will be called when the tab is initialized
            // The actual event listeners will be set up in the document ready handler
        }

        // Enhanced switchTab to initialize Mobile Command
        const originalSwitchTabForMobileCommand = switchTab;
        switchTab = function(tabName) {
            originalSwitchTabForMobileCommand(tabName);
            if (tabName === 'mobile-command') {
                initializeMobileCommand();

                // Initialize checklist button interactions after DOM is ready
                setTimeout(() => {
                    document.querySelectorAll('#mobile-command-content .checklist-btn').forEach(btn => {
                        btn.addEventListener('click', function() {
                            // Remove selected from siblings
                            this.parentElement.querySelectorAll('.checklist-btn').forEach(b => {
                                b.classList.remove('selected');
                            });
                            // Add selected to clicked button
                            this.classList.add('selected');

                            // Haptic feedback simulation
                            if (navigator.vibrate) {
                                navigator.vibrate(50);
                            }
                        });
                    });
                }, 100);
            }
        };

        console.log('Mobile Command Center loaded successfully');
        // ===== END MOBILE COMMAND CENTER JAVASCRIPT =====

        // ===== APP SWITCHER FUNCTIONALITY - Added 2025-01-08 =====
        (function() {
            const appSwitcherBtn = document.getElementById('appSwitcherBtn');
            const appSwitcherDropdown = document.getElementById('appSwitcherDropdown');
            const appSwitcherBackdrop = document.getElementById('appSwitcherBackdrop');

            // Toggle dropdown
            function toggleAppSwitcher(e) {
                e.stopPropagation();
                appSwitcherDropdown.classList.toggle('active');
                if (appSwitcherBackdrop) {
                    appSwitcherBackdrop.classList.toggle('active');
                }
            }

            // Close dropdown when clicking outside
            function closeAppSwitcher(e) {
                if (e && e.target) {
                    // Called from document click event
                    if (!appSwitcherBtn.contains(e.target) && !appSwitcherDropdown.contains(e.target)) {
                        appSwitcherDropdown.classList.remove('active');
                        if (appSwitcherBackdrop) {
                            appSwitcherBackdrop.classList.remove('active');
                        }
                    }
                } else {
                    // Called directly without event
                    appSwitcherDropdown.classList.remove('active');
                    if (appSwitcherBackdrop) {
                        appSwitcherBackdrop.classList.remove('active');
                    }
                }
            }

            // Handle app card clicks
            function handleAppCardClick(e) {
                const card = e.target.closest('.app-card');
                if (!card) return;

                const appType = card.dataset.app;
                console.log('Card clicked:', appType);

                // Prevent default and stop propagation
                e.preventDefault();
                e.stopPropagation();

                if (appType === 'permits') {
                    // Navigate to Permits landing page
                    console.log('Navigating to Permits landing page...');
                    closeAppSwitcher();
                    setTimeout(() => {
                        window.location.href = 'permits-landing-test.html';
                    }, 100);
                } else if (appType === 'new') {
                    // TODO: Open new module creation wizard
                    alert('Create New Module wizard coming soon! This will allow you to build custom applications.');
                    closeAppSwitcher();
                    // TODO: Open modal/wizard for creating new modules
                    console.log('Open new module creation wizard');
                } else if (appType === 'core') {
                    // Already on core platform
                    console.log('Already on Core Platform');
                    closeAppSwitcher();
                }
            }

            // Event listeners
            if (appSwitcherBtn) {
                appSwitcherBtn.addEventListener('click', toggleAppSwitcher);
            }

            if (appSwitcherDropdown) {
                appSwitcherDropdown.addEventListener('click', handleAppCardClick);
            }

            if (appSwitcherBackdrop) {
                appSwitcherBackdrop.addEventListener('click', closeAppSwitcher);
            }

            document.addEventListener('click', closeAppSwitcher);

            // TODO: Connect to API endpoint /api/user/apps for allowed apps
            // MOCK DATA - Currently showing Core Platform, Permits, and New Module option
            // TODO: Implement app switching logic when multiple apps are available
            // TODO: Track app usage analytics
            // TODO: Implement Permits module full functionality
            // TODO: Implement new module creation wizard

            console.log('App Switcher initialized with Permits and New Module options');
        })();
        // ===== END APP SWITCHER FUNCTIONALITY =====

        // ===== HELP/TRAINING BUTTON FUNCTIONALITY - Added 2025-01-11 =====
        (function() {
            const helpButton = document.getElementById('helpButton');

            if (helpButton) {
                helpButton.addEventListener('click', function() {
                    // Open training curriculum in new tab
                    window.open('training-curriculum.html', '_blank', 'width=1400,height=900');
                    console.log('Opening training curriculum');
                });
            }
        })();
        // ===== END HELP/TRAINING FUNCTIONALITY =====

        // ===== SIDEBAR TOGGLE FUNCTIONALITY =====
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const toggleBtn = document.getElementById('sidebarToggle');
            const icon = toggleBtn.querySelector('i');
            const isCollapsed = sidebar.classList.contains('collapsed');

            if (isCollapsed) {
                sidebar.classList.remove('collapsed');
                toggleBtn.classList.add('sidebar-open');
                icon.className = 'fas fa-chevron-left';
            } else {
                sidebar.classList.add('collapsed');
                toggleBtn.classList.remove('sidebar-open');
                icon.className = 'fas fa-chevron-right';
            }
        }

        // Add click listener to toggle button
        document.addEventListener('DOMContentLoaded', function() {
            const toggleBtn = document.getElementById('sidebarToggle');
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleSidebar);
            }
        });
        // ===== END SIDEBAR TOGGLE FUNCTIONALITY =====
    </script>

    <!-- API Configuration -->
    <script src="config.js"></script>

    <!-- Authentication Module -->
    <script src="auth.js"></script>

    <!-- CRM Module -->
    <script src="crm.js"></script>

    <!-- Grants Module -->
    <script src="grants.js"></script>

    <!-- Dashboard Module -->
    <script src="dashboard.js"></script>

    <!-- Permits Module -->
    <script src="permits.js"></script>

    <!-- Documents Module -->
    <script src="documents.js"></script>

    <!-- Workflows Module -->
    <script src="workflows.js"></script>

    <!-- Inspections Module -->
    <script src="inspections.js"></script>

    <!-- Authentication Check -->
    <script>
        // Check authentication on page load
        if (!Auth.isLoggedIn()) {
            window.location.href = 'login.html';
        }

        // Display user info if logged in
        const user = Auth.getUser();
        if (user) {
            console.log('Logged in as:', user.email, '| Role:', user.role);
        }
    </script>
</body>
</html>