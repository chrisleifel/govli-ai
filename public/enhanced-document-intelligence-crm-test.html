<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Document Intelligence - CRM Integration - Govli AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Suppress Tailwind CDN production warning
        (function() {
            const originalWarn = console.warn;
            console.warn = function(...args) {
                if (args[0]?.includes?.('cdn.tailwindcss.com should not be used in production')) {
                    return;
                }
                originalWarn.apply(console, args);
            };
        })();
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .glass:hover {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .confidence-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.1);
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        .validation-item {
            transition: all 0.3s ease;
        }

        .validation-item:hover {
            transform: translateX(5px);
        }
    </style>
</head>
<body class="p-6">
    <!-- Added 2024-10-30: Enhanced Document Intelligence System for CRM -->
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-xl p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-white mb-2">
                        <i class="fas fa-brain mr-3"></i>Enhanced Document Intelligence
                    </h1>
                    <p class="text-white/70">Government-specific models with cross-document validation & CRM integration</p>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="badge bg-green-500/20 text-green-400">
                        <i class="fas fa-shield-alt mr-1"></i>CJIS Compliant
                    </span>
                    <span class="badge bg-blue-500/20 text-blue-400">
                        <i class="fas fa-certificate mr-1"></i>FedRAMP High
                    </span>
                    <span class="badge bg-purple-500/20 text-purple-400">
                        <i class="fas fa-lock mr-1"></i>FISMA Certified
                    </span>
                </div>
            </div>

            <!-- Enhanced Stats -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                <div class="glass rounded-lg p-4">
                    <div class="text-white/70 text-sm mb-1">Gov Documents Processed</div>
                    <div class="text-2xl font-bold text-white">127,493</div>
                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-arrow-up mr-1"></i>18% this month</div>
                </div>
                <div class="glass rounded-lg p-4">
                    <div class="text-white/70 text-sm mb-1">Classification Accuracy</div>
                    <div class="text-2xl font-bold text-white">98.9%</div>
                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-check mr-1"></i>Above 95% target</div>
                </div>
                <div class="glass rounded-lg p-4">
                    <div class="text-white/70 text-sm mb-1">Auto-Validated</div>
                    <div class="text-2xl font-bold text-white">85.2%</div>
                    <div class="text-blue-400 text-sm mt-1"><i class="fas fa-robot mr-1"></i>High confidence</div>
                </div>
                <div class="glass rounded-lg p-4">
                    <div class="text-white/70 text-sm mb-1">CRM Auto-Import</div>
                    <div class="text-2xl font-bold text-white">94.7%</div>
                    <div class="text-purple-400 text-sm mt-1"><i class="fas fa-link mr-1"></i>Synced</div>
                </div>
                <div class="glass rounded-lg p-4">
                    <div class="text-white/70 text-sm mb-1">Avg Processing Time</div>
                    <div class="text-2xl font-bold text-white">1.8s</div>
                    <div class="text-green-400 text-sm mt-1"><i class="fas fa-bolt mr-1"></i>Fast</div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Upload & Document Processing -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Document Model Selector -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-layer-group mr-2"></i>Government Document Models
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="selectModel('permits')" id="model-permits" class="glass rounded-lg p-4 text-left hover:bg-blue-500/20 transition model-btn">
                            <i class="fas fa-file-contract text-2xl text-blue-400 mb-2"></i>
                            <div class="text-white font-semibold">Building Permits</div>
                            <div class="text-white/60 text-sm mt-1">Residential, Commercial, Electrical</div>
                        </button>
                        <button onclick="selectModel('licenses')" id="model-licenses" class="glass rounded-lg p-4 text-left hover:bg-green-500/20 transition model-btn">
                            <i class="fas fa-id-card text-2xl text-green-400 mb-2"></i>
                            <div class="text-white font-semibold">Licenses</div>
                            <div class="text-white/60 text-sm mt-1">Business, Professional, Driver</div>
                        </button>
                        <button onclick="selectModel('tax-forms')" id="model-tax-forms" class="glass rounded-lg p-4 text-left hover:bg-yellow-500/20 transition model-btn">
                            <i class="fas fa-file-invoice-dollar text-2xl text-yellow-400 mb-2"></i>
                            <div class="text-white font-semibold">Tax Forms</div>
                            <div class="text-white/60 text-sm mt-1">W-2, 1099, Property Tax</div>
                        </button>
                        <button onclick="selectModel('legal')" id="model-legal" class="glass rounded-lg p-4 text-left hover:bg-purple-500/20 transition model-btn">
                            <i class="fas fa-gavel text-2xl text-purple-400 mb-2"></i>
                            <div class="text-white font-semibold">Legal Documents</div>
                            <div class="text-white/60 text-sm mt-1">Contracts, Deeds, Judgments</div>
                        </button>
                        <button onclick="selectModel('compliance')" id="model-compliance" class="glass rounded-lg p-4 text-left hover:bg-red-500/20 transition model-btn">
                            <i class="fas fa-clipboard-check text-2xl text-red-400 mb-2"></i>
                            <div class="text-white font-semibold">Compliance Forms</div>
                            <div class="text-white/60 text-sm mt-1">EPA, OSHA, FDA Reports</div>
                        </button>
                        <button onclick="selectModel('identity')" id="model-identity" class="glass rounded-lg p-4 text-left hover:bg-pink-500/20 transition model-btn">
                            <i class="fas fa-user-shield text-2xl text-pink-400 mb-2"></i>
                            <div class="text-white font-semibold">Identity Docs</div>
                            <div class="text-white/60 text-sm mt-1">Passports, SSN, Birth Certs</div>
                        </button>
                    </div>
                    <div id="selectedModel" class="mt-4 text-white/70 text-sm">
                        <i class="fas fa-info-circle mr-2"></i>Select a document model to begin processing
                    </div>
                </div>

                <!-- Document Upload & Processing -->
                <div class="glass rounded-xl p-6" id="uploadSection">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-cloud-upload-alt mr-2"></i>Upload Documents
                    </h2>
                    <div class="space-y-4">
                        <!-- Upload Zone -->
                        <div class="glass rounded-lg p-8 text-center border-2 border-dashed border-white/30 hover:border-blue-400 transition cursor-pointer" id="uploadZone">
                            <i class="fas fa-file-upload text-5xl text-white/40 mb-3"></i>
                            <p class="text-white mb-2">Drop government documents here or click to browse</p>
                            <p class="text-white/60 text-sm">Supports PDF, PNG, JPG, TIFF up to 50MB</p>
                            <input type="file" id="fileInput" class="hidden" accept=".pdf,.png,.jpg,.jpeg,.tiff" multiple />
                        </div>

                        <!-- Sample Documents -->
                        <div class="flex flex-wrap gap-2">
                            <button onclick="loadSampleDocument('commercial-permit')" class="glass px-3 py-2 rounded-lg text-white text-sm hover:bg-white/20 transition">
                                <i class="fas fa-building mr-1"></i>Sample: Commercial Permit
                            </button>
                            <button onclick="loadSampleDocument('business-license')" class="glass px-3 py-2 rounded-lg text-white text-sm hover:bg-white/20 transition">
                                <i class="fas fa-store mr-1"></i>Sample: Business License
                            </button>
                            <button onclick="loadSampleDocument('w2-form')" class="glass px-3 py-2 rounded-lg text-white text-sm hover:bg-white/20 transition">
                                <i class="fas fa-file-invoice mr-1"></i>Sample: W-2 Form
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Processing Results -->
                <div class="glass rounded-xl p-6 hidden" id="resultsSection">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-chart-line mr-2"></i>Document Analysis Results
                    </h2>

                    <!-- Confidence Routing Display -->
                    <div class="glass rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-white font-semibold">Confidence Score</span>
                            <span class="text-2xl font-bold text-white" id="confidenceScore">--</span>
                        </div>
                        <div class="confidence-bar mb-2">
                            <div class="confidence-fill" id="confidenceBar"></div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <span class="text-red-400">← Manual Review (0-70%)</span>
                            <span class="text-yellow-400">Human Validation (70-85%)</span>
                            <span class="text-green-400">Auto-Approved (85-100%) →</span>
                        </div>
                    </div>

                    <!-- Routing Decision -->
                    <div class="glass rounded-lg p-4 mb-4" id="routingDecision">
                        <!-- Populated dynamically -->
                    </div>

                    <!-- Extracted Data -->
                    <div class="space-y-3" id="extractedData">
                        <!-- Populated dynamically -->
                    </div>
                </div>
            </div>

            <!-- Right Column: Validation & CRM Integration -->
            <div class="space-y-6">
                <!-- Cross-Document Validation -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-check-double mr-2"></i>Cross-Document Validation
                    </h2>
                    <div class="space-y-3" id="crossValidation">
                        <div class="glass rounded-lg p-3 text-white/60 text-sm text-center">
                            Upload a document to see validation results
                        </div>
                    </div>
                </div>

                <!-- Regulatory Compliance -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-balance-scale mr-2"></i>Regulatory Compliance
                    </h2>
                    <div class="space-y-3" id="complianceChecks">
                        <div class="glass rounded-lg p-3 text-white/60 text-sm text-center">
                            Compliance checks will appear here
                        </div>
                    </div>
                </div>

                <!-- CRM Integration -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-link mr-2"></i>CRM Integration
                    </h2>
                    <div class="space-y-3" id="crmIntegration">
                        <div class="glass rounded-lg p-3 text-white/60 text-sm text-center">
                            CRM matching will appear here
                        </div>
                    </div>
                    <button onclick="syncToCRM()" id="syncCrmBtn" class="w-full mt-4 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-4 py-3 rounded-lg transition hidden">
                        <i class="fas fa-sync-alt mr-2"></i>Sync to CRM
                    </button>
                </div>

                <!-- Processing History -->
                <div class="glass rounded-xl p-6">
                    <h2 class="text-xl font-bold text-white mb-4">
                        <i class="fas fa-history mr-2"></i>Recent Processing
                    </h2>
                    <div class="space-y-2" id="processingHistory">
                        <div class="glass rounded-lg p-3">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-white/80">Commercial Permit #3847</span>
                                <span class="badge bg-green-500/20 text-green-400">Auto ✓</span>
                            </div>
                            <div class="text-white/60 text-xs mt-1">2 minutes ago • 98.2%</div>
                        </div>
                        <div class="glass rounded-lg p-3">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-white/80">Business License #9201</span>
                                <span class="badge bg-yellow-500/20 text-yellow-400">Review</span>
                            </div>
                            <div class="text-white/60 text-xs mt-1">15 minutes ago • 78.5%</div>
                        </div>
                        <div class="glass rounded-lg p-3">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-white/80">EPA Compliance Form</span>
                                <span class="badge bg-green-500/20 text-green-400">Auto ✓</span>
                            </div>
                            <div class="text-white/60 text-xs mt-1">1 hour ago • 96.8%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // MOCK DATA - Replace in production
        // TODO: Connect to enhanced AI document intelligence API endpoint
        // Added 2024-10-30: Enhanced document intelligence with government-specific models

        let selectedDocModel = null;
        let currentDocument = null;

        // Government-specific document models
        const DOCUMENT_MODELS = {
            permits: {
                name: 'Building Permits',
                types: ['Residential', 'Commercial', 'Electrical', 'Plumbing', 'Mechanical'],
                validation_rules: ['contractor_license', 'zoning_compliance', 'insurance_verification']
            },
            licenses: {
                name: 'Business Licenses',
                types: ['Business License', 'Professional License', 'Liquor License', 'Food Service'],
                validation_rules: ['business_registration', 'tax_id', 'owner_background_check']
            },
            'tax-forms': {
                name: 'Tax Forms',
                types: ['W-2', '1099', 'W-9', 'Property Tax Assessment'],
                validation_rules: ['ssn_validation', 'ein_verification', 'calculation_check']
            },
            legal: {
                name: 'Legal Documents',
                types: ['Property Deed', 'Contract', 'Court Judgment', 'Affidavit'],
                validation_rules: ['signature_verification', 'notary_check', 'jurisdictional_validity']
            },
            compliance: {
                name: 'Compliance Reports',
                types: ['EPA Report', 'OSHA Inspection', 'FDA Compliance', 'Safety Audit'],
                validation_rules: ['regulatory_standards', 'inspector_credentials', 'date_validity']
            },
            identity: {
                name: 'Identity Documents',
                types: ['Passport', 'Driver License', 'Birth Certificate', 'SSN Card'],
                validation_rules: ['document_authenticity', 'photo_match', 'expiration_check']
            }
        };

        // Sample documents with enhanced metadata
        const SAMPLE_DOCUMENTS = {
            'commercial-permit': {
                type: 'Commercial Building Permit',
                model: 'permits',
                confidence: 96.8,
                routing: 'auto-approved',
                fields: {
                    'Permit Number': 'COM-2024-04721',
                    'Business Name': 'Springfield Tech Hub',
                    'Property Address': '2847 Innovation Drive, Springfield, IL 62701',
                    'Building Type': 'Office Complex',
                    'Total Area': '45,000 sq ft',
                    'Estimated Cost': '$12,500,000',
                    'Contractor License': 'IL-CONT-94736',
                    'Applicant Name': 'Marcus Chen',
                    'Applicant Email': 'mchen@springfieldtech.com',
                    'Applicant Phone': '(217) 555-0184'
                },
                validation: {
                    contractor_license: { status: 'valid', details: 'License IL-CONT-94736 verified with Illinois Department of Financial and Professional Regulation' },
                    zoning_compliance: { status: 'valid', details: 'Property zoned C-3 (Commercial) - matches intended use' },
                    insurance_verification: { status: 'valid', details: 'General liability insurance verified - $5M coverage' }
                },
                compliance: [
                    { regulation: 'International Building Code (IBC) 2021', status: 'compliant', icon: 'check' },
                    { regulation: 'Americans with Disabilities Act (ADA)', status: 'compliant', icon: 'check' },
                    { regulation: 'Fire Safety Code NFPA 101', status: 'compliant', icon: 'check' },
                    { regulation: 'Energy Code ASHRAE 90.1', status: 'review-needed', icon: 'exclamation' }
                ],
                crm_match: {
                    found: true,
                    contact: {
                        name: 'Marcus Chen',
                        company: 'Springfield Tech Hub',
                        email: 'mchen@springfieldtech.com',
                        phone: '(217) 555-0184',
                        existing_records: 3
                    },
                    action: 'update-existing'
                }
            },
            'business-license': {
                type: 'Business License Application',
                model: 'licenses',
                confidence: 78.3,
                routing: 'human-validation',
                fields: {
                    'License Type': 'General Business License',
                    'Business Name': 'Green Valley Organics',
                    'DBA Name': 'GV Organics',
                    'Business Address': '4521 Main Street, Springfield, IL 62704',
                    'Owner Name': 'Jennifer Martinez',
                    'EIN': '47-2839471',
                    'Business Type': 'LLC',
                    'Owner Email': 'jmartinez@gvorganics.com',
                    'Owner Phone': '(217) 555-0293'
                },
                validation: {
                    business_registration: { status: 'pending', details: 'Illinois Secretary of State registration pending verification' },
                    tax_id: { status: 'valid', details: 'EIN 47-2839471 verified with IRS' },
                    owner_background_check: { status: 'in-progress', details: 'Background check initiated - results pending (2-3 business days)' }
                },
                compliance: [
                    { regulation: 'Illinois Business Corporation Act', status: 'compliant', icon: 'check' },
                    { regulation: 'Local Zoning Ordinance', status: 'pending-review', icon: 'clock' },
                    { regulation: 'Health Department Requirements', status: 'compliant', icon: 'check' }
                ],
                crm_match: {
                    found: false,
                    suggested_action: 'create-new',
                    contact: {
                        name: 'Jennifer Martinez',
                        company: 'Green Valley Organics',
                        email: 'jmartinez@gvorganics.com',
                        phone: '(217) 555-0293'
                    }
                }
            },
            'w2-form': {
                type: 'W-2 Wage and Tax Statement',
                model: 'tax-forms',
                confidence: 99.4,
                routing: 'auto-approved',
                fields: {
                    'Employer Name': 'Springfield County Government',
                    'Employer EIN': '37-1847362',
                    'Employee Name': 'Robert Williams',
                    'Employee SSN': 'XXX-XX-4729',
                    'Wages': '$68,450.00',
                    'Federal Tax Withheld': '$9,183.75',
                    'State Tax Withheld': '$3,422.50',
                    'Tax Year': '2024'
                },
                validation: {
                    ssn_validation: { status: 'valid', details: 'SSN format validated and verified' },
                    ein_verification: { status: 'valid', details: 'Employer EIN verified with IRS database' },
                    calculation_check: { status: 'valid', details: 'Tax calculations verified - all amounts accurate' }
                },
                compliance: [
                    { regulation: 'IRS Publication 15 (Employer Tax Guide)', status: 'compliant', icon: 'check' },
                    { regulation: 'Social Security Administration Reporting', status: 'compliant', icon: 'check' },
                    { regulation: 'State Tax Withholding Requirements', status: 'compliant', icon: 'check' }
                ],
                crm_match: {
                    found: true,
                    contact: {
                        name: 'Robert Williams',
                        company: 'Springfield County Government',
                        existing_records: 1
                    },
                    action: 'link-to-existing'
                }
            }
        };

        // Model selection
        function selectModel(model) {
            selectedDocModel = model;

            // Update UI
            document.querySelectorAll('.model-btn').forEach(btn => {
                btn.classList.remove('ring-2', 'ring-blue-400', 'pulse-ring');
            });
            document.getElementById(`model-${model}`).classList.add('ring-2', 'ring-blue-400', 'pulse-ring');

            const modelData = DOCUMENT_MODELS[model];
            document.getElementById('selectedModel').innerHTML = `
                <i class="fas fa-check-circle text-green-400 mr-2"></i>
                <strong>${modelData.name}</strong> model selected - Ready to process: ${modelData.types.join(', ')}
            `;
        }

        // Upload zone handlers
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = '#3b82f6';
            uploadZone.style.background = 'rgba(59, 130, 246, 0.1)';
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            uploadZone.style.background = '';
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            uploadZone.style.background = '';

            if (!selectedDocModel) {
                showNotification('Please select a document model first', 'warning');
                return;
            }

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processDocument(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (!selectedDocModel) {
                showNotification('Please select a document model first', 'warning');
                fileInput.value = '';
                return;
            }

            if (e.target.files.length > 0) {
                processDocument(e.target.files[0]);
            }
        });

        // Load sample document
        function loadSampleDocument(type) {
            if (!selectedDocModel) {
                showNotification('Please select a document model first', 'warning');
                return;
            }

            currentDocument = SAMPLE_DOCUMENTS[type];
            displayResults(currentDocument);
        }

        // Process document (real upload)
        function processDocument(file) {
            // TODO: Connect to actual enhanced document intelligence API
            console.log('Processing file with model:', selectedDocModel, file.name);

            showNotification('Processing document with AI model...', 'info');

            // Simulate processing delay
            setTimeout(() => {
                // Use first sample document as example
                currentDocument = SAMPLE_DOCUMENTS['commercial-permit'];
                displayResults(currentDocument);
                showNotification('Document processed successfully', 'success');
            }, 2500);
        }

        // Display processing results
        function displayResults(doc) {
            // Show results section
            document.getElementById('resultsSection').classList.remove('hidden');

            // Confidence score and routing
            const confidence = doc.confidence;
            let routingColor, routingText, routingIcon;

            if (confidence >= 85) {
                routingColor = 'green';
                routingText = 'Auto-Approved';
                routingIcon = 'check-circle';
            } else if (confidence >= 70) {
                routingColor = 'yellow';
                routingText = 'Human Validation Required';
                routingIcon = 'user-check';
            } else {
                routingColor = 'red';
                routingText = 'Manual Review Required';
                routingIcon = 'exclamation-triangle';
            }

            document.getElementById('confidenceScore').textContent = confidence.toFixed(1) + '%';
            document.getElementById('confidenceBar').className = `confidence-fill bg-${routingColor}-500`;
            document.getElementById('confidenceBar').style.width = confidence + '%';

            document.getElementById('routingDecision').innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-${routingIcon} text-${routingColor}-400 text-2xl mr-3"></i>
                        <div>
                            <div class="text-white font-semibold">${routingText}</div>
                            <div class="text-white/60 text-sm">Confidence threshold: ${confidence >= 85 ? '≥85%' : confidence >= 70 ? '70-85%' : '<70%'}</div>
                        </div>
                    </div>
                    <span class="badge bg-${routingColor}-500/20 text-${routingColor}-400">${doc.type}</span>
                </div>
            `;

            // Extracted fields
            const fieldsHTML = Object.entries(doc.fields).map(([key, value]) => `
                <div class="glass rounded-lg p-3">
                    <div class="text-white/70 text-sm">${key}</div>
                    <div class="text-white font-semibold">${value}</div>
                </div>
            `).join('');

            document.getElementById('extractedData').innerHTML = fieldsHTML;

            // Cross-document validation
            const validationHTML = Object.entries(doc.validation).map(([key, val]) => {
                const statusColor = val.status === 'valid' ? 'green' : val.status === 'pending' ? 'yellow' : 'blue';
                const statusIcon = val.status === 'valid' ? 'check-circle' : val.status === 'pending' ? 'clock' : 'spinner fa-spin';

                return `
                    <div class="validation-item glass rounded-lg p-3">
                        <div class="flex items-start">
                            <i class="fas fa-${statusIcon} text-${statusColor}-400 mr-3 mt-1"></i>
                            <div class="flex-1">
                                <div class="text-white font-semibold text-sm mb-1">${key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
                                <div class="text-white/70 text-xs">${val.details}</div>
                                <div class="mt-2">
                                    <span class="badge bg-${statusColor}-500/20 text-${statusColor}-400">${val.status}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('crossValidation').innerHTML = validationHTML;

            // Regulatory compliance
            const complianceHTML = doc.compliance.map(comp => {
                const statusColor = comp.status === 'compliant' ? 'green' : comp.status === 'review-needed' ? 'yellow' : 'blue';
                const statusIcon = comp.icon === 'check' ? 'check-circle' : comp.icon === 'exclamation' ? 'exclamation-triangle' : 'clock';

                return `
                    <div class="glass rounded-lg p-3 flex items-center justify-between">
                        <div class="flex items-center flex-1">
                            <i class="fas fa-${statusIcon} text-${statusColor}-400 mr-3"></i>
                            <span class="text-white text-sm">${comp.regulation}</span>
                        </div>
                        <span class="badge bg-${statusColor}-500/20 text-${statusColor}-400 text-xs ml-2">${comp.status}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('complianceChecks').innerHTML = complianceHTML;

            // CRM Integration
            if (doc.crm_match.found) {
                const contact = doc.crm_match.contact;
                document.getElementById('crmIntegration').innerHTML = `
                    <div class="glass rounded-lg p-3 bg-blue-500/10">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-user-check text-blue-400 text-xl mr-3"></i>
                            <div class="flex-1">
                                <div class="text-white font-semibold">${contact.name}</div>
                                <div class="text-white/70 text-sm">${contact.company}</div>
                            </div>
                        </div>
                        ${contact.email ? `<div class="text-white/70 text-sm"><i class="fas fa-envelope mr-2"></i>${contact.email}</div>` : ''}
                        ${contact.phone ? `<div class="text-white/70 text-sm mt-1"><i class="fas fa-phone mr-2"></i>${contact.phone}</div>` : ''}
                        <div class="mt-3 pt-3 border-t border-white/10">
                            <div class="badge bg-green-500/20 text-green-400">
                                <i class="fas fa-link mr-1"></i>Match Found • ${contact.existing_records || 0} existing records
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('syncCrmBtn').classList.remove('hidden');
            } else {
                const contact = doc.crm_match.contact;
                document.getElementById('crmIntegration').innerHTML = `
                    <div class="glass rounded-lg p-3 bg-yellow-500/10">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-user-plus text-yellow-400 text-xl mr-3"></i>
                            <div class="flex-1">
                                <div class="text-white font-semibold">New Contact</div>
                                <div class="text-white/70 text-sm">${contact.name}</div>
                            </div>
                        </div>
                        <div class="text-white/70 text-sm">${contact.company}</div>
                        ${contact.email ? `<div class="text-white/70 text-sm mt-1"><i class="fas fa-envelope mr-2"></i>${contact.email}</div>` : ''}
                        ${contact.phone ? `<div class="text-white/70 text-sm mt-1"><i class="fas fa-phone mr-2"></i>${contact.phone}</div>` : ''}
                        <div class="mt-3 pt-3 border-t border-white/10">
                            <div class="badge bg-yellow-500/20 text-yellow-400">
                                <i class="fas fa-plus mr-1"></i>Create New CRM Record
                            </div>
                        </div>
                    </div>
                `;
                document.getElementById('syncCrmBtn').classList.remove('hidden');
            }

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Sync to CRM
        function syncToCRM() {
            if (!currentDocument) return;

            // TODO: Connect to CRM API endpoint for data synchronization
            // SECURITY TODO: Validate all data before syncing to CRM

            showNotification('Syncing document data to CRM...', 'info');

            setTimeout(() => {
                showNotification('Data successfully synced to CRM', 'success');

                // Update CRM integration display
                if (currentDocument.crm_match.found) {
                    document.getElementById('crmIntegration').innerHTML += `
                        <div class="mt-3 glass rounded-lg p-3 bg-green-500/10">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                <span class="text-white text-sm">Successfully synced at ${new Date().toLocaleTimeString()}</span>
                            </div>
                        </div>
                    `;
                }
            }, 1500);
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const colors = {
                success: 'green',
                error: 'red',
                warning: 'yellow',
                info: 'blue'
            };
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };

            const color = colors[type] || 'blue';
            const icon = icons[type] || 'info-circle';

            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 glass rounded-lg p-4 text-white bg-${color}-500/20 border-${color}-400 z-50 max-w-md`;
            notification.style.animation = 'slideIn 0.3s ease';
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${icon} mr-3 text-${color}-400"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl+U to focus upload
            if (e.ctrlKey && e.key === 'u') {
                e.preventDefault();
                fileInput.click();
            }
        });

        // Auto-select first model on load (for demo)
        window.addEventListener('load', () => {
            // Don't auto-select, let user choose
        });
    </script>

    <!-- Animation styles -->
    <style>
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
    </style>
</body>
</html>
