<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Submit FOIA Request - Govli AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'ocean-dark': '#0a1628',
            'ocean-blue': '#1e3a8a',
            'ocean-light': '#3b82f6'
          }
        }
      }
    }
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #0a1628 0%, #1e3a8a 100%);
      min-height: 100vh;
    }
    .glass {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    .glass-hover:hover {
      background: rgba(255, 255, 255, 0.08);
    }
    .file-upload-area {
      border: 2px dashed rgba(59, 130, 246, 0.5);
      transition: all 0.3s ease;
    }
    .file-upload-area.dragover {
      border-color: #3b82f6;
      background: rgba(59, 130, 246, 0.1);
    }
    .ai-suggestion {
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }
    .ai-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
    }
  </style>
</head>
<body class="text-white">
  <!-- Header -->
  <header class="glass border-b border-white/10">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
          <h1 class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
            Govli AI
          </h1>
          <span class="text-gray-400">|</span>
          <span class="text-gray-300">Freedom of Information Act Request</span>
          <span class="ai-badge text-xs px-3 py-1 rounded-full text-white font-semibold">
            ‚ú® AI-Powered
          </span>
        </div>
        <div class="flex items-center space-x-4">
          <a href="foia-track.html" class="glass glass-hover px-4 py-2 rounded-lg text-sm">
            Track Request
          </a>
          <a href="index.html" class="text-gray-400 hover:text-white text-sm">
            Back to Home
          </a>
        </div>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-6 py-12 max-w-4xl">
    <!-- Info Banner -->
    <div class="glass rounded-lg p-6 mb-8 border-l-4 border-cyan-400">
      <div class="flex items-start space-x-4">
        <svg class="w-6 h-6 text-cyan-400 flex-shrink-0 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <div>
          <h3 class="font-semibold text-lg mb-2">What is a FOIA Request?</h3>
          <p class="text-gray-300 text-sm leading-relaxed">
            The Freedom of Information Act (FOIA) gives you the right to request access to federal agency records.
            This includes documents, emails, reports, and other materials. Agencies must respond within 20 business days.
          </p>
        </div>
      </div>
    </div>

    <!-- Main Form -->
    <div class="glass rounded-lg p-8">
      <h2 class="text-3xl font-bold mb-2">Submit a FOIA Request</h2>
      <p class="text-gray-400 mb-8">All fields marked with * are required</p>

      <form id="foiaForm" class="space-y-6">
        <!-- Personal Information Section -->
        <div class="glass rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            Your Information
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-2">Full Name *</label>
              <input type="text" id="requesterName" required
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Email Address *</label>
              <input type="email" id="requesterEmail" required
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Phone Number</label>
              <input type="tel" id="requesterPhone"
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition"
                placeholder="(555) 123-4567">
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Organization (if applicable)</label>
              <input type="text" id="requesterOrganization"
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
            </div>
          </div>

          <div class="mt-4">
            <label class="block text-sm font-medium mb-2">Requester Type *</label>
            <select id="requesterType" required
              class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
              <option value="">Select your type</option>
              <option value="citizen">Individual/Citizen</option>
              <option value="media">News Media</option>
              <option value="educational">Educational Institution</option>
              <option value="commercial">Commercial Entity</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="mt-4">
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" id="isAnonymous" class="w-4 h-4 rounded border-white/10 bg-white/5 focus:ring-cyan-400">
              <span class="text-sm">Submit this request anonymously</span>
            </label>
          </div>
        </div>

        <!-- Request Details Section -->
        <div class="glass rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            Request Details
          </h3>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-2 flex items-center justify-between">
                <span>Request Type *</span>
                <span id="aiClassificationBadge" class="hidden text-xs px-2 py-1 bg-purple-500/20 border border-purple-500/30 rounded-full text-purple-300">
                  <span class="pulse inline-block w-2 h-2 bg-purple-400 rounded-full mr-1"></span>
                  AI Suggested
                </span>
              </label>
              <select id="requestType" required
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
                <option value="">Select request type</option>
                <option value="general">General Information</option>
                <option value="police_report">Police Report</option>
                <option value="building_permit">Building Permit</option>
                <option value="personnel">Personnel Records</option>
                <option value="contracts">Contracts</option>
                <option value="meetings">Meeting Minutes/Records</option>
                <option value="financial">Financial Records</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Subject/Title *</label>
              <input type="text" id="subject" required
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition"
                placeholder="Brief summary of what you're requesting">
            </div>

            <div>
              <label class="block text-sm font-medium mb-2 flex items-center justify-between">
                <span>Detailed Description *</span>
                <button type="button" id="improveDescriptionBtn"
                  class="text-xs px-3 py-1 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full hover:from-purple-600 hover:to-pink-600 transition font-medium">
                  ‚ú® AI Improve
                </button>
              </label>
              <textarea id="description" required rows="6"
                class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition resize-none"
                placeholder="Please provide specific details about the records you are requesting. Include dates, names, subjects, or any other information that will help us locate the records."></textarea>
              <p class="text-xs text-gray-400 mt-1">Be as specific as possible to help us process your request faster</p>

              <!-- AI Suggestions Panel -->
              <div id="aiSuggestionsPanel" class="hidden mt-3 glass rounded-lg p-4 border-l-4 border-purple-500 ai-suggestion">
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-purple-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                  </svg>
                  <div class="flex-1">
                    <h4 class="font-semibold text-sm mb-2 text-purple-300">AI Suggestions</h4>
                    <div id="aiSuggestionContent" class="text-sm text-gray-300 mb-3 leading-relaxed"></div>
                    <div class="flex items-center justify-between">
                      <div class="flex items-center space-x-2">
                        <span class="text-xs text-gray-400">Confidence:</span>
                        <div class="w-32 h-2 bg-white/10 rounded-full overflow-hidden">
                          <div id="aiConfidenceBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500" style="width: 0%"></div>
                        </div>
                        <span id="aiConfidenceText" class="text-xs text-purple-300 font-semibold">0%</span>
                      </div>
                      <div class="flex space-x-2">
                        <button type="button" id="applyAISuggestion"
                          class="px-3 py-1 bg-purple-500 hover:bg-purple-600 rounded text-xs font-medium transition">
                          Apply
                        </button>
                        <button type="button" id="dismissAISuggestion"
                          class="px-3 py-1 glass glass-hover rounded text-xs transition">
                          Dismiss
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-2">Date Range Start</label>
                <input type="date" id="dateRangeStart"
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Date Range End</label>
                <input type="date" id="dateRangeEnd"
                  class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition">
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Preferred Format</label>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <label class="flex items-center space-x-2 cursor-pointer glass glass-hover p-3 rounded-lg">
                  <input type="radio" name="preferredFormat" value="electronic" checked class="text-cyan-400">
                  <span class="text-sm">Electronic</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer glass glass-hover p-3 rounded-lg">
                  <input type="radio" name="preferredFormat" value="paper" class="text-cyan-400">
                  <span class="text-sm">Paper</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer glass glass-hover p-3 rounded-lg">
                  <input type="radio" name="preferredFormat" value="cd" class="text-cyan-400">
                  <span class="text-sm">CD/DVD</span>
                </label>
                <label class="flex items-center space-x-2 cursor-pointer glass glass-hover p-3 rounded-lg">
                  <input type="radio" name="preferredFormat" value="any" class="text-cyan-400">
                  <span class="text-sm">Any Format</span>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Document Upload Section -->
        <div class="glass rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            Supporting Documents (Optional)
          </h3>

          <div id="dropZone" class="file-upload-area rounded-lg p-8 text-center cursor-pointer">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
            </svg>
            <p class="text-gray-300 mb-2">Drag and drop files here, or click to browse</p>
            <p class="text-sm text-gray-500">Supported formats: PDF, DOC, DOCX, JPG, PNG (Max 10MB per file)</p>
            <input type="file" id="fileInput" multiple class="hidden" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
          </div>

          <div id="fileList" class="mt-4 space-y-2"></div>

          <!-- AI Document Analysis Results -->
          <div id="aiDocumentAnalysis" class="hidden mt-4 glass rounded-lg p-4 border-l-4 border-yellow-500">
            <div class="flex items-start space-x-3">
              <svg class="w-5 h-5 text-yellow-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
              </svg>
              <div class="flex-1">
                <h4 class="font-semibold text-sm mb-2 text-yellow-300">‚ö†Ô∏è Potential PII Detected</h4>
                <div id="piiWarnings" class="text-sm text-gray-300 mb-2"></div>
                <p class="text-xs text-gray-400">These documents may contain personally identifiable information that will be redacted during processing.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Response Time Prediction -->
        <div id="aiResponseTime" class="hidden glass rounded-lg p-6 border-l-4 border-cyan-500">
          <div class="flex items-start space-x-3">
            <svg class="w-5 h-5 text-cyan-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div class="flex-1">
              <h4 class="font-semibold mb-2 text-cyan-300">üìä Estimated Response Time</h4>
              <div class="flex items-center space-x-4 mb-2">
                <div class="flex-1">
                  <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
                    <div id="complexityBar" class="h-full bg-gradient-to-r from-green-500 to-yellow-500" style="width: 0%"></div>
                  </div>
                </div>
                <span id="estimatedDays" class="text-lg font-bold text-cyan-300">-</span>
              </div>
              <div id="complexityFactors" class="text-sm text-gray-300"></div>
              <p class="text-xs text-gray-400 mt-2">This is an AI-generated estimate based on request complexity, document count, and historical data.</p>
            </div>
          </div>
        </div>

        <!-- Fee Information -->
        <div class="glass rounded-lg p-6 border-l-4 border-yellow-500">
          <h3 class="text-xl font-semibold mb-2 flex items-center">
            <svg class="w-5 h-5 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Fee Information
          </h3>
          <p class="text-gray-300 text-sm mb-4">
            Processing fees may apply based on the complexity of your request. You will be notified of any fees before processing begins.
          </p>

          <label class="flex items-center space-x-2 cursor-pointer">
            <input type="checkbox" id="feeWaiverRequested" class="w-4 h-4 rounded border-white/10 bg-white/5 focus:ring-cyan-400">
            <span class="text-sm">Request a fee waiver</span>
          </label>

          <div id="feeWaiverReason" class="mt-4 hidden">
            <label class="block text-sm font-medium mb-2">Reason for Fee Waiver Request</label>
            <textarea rows="3"
              class="w-full px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition resize-none"
              placeholder="Explain why you are requesting a fee waiver..."></textarea>
          </div>
        </div>

        <!-- Notification Preferences -->
        <div class="glass rounded-lg p-6">
          <h3 class="text-xl font-semibold mb-4 flex items-center">
            <svg class="w-5 h-5 mr-2 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
            </svg>
            Notification Preferences
          </h3>

          <div class="space-y-3">
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" id="notifyEmail" checked class="w-4 h-4 rounded border-white/10 bg-white/5 focus:ring-cyan-400">
              <span class="text-sm">Email notifications for status updates</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" id="notifySMS" class="w-4 h-4 rounded border-white/10 bg-white/5 focus:ring-cyan-400">
              <span class="text-sm">SMS notifications (requires phone number)</span>
            </label>
          </div>
        </div>

        <!-- Submit Section -->
        <div class="flex items-center justify-between pt-6 border-t border-white/10">
          <button type="button" onclick="window.location.href='index.html'"
            class="px-6 py-3 glass glass-hover rounded-lg font-medium">
            Cancel
          </button>

          <button type="submit"
            class="px-8 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg font-semibold hover:from-cyan-600 hover:to-blue-600 transition shadow-lg">
            Submit FOIA Request
          </button>
        </div>
      </form>
    </div>

    <!-- AI Chatbot Assistant -->
    <div id="aiChatbot" class="fixed bottom-6 right-6 z-40">
      <!-- Chat Toggle Button -->
      <button id="chatToggle" class="w-14 h-14 ai-badge rounded-full flex items-center justify-center text-white shadow-2xl hover:scale-110 transition-transform">
        <svg id="chatIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <span class="absolute -top-1 -right-1 w-3 h-3 bg-green-400 rounded-full pulse"></span>
      </button>

      <!-- Chat Window -->
      <div id="chatWindow" class="hidden absolute bottom-16 right-0 w-96 h-[500px] glass rounded-lg shadow-2xl border border-white/20 flex flex-col">
        <div class="p-4 border-b border-white/10 flex items-center justify-between">
          <div class="flex items-center space-x-2">
            <div class="w-3 h-3 bg-green-400 rounded-full pulse"></div>
            <h3 class="font-semibold">AI Assistant</h3>
          </div>
          <button id="closeChatBtn" class="text-gray-400 hover:text-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <div id="chatMessages" class="flex-1 overflow-y-auto p-4 space-y-3">
          <div class="flex items-start space-x-2">
            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center flex-shrink-0">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
              </svg>
            </div>
            <div class="flex-1 glass rounded-lg p-3 text-sm">
              <p>Hi! I'm your AI assistant. I can help you:</p>
              <ul class="mt-2 space-y-1 text-xs text-gray-300">
                <li>‚Ä¢ Write better request descriptions</li>
                <li>‚Ä¢ Choose the right request type</li>
                <li>‚Ä¢ Estimate processing time</li>
                <li>‚Ä¢ Answer FOIA questions</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="p-4 border-t border-white/10">
          <div class="flex space-x-2">
            <input type="text" id="chatInput" placeholder="Ask me anything..."
              class="flex-1 px-4 py-2 bg-white/5 border border-white/10 rounded-lg focus:outline-none focus:border-cyan-400 transition text-sm">
            <button id="sendChatBtn"
              class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg hover:from-purple-600 hover:to-pink-600 transition">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
              </svg>
            </button>
          </div>
          <div class="mt-2 flex flex-wrap gap-1">
            <button class="quick-question text-xs px-2 py-1 glass glass-hover rounded-full">What documents can I request?</button>
            <button class="quick-question text-xs px-2 py-1 glass glass-hover rounded-full">How long will it take?</button>
            <button class="quick-question text-xs px-2 py-1 glass glass-hover rounded-full">Improve my description</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4">
      <div class="glass rounded-lg p-8 max-w-md w-full">
        <div class="text-center">
          <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </div>
          <h3 class="text-2xl font-bold mb-2">Request Submitted!</h3>
          <p class="text-gray-300 mb-4">Your FOIA request has been successfully submitted.</p>
          <div class="glass rounded-lg p-4 mb-6">
            <p class="text-sm text-gray-400 mb-1">Tracking Number:</p>
            <p id="trackingNumber" class="text-xl font-mono font-bold text-cyan-400"></p>
          </div>
          <p class="text-sm text-gray-400 mb-6">
            You will receive a confirmation email shortly. We will respond to your request within 20 business days.
          </p>
          <div class="flex space-x-3">
            <button onclick="window.location.href='foia-track.html'"
              class="flex-1 px-4 py-2 glass glass-hover rounded-lg text-sm font-medium">
              Track Request
            </button>
            <button onclick="window.location.href='foia-request.html'"
              class="flex-1 px-4 py-2 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-lg text-sm font-semibold">
              Submit Another
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE_URL = 'http://localhost:3000';
    let uploadedFiles = [];

    // File Upload Handling
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const fileList = document.getElementById('fileList');

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropZone.classList.add('dragover');
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.classList.remove('dragover');
    });

    dropZone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropZone.classList.remove('dragover');
      handleFiles(e.dataTransfer.files);
    });

    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.size > 10 * 1024 * 1024) {
          alert(`File ${file.name} is too large. Maximum size is 10MB.`);
          return;
        }
        uploadedFiles.push(file);
        addFileToList(file);
      });
    }

    function addFileToList(file) {
      const fileItem = document.createElement('div');
      fileItem.className = 'glass rounded-lg p-3 flex items-center justify-between';
      fileItem.innerHTML = `
        <div class="flex items-center space-x-3">
          <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <div>
            <p class="text-sm font-medium">${file.name}</p>
            <p class="text-xs text-gray-400">${(file.size / 1024).toFixed(2)} KB</p>
          </div>
        </div>
        <button onclick="removeFile('${file.name}')" class="text-red-400 hover:text-red-300">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      `;
      fileList.appendChild(fileItem);
    }

    function removeFile(filename) {
      uploadedFiles = uploadedFiles.filter(f => f.name !== filename);
      const items = fileList.children;
      for (let item of items) {
        if (item.textContent.includes(filename)) {
          fileList.removeChild(item);
          break;
        }
      }
    }

    // Fee Waiver Toggle
    document.getElementById('feeWaiverRequested').addEventListener('change', (e) => {
      document.getElementById('feeWaiverReason').classList.toggle('hidden', !e.target.checked);
    });

    // Form Submission
    document.getElementById('foiaForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = {
        requesterName: document.getElementById('requesterName').value,
        requesterEmail: document.getElementById('requesterEmail').value,
        requesterPhone: document.getElementById('requesterPhone').value || null,
        requesterOrganization: document.getElementById('requesterOrganization').value || null,
        requesterType: document.getElementById('requesterType').value,
        isAnonymous: document.getElementById('isAnonymous').checked,
        requestType: document.getElementById('requestType').value,
        subject: document.getElementById('subject').value,
        description: document.getElementById('description').value,
        dateRangeStart: document.getElementById('dateRangeStart').value || null,
        dateRangeEnd: document.getElementById('dateRangeEnd').value || null,
        preferredFormat: document.querySelector('input[name="preferredFormat"]:checked').value,
        feeWaiverRequested: document.getElementById('feeWaiverRequested').checked,
        notificationPreferences: {
          email: document.getElementById('notifyEmail').checked,
          sms: document.getElementById('notifySMS').checked
        }
      };

      try {
        const response = await fetch(`${API_BASE_URL}/api/foia/requests`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (response.ok) {
          // Show success modal
          document.getElementById('trackingNumber').textContent = result.trackingNumber;
          document.getElementById('successModal').classList.remove('hidden');
        } else {
          alert('Error submitting request: ' + (result.message || 'Unknown error'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Failed to submit request. Please try again.');
      }
    });

    // Close modal on outside click
    document.getElementById('successModal').addEventListener('click', (e) => {
      if (e.target.id === 'successModal') {
        e.target.classList.add('hidden');
      }
    });

    // ========== AI FEATURES ==========

    // AI-Powered Description Improvement
    let aiSuggestedText = '';

    document.getElementById('improveDescriptionBtn').addEventListener('click', async () => {
      const description = document.getElementById('description').value.trim();

      if (!description) {
        alert('Please enter a description first');
        return;
      }

      // Show loading state
      const btn = document.getElementById('improveDescriptionBtn');
      btn.innerHTML = '<span class="pulse">‚è≥ Analyzing...</span>';
      btn.disabled = true;

      // Simulate AI analysis (in production, this would call OpenAI or your backend)
      setTimeout(() => {
        const improved = improveDescriptionWithAI(description);
        aiSuggestedText = improved.text;

        document.getElementById('aiSuggestionContent').textContent = improved.text;
        document.getElementById('aiConfidenceBar').style.width = improved.confidence + '%';
        document.getElementById('aiConfidenceText').textContent = improved.confidence + '%';
        document.getElementById('aiSuggestionsPanel').classList.remove('hidden');

        btn.innerHTML = '‚ú® AI Improve';
        btn.disabled = false;

        // Trigger auto-classification
        autoClassifyRequestType(improved.text);
      }, 1500);
    });

    function improveDescriptionWithAI(text) {
      // AI-powered text improvement (keyword-based for demo, would use OpenAI in production)
      let improved = text;
      let confidence = 70;

      // Add specificity suggestions
      if (!text.match(/\d{4}/)) { // No year mentioned
        improved += ' Please include specific date range if applicable.';
        confidence += 5;
      }

      if (text.length < 50) {
        improved = 'I am requesting ' + text.toLowerCase() + '. This information is needed for [specify purpose]. ';
        improved += 'Please provide all relevant documents, correspondence, and records related to this matter.';
        confidence += 10;
      }

      // Improve clarity
      if (!text.includes('requesting')) {
        improved = 'I am formally requesting access to the following records: ' + improved;
        confidence += 5;
      }

      // Add context suggestions
      if (confidence < 85) {
        improved += ' I would appreciate receiving these records in electronic format if available.';
        confidence = Math.min(confidence + 10, 95);
      }

      return { text: improved, confidence };
    }

    document.getElementById('applyAISuggestion').addEventListener('click', () => {
      document.getElementById('description').value = aiSuggestedText;
      document.getElementById('aiSuggestionsPanel').classList.add('hidden');

      // Re-run auto-classification and time estimation
      autoClassifyRequestType(aiSuggestedText);
      calculateResponseTime();
    });

    document.getElementById('dismissAISuggestion').addEventListener('click', () => {
      document.getElementById('aiSuggestionsPanel').classList.add('hidden');
    });

    // Auto-Classification of Request Type
    function autoClassifyRequestType(description) {
      const lowerDesc = description.toLowerCase();
      let detectedType = '';
      let confidence = 0;

      const keywords = {
        'police_report': ['police', 'arrest', 'incident', 'crime', 'law enforcement', 'citation'],
        'building_permit': ['building', 'permit', 'construction', 'zoning', 'property', 'inspection'],
        'personnel': ['employee', 'personnel', 'staff', 'hiring', 'employment', 'hr', 'human resources'],
        'contracts': ['contract', 'vendor', 'procurement', 'purchase', 'bid', 'rfp'],
        'meetings': ['meeting', 'minutes', 'agenda', 'council', 'board', 'session'],
        'financial': ['budget', 'financial', 'spending', 'expense', 'revenue', 'audit', 'invoice']
      };

      for (const [type, words] of Object.entries(keywords)) {
        const matches = words.filter(word => lowerDesc.includes(word)).length;
        const typeConfidence = (matches / words.length) * 100;

        if (typeConfidence > confidence) {
          confidence = typeConfidence;
          detectedType = type;
        }
      }

      if (confidence >= 30) {
        document.getElementById('requestType').value = detectedType;
        document.getElementById('aiClassificationBadge').classList.remove('hidden');

        // Auto-hide badge after 5 seconds
        setTimeout(() => {
          document.getElementById('aiClassificationBadge').classList.add('hidden');
        }, 5000);
      }
    }

    // Auto-trigger classification when description changes
    let descriptionTimeout;
    document.getElementById('description').addEventListener('input', (e) => {
      clearTimeout(descriptionTimeout);
      descriptionTimeout = setTimeout(() => {
        if (e.target.value.length > 30) {
          autoClassifyRequestType(e.target.value);
          calculateResponseTime();
        }
      }, 1000); // Wait 1 second after user stops typing
    });

    // AI Response Time Prediction
    function calculateResponseTime() {
      const description = document.getElementById('description').value;
      const requestType = document.getElementById('requestType').value;
      const fileCount = uploadedFiles.length;
      const dateRange = document.getElementById('dateRangeStart').value && document.getElementById('dateRangeEnd').value;

      let baseDays = 10; // Base processing time
      let complexity = 0;
      let factors = [];

      // Analyze complexity
      if (description.length > 200) {
        baseDays += 3;
        complexity += 15;
        factors.push('Detailed request (+3 days)');
      }

      if (fileCount > 3) {
        baseDays += 2;
        complexity += 10;
        factors.push(`${fileCount} supporting documents (+2 days)`);
      }

      if (dateRange) {
        const start = new Date(document.getElementById('dateRangeStart').value);
        const end = new Date(document.getElementById('dateRangeEnd').value);
        const rangeYears = (end - start) / (1000 * 60 * 60 * 24 * 365);

        if (rangeYears > 2) {
          baseDays += 5;
          complexity += 20;
          factors.push('Wide date range (+5 days)');
        }
      }

      if (requestType === 'personnel' || requestType === 'financial') {
        baseDays += 4;
        complexity += 15;
        factors.push('Sensitive records requiring review (+4 days)');
      }

      // Complex keywords
      const complexKeywords = ['all', 'comprehensive', 'complete', 'entire', 'every'];
      if (complexKeywords.some(word => description.toLowerCase().includes(word))) {
        baseDays += 3;
        complexity += 10;
        factors.push('Broad scope request (+3 days)');
      }

      complexity = Math.min(complexity + 30, 100); // Add base complexity

      if (description.length > 20 || fileCount > 0 || requestType) {
        document.getElementById('aiResponseTime').classList.remove('hidden');
        document.getElementById('estimatedDays').textContent = baseDays + ' days';
        document.getElementById('complexityBar').style.width = complexity + '%';

        if (complexity < 40) {
          document.getElementById('complexityBar').className = 'h-full bg-green-500';
        } else if (complexity < 70) {
          document.getElementById('complexityBar').className = 'h-full bg-yellow-500';
        } else {
          document.getElementById('complexityBar').className = 'h-full bg-red-500';
        }

        document.getElementById('complexityFactors').innerHTML = factors.length > 0
          ? '<ul class="space-y-1">' + factors.map(f => '<li>‚Ä¢ ' + f + '</li>').join('') + '</ul>'
          : '<p>Standard processing timeline</p>';
      }
    }

    // Trigger response time calculation on form changes
    document.getElementById('requestType').addEventListener('change', calculateResponseTime);
    document.getElementById('dateRangeStart').addEventListener('change', calculateResponseTime);
    document.getElementById('dateRangeEnd').addEventListener('change', calculateResponseTime);

    // AI Document PII Pre-Analysis
    function analyzeDocumentForPII(file) {
      // In production, this would send the file to backend for analysis
      // For demo, we'll simulate based on filename and type

      const suspiciousPatterns = ['resume', 'application', 'personal', 'identity', 'ssn', 'medical'];
      const hasSuspiciousName = suspiciousPatterns.some(pattern =>
        file.name.toLowerCase().includes(pattern)
      );

      if (hasSuspiciousName || file.size > 5 * 1024 * 1024) { // Large files likely contain more data
        setTimeout(() => {
          const piiTypes = [];
          if (file.name.toLowerCase().includes('resume') || file.name.toLowerCase().includes('application')) {
            piiTypes.push('Names', 'Contact Information');
          }
          if (file.name.toLowerCase().includes('medical')) {
            piiTypes.push('Medical Records', 'SSN');
          }
          if (file.size > 5 * 1024 * 1024) {
            piiTypes.push('Potentially Sensitive Data');
          }

          if (piiTypes.length > 0) {
            document.getElementById('piiWarnings').innerHTML =
              '<p class="font-semibold mb-1">File: ' + file.name + '</p>' +
              '<ul class="text-xs space-y-1">' +
              piiTypes.map(type => '<li>‚Ä¢ Detected: ' + type + '</li>').join('') +
              '</ul>';
            document.getElementById('aiDocumentAnalysis').classList.remove('hidden');
          }
        }, 800);
      }
    }

    // Modify handleFiles to include PII analysis
    const originalHandleFiles = handleFiles;
    handleFiles = function(files) {
      originalHandleFiles(files);
      Array.from(files).forEach(file => {
        if (file.size <= 10 * 1024 * 1024) {
          analyzeDocumentForPII(file);
        }
      });
      calculateResponseTime();
    };

    // AI Chatbot Assistant
    const chatToggle = document.getElementById('chatToggle');
    const chatWindow = document.getElementById('chatWindow');
    const closeChatBtn = document.getElementById('closeChatBtn');
    const chatInput = document.getElementById('chatInput');
    const sendChatBtn = document.getElementById('sendChatBtn');
    const chatMessages = document.getElementById('chatMessages');

    chatToggle.addEventListener('click', () => {
      chatWindow.classList.toggle('hidden');
    });

    closeChatBtn.addEventListener('click', () => {
      chatWindow.classList.add('hidden');
    });

    function addChatMessage(text, isUser = false) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'flex items-start space-x-2' + (isUser ? ' justify-end' : '');

      if (!isUser) {
        messageDiv.innerHTML = `
          <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center flex-shrink-0">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"></path>
            </svg>
          </div>
          <div class="flex-1 glass rounded-lg p-3 text-sm">
            ${text}
          </div>
        `;
      } else {
        messageDiv.innerHTML = `
          <div class="glass rounded-lg p-3 text-sm bg-cyan-500/20">
            ${text}
          </div>
        `;
      }

      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function respondToChat(userMessage) {
      const lowerMessage = userMessage.toLowerCase();

      if (lowerMessage.includes('document') || lowerMessage.includes('what can i request')) {
        return 'You can request any federal agency records including: emails, reports, meeting minutes, contracts, financial records, and more. The FOIA law requires agencies to provide access unless the information falls under specific exemptions.';
      }

      if (lowerMessage.includes('long') || lowerMessage.includes('time') || lowerMessage.includes('take')) {
        return 'Agencies must respond within <strong>20 business days</strong>. However, complex requests may take longer. Our AI estimates your request will take approximately <strong>' + (document.getElementById('estimatedDays').textContent || '10-15 days') + '</strong> based on complexity.';
      }

      if (lowerMessage.includes('improve') || lowerMessage.includes('description') || lowerMessage.includes('better')) {
        document.getElementById('improveDescriptionBtn').click();
        return 'I\'ve triggered the AI description improvement tool for you! Check the suggestions that appear below the description field.';
      }

      if (lowerMessage.includes('fee') || lowerMessage.includes('cost')) {
        return 'Fees vary by requester type. News media and educational institutions often get fee waivers. You can request a fee waiver when submitting your request. Most simple requests have minimal or no fees.';
      }

      if (lowerMessage.includes('denied') || lowerMessage.includes('reject')) {
        return 'If your request is denied, you have the right to appeal. The agency must provide the specific exemption used. You can also file a lawsuit in federal court if the appeal is unsuccessful.';
      }

      return 'I can help you with writing better descriptions, choosing request types, or answering FOIA questions. Try asking: "How long will my request take?" or "What documents can I request?"';
    }

    function sendMessage() {
      const message = chatInput.value.trim();
      if (!message) return;

      addChatMessage(message, true);
      chatInput.value = '';

      // Simulate AI thinking
      setTimeout(() => {
        const response = respondToChat(message);
        addChatMessage(response, false);
      }, 800);
    }

    sendChatBtn.addEventListener('click', sendMessage);
    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Quick question buttons
    document.querySelectorAll('.quick-question').forEach(btn => {
      btn.addEventListener('click', () => {
        chatInput.value = btn.textContent;
        sendMessage();
      });
    });

  </script>
</body>
</html>
